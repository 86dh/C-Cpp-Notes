<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-06-04 Fri 15:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CPP / C++ - CMake Building System</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="cpp/c++ cmake building system productivity devops survival"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="theme/org-nav-theme.css" rel="stylesheet">
<script src="theme/org-nav-theme.js"></script>
<link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "%LINEBREAKS" },
                        webFont: "%FONT"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "%LINEBREAKS" },
              font: "%FONT"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "%AUTONUMBER"},
               MultLineWidth: "%MULTLINEWIDTH",
               TagSide: "%TAGSIDE",
               TagIndent: "%TAGINDENT"
             }
});
</script>
<script type="text/javascript"
        src="theme/MathJax/MathJax.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">CPP / C++ - CMake Building System</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf7fd60d">1. CMake Building System</a>
<ul>
<li><a href="#org685e848">1.1. Overview</a></li>
<li><a href="#orga36d1d7">1.2. Cmake Videos</a></li>
<li><a href="#org58e186c">1.3. Notable Projects Using CMake</a></li>
<li><a href="#org84375b5">1.4. IDE with CMake support</a>
<ul>
<li><a href="#orge65ad58">1.4.1. Overview</a></li>
<li><a href="#org262df4d">1.4.2. Lightweight IDE - Integrated Development Environments</a></li>
<li><a href="#org51ff943">1.4.3. Full-fledge IDE - Integrated Development Environments</a></li>
</ul>
</li>
<li><a href="#org1fdb2ff">1.5. Minimal CMake Project Workflow</a></li>
<li><a href="#orgaaadd2f">1.6. Build a project from command line - detailed</a></li>
<li><a href="#org5a3fac7">1.7. Sample Project with multiple targets</a>
<ul>
<li><a href="#org707296d">1.7.1. Adding and setting multiple targets</a></li>
<li><a href="#org5ba6624">1.7.2. Example</a></li>
<li><a href="#org06000ee">1.7.3. Further Reading</a></li>
</ul>
</li>
<li><a href="#orge50f1ac">1.8. Sample Project with multiple sub-projects</a>
<ul>
<li><a href="#orgcce655a">1.8.1. Overview</a></li>
<li><a href="#org253a722">1.8.2. Building and installing on Linux</a></li>
<li><a href="#orgd4f0e58">1.8.3. Building and installing on Windows with MSVC</a></li>
<li><a href="#org2e7915e">1.8.4. Building and installing on Windows with MinGW</a></li>
<li><a href="#org62231ac">1.8.5. Building and installing on Mac OSX</a></li>
</ul>
</li>
<li><a href="#orgbc47124">1.9. [DRAFT] Enabling and disabling preprocessor macros</a></li>
<li><a href="#org93abc72">1.10. Consuming or Dependencies</a>
<ul>
<li><a href="#orga3f1439">1.10.1. Overview</a></li>
<li><a href="#org4f1f787">1.10.2. CMake add_subdirectory</a></li>
<li><a href="#orgb559a01">1.10.3. FetchContent module (Approach 1)</a></li>
<li><a href="#org0947dff">1.10.4. FetchContent module (Approach 2)</a></li>
<li><a href="#org93a8ed0">1.10.5. FetchContent_makeAvailable (Approach 3)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="opengl">opengl</span>&#xa0;<span class="glfw">glfw</span>&#xa0;<span class="graphics">graphics</span></span></a></li>
<li><a href="#org5c4b6bf">1.10.6. CPM.cmake module [best]&#xa0;&#xa0;&#xa0;<span class="tag"><span class="cmake">cmake</span>&#xa0;<span class="best">best</span>&#xa0;<span class="dependency">dependency</span></span></a></li>
</ul>
</li>
<li><a href="#orga9bbf5c">1.11. Show system information</a></li>
<li><a href="#org4fe232c">1.12. Show all modules</a></li>
<li><a href="#orgc6823ed">1.13. Microsft Windows Specific</a>
<ul>
<li><a href="#org787dcb0">1.13.1. Statically link against MINGW runtime</a></li>
<li><a href="#orgeacedcd">1.13.2. Executable Target with resource icon</a></li>
<li><a href="#orga860874">1.13.3. Build executable for console or window subsystem</a></li>
<li><a href="#orged8996a">1.13.4. Set target subsystem: console/window</a></li>
<li><a href="#org1584dae">1.13.5. Export all shared library symbols</a></li>
</ul>
</li>
<li><a href="#org42982ac">1.14. Snippets</a>
<ul>
<li><a href="#orgf192cd5">1.14.1. Place build-tree object-code in source directory</a></li>
<li><a href="#orgc71ba06">1.14.2. Set common file extension for all executables</a></li>
<li><a href="#org34bc5f6">1.14.3. Glob files from a directory or sub-directories</a></li>
<li><a href="#org985fc35">1.14.4. Copy some target binaries to a directory</a></li>
<li><a href="#org7bd6086">1.14.5. Create target to run compiled executable</a></li>
<li><a href="#orgda077a5">1.14.6. Issue an error if condition is not met</a></li>
<li><a href="#org9b1220d">1.14.7. Copy a target file whenever it is recompiled</a></li>
<li><a href="#org8c60e32">1.14.8. Cross compiling for Android</a></li>
<li><a href="#orgf092992">1.14.9. Detect Operating System</a></li>
<li><a href="#org17a49fe">1.14.10. Detect whether current build is 32 bits or 64 bits</a></li>
<li><a href="#org4c7d548">1.14.11. Detect Compiler</a></li>
<li><a href="#org5cbb1b7">1.14.12. Debug Information for diagnosing problems</a></li>
</ul>
</li>
<li><a href="#orgd19c82c">1.15. Force Settings</a>
<ul>
<li><a href="#org6161703">1.15.1. Force generation of debugging symbols</a></li>
<li><a href="#orgf301ce6">1.15.2. Force Compiler to Clang</a></li>
</ul>
</li>
<li><a href="#org01831b6">1.16. Useful CMake Modules</a>
<ul>
<li><a href="#orga07de7e">1.16.1. CMake Module Projects</a></li>
<li><a href="#org452b63f">1.16.2. Collected CMake Modules</a></li>
</ul>
</li>
<li><a href="#orga5b3312">1.17. Cross references</a>
<ul>
<li><a href="#org52133f1">1.17.1. Common Variables</a></li>
<li><a href="#orgb2c37ba">1.17.2. CMake Map</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgf7fd60d" class="outline-2">
<h2 id="orgf7fd60d"><span class="section-number-2">1</span> CMake Building System</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org685e848" class="outline-3">
<h3 id="org685e848"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<b>Motivation</b> 
</p>

<ul class="org-ul">
<li><span class="underline">Easier cross-platform compilation and portability</span>
<ul class="org-ul">
<li>A single CMake building-script to rule all building systems.</li>
</ul></li>

<li><span class="underline">No reliance on a single IDE or building system</span>
<ul class="org-ul">
<li>CMake can generate projects and building scripts for many IDEs
and also several IDEs are providing support for CMake without
requiring generating a project to the IDE.</li>
</ul></li>

<li><span class="underline">Human-readable project file with a declarative language</span>
<ul class="org-ul">
<li>The project file is just a CMakeLists.txt human-readable text
with a simple and declarative language, not an obfuscated or
cryptic XML file, a verbose and fragile Json or a non-portable
Makefile or Visual Studio Solutions.</li>
</ul></li>

<li><span class="underline">Easier to consume libraries and other projects</span>
<ul class="org-ul">
<li>CMake makes consuming external and internal dependencies easier
than other building systems such as GNU autotools and GNU
Makefile. All what it is needed to add a external library to a
project is to copy the library directory to the project and add
the line add_subdirectory(&lt;LIBRARY_DIRECTORY&gt;). Another
advantage is that the library does not need to be installed
in the system.</li>
</ul></li>

<li><span class="underline">All configuration managed by code rather than GUI and XML</span>
<ul class="org-ul">
<li>Almost all configuration of a CMake project are managed by CMake
language code, rather than by GUIs graphical user interfaces
like Visual Studio Projects with MSBUild. This approach allows
more customization, scalability and also faster changes. Another
benefits are the portability among IDEs with CMake support. This
text-centric approach also frees users from learning IDE
specific details or configuration GUIs.</li>
</ul></li>

<li><span class="underline">Network effect (Network Externality)</span>
<ul class="org-ul">
<li>Network effect can be described as phenomenon where additional
users increases the value of products and services to all
users.</li>
<li>Many C++ libraries are being distributed with CMake; many open
source projects are adopting CMake; most C++ package managers
support CMake and IDEs are starting to provide CMake support.</li>
</ul></li>
</ul>


<p>
<b>CMake can be used in following ways:</b>
</p>

<ul class="org-ul">
<li><span class="underline">Build a software directly from command line</span> in a similar way to
Unix's make - $ make and $ make install.</li>

<li><span class="underline">Generate IDE-specific or preferred project files</span> in IDEs that does
not supports CMake, for instance cmake can generate projects from
the file CMakeLists.txt for the IDEs and text editors: Microsoft
Visual Studio, CodeBlocks, Kate projects, Sublime and Eclipse CDT.</li>

<li><span class="underline">Manage a project in IDEs which supports CMake</span>. In this case, it is
not necessary to generate IDE-specific project files.</li>
</ul>

<p>
<b>Programming Languages supported by CMake</b> 
</p>

<ul class="org-ul">
<li>ASM - Assembly</li>
<li>C</li>
<li>C++</li>
<li>Fortran</li>
<li>CSharp C#</li>
<li>CUDA</li>
<li>CXX</li>
<li>Java</li>
<li>RC - Windows Resource Compiler</li>
<li>Swift</li>
</ul>

<p>
<b>Capabilities:</b>
</p>

<ul class="org-ul">
<li>Generate IDE-specific project files.</li>
<li>Generate Visual Studio Solutions (projects)</li>
<li>Generate Makefiles (GNU Make) or NMake (Windows make) for direct
compilation.</li>
<li>Run targets like GNU make</li>
<li>Build a software or library directly from command line.</li>
</ul>

<p>
<b>Possibilities</b> 
</p>

<p>
A CMake project can contain one or more target (taks), similar to
Makefile rules:
</p>

<ul class="org-ul">
<li>Multiples targets for build executables - the same CMake file can
be used to build multiple applications.</li>

<li>Target to build shared library</li>

<li>Target to build static library</li>

<li>Target to install aplications or libraries</li>

<li>Custom targets</li>
</ul>

<p>
<b>CMake Project Examples</b>
</p>

<ul class="org-ul">
<li><a href="https://github.com/caiorss/winapi-snippets-cmake">winapi snippets</a>
<ul class="org-ul">
<li>Code snippets and examples for Windows API in modern C++ managed
by CMake.</li>
</ul></li>
<li><a href="https://gist.github.com/caiorss/2bba4c50866d9467aaa8c7792b337f71">shared library</a>
<ul class="org-ul">
<li>Example containibng: Cross platform shared library exporting
functions, classes, polymorphic classes and C-interfaces
(wrapper functions with C-linkage). It also contains a C++
client-code and Python wrapper which uses Python ctype FFI
foreign function interface.</li>
</ul></li>
<li><a href="https://github.com/caiorss/example-pybind11-vcpkg">example-pybind11-vcpkg</a>
<ul class="org-ul">
<li>This example project contains a Python3 native module written in
C++ with the help of CMake and Pybind11, vcpkg (C++) Package
manager.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orga36d1d7" class="outline-3">
<h3 id="orga36d1d7"><span class="section-number-3">1.2</span> Cmake Videos</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?app=desktop&amp;v=jt3meXdP-QI">Florent Castelli: Introduction to CMake</a>
<ul class="org-ul">
<li>"CMake is a tool designed to help you build and test your
software. It is now more popular than ever and is now supported
by some major IDEs and libraries, including Android Studio,
CLion, QtCreator or Visual Studio. Let's cover the basics,
understand how CMake works and how to write modern and
extensible cross-platform build scripts with CMake. We'll cover
some examples on how to enable some modern C++ tooling through
CMake, improving code quality and build times."</li>
</ul></li>

<li><a href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">C++Now 2017: Daniel Pfeifer “Effective CMake"</a>
<ul class="org-ul">
<li>"While CMake has become the de-facto standard buildsystem for
C++, it's siblings CTest and CPack are less well known. This
talk gives a lightspeed introduction into these three tools and
then focuses on best practices on building, testing, and
packaging. We will learn how to manage dependencies and export
our libraries in such a way that they can be easily used by our
clients. We will crosscompile for different platforms and run
our tests in an emulator. We will analyze code coverage and
perform static and dynamic code analysis."</li>
</ul></li>

<li><a href="https://www.youtube.com/watch?app=desktop&amp;v=m0DwB4OvDXk">Deep CMake for Library Authors - Craig Scott - CppCon 2019</a>
<ul class="org-ul">
<li>"This talk presents a road map for C++ library authors
grappling with cross-platform aspects of library development
and deployment. It highlights key CMake features that every
cross-platform library project should be using and digs deeper
into the platform-specific quirks and conventions behind
them. The material presented will give library authors more
robust control over their API, smoother integration with major
platforms and packaging systems, and more convenient inclusion
by other projects. The presentation will firstly examine how
symbol visibility, library versioning and API evolution can be
handled coherently across all major platforms and
compilers. CMake provides dedicated features for these that are
easy to use, but with the deeper understanding provided by this
talk, library authors will be able to make these areas work
together more seamlessly and avoid future maintenance and
compatibility issues. We will then explore how platform and
vendor differences affect the installed directory layout for
projects with libraries. CMake features for transparently
handling the different conventions and policies will be
presented, including recent CMake improvements which simplify
this task. The importance of RPATH/RUNPATH functionality for
improved runtime robustness and ease of use will also be
explained, along with some associated support CMake
provides. Along the way, the talk will mention a number of
specific things that CMake library projects should do or avoid
to make themselves easy for other projects to consume. This
will include versioning support for CMake config package files,
guidance on defining install components and accounting for the
different ways that projects may incorporate yours into their
build."</li>
</ul></li>

<li><a href="https://www.youtube.com/watch?app=desktop&amp;v=6sWec7b0JIc">C++Now 2018: Mateusz Pusz “Git, CMake, Conan: How to Ship and Reuse our C++ Projects”</a>
<ul class="org-ul">
<li>"The purpose of that presentation is to solve the problems of
build system and packaging that we have with large,
multi-platform, C++ projects with many open source
dependencies. Git and CMake are already established standards
in our community. However, it is not clear how to use them in
an efficient way. As a result, many C++ projects have problems
with either importing other dependencies or making themselves
easy to import by others. The talk will describe how Conan
package manager - a new contender on the market may address
those use cases."</li>
</ul></li>

<li><a href="https://www.youtube.com/watch?app=desktop&amp;v=YxortD9IxSc">Let's cmakeify the C++ standard library - Jussi Pakkanen - CppCon2019</a></li>

<li><a href="https://www.youtube.com/watch?app=desktop&amp;feature=youtu.be&amp;v=bDdkJu-nVTo">Modern Cmake: An introduction</a></li>

<li><a href="https://www.youtube.com/watch?v=8Ut9o4OdSC0">CMake/CPack/CTest/CDash Open Source Tools to Build Test and Deploy C++ Software</a>
<ul class="org-ul">
<li>"CMake/CPack/CTest/CDash Open Source Tools to Build Test and
Deploy C++ Software, presented by Bill Hoffman. CMake has been
in development since 1999, and has been used on several large
open source projects such as ITK, VTK, ParaView, VXL, Trilinos
and CMake itself. Further, KDE, one of the largest OSS projects
has adopted CMake, demonstrating that CMake is capable of
successfully supporting complex and large software
systems. Hence CMake usage is growing rapidly with thousands of
daily downloads and inclusion in several Linux
distributions. Unlike many build systems, CMake is designed to
be used in conjunction with native build tools enabling
developers to use makefiles, Kdevelop projects, Xcode projects,
and even MS Visual Studio projects. A simple input language
(included in a CMakeLists.txt file) is used to specify which
files to build and what types of system introspection tests
need to be performed to build the software. A persistent cache
file is used to store the system information and avoid the need
for user-defined environment variables. In addition to building
software, CMake provides a testing client (CTest) that
integrates with the web-based CDash testing server. This server
creates dashboards that build a snapshot of the software at a
given time. This is critical to cross-platform development
since often a change on one platform fails to compile on
another one. The testing system provides for nightly builds
which use a copy of the software at a specific time each night,
experimental tests that can be used to share build results with
other developers before committing source code, and continuous
build results that test the build each time files are committed
to the source control system. Once the software is built and
tested, the CPack tool can be used to package the
software. CPack works similar to CMake in that it generates
package information for native packaging tools. NSIS, RPM, OSX
packages self extracting tar.gz, tar.gz, tar.zip can all be
created. CPack information is included as a simple extension to
the CMake build files."</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org58e186c" class="outline-3">
<h3 id="org58e186c"><span class="section-number-3">1.3</span> Notable Projects Using CMake</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>See: <a href="https://cmake.org/success/">https://cmake.org/success/</a></li>

<li><a href="https://github.com/Kitware/VTK">kitware/VTK - Visualization Toolkit repository</a>
<ul class="org-ul">
<li>"VTK is an open-source software system for image processing,
3D graphics, volume rendering and visualization. VTK includes
many advanced algorithms (e.g., surface reconstruction,
implicit modeling, decimation) and rendering techniques (e.g.,
hardware-accelerated volume rendering, LOD control)."</li>
</ul></li>

<li><a href="https://github.com/Kitware/ParaView">Kitware/ParaView</a>
<ul class="org-ul">
<li><a href="https://www.paraview.org/">https://www.paraview.org/</a></li>
<li>"ParaView is an open-source, multi-platform data analysis and
visualization application. ParaView users can quickly build
visualizations to analyze their data using qualitative and
quantitative techniques. The data exploration can be done
interactively in 3D or programmatically using ParaView’s batch
processing capabilities. ParaView was developed to analyze
extremely large datasets using distributed memory computing
resources. It can be run on supercomputers to analyze datasets
of petascale size as well as on laptops for smaller data, has
become an integral tool in many national laboratories,
universities and industry, and has won several awards related
to high performance computation."</li>
</ul></li>

<li><a href="https://github.com/KDE">KDE Project</a> (Note: KDE is a framework and desktop environment
built on top of QT Framework) 
<ul class="org-ul">
<li><a href="https://www.kdevelop.org/">https://www.kdevelop.org/</a></li>
<li>See: <a href="https://community.kde.org/Guidelines_and_HOWTOs/CMake">Guidelines and HOWTOs/CMake</a></li>
<li>See: <a href="https://lwn.net/Articles/188693/">Why the KDE project switched to CMake &#x2013; and how (continued)</a></li>
<li><a href="https://github.com/KDE/kate">Kate Editor</a></li>
<li><a href="https://github.com/KDE/kdevelop">Kdevelop Editor</a></li>
</ul></li>

<li><a href="https://github.com/qt/qt5">Qt5 GUI Application Framework</a>
<ul class="org-ul">
<li>One of the most well-known C++ libraries. Qt works on
Microsoft Windows, Apple's MacOSX, Linux-x11,
Linux-framebuffer (embedded systems) and many other operating
systems.</li>
<li><a href="https://github.com/qt/qtwayland">https://github.com/qt/qtwayland</a></li>
<li><a href="https://github.com/qt/qtapplicationmanager">https://github.com/qt/qtapplicationmanager</a></li>
<li><a href="https://github.com/qt/qtwinextras">https://github.com/qt/qtwinextras</a></li>
<li><a href="https://github.com/qt/qtserialbus">https://github.com/qt/qtserialbus</a></li>
<li><a href="https://github.com/qt/qtdeclarative">https://github.com/qt/qtdeclarative</a></li>
<li><a href="https://github.com/qt/qtsensors">https://github.com/qt/qtsensors</a></li>
<li><a href="https://github.com/qt/qtremoteobjects">https://github.com/qt/qtremoteobjects</a></li>
</ul></li>

<li><a href="https://github.com/llvm/llvm-project">LLVM Project</a> (LLVM compiler framework and CLang Compiler)
<ul class="org-ul">
<li>"The LLVM Project is a collection of modular and reusable
compiler and toolchain technologies. Note: the repository does
not accept github pull requests at this moment."</li>
</ul></li>

<li><a href="https://github.com/root-project/root">CERN's Root</a>
<ul class="org-ul">
<li>"The official repository for ROOT: analyzing, storing and
visualizing big data, scientifically."</li>
</ul></li>

<li><a href="https://github.com/reactos/reactos">React-OS</a>
<ul class="org-ul">
<li>Open source clone of Windows NT operating system.</li>
</ul></li>

<li><a href="https://github.com/boostorg/boost">Boost Library</a>
<ul class="org-ul">
<li>Most famous C++ framework. Boost used its own building system
Bjam, but newer versions are using CMake.</li>
</ul></li>

<li><a href="https://github.com/notepad-plus-plus/notepad-plus-plus">Notepad Plus Plus - NPP</a>
<ul class="org-ul">
<li>Fast lightweight and customizable Windows-only text editor.</li>
<li><a href="https://notepad-plus-plus.org/">https://notepad-plus-plus.org/</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org84375b5" class="outline-3">
<h3 id="org84375b5"><span class="section-number-3">1.4</span> IDE with CMake support</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-orge65ad58" class="outline-4">
<h4 id="orge65ad58"><span class="section-number-4">1.4.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-4-1">
<ul class="org-ul">
<li>Note: List of IDEs that can use CMake as project configuration file
where the user does not need to generate IDE specific project file
such as Visual Studio Solution or CodeBlocks projects.</li>
</ul>
</div>
</div>
<div id="outline-container-org262df4d" class="outline-4">
<h4 id="org262df4d"><span class="section-number-4">1.4.2</span> Lightweight IDE - Integrated Development Environments</h4>
<div class="outline-text-4" id="text-1-4-2">
<ul class="org-ul">
<li><a href="https://doc.qt.io/qtcreator/">QTCreator</a> (QT Company) [BEST]
<ul class="org-ul">
<li>Note: Best replacement for CodeBlocks IDE with CMake support.</li>
<li>Features:
<ul class="org-ul">
<li>Just-work solution, zero time spending on configuration</li>
<li>Despite the name, can be used with any type of C++ project.</li>
<li>Good Integration with debugger</li>
<li>Cross-platform and ligthweight</li>
<li>Fast and accurate code completion</li>
<li>Basic refactoring support</li>
<li>Outstanding CMake support</li>
<li>QT Widgets and QTQuick QML GUI builder, aka drag-and-drop GUI designer.</li>
</ul></li>
<li>Supported Building Systems:
<ul class="org-ul">
<li>CMake</li>
<li>QBS</li>
<li>QMake</li>
<li>GNU Autotools - provided by plugin</li>
</ul></li>
<li>Download: <a href="https://www.qt.io/offline-installers">https://www.qt.io/offline-installers</a></li>
<li>Source Code: <a href="https://github.com/qt-creator/qt-creator">https://github.com/qt-creator/qt-creator</a></li>
<li>Additional: 
<ul class="org-ul">
<li><a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Qt-QMake-CMake-Future-Not-Qbs">The Qt Company Decides To Deprecate The Qbs Build System, Will Focus On CMake &amp; QMake</a></li>
<li><a href="https://blog.qt.io/blog/2018/10/29/deprecation-of-qbs/">QT Company - Deprecation of QBS in favor of CMake</a></li>
<li><a href="https://doc.qt.io/qtcreator/creator-project-cmake.html">Qt Creator Documentation - Setting Up CMake</a></li>
</ul></li>
</ul></li>

<li><a href="https://www.kdevelop.org/">KDevelop IDE</a> [BEST]
<ul class="org-ul">
<li>Note: KDevelop allows managing project with CMake, visualization
of all CMake targets, run individual targets with mouse click,
run install target and so on.</li>
<li>Note: On Windows, it doesn't support Visual Studio / MSVC
projects with MSVC (VC++) "visual" C++ compiler.</li>
</ul></li>

<li><a href="https://code.visualstudio.com/">VScode - Visual Studio Code</a> (Microsft MSFT) [BEST]
<ul class="org-ul">
<li>Note: Lightweight editor built on top of <a href="https://en.wikipedia.org/wiki/Electron_(software_framework)">Electron</a> framework
using web technologies with extensions, aka plugin,
support.</li>

<li>Note: Some of the following features are provided by VScode
extensions.</li>

<li>Features:

<ul class="org-ul">
<li>Command-based like Emacs, but VScode uses Ctrl + P for
launching commands, intead of Emacs' Alt + x or Meta-X
keybindings.</li>

<li>Configurable-like Emacs, but VScode uses JSon for configuration
files and Javascript for extensions.</li>

<li>Syntax highlight for many languages, including C++ and CMake
scripting language.</li>

<li>Code folding</li>

<li>CMake building system support</li>

<li><span class="underline">CMake support</span>: Automatic toolchain (compilers, linker and so
on) scanning for CMake.</li>

<li><span class="underline">CMake support:</span> Also supports CMake utility targets, that are
not associated to any source file.</li>

<li>Code Navigation: symbol panel and click-at symbol to open the
file where it is defined.</li>

<li>Cross Platform: works on Windows, Linux and Mac OSX.</li>

<li>Built-in terminal emulator panel.</li>

<li>Can open and run projects from any programming languages in
Docker containers which allows creating reproducible
development environments.</li>
</ul></li>

<li>VScode Extensions:
<ul class="org-ul">
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">ms-vscode.cpptools</a> [ESSENTIAL]
<ul class="org-ul">
<li>C/C++ IntelliSense, debugging, and code browsing.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">ms-vscode.cmake-tools</a> [ESSENTIAL]
<ul class="org-ul">
<li>CMake support</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=twxs.cmake">twxs.cmake</a>  [ESSENTIAL]
<ul class="org-ul">
<li>CMake language support</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">ms-vscode-remote.remote-containers</a> [ESSENTIAL]
<ul class="org-ul">
<li>Development in containers, specially Docker containers.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">ms-azuretools.vscode-docker</a> [ESSENTIAL]
<ul class="org-ul">
<li>Allows managing Docker containers.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=slevesque.shader">vscode-shader</a>
<ul class="org-ul">
<li>Shader language support for VScode. Supports GLSL (OpenGL
shading language - extension *.glsl); HLSL (DirectX shading
language) and Cg.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=danielpinto8zz6.c-cpp-compile-run">danielpinto8zz6.c-cpp-compile-run</a> [ESSENTIAL]
<ul class="org-ul">
<li>Makes possible compiling and running single C++-files.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-themes">ms-vscode.cpptools-themes</a>
<ul class="org-ul">
<li>C/C++ Extension UI Themes</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2">CoenraadS.bracket-pair-colorizer-2</a> 
<ul class="org-ul">
<li>Set different colors for matching brackets, parenthesis,
square brackets, curly brackets which helps code
readability.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=tonka3000.qtvsctools">tonka3000.qtvsctools</a>
<ul class="org-ul">
<li>Integration with QT Tools.</li>
</ul></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=hars.CppSnippets">hars.CppSnippets</a>
<ul class="org-ul">
<li>Many basic recurring C++ snippets for class, enum, enum
class and control structures.</li>
</ul></li>

<li><a href="https://marketplace.visualstudio.com/items?itemName=lfs.vscode-emacs-friendly">lfs.vscode-emacs-friendly</a> 
<ul class="org-ul">
<li>Emulates Emacs keybinds, for instance, replaces Ctrl-P with
Meta-X for lauching commands.</li>
</ul></li>
</ul></li>
</ul></li>

<li><a href="https://gitlab.com/cppit/jucipp">Jucipp / Gitlab</a> 
<ul class="org-ul">
<li>"A lightweight &amp; cross-platform IDE supporting the most recent
C++ standards. Current IDEs struggle with C++ support due to the
complexity of the programming language. juCI++, however, is
designed especially towards libclang with speed, stability, and
ease of use in mind."</li>
<li>Supported build systems: <b>CMake</b> ad Meson</li>
</ul></li>

<li><a href="https://wiki.gnome.org/Apps/Builder">GNome Builder IDE</a>
<ul class="org-ul">
<li>"Builder aims to be an IDE for writing GNOME-based software. We
believe this focus will help us build something great for our
community. If you would like to help in this effort, join our
IRC channel and we will help you find something to work
on. Builder is primarily written in C and Python. Some aspects
of Builder may be written in another language when it makes
sense. Builder is developed in conjunction with GNOME
releases. This means that we often contribute to, and rely on,
features being developed in other GNOME modules such as Gtk."</li>
<li>Supported building systems:
<ul class="org-ul">
<li>GNU Autotools</li>
<li>CMake</li>
<li>Meson</li>
</ul></li>
<li><a href="https://builder.readthedocs.io/en/latest/">https://builder.readthedocs.io/en/latest/</a></li>
<li><a href="https://github.com/GNOME/gnome-builder">https://github.com/GNOME/gnome-builder</a></li>
</ul></li>

<li><a href="https://codelite.org/">CodeLite IDE</a> 
<ul class="org-ul">
<li>"CodeLite is an open source, free, cross platform IDE specialized
in C, C++, PHP and JavaScript (mainly for backend developers
using Node.js) programming languages which runs best on all major
Platforms ( OSX, Windows and Linux )"</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org51ff943" class="outline-4">
<h4 id="org51ff943"><span class="section-number-4">1.4.3</span> Full-fledge IDE - Integrated Development Environments</h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
Large IDEs (Integrated Development Enviroment) are best suitable for
navigating and editing large codebases. The killer features of IDEs
are: more accurate code completion; side-panel with list of functions,
classes and so on; refactoring menu which allows making changes on
multiple files in a single step; project templates; generation of
boilerplate code such as: getters, setters and header-source files
pair ; integrated debug and many other amenities that enhances the
productivity.
</p>

<ul class="org-ul">
<li><a href="https://blogs.msdn.microsoft.com/vcblog/2016/10/05/cmake-support-in-visual-studio/">Microsft Visual Studio</a> [Windows-only] [BEST]</li>

<li><a href="https://www.youtube.com/watch?v=Rbb0fVCz41w">JetBrains - Clion IDE</a> [BEST]</li>

<li><a href="https://cevelop.com/">Eclipse CEvelop</a> (Modified Eclipse IDE for C and C++ Development)
<ul class="org-ul">
<li>Many embedded systems vendors provide IDEs or development
environment based on modified Eclipse IDEs.</li>
<li>Note: It does not support CMake directly, it requires some the
installation of some plugins:</li>
<li>Plugin: <a href="https://marketplace.eclipse.org/content/cmake-eclipse-helper">cmake-eclipse-helper</a></li>
<li>Plugin: <a href="https://marketplace.eclipse.org/content/cmake4eclipse">cmake4eclipse</a></li>
<li>Plugin: <a href="https://marketplace.eclipse.org/content/cmake-editor">cmake-editor</a></li>
</ul></li>

<li>Other Eclipse-based IDEs and Frameworks:

<ul class="org-ul">
<li><a href="https://marketplace.eclipse.org/content/linux-kernel-programming-ide-link-ide">Linux Kernel Programming IDE (LinK+ IDE)</a>
<ul class="org-ul">
<li>"LinK+ IDE is a simple IDE for Linux Kernel Developers and
Lovers. It is based on Eclipse IDE customized for Linux kernel
programming. It reduces the development time and executes code
in an elegant fashion. This IDE supports Linux kernel
configuration, compilation &amp; emulation, system call development
and device driver development. LinK+ IDE includes various
templates in the category of character, block and network
device driver subsystems for device driver development. It
includes various bus infrastructure templates and also provides
Linux device driver code completion, code assistance &amp; code
navigation for developers."</li>
</ul></li>

<li><a href="https://www.eclipse.org/downloads/packages/release/helios/sr2/eclipse-ide-cc-linux-developers-includes-incubating-components">Eclipse IDE for C/C++ Linux Developers</a>
<ul class="org-ul">
<li>"This package augments the C/C++ package specifically for Linux
developers. It includes GNU Autotools integration with the CDT
and plugins to interact with native Linux tools such as GCov,
GProf, OProfile, and Valgrind. Visualization and analysis
plugins for Linux tracing tools LTTng and SystemTap are also
present. For Linux distribution packagers, an RPM .spec editor
with rpmlint integration is available. Note that this package
includes some incubating components, as indicated by features
with "(Incubation)" following their name."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/modembed">MODembed</a> (Microchip PIC 8-bits, 16 Bits Microcontrollers and
MSP430 core from Texas Instruments)
<ul class="org-ul">
<li>"MODembed is an experimental IDE aiming to provide a more
advanced toolchain for embedded software development. It
provides a model-based approach for defining the whole
compilation process."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/somnium-drt-cortex-m-ide">somnium-drt-cortex-m-ide</a>
<ul class="org-ul">
<li>"SOMNIUM DRT Cortex-M IDE is a professional C and C++ embedded
software development environment for ARM Cortex-M devices,
which is built on the Eclipse platform. DRT is fully compatible
with the GNU toolchain and other third party software. DRT
provides industry-leading levels of optimization, support for
the latest C and C++ language standards and unique debugging
tools, including live expression view without breakpointing,
trace and fault diagnosis."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/arduino-eclipse-ide-named-sloeber-product">The Arduino Eclipse IDE named Sloeber (Product)</a>
<ul class="org-ul">
<li>"This product allows you to create, compile and upload sketches
with nearly the same simplicity as the Arduino IDE but with all
full functional features one would expect from a professional
IDE and includes a serial monitor and a graphical plotter. This
is a free and open-source plugin that is a professional and
complete alternative to the Arduino IDE. This is an add-on to
the CDT plugin and as such has all C/C++ development features
plus a toolbar with the Arduino buttons from the Arduino IDE
and an Arduino menu for importing libraries and more."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/opencl-development-tool">OpenCL Development Tool</a> 

<ul class="org-ul">
<li>Note: OpenCL (Kronos Group) is a vendor-agnostic C-extension
language for general purpose computing on GPUs.</li>

<li>"OpenCL Development Tool is an IDE based on Eclipse CDT for
developers writing kernels and host stubs in C, C++ and OpenCL
language. The tool provides wizards creating OpenCL projects
and kernels by one click. The editor provides syntax checking,
error highlighting and offers solutions for typical
errors. Also provides cheat sheets for best practices."</li>
</ul></li>
</ul></li>

<li>EClipse tooling and Convenience for Embedded Systems 

<ul class="org-ul">
<li><a href="https://marketplace.eclipse.org/content/gnu-mcu-eclipse">GNU MCU Eclipse</a> and <a href="https://gnu-mcu-eclipse.github.io/">GNU ARM → GNU MCU Eclipse!</a>
<ul class="org-ul">
<li>"The GNU MCU Eclipse (formerly GNU ARM Eclipse) is an open
source project that includes a family of Eclipse plug-ins and
tools for multi-platform embedded ARM &amp; RISC-V development,
based on GNU toolchains."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/embsysregview">EmbSysRegView</a> - View Registers of Embedded Devices 
<ul class="org-ul">
<li>"EMBedded SYStems REGister VIEW is an Eclipse Plugin which is
designed for monitoring and modifying memory values of embedded
devices. Therefore it offers a structured display of the
special functions registers (SFR). While debugging, the
register values are presented in the Hexadecimal (HEX) and
Binary (Bin) column of the view. Modifications of peripheral
registers values are possible via: Editing in the Binary column
via BitButtons; Editing in the Hex column; Choosing an
interpretation from an ComboBox in the Hex column (not
supported by all chip xml files); The EmbSysRegView works with
any 32 bit target that stores data in little endian byte order
and maps its register into memory adress space. In other words,
if you find your registers in the CDT Memory View, the
RegisterView will also work with that device assumin that a
chip xml description is available."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/embedded-reservation-space#group-details">Embedded Reservation Space</a>
<ul class="org-ul">
<li>"This Embedded Reservation space (ERS) plugin will help
embedded programmer to know the embedded resource that are
utilized by team members. This information (usage of embedded
resources) will be shared between team member using ERS
plugin. ERS plugin contains two plugins one is server and other
is client plugin. Server plugin will be installed by team
leader and client plugin will be installed by team
members. Team leader enter the embedded resources that are used
by different team members. The team members access the
information using client plugin."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/impulse-embedded-extension">impulse Embedded Extension</a> (Support for Serial RS232 and JTag)
<ul class="org-ul">
<li>"An embedded system is a computer system with a dedicated
function within a larger mechanical or electrical system, often
with real-time computing constraints. This extension contains a
serial line (RS232) adapter, a J-Link adapter, a CDT memory
adapter, a Serial Wire Viewer (SWV) reader, a SystemView reader
and a binary log format reader from the ukos project. impulse
is a powerful waveform viewer and analyser tool, helping
engineers to comfortably understand and debug complex
semiconductor and multi-core software systems."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/code-confidence-tools-ecos">code-confidence-tools-ecos</a> [EVALUATION VERSION] (Note: ECos is an RTOS used in automotive industry)
<ul class="org-ul">
<li>"The Code Confidence™ Tools provide the most productive
environment for eCos RTOS application development. All
components are fully integrated with the Eclipse™ C/C++
Development Tooling (CDT), creating a seamless development
experience from the initial installation of eCos(R) source code
to the final delivery of your fully debugged eCos
application. Product features include project creation wizards,
an advanced configuration editor, C/C++ editor integration,
performance-optimized GNU toolchains, support for profiling,
code coverage analysis, and kernel-aware debug views which
simplify and accelerate eCos application debugging. The tools
incorporate ThreadSpy™ technology for the thread-aware
debugging of eCos applications using JTAG, BDM, SWD and other
on-chip debug hardware. All debugging features are integrated
with the Eclipse Debugger Services Framework (DSF) which is
optimized for use with embedded systems."</li>
</ul></li>

<li><a href="https://marketplace.eclipse.org/content/code-confidence-tools-freertos">Code Confidence Tools for FreeRTOS</a> [EVALUATION VERSION]
<ul class="org-ul">
<li>"The Code Confidence™ Tools provide the most productive debug
environment for embedded application engineers working with the
FreeRTOS™ kernel. All components are fully integrated with the
award-winning Eclipse™ Platform (IDE) and C/C++ Development
Tooling (CDT), providing a seamless debugging
experience. Product features include full support for the
debugging of individual FreeRTOS tasks at both source code and
machine assembly levels. Code Confidence ThreadSpy™ technology
provides per-task backtrace, and enables inspection of the
local variables within each stack frame of each task. All
debugging features are fully integrated with the
high-performance Debugger Services Framework (DSF), enabling
the use of per-task breakpoints, watchpoints and
single-stepping while allowing the inspection of call stacks,
source code variables, processor registers and memory
regions. An evaluation version is available for download."</li>
</ul></li>
</ul></li>

<li>Articles about Eclipse IDE:

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/List_of_Eclipse-based_software">List of Eclipse-based software - Wikipedia</a></li>

<li><a href="https://dzone.com/articles/going-to-mars-building-a-diy-eclipse-ide-for-arm-e">Going to Mars: Building a DIY Eclipse IDE for ARM Embedded Microcontrollers - DZone IoT</a></li>

<li><a href="https://eclipsecon.org/2013/node/1330.html">Buildroot Eclipse Bundle : A powerful IDE for Embedded Linux developers | EclipseCon 2013</a></li>

<li><a href="http://blog.atollic.com/extend-your-embedded-arm-c/c-ide-with-additional-features-more-power-to-developers">Extend your embedded ARM C/C++ IDE with additional features more power to developers!</a></li>

<li><a href="https://developer.toradex.com/getting-started/module-2-my-first-hello-world-in-c/configure-eclipse">Configure Eclipse - Getting Started with Toradex</a></li>

<li><a href="https://www.appinf.com/download/EclipseEmbeddedLinuxPaper.pdf">Using Eclipse to develop for Embedded Linux on a Windows Host</a> [White Paper]</li>

<li><a href="http://courses.daiict.ac.in/pluginfile.php/5878/mod_resource/content/0/presentation/pres_R_eclipse.pdf">Eclipse in Embedded</a></li>

<li><a href="https://devel.rtems.org/wiki/Developer/Eclipse/Information">Developer/Eclipse/Information – RTEMS Project</a></li>

<li><a href="https://www.biglakesoftware.com/debugging-u-boot-using-eclipse/">Debugging u-boot using Eclipse - Big Lake Software</a></li>

<li><a href="https://dantechrb.com/blog/build-and-debug-u-boot-for-the-mx6sx-in-eclipse-kds-3-2">Build and debug u-boot for the MX6sx in eclipse ( KDS 3.2 )</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1fdb2ff" class="outline-3">
<h3 id="org1fdb2ff"><span class="section-number-3">1.5</span> Minimal CMake Project Workflow</h3>
<div class="outline-text-3" id="text-1-5">
<p>
This section contains a minimal CMake project that generates a single
executable which uses OpenGL libraries. All sources at: <a href="https://gist.github.com/caiorss/fd9e61887e9b2575f2275a80af44fac2">gist</a>
</p>

<p>
A CMake project contains at least the file CMakeLists.txt (Cmake
building definitions akin to Makefile) and one or more sources -
files: *.c, *.cpp, *.cxx, *.hpp. 
</p>

<p>
Workflow:
</p>

<ul class="org-ul">
<li>Build and install the application or library directly from command
line.</li>

<li>Generate IDE-specific building scripts if the IDE does not support
opening CMake projects. Example: CMake can generate Makefiles for
EClipse CDT or Visual Studio solution for old Visual Studio
versions which doesn't support CMake.</li>

<li>Open and manage the project directly if the IDE or editor supports
CMake. In Visual Studio, QTCreator or KDevelop, to open a CMake
project, it is just necessary to open the directory containing the
CMakeLists.txt.</li>
</ul>

<p>
<b>File:</b> CMakeLists.text 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)

<span class="org-comment"># Proeject name - should not contain whitespace </span>
<span class="org-function-name">project</span>(OpengGL_CPP)

<span class="org-comment">#========== Global Configurations =============#</span>
<span class="org-comment">#----------------------------------------------#</span>

<span class="org-comment"># Set the C++ standard for all targets (It sets the flags</span>
<span class="org-comment"># (-std=c++11, -std=c++14 ...) on Clang or GCC. and /std=c++17 on MSVC</span>
<span class="org-comment"># OPTIONAL:</span>
<span class="org-comment">#---------------------------------</span>
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment">#========== Targets Configurations ============#</span>

<span class="org-comment"># Build an executable (Unix-like OSes generates ./openglDemo1, on</span>
<span class="org-comment"># Windows ./opengDemo1.exe)</span>
<span class="org-comment"># ..........................................</span>
<span class="org-function-name">add_executable</span>(openglDemo1 opengl1.cpp)

<span class="org-comment"># Set executable dependency libraries</span>
<span class="org-comment"># Equivalent to pass flags -lGL, -lGLU and -lglut </span>
<span class="org-function-name">target_link_libraries</span>(openglDemo1 GL GLU glut)

<span class="org-comment"># Add extension .bin to executable name to make it easier</span>
<span class="org-comment"># to identify that the binary file is an executable.</span>
<span class="org-comment"># So, it renames the executable  'openglDemo1' to 'openglDemo1.bin'</span>
<span class="org-keyword">if</span>(UNIX)
  <span class="org-function-name">set_target_properties</span>(openglDemo1 PROPERTIES SUFFIX <span class="org-string">".bin"</span>)
<span class="org-keyword">endif</span>()

<span class="org-comment"># Add target to run executable </span>
<span class="org-function-name">add_custom_target</span>(run-ex1
    COMMAND openglDemo1 
    DEPENDS openglDemo1 
    WORKING_DIRECTORY ${<span class="org-variable-name">CMAKE_PROJECT_DIR</span>}
)
</pre>
</div>

<p>
Without all the comments and the custom target, the CMakeLists.txt
file would become:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(OpengGL_CPP)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment">#========== Targets Configurations ============#</span>
<span class="org-function-name">add_executable</span>(openglDemo1 opengl1.cpp)
<span class="org-function-name">target_link_libraries</span>(openglDemo1 GL GLU glut)
</pre>
</div>


<p>
<b>Building on Command Line:</b>
</p>

<p>
1 Install OpenGL development libraries (Fedora Linux):
</p>

<div class="org-src-container">
<pre class="src src-sh">$ sudo dnf install freeglut-devel.x86_64
<span class="org-comment-delimiter"># </span><span class="org-comment">Optional: Faster and better building system than GNU Make</span>
$ sudo dnf install ninja-build.x86_64 
</pre>
</div>

<p>
2 Clone sample project:
</p>

<div class="org-src-container">
<pre class="src src-sj">$ git clone https://gist.github.com/caiorss/fd9e61887e9b2575f2275a80af44fac2 cmake-opengl
Cloning into 'cmake-opengl'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (4/4), done.

$ cd cmake-opengl/

$ ls
CMakeLists.txt  opengl1.cpp
</pre>
</div>

<p>
3 Build with Makefile:
</p>

<ul class="org-ul">
<li>cmake -H&lt;SOURCE&gt; -B&lt;BUILD&gt; [-G &lt;Build-Systems&gt;]
<ul class="org-ul">
<li>&lt;SOURCE&gt; - Directory where is CMakeLists.txt (In this case (.)
current directory)</li>
<li>&lt;BUILD&gt; - Directory containing compilation output and the
building scripts generated by CMake for some building
systems. In this exaple: ./cache</li>
<li>-G  &lt;Build-Systems&gt; -&gt; [Optional] Specifies the building
systems which CMake will generate the scripts for. On Linux,
the default building system is Makefiles and on Windows it is
MSBuild.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Generate =&gt; Building scripts for Makefile on ./cache directory </span>
$ cmake -H. -Bcache 

-- The C compiler identification is GNU 8.2.1
-- The CXX compiler identification is GNU 8.2.1
... ...   ... ...   ... ...   ... ...   ... ... 
-- Generating done
-- Build files have been written to: /home/archbox/root-scripts/cmake-opengl/cache
</pre>
</div>

<p>
Build the executable running the building script (Makefile) from CMake:
</p>

<ul class="org-ul">
<li>Note: It will build all CMake targets, all executables and libraries.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache

/usr/bin/cmake -H/home/archbox/root-scripts/cmake-opengl -B/home/archbox/root-scripts/cmake-opengl/cache --check-build-system CMakeFiles/Makefile.cmake 0
/usr/bin/cmake -E cmake_progress_start /home/archbox/root-scripts/cmake-opengl/cache/CMakeFiles /home/archbox/root-scripts/cmake-opengl/cache/CMakeFiles/progress.marks
 .. ...  .. ...  .. ...  .. ...  .. ...  .. ... 
ir/build
<span class="org-function-name">gmake</span>[<span class="org-compilation-line-number">2</span>]: Entering directory <span class="org-string">'/home/archbox/root-scripts/cmake-opengl/cache'</span>
[ 50%] Building CXX object CMakeFiles/openglDemo1.dir/opengl1.cpp.o
/usr/lib64/ccache/c++    -std=gnu++1z -o <span class="org-keyword">CMakeFiles/openglDemo1.dir/opengl1.cpp.o</span> -c /home/archbox/root-scripts/cmake-opengl/opengl1.cpp
[100%] Linking CXX executable openglDemo1.bin
</pre>
</div>

<p>
Build a single target:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target openglDemo1
</pre>
</div>

<p>
Inspect executable: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ file cache/openglDemo1.bin 

 cache/openglDemo1.bin: ELF 64-bit LSB
 executable, x86-64, version 1 (SYSV), dynamically linked, interpreter
 /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0,
 <span class="org-variable-name">BuildID</span>[sha1]=269d06a0054677d70ecf0258268565535e3dfbd4, not stripped
</pre>
</div>

<p>
Execute a custom target, for instance the custom target <span class="underline">run-ex1</span> which runs
the executable (aking to $ make run).
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target run-ex1

  ... ... .... 
Scanning dependencies of target run-ex1
<span class="org-function-name">gmake</span>[<span class="org-compilation-line-number">3</span>]: Leaving directory <span class="org-string">'/home/archbox/root-scripts/cmake-opengl/cache'</span>
/usr/bin/gmake -f CMakeFiles/run-ex1.dir/build.make CMakeFiles/run-ex1.dir/build
<span class="org-function-name">gmake</span>[<span class="org-compilation-line-number">3</span>]: Entering directory <span class="org-string">'/home/archbox/root-scripts/cmake-opengl/cache'</span>
./openglDemo1.bin
[INFO] Starting OpenGL main loop.
[INFO] Running loop.
[INFO] Running loop.
</pre>
</div>

<p>
4 Build with Ninja. 
</p>

<ul class="org-ul">
<li>The compilation can be faster and less verbose with Ninja-build
building systems.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Remove cache directory </span>
rm -rf cache

<span class="org-comment-delimiter"># </span><span class="org-comment">Generate building scripts for Ninja building system in directory ./cache </span>
$ cmake -H. -Bcache -G Ninja
-- The C compiler identification is GNU 8.2.1
 ... .... ... .... ... .... ... ....
-- Generating done
-- Build files have been written to: /home/archbox/root-scripts/cmake-opengl/cache

<span class="org-comment-delimiter"># </span><span class="org-comment">Build a single target </span>
$ cmake --build cache --target openglDemo1
[2/2] Linking CXX executable openglDemo1.bin

<span class="org-comment-delimiter"># </span><span class="org-comment">Build all targets </span>
$ cmake --build cache --target all
<span class="org-function-name">ninja</span>: no work to do.

<span class="org-comment-delimiter"># </span><span class="org-comment">Run target: run-ex1 (akin to $ make run)</span>
$ cmake --build cache --target run-ex1
[0/1] cd /home/archbox/root-scripts/cm...pts/cmake-opengl/cache/openglDemo1.bin
</pre>
</div>

<p>
5 Open project with IDE or editor that doesn't support CMake, for
instance: Code Blocks.
</p>

<ul class="org-ul">
<li>The following command generates a blocks project file
(OpengGL_CPP.cbp) and a GNU make building (Makefile) script. Then,
the project can be opened from Code Blocks by selecting the file
OpenGL_CPP.cpb which is a CodeBlocks project file.</li>
</ul>

<pre class="example">
$ cmake -H. -Bcblock -G "CodeBlocks - Unix Makefiles"

-- The C compiler identification is GNU 8.2.1
 ... ... ... ... ... ... .... 
-- Configuring done
-- Generating done
-- Build files have been written to: /home/archbox/root-scripts/cmake-opengl/cblock

$ tree cblock -L 1
cblock
├── CMakeCache.txt
├── CMakeFiles
├── cmake_install.cmake
├── Makefile
└── OpengGL_CPP.cbp

1 directory, 4 files
</pre>
</div>
</div>
<div id="outline-container-orgaaadd2f" class="outline-3">
<h3 id="orgaaadd2f"><span class="section-number-3">1.6</span> Build a project from command line - detailed</h3>
<div class="outline-text-3" id="text-1-6">
<p>
A project using Cmake as building system contains a build script at
top level directory named CMakeLists.txt. To build a project with
CMake, it is necessary to consider that CMake, is not a building
system and does not build anything. Actually, Cmake generates building
scripts for the platform preferred building scripts. For instance, on
Linux, it can generate Makefile, Eclipse Makefiles; on Windows it can
generate MSBuild scripts, NMake (Windows SDK's make) and so on.
</p>

<ul class="org-ul">
<li>Check all possible building system for which CMake can generate
build scripts.
<ul class="org-ul">
<li>Command: $ <b>cmake -G</b></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Running on Windows 10 </span>
$ cmake -G
CMake Error: No generator specified for -G

Generators
  Visual Studio 15 2017 [arch] = Generates Visual Studio 2017 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"ARM"</span>.
  Visual Studio 14 2015 [arch] = Generates Visual Studio 2015 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"ARM"</span>.
  Visual Studio 12 2013 [arch] = Generates Visual Studio 2013 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"ARM"</span>.
  Visual Studio 11 2012 [arch] = Generates Visual Studio 2012 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"ARM"</span>.
  Visual Studio 10 2010 [arch] = Generates Visual Studio 2010 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"IA64"</span>.
  Visual Studio 9 2008 [arch]  = Generates Visual Studio 2008 project files.
                                 Optional [arch] can be <span class="org-string">"Win64"</span> or <span class="org-string">"IA64"</span>.
  Borland Makefiles            = Generates Borland makefiles.
  NMake Makefiles              = Generates NMake makefiles.
  NMake Makefiles JOM          = Generates JOM makefiles.
  Green Hills MULTI            = Generates Green Hills MULTI files
                                 (experimental, work-in-progress)<span class="org-builtin">.</span>
  MSYS Makefiles               = Generates MSYS makefiles.
  MinGW Makefiles              = Generates a make file for use with
                                 mingw32-make.
  Unix Makefiles               = Generates standard UNIX makefiles.
  Ninja                        = Generates build.ninja files.
  Watcom WMake                 = Generates Watcom WMake makefiles.
  CodeBlocks - MinGW Makefiles = Generates CodeBlocks project files.
  CodeBlocks - NMake Makefiles = Generates CodeBlocks project files.
  CodeBlocks - NMake Makefiles JOM
                               = Generates CodeBlocks project files.
  CodeBlocks - Ninja           = Generates CodeBlocks project files.
  CodeBlocks - Unix Makefiles  = Generates CodeBlocks project files.
  CodeLite - MinGW Makefiles   = Generates CodeLite project files.
  CodeLite - NMake Makefiles   = Generates CodeLite project files.
  CodeLite - Ninja             = Generates CodeLite project files.
  CodeLite - Unix Makefiles    = Generates CodeLite project files.
  Sublime Text 2 - MinGW Makefiles
                               = Generates Sublime Text 2 project files.
  Sublime Text 2 - NMake Makefiles
                               = Generates Sublime Text 2 project files.
  Sublime Text 2 - Ninja       = Generates Sublime Text 2 project files.
  Sublime Text 2 - Unix Makefiles
                               = Generates Sublime Text 2 project files.
  Kate - MinGW Makefiles       = Generates Kate project files.
  Kate - NMake Makefiles       = Generates Kate project files.
  Kate - Ninja                 = Generates Kate project files.
  Kate - Unix Makefiles        = Generates Kate project files.
  Eclipse CDT4 - NMake Makefiles
                               = Generates Eclipse CDT 4.0 project files.
  Eclipse CDT4 - MinGW Makefiles
                               = Generates Eclipse CDT 4.0 project files.
  Eclipse CDT4 - Ninja         = Generates Eclipse CDT 4.0 project files.
  Eclipse CDT4 - Unix <span class="org-variable-name">Makefiles</span>= Generates Eclipse CDT 4.0 project files.
</pre>
</div>

<p>
<b>STEP 1: Generate Building Script</b>
</p>

<p>
Project directory listing:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tree .
<span class="org-builtin">.</span>
&#9500;&#9472;&#9472; build.bat
&#9500;&#9472;&#9472; client1.cpp
&#9500;&#9472;&#9472; CMakeLists.txt
&#9500;&#9472;&#9472; Makefile
&#9500;&#9472;&#9472; pywrapper.py
&#9500;&#9472;&#9472; testlib.cpp
&#9492;&#9472;&#9472; testlib.hpp
</pre>
</div>

<p>
<b>Generate building scripts for platform-preferred building system:</b>
</p>

<ul class="org-ul">
<li>$ cmake -H&lt;SOURCE&gt; -B&lt;BUILD&gt;
<ul class="org-ul">
<li>&lt;SOURCE&gt; =&gt; Source directory where all *.cpp, *.hpp code. In this
case it is (.) dot, current directory. If the directory was
./src, the command would be -Hsrc or -H./src</li>
<li>&lt;BUILD&gt; =&gt; Compilation output, directory where are all building
scripts.</li>
</ul></li>
</ul>

<p>
Command output on Windows 10 - MSVC 2017. Note: It will set VC++ for
32 bits target, not 64 bits.
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -Bbuild
-- Building for: Visual Studio 15 2017
-- The C compiler identification is MSVC 19.16.27025.1
-- The CXX compiler identification is MSVC 19.16.27025.1  
... ...   ... ...   ... ...   ... ...   ... ... 
-- Configuring done
-- Generating done
-- Build files have been written to: C:/Users/archbox/Desktop/experiments/dll/build
</pre>
</div>

<p>
Command output on Linux: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -Bbuild
-- The C compiler identification is GNU 8.2.1
-- The CXX compiler identification is GNU 8.2.1
-- Check for working C compiler: /usr/lib64/ccache/cc
-- Check for working C compiler: /usr/lib64/ccache/cc -- works
... ...   ... ...   ... ...   ... ...   ... ... 
 [INFO] Libtest location is at: libtest_location-NOTFOUND
-- Configuring done
-- Generating done
-- Build files have been written to: /home/archbox/root-scripts/gist/build

<span class="org-comment-delimiter"># </span><span class="org-comment">List ./build directory </span>
$ tree -L 1 build
build
&#9500;&#9472;&#9472; CMakeCache.txt
&#9500;&#9472;&#9472; CMakeFiles
&#9500;&#9472;&#9472; cmake_install.cmake
&#9492;&#9472;&#9472; Makefile

1 directory, 3 files
</pre>
</div>

<p>
<b>Generate building script for specific building system:</b>
</p>

<ul class="org-ul">
<li>$ cmake -H&lt;SOURCE&gt; -B&lt;BUILD&gt; -G &lt;BUILD-SYSTEM&gt;
<ul class="org-ul">
<li>&lt;SOURCE&gt; =&gt; Source directory where all *.cpp, *.hpp code. In this
case it is (.) dot, current directory. If the directory was
./src, the command would be -Hsrc or -H./src</li>
<li>&lt;BUILD&gt; =&gt; Compilation output, directory where are all building
scripts.</li>
<li>&lt;BUILD-SYSTEM&gt; =&gt; All available build system can be listed with $ cmake -G.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Generate MSbuild building scripts for 32 bits target </span>
 $ cmake -H. -Bbuild -G <span class="org-string">"Visual Studio 15 2017"</span>

 <span class="org-comment-delimiter"># </span><span class="org-comment">Generate MSbuild building scripts for 64 bits target </span>
 $ cmake -H. -Bbuild -G <span class="org-string">"Visual Studio 15 2017 Win64"</span>
</pre>
</div>

<p>
<b>Generate building script with debug symbols enabled:</b>
</p>

<p>
It automatically adds the debugging flags (/Zi) for VC++ Microsoft
Visual C++ Compiler which necessary for debugging a program with GDB,
LLDB or WinDBG. 
</p>

<ul class="org-ul">
<li>Add the flag <b>-DCMAKE_BUILD_TYPE=DEBUG</b></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Example 1:</span>
$ cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=DEBUG

<span class="org-comment-delimiter"># </span><span class="org-comment">Example 2:</span>
$ cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=RELEASE

<span class="org-comment-delimiter"># </span><span class="org-comment">Example 3: </span>
cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=DEBUG -G <span class="org-string">"Visual Studio 15 2017 Win64"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Example 4: </span>
cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=DEBUG -G <span class="org-string">"Visual Studio 15 2017 Win64"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Example 5: </span>
cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=RELEASE -G <span class="org-string">"Visual Studio 15 2017 Win64"</span>
</pre>
</div>


<p>
<b>STEP 2: Compile the project invoking the generated building scripts</b>
</p>

<p>
Invoke the building scripts indirectly using CMake:
</p>

<ul class="org-ul">
<li>$ cmake &#x2013;build &lt;BUILD&gt;
<ul class="org-ul">
<li>&lt;BUILD&gt; Is the build directory generated at step 1.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build build
<span class="org-comment-delimiter"># </span><span class="org-comment">OR</span>
$ cmake --build build --config Debug 
<span class="org-comment-delimiter"># </span><span class="org-comment">OR</span>
$ cmake --build build --config Release
</pre>
</div>

<p>
Invoke the building script directly, call the building tool:
</p>
<ul class="org-ul">
<li>This building method depends on the current building system.</li>
</ul>

<p>
For MSBuild, the compilation becomes:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ MSBuild build\testlib.vcxproj

<span class="org-function-name">Microsoft</span> (R) Build Engine version 15.5.180.51428 for .NET Framework
<span class="org-function-name">Copyright</span> (C) Microsoft Corporation. All rights reserved.

Build started 12/21/2018 12:49:38 PM.
Project <span class="org-string">"C:\Users\archbox\Desktop\experiments\dll\build\testlib.vcxproj"</span> on node 1 (default targets)<span class="org-builtin">.</span>
Project <span class="org-string">"C:\Users\archbox\Desktop\experiments\dll\build\testlib.vcxproj"</span> (1) is building <span class="org-string">"C:\Users\archbox\ Desktop\experiments\dll\build\ZERO_CHECK.vcxproj"</span> (2) on node 1 (default targets)<span class="org-builtin">.</span>
... ... ... ... ... ... ... ... ... ... ... ... ... ... 
testlib.vcxproj -&gt; C:\Users\archbox\Desktop\experiments\dll\build\Debug\testlib.dll
<span class="org-function-name">FinalizeBuildStatus</span>:
  Deleting file <span class="org-string">"testlib.dir\Debug\testlib.tlog\unsuccessfulbuild"</span>.
  Touching <span class="org-string">"testlib.dir\Debug\testlib.tlog\testlib.lastbuildstate"</span>.
Done Building Project <span class="org-string">"C:\Users\archbox\Desktop\experiments\dll\build\testlib.vcxproj"</span> (default targets)<span class="org-builtin">.</span>
</pre>
</div>

<p>
For Linux or Unix GNU-Make, the compilation becomes:
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ cd build

 $ make
 /usr/bin/cmake -H/home/archbox/root-scripts/gist -B/home/archbox/root-scripts/gist/build --check-build-system CMakeFiles/Makefile.cmake 0
 /usr/bin/cmake -E cmake_progress_start /home/archbox/root-scripts/gist/build/CMakeFiles /home/archbox/root-scripts/gist/build/CMakeFiles/progress.marks
 make -f CMakeFiles/Makefile2 all
 make[1]: Entering directory <span class="org-string">'/home/archbox/root-scripts/gist/build'</span>
 make -f CMakeFiles/testlib.dir/build.make CMakeFiles/testlib.dir/depend
 make[2]: Entering directory <span class="org-string">'/home/archbox/root-scripts/gist/build'</span>
 ... ... ... ... ... ... ... ... ... ... ... ... 
 [100%] Built target client1-executable
 make[1]: Leaving directory <span class="org-string">'/home/archbox/root-scripts/gist/build'</span>
 /usr/bin/cmake -E cmake_progress_start /home/archbox/root-scripts/gist/build/CMakeFiles 0  


<span class="org-comment-delimiter"># </span><span class="org-comment">Built executables: </span>
<span class="org-comment-delimiter">#</span><span class="org-comment">--------------------------------</span>
$ file libtestlib.so 
<span class="org-function-name">libtestlib.so</span>: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically 
linked, <span class="org-variable-name">BuildID</span>[sha1]=ce79ed7580a16cbc27bf113a2967eb1d66f496a3, not stripped

$ file client1-executable.bin 
<span class="org-function-name">client1-executable.bin</span>: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, 
<span class="org-keyword">for</span> GNU/Linux 3.2.0, <span class="org-variable-name">BuildID</span>[sha1]=8103d822a6d58497b63346dfcc1f7375599114f7, not stripped
</pre>
</div>

<p>
Or just in a single step: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cd build &amp;&amp; make &amp;&amp; <span class="org-builtin">cd</span> ..
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a3fac7" class="outline-3">
<h3 id="org5a3fac7"><span class="section-number-3">1.7</span> Sample Project with multiple targets</h3>
<div class="outline-text-3" id="text-1-7">
</div>
<div id="outline-container-org707296d" class="outline-4">
<h4 id="org707296d"><span class="section-number-4">1.7.1</span> Adding and setting multiple targets</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
This section provides shows how to set up a project with additional
configuration and multiple targets which means a project with multiple
executables, shared libraries or static libraries.
</p>

<p>
<b>Set up executable target</b>
</p>

<ul class="org-ul">
<li>Executable target defintion =&gt; Builds a *.exe on Windows.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_executable</span>(SampleApp main.cpp source1.cpp source2.cpp)
</pre>
</div>

<p>
Header files can also be added to the target in order to make them
easier to access in an IDE such as Visual Studio. 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_executable</span>( SampleApp 
                main.cpp 
                class1.cpp class2.hpp 
                class1.cpp lcass2.hpp
              )
</pre>
</div>


<p>
<b>Set target defines #define or -D&lt;DEFINITION&gt;=VALUE or /D&lt;DEFINTION&gt;=&lt;VALUE&gt;</b>
</p>

<ul class="org-ul">
<li>Compiler defintions. =&gt; Defines.
<ul class="org-ul">
<li>It is the same as compiling with GCC with command line option
-D{DEFINITION}={VALUE} or compiling with MSVC VC++ with the
command line option /D{DEFINITION}={VALUE} which becomes #define
{DEFINITION} {VALUE} in the code.</li>
<li>Docs: <a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html">target_compile_definitions — CMake 3.13.2 Documentation</a></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"> <span class="org-function-name">target_compile_definitions</span>(SampleApp PRIVATE  
    VERBOSITY=100  <span class="org-comment"># Same as #define VERBOSITY 100 </span>
    Optimize       <span class="org-comment"># Same as -DOptimize or #define Optimize</span>
    foo=bar        <span class="org-comment"># Same as -Dfoo=bar on (GGCC or Clang) or /Dfoo=bar on MSVC</span>
   )
<span class="org-comment"># In a single line </span>
 <span class="org-function-name">target_compile_definitions</span>(SampleApp PRIVATE VERBOSITY=100 Optimize foo=bar)
</pre>
</div>

<p>
<b>Set target include directories</b>
</p>

<ul class="org-ul">
<li>Include directories containing header files. Similar to
command line option -I with GCC.
<ul class="org-ul">
<li><a href="https://cmake.org/cmake/help/v3.0/command/target_include_directories.html">target_include_directories — CMake 3.0.2 Documentation</a></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># Similar to: g++ main.cpp src1.cpp ... -o app.bin -Isrc/include1 -I/home/user/include</span>
<span class="org-function-name">target_include_directories</span>(SampleApp PUBLIC src/include1 /home/usr/include)
</pre>
</div>

<p>
<b>Set directories where shared or static libraries will be searched</b>
</p>

<p>
Set the directories where shared or static libraries will be
searched. Note: this command sets the search path for shared libraries
for all targets. 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">link_directories</span>(  
  <span class="org-comment"># C:\Users\DummyUser\libs</span>
  <span class="org-string">"C:\\Users\\DummyUser\\libs"</span> <span class="org-comment"># Windows paths with backward slash must be escaped with '\'</span>
  <span class="org-string">"C:/libs/Graphics"</span>           <span class="org-comment"># Windows paths with forward slash </span>
  <span class="org-string">"/home/DummyUser/libs"</span> 
)
</pre>
</div>

<p>
The command shown in the previous code is equivalent to compiling a
target with GCC as: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ g++ file1.cpp -c -o <span class="org-keyword">file1.o</span> -LC:\Users\DummyUser\libs -LC:/libs/Graphics/ -L/home/DummyUser/libs
</pre>
</div>


<p>
Shared Librarie files extensions: 
</p>
<ul class="org-ul">
<li><code>*.dll</code> files on Windows for all compilers.</li>
<li><code>*.so</code> files on Unix-like OSes</li>
<li><code>*.dylib</code> or <code>*.so</code> on MacOSX</li>
</ul>

<p>
Static librarie file extension:
</p>
<ul class="org-ul">
<li><code>*.lib</code> files for MSVC, VC++</li>
<li><code>*.a</code> for GCC, GCC/Mingw or Clang++.</li>
</ul>

<p>
<b>Set linking libraries</b>
</p>

<ul class="org-ul">
<li>Libraries that the executable will link against.
<ul class="org-ul">
<li>It can be: shared libraries installed on the system or either
shared or static libraries in the current project.</li>
<li>Note: Project libraries are also targets.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># Project shared library SampleSharedLib.so (Linux, Unix) or </span>
<span class="org-comment"># SampleSharedLib.dll on Windows. </span>
<span class="org-function-name">add_library</span>( SampleSharedLib SHARED  
             tools.cpp      tools.hpp 
             CShell.cpp     CShell.hpp 
             FileSystem.cpp FileSystem.hpp
           )
<span class="org-comment"># Configuration of target SampleSharedLib</span>
<span class="org-function-name">target_include_directories</span>(SampleSharedLib PRIVATE src/lib/include1)

<span class="org-comment"># Project static library </span>
<span class="org-function-name">add_library</span>(StaticLibrary STATIC lib1.cpp lib2.cpp lib3.cpp)

<span class="org-function-name">target_link_libraries</span>(SampleApp  
        GL blas opencv ole32 user32  <span class="org-comment"># System libraries  /usr/lib/*.so files on Linux </span>
                                     <span class="org-comment"># or *.lib files for MSVC VC++/Windows compiler and DLLs </span>
                                     <span class="org-comment"># at C:\Windows\System32</span>
        SampleSharedLib              <span class="org-comment"># Project shared library </span>
        StaticLibrary                <span class="org-comment"># Project static library </span>
)
</pre>
</div>

<p>
<b>Set compiler flags</b> 
</p>

<ul class="org-ul">
<li>Target compilar flags.
<ul class="org-ul">
<li>Note: The compilation flags are compiler-specific, the following
flags only works for GCC and Clang, but they don't work for MSVC
(VC++ Compiler) that uses forward slashes for compiler options
instead of dashes.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(NOT MSVC) 
   <span class="org-comment"># Only for GCC or Clang </span>
   <span class="org-comment"># (g) =&gt; Add debugging symbols </span>
   <span class="org-function-name">target_compile_options</span>(SampleApp -g -Wall -Wpendantic -Wextra )
<span class="org-keyword">else</span>()
   <span class="org-comment"># MSVC (VC++) =&gt; "visual" C++</span>
   <span class="org-function-name">target_compile_options</span>(SampleApp /Zi /Wall /Yd)         
<span class="org-keyword">endif</span>()
</pre>
</div>


<p>
<b>Set target compiler extensions and C++ standard</b>
</p>

<p>
Documentation: 
</p>
<ul class="org-ul">
<li><a href="https://cmake.org/cmake/help/latest/command/target_compile_features.html">target_compile_features</a></li>
<li><a href="https://cmake.org/cmake/help/latest/prop_gbl/CMAKE_CXX_KNOWN_FEATURES.html">CMAKE_CXX_KNOWN_FEATURES</a> - Arguments of command target_compile_features</li>
<li>See: <a href="https://github.com/Kitware/CMake/tree/master/Tests/CompileFeatures">https://github.com/Kitware/CMake/tree/master/Tests/CompileFeatures</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake">
<span class="org-comment"># Equivalent to compiling the target usign GCC with -std=c++14 (C++14 ISO Standard)</span>
<span class="org-comment"># Or /std:c++14 in MSVC VC++ </span>
<span class="org-function-name">target_compile_features</span>(SomeExecutableTarget PRIVATE cxx_std_14)

<span class="org-comment"># Equivalent to compiling the target usign GCC with -std=c++17 (C++17 ISO Standard)</span>
<span class="org-comment"># Or /std:c++17 in MSVC VC++ </span>
<span class="org-function-name">target_compile_features</span>(SomeExecutableTarget PRIVATE cxx_std_17)

<span class="org-comment"># Equivalent to compiling the target usign GCC with -std=c++20 - Experimental C++20</span>
<span class="org-function-name">target_compile_features</span>(SomeExecutableTarget PRIVATE cxx_std_20)
</pre>
</div>


<p>
<b>Set target Properties</b>
</p>

<ul class="org-ul">
<li>Set target properties:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">set_target_properties</span>(SampleApp PROPERTIES 
    {PROPERTY1} {VALUE1}
    {PROPERTY2} {VALUE2}
    ... .... ... ... 
    {PROPERTYN} {VALUEN}
 )
</pre>
</div>

<p>
Example 1: Add file extension .bin to Unix executable (note:
executables of Unix-like operating system do not have extension *.exe
like in Microsft Windows): 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(UNIX)
   <span class="org-comment"># When it is compiled, instead of generating the executable named as SampleApp, </span>
   <span class="org-comment"># the program will be named as "SampleApp.bin". </span>
   <span class="org-function-name">set_target_properties</span>(SampleApp PROPERTIES SUFFIX <span class="org-string">".bin"</span>)
 <span class="org-keyword">endif</span>()
</pre>
</div>

<p>
Example 2: Modify multiple properties, set the shared library file
name to AddinExtesion.xll. 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_library</span>(WrapperLibrary SHARED src1.cpp src2.cpp ... srcN.cpp)
<span class="org-comment"># ... omit configuration ... # </span>

<span class="org-function-name">set_target_properties</span>(WrapperLibrary PROPERTIES
  <span class="org-comment"># On Unix, it would add "lib" to beggining of the file name.</span>
  <span class="org-comment"># If prefix was not set to empty, the output file name would be</span>
  <span class="org-comment"># 'libAddinExtesion.xll'</span>
  PREFIX       <span class="org-string">""</span>  

  <span class="org-comment"># Change file name without changing prefix or extension (suffix)</span>
  OUTPUT_NAME  <span class="org-string">"AddinExtension"</span>

  <span class="org-comment"># Change file extension </span>
  SUFFIX      <span class="org-string">".xll"</span>    

  <span class="org-comment"># Makes all symbols hidden by default (compiles with by compiling</span>
  <span class="org-comment"># with flag -fvisibility=hidden on Unix-like Oses).  This setting</span>
  <span class="org-comment"># mimics the behavior of MSVC compiler extension</span>
  <span class="org-comment"># __declspec(dllexport)/__declspec(dllimport)</span>
  CXX_VISIBILITY_PRESET hidden
)
</pre>
</div>

<p>
The target properties could also be set individually:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_library</span>(WrapperLibrary SHARED src1.cpp src2.cpp ... srcN.cpp)
<span class="org-comment"># ... omit configuration ... # </span>
<span class="org-function-name">set_target_properties</span>(WrapperLibrary PROPERTIES PREFIX      <span class="org-string">""</span>)
<span class="org-function-name">set_target_properties</span>(WrapperLibrary PROPERTIES OUTPUT_NAME <span class="org-string">"AddinExtension"</span>)
<span class="org-function-name">set_target_properties</span>(WrapperLibrary PROPERTIES SUFFIX      <span class="org-string">".xll"</span>)  
</pre>
</div>

<p>
<b>Add more targets</b> 
</p>

<p>
A CMake project can have multiple targets, generating executables,
static libraries or shared libraries.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_executable</span>(DocGenerator src/docgen/main.cpp src/docgen/src2.cpp ...)
<span class="org-comment"># ... configuration of DocGenerator</span>

<span class="org-function-name">add_executable</span>(Display src/docgen/main.cpp src/docge/src2.cpp ...)

<span class="org-function-name">add_library</span>(libCommon SHARED src/lib/src1.cpp src/lib/src2.cpp ...)

<span class="org-comment"># .... configure targes .... #</span>
</pre>
</div>

<p>
<b>To avoid</b> 
</p>

<ul class="org-ul">
<li><b>Commands which affects all targets</b>: for instance,
include_directories(dir1 dir2 &#x2026;) will add those include
directories to all targets regardless if they need them or not. It
is better to use the command target_include_directories as it
affects just a single target. The word 'should not' does not means
'never'. If the intent is really set the same include directories
for all targets, then the command include_directories should be
used.</li>

<li><b>Non portable compiler settings.</b> Example: Compiler flags such as
-D{KEY}=VALUE, used by GCC and Clang, or /D{KEY}=VALUE, used by
MSVC (VC++) are non portable accross different compilers. To
overcome this, CMake provides many commands with an unified
interface to many compilers and build-systems, such as
<span class="underline">target_compile_definitions</span> that allows setting defines in a
compiler agnostic manner.</li>
</ul>
</div>
</div>
<div id="outline-container-org5ba6624" class="outline-4">
<h4 id="org5ba6624"><span class="section-number-4">1.7.2</span> Example</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
Project directory structure:
</p>

<ul class="org-ul">
<li><code>C:\User\Dummy\Documents\SampleProject</code>  (Project Root Directory)

<ul class="org-ul">
<li>CMakeLists.txt</li>

<li>./bin =&gt; Directory where the compiled binaries will be installed.</li>

<li>./src - Directory 
<ul class="org-ul">
<li>src/main.cpp</li>
<li>src/execMain.cpp</li>
<li>src/source1.cpp</li>
<li>src/source1.hpp</li>
<li>src/source2.cpp</li>
<li>src/source2.hpp</li>
<li>src/source3.cpp</li>
<li>&#x2026; &#x2026; ..</li>
</ul></li>

<li>./lib - directory
<ul class="org-ul">
<li>lib/lib1.cpp</li>
<li>lib/lib2.cpp</li>
<li>lib/lib3.cpp</li>
</ul></li>
</ul></li>
</ul>


<p>
File: <b>CMakeLists.txt</b> file for this hypothetical project.
</p>

<p>
Global configuration: 
</p>
<ul class="org-ul">
<li>Note: Global settings such <span class="underline">add_definitions</span> and <span class="underline">include_directories</span>
should be avoided.</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Part 1 of CMakeListi.txt - Global project's configuration</label><pre class="src src-cmake"> <span class="org-comment"># ========= Global Configuration  ===============#</span>
 <span class="org-comment"># The global configuration is shared by all targets. </span>
 <span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)

 <span class="org-function-name">project</span>( SuperCADTool
          <span class="org-comment"># Note: the following fields are optional </span>
          DESCRIPTION <span class="org-string">"Another CAD Computer Aided Design APP"</span>
          VERSION     1.0 
          LANGUAGE    CXX 
        )

 <span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
 <span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment"># AVOID! </span>
<span class="org-comment"># Global compile definition</span>
<span class="org-comment"># Add compiled definition -DQT_QML_DEBUG for all target.s </span>
<span class="org-function-name">add_definitions</span>(-DQT_QML_DEBUG)

<span class="org-comment"># AVOID!</span>
<span class="org-comment"># Global includes added to all targets </span>
<span class="org-function-name">include_directories</span>(<span class="org-string">"C:\\boost\\v1.67\\include"</span>  <span class="org-string">"/home/someone/includes"</span>)

<span class="org-comment"># AVOID! </span>
<span class="org-comment"># Global linking directories which contains static (*.a) or shared</span>
<span class="org-comment"># libraries (*.so or *.dll files)</span>
<span class="org-function-name">link_directories</span>(  
   <span class="org-comment"># C:\Users\DummyUser\libs</span>
   <span class="org-string">"C:\\Users\\DummyUser\\libs"</span> <span class="org-comment"># Windows paths with backward slash must be escaped with '\'</span>
   <span class="org-string">"C:/libs/Graphics"</span>           <span class="org-comment"># Windows paths with forward slash </span>
   <span class="org-string">"/home/DummyUser/libs"</span> 
 )
</pre>
</div>

<p>
Target Configurations: 
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>Part 2 of CMakeListi.txt - Per-target configuration.</label><pre class="src src-cmake"> <span class="org-comment"># ======= Configuration per target =============#</span>

 <span class="org-comment"># Target: SampleApp executable </span>
 <span class="org-comment">#---------------------------------------------------------</span>
 <span class="org-function-name">add_executable</span>(SampleApp src/main.cpp src/source1.cpp src/source2.cpp) 
 <span class="org-function-name">target_compile_definitions</span>(SampleApp PRIVATE VERBOSITY=100 Optimize foo=bar)
 <span class="org-function-name">target_include_directories</span>(SampleApp PUBLIC src/include1 /home/usr/include)

 <span class="org-function-name">target_link_libraries</span>(SampleApp  
         GL blas opencv ole32 user32  <span class="org-comment"># System libraries  /usr/lib/*.so files on Linux </span>
                                      <span class="org-comment"># or *.lib files for MSVC VC++/Windows compiler and DLLs </span>
                                      <span class="org-comment"># at C:\Windows\System32</span>
         SampleSharedLib              <span class="org-comment"># Project shared library </span>
         StaticLibrary                <span class="org-comment"># Project static library </span>
 )

<span class="org-comment"># Target: Executable2 - Add header files to make them visible in the IDE </span>
<span class="org-comment">#-----------------------------------------------------------------</span>
<span class="org-function-name">add_executable</span>(Executable2 src/execMain.cpp 
                           src/source1.cpp src/source1.hpp 
                           src/source2.cpp src/source2.hpp 
               ) 

<span class="org-comment"># Target: SampleShared - Shared library dll, so </span>
<span class="org-comment">#-------------------------------------------------------------------</span>
<span class="org-function-name">add_library</span>(SampleSharedLib SHARED  lib/lib1.cpp lib/lib2.cpp lib/lib3.cpp)
<span class="org-function-name">target_include_directories</span>(SampleSharedLib PRIVATE src/lib/include1)
</pre>
</div>

<p>
Intallation commands: 
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>Part 3 of CMakeListi.txt - Target/commands for installing executables and libraries.</label><pre class="src src-cmake"><span class="org-comment"># Install binaries locally during development.</span>
<span class="org-comment"># The binaries are installed in project's "${ROOT DIRECTORY}./bin" </span>
<span class="org-comment">#----------------------------------------------------------------------</span>

<span class="org-comment"># During the development install ./bin dir.  in project's root directory </span>
<span class="org-comment"># To install using CMAKE_INSTALL_PREFIX path, set this variable to 'OFF'</span>
<span class="org-function-name">set</span>(INSTALL_LOCAL ON) 

<span class="org-keyword">if</span>(INSTALL_LOCAL ON)
  <span class="org-comment"># Overrides the default default install location that would be </span>
  <span class="org-comment"># ${</span><span class="org-variable-name">CMAKE_INSTALL_PREFIX</span><span class="org-comment">}/bin as ${</span><span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span><span class="org-comment">}/bin </span>
  <span class="org-comment">#</span>
  <span class="org-comment"># Note: CMAKE_CURRENT_LIST_DIR is the directory where is CMakeLists.txt </span>
  <span class="org-function-name">install</span>(TARGETS SampleApp Executable2 SampleSharedLib DESTINATION  ${<span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span>}/bin)
<span class="org-keyword">else</span>()
  <span class="org-comment"># Install binary to directory probvided by the variable CMAKE_INSTALL_PREFIX </span>
  <span class="org-function-name">install</span>(TARGETS SampleApp Executable2 SampleSharedLib DESTINATION  bin)
<span class="org-keyword">endif</span>()
</pre>
</div>


<p>
<b>Compilation:</b>
</p>

<p>
Once the project file CMakeLists.txt is opened in any supported IDE or
an text editor such as QTCreator, the IDE will show all available
targets and provide menus, context menus or buttons where is possible
to select all targets for building the entire project; build individual
targets; debug an specific executable targets and run the <b>install</b>
target that copies the compiled files to the directory stored in the
variable <b>CMAKE_INSTALL_PREFIX</b>. 
</p>

<p>
<b>Running targets manually from command line without any IDE:</b> 
</p>

<p>
Step 1. Configuration - run the command from the project's top level directory.
</p>

<ul class="org-ul">
<li>Configure with install path CMAKE_INSTALL_PREFIX set to default
sytem location. (/usr/local on Linux). To install the binaries to
the this location, set the variable INSTALL_LOCAL in the code to
OFF.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Use Ninja build system </span>
$ cmake -Bcache -H. -G Ninja 

<span class="org-comment-delimiter"># </span><span class="org-comment">Use Makefile </span>
$ cmake -Bcache -H. -G Ninja 
</pre>
</div>

<ul class="org-ul">
<li>Configure base install path (CMAKE_INSTALL_PREFIX) to
/home/dummy/Documents/myapp, assuming that INSTALL_LOCAL is set to
OFF.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -Bcache -H. -G Ninja -DCMAKE_INSTALL_PREFIX=/home/dummy/Documents/myapp 
</pre>
</div>

<p>
Step 2. Run targets. 
</p>

<ul class="org-ul">
<li>Run all targetes building the whole project</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target  
</pre>
</div>

<ul class="org-ul">
<li>Run only the target SampleApp that builds the SampleApp executable:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target SampleApp
</pre>
</div>

<ul class="org-ul">
<li>Run only the target Executable2 that builds the Excutable2 executable</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target Executable2 
</pre>
</div>

<ul class="org-ul">
<li>Run the target 'install' that will install all binaries specified
in target install to ./bin directory if the option <b>INSTALL_LOCAL</b> is
set in the code (ON). To install the standard location specified by
${CMAKE_INSTALL_PREFIX}, set <b>INSTALL_LOCAL</b> in the code to OFF.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build cache --target install 
</pre>
</div>
</div>
</div>

<div id="outline-container-org06000ee" class="outline-4">
<h4 id="org06000ee"><span class="section-number-4">1.7.3</span> Further Reading</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
General 
</p>

<ul class="org-ul">
<li>Ben Morgan - The University of Warwick - <a href="https://web.archive.org/web/20190109203537/https://indico.fnal.gov/event/9717/session/38/contribution/82/material/slides/0.pdf">C++11/14/1z in CMake</a></li>
<li><a href="https://foonathan.net/doc/compatibility/">Documentation of Compatibility</a></li>
<li><a href="https://manpages.debian.org/stretch-backports/cmake-data/cmake-compile-features.7.en.html">Manpage - Cmake compile features</a></li>
<li><a href="https://community.kde.org/Guidelines_and_HOWTOs/CMake/Library">https://community.kde.org/Guidelines_and_HOWTOs/CMake/Library</a></li>
</ul>

<p>
Install Dependencies - Shared Libraries: 
</p>

<ul class="org-ul">
<li><a href="https://cmake.org/cmake/help/latest/command/install.html">https://cmake.org/cmake/help/latest/command/install.html</a></li>

<li><a href="https://stackoverflow.com/questions/41175354/can-i-install-shared-imported-library">Can I install shared imported library?</a></li>

<li><a href="https://cmake.org/pipermail/cmake/2014-December/059338.html">https://cmake.org/pipermail/cmake/2014-December/059338.html</a></li>

<li><a href="https://cmake.org/pipermail/cmake/2009-June/030205.html">Install of library sub-project prior to building application</a></li>

<li><a href="http://cmake.3232098.n2.nabble.com/Copying-Shared-Libraries-DLLs-Next-to-the-Executable-td7597163.html">Copying Shared Libraries (DLLs) Next to the Executable</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orge50f1ac" class="outline-3">
<h3 id="orge50f1ac"><span class="section-number-3">1.8</span> Sample Project with multiple sub-projects</h3>
<div class="outline-text-3" id="text-1-8">
</div>
<div id="outline-container-orgcce655a" class="outline-4">
<h4 id="orgcce655a"><span class="section-number-4">1.8.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
The following code is a cross-platform CMake project, with
sub-projects, containing 5 targets: a install target; a shared and
static libraries and two executables. The aim of this experiment is to
asses how a installation of a CMake project with multiple sub-projects
behaves on different operating systems.
</p>

<p>
Repository: 
</p>

<ul class="org-ul">
<li><a href="https://github.com/caiorss/cmake-cpp-nested">https://github.com/caiorss/cmake-cpp-nested</a></li>
</ul>

<p>
<b>Directory structure</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; tree . 
<span class="org-builtin">.</span>
&#9500;&#9472;&#9472; app1.cpp
&#9500;&#9472;&#9472; app2.cpp
&#9500;&#9472;&#9472; build_msvc.bat
&#9500;&#9472;&#9472; CMakeLists.txt
&#9500;&#9472;&#9472; lib_tool
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeLists.txt
&#9474;&#160;&#160; &#9500;&#9472;&#9472; tool.cpp
&#9474;&#160;&#160; &#9492;&#9472;&#9472; tool.hpp
&#9500;&#9472;&#9472; lib_util
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeLists.txt
&#9474;&#160;&#160; &#9500;&#9472;&#9472; util.cpp
&#9474;&#160;&#160; &#9492;&#9472;&#9472; util.hpp
&#9500;&#9472;&#9472; LICENSE.txt
&#9492;&#9472;&#9472; Makefile

2 directories, 12 files
</pre>
</div>

<p>
<b>Top-Level Files</b> 
</p>

<p>
File: <span class="underline">CMakeLists.txt</span>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(CMake_With_Makefile)

<span class="org-comment">#========== Global Configurations =============#</span>
<span class="org-comment">#----------------------------------------------#</span>

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment"># Export ALL DLLs symbols on Windows without __declspec(xxxx) annotations.</span>
<span class="org-function-name">set</span>(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS true)

<span class="org-keyword">function</span>(ADD_RUN_TARGET tname target)
    <span class="org-function-name">add_custom_target</span>( ${<span class="org-variable-name">tname</span>}
        COMMAND ${<span class="org-variable-name">target</span>}
        DEPENDS ${<span class="org-variable-name">target</span>}
        WORKING_DIRECTORY ${<span class="org-variable-name">CMAKE_PROJECT_DIR</span>}
    )
<span class="org-keyword">endfunction</span>()

<span class="org-comment"># Fix DLL not found problem on Windows </span>
<span class="org-comment"># Note: Windows shared libraries do not have RPATH or RUNPATH</span>
<span class="org-comment"># DLLs are searched first at current directories and then in directories </span>
<span class="org-comment"># listed in $PATH variable.</span>
<span class="org-keyword">if</span>(WIN32)
    <span class="org-function-name">set</span>(LIBRARY_OUTPUT_PATH    <span class="org-string">"${</span><span class="org-variable-name">CMAKE_BINARY_DIR</span><span class="org-string">}"</span>)
    <span class="org-function-name">set</span>(EXECUTABLE_OUTPUT_PATH <span class="org-string">"${</span><span class="org-variable-name">CMAKE_BINARY_DIR</span><span class="org-string">}"</span>)
<span class="org-keyword">endif</span>()


    <span class="org-comment">#=============================================#</span>
    <span class="org-comment">#  T A R G E T S  C O N F I G U R A T I O N   #  </span>
    <span class="org-comment">#=============================================#</span>


<span class="org-function-name">add_subdirectory</span>(lib_util)
<span class="org-function-name">add_subdirectory</span>(lib_tool)

       <span class="org-function-name">add_executable</span>( app1 app1.cpp )
<span class="org-function-name">target_link_libraries</span>( app1 lib::util lib::tool )


<span class="org-keyword">if</span>(_WIN32)
    <span class="org-function-name">set_target_properties</span>( lib::util PROPERTIES 
                                     OUTPUT_NAME Util 
                                     CLEAN_DIRECTORY_OUTPUT 1 )  
<span class="org-keyword">endif</span>()

<span class="org-comment"># Set RPATH in the executable for making it relocatable on Unix.</span>
<span class="org-comment"># It allows installing the application on any directory or </span>
<span class="org-comment"># running the application from any directory without </span>
<span class="org-comment"># 'symbol not found or library not found' errros. </span>
<span class="org-comment">#</span>
<span class="org-comment"># Note: The variable $ORIGIN is the executable absolute directory</span>
<span class="org-keyword">if</span>(UNIX AND NOT APPLE)
    <span class="org-function-name">set_target_properties</span>( app1 PROPERTIES INSTALL_RPATH <span class="org-string">"$ORIGIN:$ORIGIN/../lib"</span>)                       
<span class="org-keyword">elseif</span>(APPLE)
    <span class="org-comment"># For MacOSX (MacO - Binary Files)</span>
    <span class="org-function-name">set_target_properties</span>( app1 PROPERTIES INSTALL_RPATH <span class="org-string">"@executable_path/../lib"</span>)                       
<span class="org-keyword">endif</span>()

       <span class="org-function-name">add_executable</span>( app2 app2.cpp )
<span class="org-function-name">target_link_libraries</span>( app2 lib::util lib::tool)
<span class="org-comment"># set_target_properties( app2 PROPERTIES INSTALL_RPATH "$ORIGIN/../lib")                       </span>


<span class="org-function-name">ADD_RUN_TARGET</span>(run-app1 app1)
<span class="org-function-name">ADD_RUN_TARGET</span>(run-app2 app2)

    <span class="org-comment">#===========================================#</span>
    <span class="org-comment">#  I N S T A L  L    T A R G E T            #</span>
    <span class="org-comment">#===========================================#</span>


<span class="org-function-name">install</span>( TARGETS  app1 app2 util tool 
         <span class="org-comment"># Executables and DLLs (Windows Only)</span>
         RUNTIME  DESTINATION ${<span class="org-variable-name">CMAKE_INSTALL_BINDIR</span>}            
         <span class="org-comment"># Shared libraries: *.so or *.dylib </span>
         LIBRARY  DESTINATION ${<span class="org-variable-name">CMAKE_INSTALL_LIBDIR</span>}          
         <span class="org-comment"># Static libraries: *.a </span>
         ARCHIVE  DESTINATION ${<span class="org-variable-name">CMAKE_INSTALL_LIBDIR</span>}

)

<span class="org-function-name">install</span>(FILES LICENSE.txt DESTINATION data)
</pre>
</div>

<p>
File: <span class="underline">Makefile</span>
</p>
<ul class="org-ul">
<li>Makefile for performing project commands.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">GNU Make file script for easier compilation from</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">command line</span>

<span class="org-function-name">all</span>: help 

<span class="org-function-name">help</span>:
        @echo <span class="org-string">"Build options "</span>
        @echo <span class="org-string">" $ make debug                 =&gt; Debug build at _debug directory "</span>
        @echo <span class="org-string">" $ make release               =&gt; Release build at _release directory "</span>   
        @echo <span class="org-string">" $ make install prefix=&lt;PATH&gt; =&gt; Build in release mode and install app. at prefix path. "</span>                

<span class="org-function-name">debug</span>:
        @echo <span class="org-string">" =&gt;&gt; DEBUG build "</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">Only configs if '_debug' directory does not exist yet.</span>
        [ <span class="org-negation-char">!</span> -f _debug ] &amp;&amp; cmake --config Debug -B_debug -H.    
        cmake --build _debug --target

<span class="org-function-name">release</span>:
        @echo <span class="org-string">" =&gt;&gt; RELEASE build "</span> &amp;&amp; sleep 1 
        [ <span class="org-negation-char">!</span> -f _release ] &amp;&amp; cmake --config Release -B_release -H. 
        cmake --build _release --target

<span class="org-function-name">install</span>:
        @echo <span class="org-string">" =&gt;&gt; INSTALL release"</span> &amp;&amp; sleep 1 
        cmake --config Release -B_install -H. -DCMAKE_INSTALL_PREFIX=${<span class="org-variable-name">prefix</span>}
        cmake --build _install --target install

<span class="org-function-name">run-app1</span>:
        @echo <span class="org-string">" =&gt;&gt; Run app1 "</span> &amp;&amp; sleep 1
        [ <span class="org-negation-char">!</span> -f _debug ] &amp;&amp; cmake --config Debug -B_debug -H.    
        cmake --build _debug --target run-app1 

<span class="org-function-name">clean</span>:
        rm -rfv ./_debug ./_release ./_install  

<span class="org-function-name">clean-debug</span>:
        rm -rf -v ./_debug 

<span class="org-function-name">clean-release</span>:
        rm -rf -v ./_release 
</pre>
</div>

<p>
File: <span class="underline">app1.cpp</span> / target app1 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">util.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">tool.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

 <span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Application 1 Called Ok."</span> &lt;&lt; <span class="org-constant">std</span>::endl;

    <span class="org-constant">util</span>::util_function<span class="org-rainbow-delimiters-depth-2">(</span>100<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">tool</span>::too_lib_function<span class="org-rainbow-delimiters-depth-2">()</span>;

<span class="org-preprocessor">   #ifdef</span> _WIN32
      <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" Type RETURN to exit "</span> &lt;&lt; <span class="org-string">"\n"</span>;
      <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-preprocessor">   #endif</span>   

    <span class="org-keyword">return</span> 0;
 <span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
File: <span class="underline">app2.cpp</span> / target app2 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">util.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">tool.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Application 2 Called Ok."</span> &lt;&lt; <span class="org-constant">std</span>::endl;

    <span class="org-constant">util</span>::util_function<span class="org-rainbow-delimiters-depth-2">(</span>20<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">tool</span>::too_lib_function<span class="org-rainbow-delimiters-depth-2">()</span>;

<span class="org-preprocessor">    #ifdef</span> _WIN32
       <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" Type RETURN to exit "</span> &lt;&lt; <span class="org-string">"\n"</span>;
       <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-preprocessor">    #endif</span> 

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Sub-project lib_util</b>  (target lib::util)
</p>

<p>
File: lib_util/CMakeLists.txt  
</p>

<div class="org-src-container">
<pre class="src src-cmake">               <span class="org-function-name">add_library</span>( tool STATIC tool.cpp tool.hpp )
<span class="org-function-name">target_include_directories</span>( tool PUBLIC . )

<span class="org-function-name">add_library</span>( lib::tool ALIAS tool )
</pre>
</div>

<p>
File: lib_util/util.hpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _UTIL_HPP_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_UTIL_HPP_</span>

<span class="org-keyword">namespace</span> <span class="org-constant">util</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">void</span> <span class="org-function-name">util_function</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">n</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-preprocessor">#endif</span> 
</pre>
</div>

<p>
File: lib_util/util.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment">#include "util.hpp"</span>

<span class="org-comment">#include &lt;iostream&gt; </span>

namespace util {

    void <span class="org-function-name">util_function</span>(int n)
    {
        std::cout &lt;&lt; <span class="org-string">" [TRACE] util_function() called with n = "</span> &lt;&lt; n &lt;&lt; '\n';
    }
}
</pre>
</div>


<p>
<b>Sub-project lib_tool</b>  (target lib::tool)
</p>

<p>
File: lib_tool/CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake">               <span class="org-function-name">add_library</span> ( util SHARED util.cpp util.hpp)
<span class="org-function-name">target_include_directories</span> ( util PUBLIC . )
               <span class="org-function-name">add_library</span> ( lib::util ALIAS util )
</pre>
</div>

<p>
File: lib_tool/tool.hpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _TOOL_HPP_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_TOOL_HPP_</span>

<span class="org-keyword">namespace</span> <span class="org-constant">tool</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">void</span> <span class="org-function-name">too_lib_function</span><span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-preprocessor">#endif</span> 
</pre>
</div>

<p>
File: lib_tool/tool.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string">"tool.hpp"</span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-keyword">namespace</span> <span class="org-constant">tool</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">void</span> <span class="org-function-name">too_lib_function</span><span class="org-rainbow-delimiters-depth-2">()</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Called tool_lib_function() OK. "</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

</pre>
</div>
</div>
</div>
<div id="outline-container-org253a722" class="outline-4">
<h4 id="org253a722"><span class="section-number-4">1.8.2</span> Building and installing on Linux</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
Clone the repository: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://github.com/caiorss/cmake-cpp-nested cnest 
$ cd cnest
</pre>
</div>

<p>
<b>Run debug build</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; make debug 
 =&gt;&gt; DEBUG build 
<span class="org-comment-delimiter"># </span><span class="org-comment">Only configs if '_debug' directory does not exist yet.</span>
[ <span class="org-negation-char">!</span> -f _debug ] &amp;&amp; cmake --config Debug -B_debug -H.    
-- The C compiler identification is GNU 10.1.1
-- The CXX compiler identification is GNU 10.1.1
-- Check for working C compiler: /usr/bin/cc
 ... ... ... 

 $ &gt;&gt; ls _debug/
app1*  CMakeCache.txt  cmake_install.cmake  lib_util/
app2*  CMakeFiles/     lib_tool/            Makefile

 <span class="org-comment-delimiter"># </span><span class="org-comment">Test executable app1 </span>
 $ &gt;&gt; _debug/app1
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 

 <span class="org-comment-delimiter"># </span><span class="org-comment">Test executable app2 </span>
 ~/t/cnest
 $ &gt;&gt; _debug/app2
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK. 
</pre>
</div>

<p>
<b>Building and Installing application locally</b>
</p>

<ul class="org-ul">
<li>Building and installing application to directory $HOME/Applications/mycmake-app</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --config Release -H. -B_install -DCMAKE_INSTALL_PREFIX=$<span class="org-variable-name">HOME</span>/Applications/mycmake-app
$ cmake --build _install --target install 
</pre>
</div>

<ul class="org-ul">
<li>Building and installing application to directory
$HOME/Applications/mycmake-app using the Makefile.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ make install <span class="org-variable-name">prefix</span>=$<span class="org-variable-name">HOME</span>/Applications/mycmake-app
</pre>
</div>

<ul class="org-ul">
<li>Checking installation directory:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; tree ~/Applications/mycmake-app
/home/user/Applications/mycmake-app
&#9500;&#9472;&#9472; bin
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app1
&#9474;&#160;&#160; &#9492;&#9472;&#9472; app2
&#9500;&#9472;&#9472; data
&#9474;&#160;&#160; &#9492;&#9472;&#9472; LICENSE.txt
&#9492;&#9472;&#9472; lib
    &#9500;&#9472;&#9472; libtool.a
    &#9492;&#9472;&#9472; libutil.so

3 directories, 5 files
</pre>
</div>

<ul class="org-ul">
<li>Testing applications:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"> <span class="org-comment-delimiter"># </span><span class="org-comment">Attempt to run executable app1 </span>
 $ &gt;&gt; ~/Applications/mycmake-app/bin/app1 
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 


 <span class="org-comment-delimiter"># </span><span class="org-comment">Attempt to run executable app2   </span>
 $ &gt;&gt; ~/Applications/mycmake-app/bin/app2
 [INFO] Application 2 Called Ok.
<span class="org-function-name">/home/mxpkf8/Applications/mycmake-app/bin/app2</span>: symbol lookup error: /home/mxpkf8/Applications/mycmake-app/bin/app2: undefined symbol: _ZN4util13util_functionEi

 $ &gt;&gt; env <span class="org-variable-name">LD_LIBRARY_PATH</span>=$<span class="org-variable-name">HOME</span>/Applications/mycmake-app/lib  ~/Applications/mycmake-app/bin/app2
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK. 
</pre>
</div>

<ul class="org-ul">
<li>Running from applications from any directory [SOLUTION 1].</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">[FAILURE] Attempt to run app1 from any directory </span>
$ app1
<span class="org-function-name">bash</span>: app1: command not found

<span class="org-comment-delimiter"># </span><span class="org-comment">Solution: Add the install directory to $PATH environment variable</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">either in the shell or in the configuration files ~/.bashrc or ~/.profile</span>
$ export <span class="org-variable-name">PATH</span>=$<span class="org-variable-name">HOME</span>/Applications/mycmake-app/bin:$<span class="org-variable-name">PATH</span>

$ app1
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 

$ app2
 [INFO] Application 1 Called Ok.
<span class="org-function-name">app2</span>: symbol lookup error: app2: undefined symbol: _ZN4util13util_functionEi

<span class="org-comment-delimiter"># </span><span class="org-comment">Not recommended </span>
$ export <span class="org-variable-name">LD_LIBRARY_PATH</span>=$<span class="org-variable-name">HOME</span>/Applications/mycmake-app/lib:$<span class="org-variable-name">LD_LIBARY_PATH</span>

$ app2
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK. 
</pre>
</div>

<ul class="org-ul">
<li>Running from applications from any directory [SOLUTION 2].
<ul class="org-ul">
<li>Create symbolic links from the install directory to any directory
listed in $PATH variable such as /usr/local/bin</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ ln -s ~/Applications/mycmake-app/bin/app1 /usr/local/bin/app1
$ ln -s ~/Applications/mycmake-app/bin/app2 /usr/local/bin/app2  
</pre>
</div>

<ul class="org-ul">
<li>Checking shared libraries dependencies</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ldd  ~/Applications/mycmake-app/bin/app1
<span class="org-function-name">linux-vdso.so.1</span> (0x00007ffc945f6000)
libutil.so =&gt; /home/user/Applications/mycmake-app/bin/../lib/libutil.so (0x00007f6f95035000)
libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007f6f94e23000)
libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f6f94cdd000)
libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f6f94cc2000)
libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f6f94af8000)
<span class="org-function-name">/lib64/ld-linux-x86-64.so.2</span> (0x00007f6f9503c000)
</pre>
</div>


<p>
<b>Build and Install application globally</b> (system-wide install)
</p>

<ul class="org-ul">
<li>Run a docker-image containing building tools for simulating a virtual machine.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ docker run -it --rm -v $<span class="org-variable-name">PWD</span>:/cwd -w /cwd --entrypoint=bash linux-build
</pre>
</div>

<ul class="org-ul">
<li>The following commands are performed within the docker image: 

<ul class="org-ul">
<li>Note: The default behavior of CMake install target on Linux is to
install libraries and executables in a system-wide mode to the
paths <code>/usr/local/lib</code> and <code>/usr/local/bin/</code>. The shortcoming of
installing in this way are: different versions of the same
applications cannot coexist; possible dependency hell if installed
application libraries overrides existing ones already being used by
other applications.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --config Release -H. -B_install 

$ cmake --build _install --target install
    ... ... ... ... ... ... ... ... 
    ... ... ... ... ... 
 Install the project...
 /hbb/bin/cmake -P cmake_install.cmake
 -- Install configuration: <span class="org-string">""</span>
 -- Installing: /usr/local/bin/app1
 -- Set runtime path of <span class="org-string">"/usr/local/bin/app1"</span> to <span class="org-string">"$ORIGIN:$ORIGIN/../lib"</span>
 -- Installing: /usr/local/bin/app2
 -- Set runtime path of <span class="org-string">"/usr/local/bin/app2"</span> to <span class="org-string">""</span>
 -- Installing: /usr/local/lib/libutil.so
 -- Installing: /usr/local/lib/libtool.a
 -- Installing: /usr/local/data/LICENSE.txt
</pre>
</div>

<ul class="org-ul">
<li>Testing executables:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ app1
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 

$ app2
 [INFO] Application 2 Called Ok.
<span class="org-function-name">app2</span>: symbol lookup error: app2: undefined symbol: _ZN4util13util_functionEi
[root@5bf932c0a153 cwd]# 
</pre>
</div>

<ul class="org-ul">
<li>Checking executables:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"> $ which app1
 /usr/local/bin/app1

 $ which app2
 /usr/local/bin/app2

$ ldd $(<span class="org-sh-quoted-exec">which</span> app1)
   linux-vdso.so.1 =&gt;  (0x00007ffe2752b000)
   libutil.so =&gt; /usr/local/bin/../lib/libutil.so (0x00007f1530013000)
   libstdc++.so.6 =&gt; /usr/lib64/libstdc++.so.6 (0x00007f152fd0d000)
   libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f152fa89000)
   libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f152f873000)
   libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f152f4df000)
   /lib64/ld-linux-x86-64.so.2 (0x00007f1530215000)


$ ldd $(<span class="org-sh-quoted-exec">which</span> app2)
   linux-vdso.so.1 =&gt;  (0x00007ffdad757000)
   libutil.so =&gt; /usr/lib64/libutil.so (0x00007fed49570000)
   libstdc++.so.6 =&gt; /usr/lib64/libstdc++.so.6 (0x00007fed4926a000)
   libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fed48fe6000)
   libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fed48dd0000)
   libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fed48a3c000)
   /lib64/ld-linux-x86-64.so.2 (0x00007fed49773000)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4f0e58" class="outline-4">
<h4 id="orgd4f0e58"><span class="section-number-4">1.8.3</span> Building and installing on Windows with MSVC</h4>
<div class="outline-text-4" id="text-1-8-3">
<p>
<b>Building and installing locally</b> (non sytem wide mode)
</p>

<ul class="org-ul">
<li>Clone repository:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://github.com/caiorss/cmake-cpp-nested cnest 
$ cd cnest
</pre>
</div>

<ul class="org-ul">
<li>Configure: 

<ul class="org-ul">
<li>Note: If the option -G is omitted, CMake will chose the newest
version of MSVC installed on the current machine.</li>

<li>Note: Visual Sudio Compilers MSVC older than 2019 versions does
not use the command line switch -A for specifying the
architecture. For instance, for MSVC 2017, the command line
switch should be:
<ul class="org-ul">
<li>-G "Visual Sudio 15 2017" for x86 (IA32 - 32 bits)</li>
<li>-G "Visual Sudio 15 2017 Win64" for x86-64 64 bits (AMD64 or IA64)</li>
<li>-G "Visual Sudio 15 2017 ARM" for ARM architecture</li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">For Visual Studio MSVC 2019 / x86-64 (AMD64 or IA64 - 64 bits)</span>
$ cmake --Config Release -H. -B_install1 -G <span class="org-string">"Visual Studio 16 2019"</span> -A x64 -DCMAKE_INSTALL_PREFIX=%USERPROFILE%\Desktop\mycmake-app

<span class="org-comment-delimiter"># </span><span class="org-comment">For Visual Studio MSVC 2017 / x86-64 (64 bits)</span>
$ cmake --Config Release -H. -B_install1 -G <span class="org-string">"Visual Studio 16 2017 Win64"</span> -DCMAKE_INSTALL_PREFIX=%USERPROFILE%\Desktop\mycmake-app

<span class="org-comment-delimiter"># </span><span class="org-comment">For Visual Studio MSVC 2017 x86 - 32 bits </span>
$ cmake --Config Release -H. -B_install1 -G <span class="org-string">"Visual Studio 16 2017"</span> -DCMAKE_INSTALL_PREFIX=%USERPROFILE%\Desktop\mycmake-app
</pre>
</div>

<ul class="org-ul">
<li>Build all targets:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _install1 --target
</pre>
</div>

<ul class="org-ul">
<li>Show contents of build directory
<ul class="org-ul">
<li>Note: ls =&gt; is Unix tool ported for Windows, provided by bash and
git on Windows.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ ls _install1

ALL_BUILD.vcxproj          CMake_With_Makefile.sln  run-app1.vcxproj
ALL_BUILD.vcxproj.filters  CMakeCache.txt           run-app1.vcxproj.filters
app1.dir/                  CMakeFiles/              run-app2.vcxproj
app1.vcxproj               Debug/                   run-app2.vcxproj.filters
app1.vcxproj.filters       INSTALL.vcxproj          x64/
app2.dir/                  INSTALL.vcxproj.filters  ZERO_CHECK.vcxproj
app2.vcxproj               install_manifest.txt     ZERO_CHECK.vcxproj.filters
app2.vcxproj.filters       lib_tool/
cmake_install.cmake        lib_util/

$ ls _install1/Debug
app1.exe*  app1.pdb   app2.ilk  tool.lib  util.dll*  util.ilk  util.pdb
app1.ilk   app2.exe*  app2.pdb  tool.pdb  util.exp   util.lib

<span class="org-comment-delimiter"># </span><span class="org-comment">----- Check file types ----------------------------------------------#</span>

$ file _install1/Debug/app1.exe
<span class="org-function-name">_install1/Debug/app1.exe</span>: PE32+ executable (console) x86-64, for MS Windows

$ file _install1/Debug/app1.ilk
<span class="org-function-name">_install1/Debug/app1.ilk</span>: data

$ file _install1/Debug/app1.pdb
<span class="org-function-name">_install1/Debug/app1.pdb</span>: MSVC program database ver 7.00, 4096*267 bytes

$ file _install1/Debug/app1.lib
<span class="org-function-name">_install1/Debug/app1.lib</span>: cannot open <span class="org-sh-quoted-exec">`_install1/Debug/app1.lib' (No such file or directory)</span>

<span class="org-sh-quoted-exec">$ file _install1/Debug/tool.lib</span>
<span class="org-sh-quoted-exec">_install1/Debug/tool.lib: current ar archive</span>

<span class="org-sh-quoted-exec">$ file _install1/Debug/util.exp</span>
<span class="org-sh-quoted-exec">_install1/Debug/util.exp: Intel amd64 COFF object file, not stripped, 2 sections, symbol offset=0xb38, 38 symbols</span>
</pre>
</div>

<ul class="org-ul">
<li>Testing executable targets:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ _install1\Debug\app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit

$ _install1\Debug\app2.exe
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit
</pre>
</div>

<ul class="org-ul">
<li>Peform installation target:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _install1 --target install
<span class="org-function-name">Microsoft</span> (R) Build Engine version 16.8.2+25e4d540b for .NET Framework
<span class="org-function-name">Copyright</span> (C) Microsoft Corporation. All rights reserved.

  tool.vcxproj -&gt; Z:\cnest<span class="org-string">\_</span>install1\Debug\tool.lib
  Auto build dll exports
  util.vcxproj -&gt; Z:\cnest<span class="org-string">\_</span>install1\Debug\util.dll
  app1.vcxproj -&gt; Z:\cnest<span class="org-string">\_</span>install1\Debug\app1.exe
  app2.vcxproj -&gt; Z:\cnest<span class="org-string">\_</span>install1\Debug\app2.exe
  -- Install configuration: <span class="org-string">"Debug"</span>
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/bin/app1.exe
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/bin/app2.exe
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/lib/util.lib
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/bin/util.dll
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/lib/tool.lib
  -- Installing: C:/Users/h03fx/Desktop/mycmake-app/data/LICENSE.txt
</pre>
</div>

<ul class="org-ul">
<li>Listing installation directory.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; tree mycmake-app 
mycmake-app
&#9500;&#9472;&#9472; bin
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app1.exe
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app2.exe
&#9474;&#160;&#160; &#9492;&#9472;&#9472; util.dll
&#9500;&#9472;&#9472; data
&#9474;&#160;&#160; &#9492;&#9472;&#9472; LICENSE.txt
&#9492;&#9472;&#9472; lib
    &#9500;&#9472;&#9472; tool.lib
    &#9492;&#9472;&#9472; util.lib

3 directories, 6 files
</pre>
</div>

<ul class="org-ul">
<li>Testing executables.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ %USERPROFILE%\Desktop\mycmake-app\bin\app1
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit


$ %USERPROFILE%\Desktop\mycmake-app\bin\app2
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit


$ %USERPROFILE%\Desktop\mycmake-app\bin\app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit
</pre>
</div>

<p>
<b>Building and installing globally</b> (sytem wide mode)
</p>

<ul class="org-ul">
<li>Building and installing with default generator
<ul class="org-ul">
<li>Note: This step requires running a terminal emulator with administrative privilege.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --Config Release -H. -B_install2 -G <span class="org-string">"Visual Studio 16 2019"</span> -A x64

$ cmake --build _install2 --target install
<span class="org-function-name">Microsoft</span> (R) Build Engine version 16.6.0+5ff7b0c9e for .NET Framework
<span class="org-function-name">Copyright</span> (C) Microsoft Corporation. All rights reserved.

  tool.vcxproj -&gt; C:\Users\mxpkf8\Desktop\cnest<span class="org-string">\_</span>install2\Debug\tool.lib
  Auto build dll exports
  util.vcxproj -&gt; C:\Users\mxpkf8\Desktop\cnest<span class="org-string">\_</span>install2\Debug\util.dll
  app1.vcxproj -&gt; C:\Users\mxpkf8\Desktop\cnest<span class="org-string">\_</span>install2\Debug\app1.exe
  app2.vcxproj -&gt; C:\Users\mxpkf8\Desktop\cnest<span class="org-string">\_</span>install2\Debug\app2.exe
  -- Install configuration: <span class="org-string">"Debug"</span>
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/bin/app1.exe
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/bin/app2.exe
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/lib/util.lib
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/bin/util.dll
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/lib/tool.lib
  -- Installing: C:/Program Files (x86)/CMake_With_Makefile/data/LICENSE.txt
</pre>
</div>

<ul class="org-ul">
<li>Running:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ <span class="org-string">"C:/Program Files/CMake_With_Makefile/bin/app1.exe"</span>
[INFO] Application 1 Called Ok.
[TRACE] util_function() called with n = 100
[TRACE] Called tool_lib_function() OK.
Type RETURN to exit

$ <span class="org-string">"C:/Program Files/CMake_With_Makefile/bin/app2.exe"</span>
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit

$ <span class="org-string">"%PROGRAMFILES%"</span>\CMake_With_Makefile\bin\app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit


</pre>
</div>
</div>
</div>

<div id="outline-container-org2e7915e" class="outline-4">
<h4 id="org2e7915e"><span class="section-number-4">1.8.4</span> Building and installing on Windows with MinGW</h4>
<div class="outline-text-4" id="text-1-8-4">
<p>
Clone the repository: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://github.com/caiorss/cmake-cpp-nested cnest 
$ cd cnest
</pre>
</div>

<p>
<b>Build and install in a non-system wide way</b> 
</p>

<ul class="org-ul">
<li>Perform configuration step:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --config Debug -H. -B_buildmg -G <span class="org-string">"MinGW Makefiles"</span> -DCMAKE_INSTALL_PREFIX=%USERPROFILE%\Desktop\cnest-mingw-install
</pre>
</div>

<ul class="org-ul">
<li>Perform build step:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _buildmg --target
</pre>
</div>

<ul class="org-ul">
<li>Check build directory:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ ls _buildmg
app1.exe  cmake_install.cmake  CMakeFiles  lib_util   libutil.dll    Makefile
app2.exe  CMakeCache.txt       lib_tool    libtool.a  libutil.dll.a
</pre>
</div>

<ul class="org-ul">
<li>Test executables:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ _buildmg/app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit

$ _buildmg/app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit
</pre>
</div>

<ul class="org-ul">
<li>Run install target:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _buildmg --target install
  ...   ...   ...   ...   ...   ... 
  ...   ...   ...   ...   ...   ... 

 Install the project...
<span class="org-function-name">C</span>:\Users\myuser\scoop\apps\cmake\3.19.2\bin\cmake.exe -P cmake_install.cmake
-- Install configuration: <span class="org-string">""</span>
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/bin/app1.exe
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/bin/app2.exe
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/lib/libutil.dll.a
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/bin/libutil.dll
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/lib/libtool.a
-- Installing: C:/Users/myuser/Desktop/cnest-mingw-install/data/LICENSE.txt
</pre>
</div>

<ul class="org-ul">
<li>Run executables from install directory:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ %USERPROFILE%\Desktop\cnest-mingw-install\bin\app1.exe
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit

$ %USERPROFILE%\Desktop\cnest-mingw-install\bin\app2.exe
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK.
 Type RETURN to exit
</pre>
</div>
</div>
</div>
<div id="outline-container-org62231ac" class="outline-4">
<h4 id="org62231ac"><span class="section-number-4">1.8.5</span> Building and installing on Mac OSX</h4>
<div class="outline-text-4" id="text-1-8-5">
<ul class="org-ul">
<li>Clone repository:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://github.com/caiorss/cmake-cpp-nested cnest 
$ cd cnest
</pre>
</div>

<p>
<b>Building installing (non-system wide way)</b> 
</p>

<p>
Configure: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --config Release -H. -B_build -DCMAKE_INSTALL_PREFIX=$<span class="org-variable-name">HOME</span>/Desktop/myappx

-- The C compiler identification is AppleClang 11.0.3.11030032
-- The CXX compiler identification is AppleClang 11.0.3.11030032
-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc
-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc - works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++
-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++ - works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done

-- Generating done
-- Build files have been written to: /Volumes/data/cnest/_build

</pre>
</div>

<p>
Build: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _build --target 
</pre>
</div>

<p>
View build-tree: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tree -L 2 _build
_build
&#9500;&#9472;&#9472; CMakeCache.txt
 ... ... ... ... ... 
 ... ... ... ... ... 
&#9500;&#9472;&#9472; Makefile
&#9500;&#9472;&#9472; app1
&#9500;&#9472;&#9472; app2
&#9500;&#9472;&#9472; cmake_install.cmake
&#9500;&#9472;&#9472; lib_tool
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeFiles
&#9474;&#160;&#160; &#9500;&#9472;&#9472; Makefile
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cmake_install.cmake
&#9474;&#160;&#160; &#9492;&#9472;&#9472; libtool.a
&#9492;&#9472;&#9472; lib_util
    &#9500;&#9472;&#9472; CMakeFiles
    &#9500;&#9472;&#9472; Makefile
    &#9500;&#9472;&#9472; cmake_install.cmake
    &#9492;&#9472;&#9472; libutil.dylib
</pre>
</div>

<p>
Show format of binary files: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ file _build/app1
<span class="org-function-name">_build/app1</span>: Mach-O 64-bit executable x86_64

$ file _build/lib_tool/libtool.a
<span class="org-function-name">_build/lib_tool/libtool.a</span>: current ar archive random library

$ file _build/lib_util/libutil.dylib
<span class="org-function-name">_build/lib_util/libutil.dylib</span>: Mach-O 64-bit dynamically linked shared library x86_64
</pre>
</div>

<p>
Test applications:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ _build/app1
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 

$ _build/app2
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK.  
</pre>
</div>

<p>
Install: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _build --target install
  ... ... ... ... ... ... ... ... ...
  ... ...  ... .... ... ... ... ... .. 
/Library/Developer/CommandLineTools/usr/bin/make  -f CMakeFiles/Makefile2 preinstall
<span class="org-function-name">make</span>[<span class="org-compilation-line-number">1</span>]: Nothing to be done for <span class="org-sh-quoted-exec">`preinstall'.</span>
<span class="org-sh-quoted-exec">Install the project...</span>
<span class="org-sh-quoted-exec">/usr/local/Cellar/cmake/3.17.3/bin/cmake -P cmake_install.cmake</span>
<span class="org-sh-quoted-exec">-- Install configuration: ""</span>
<span class="org-sh-quoted-exec">-- Installing: /Users/unix/Desktop/myappx/bin/app1</span>
<span class="org-sh-quoted-exec">-- Installing: /Users/unix/Desktop/myappx/bin/app2</span>
<span class="org-sh-quoted-exec">-- Installing: /Users/unix/Desktop/myappx/lib/libutil.dylib</span>
<span class="org-sh-quoted-exec">-- Installing: /Users/unix/Desktop/myappx/lib/libtool.a</span>
<span class="org-sh-quoted-exec">-- Installing: /Users/unix/Desktop/myappx/data/LICENSE.txt</span>
</pre>
</div>

<p>
Show installation directory: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tree $<span class="org-variable-name">HOME</span>/Desktop/myappx
/Users/unix/Desktop/myappx
&#9500;&#9472;&#9472; bin
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app1
&#9474;&#160;&#160; &#9492;&#9472;&#9472; app2
&#9500;&#9472;&#9472; data
&#9474;&#160;&#160; &#9492;&#9472;&#9472; LICENSE.txt
&#9492;&#9472;&#9472; lib
    &#9500;&#9472;&#9472; libtool.a
    &#9492;&#9472;&#9472; libutil.dylib

3 directories, 5 files
</pre>
</div>

<p>
Test applications from install directory:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ /Users/unix/Desktop/myappx/bin/app1
 [INFO] Application 1 Called Ok.
 [TRACE] util_function() called with n = 100
 [TRACE] Called tool_lib_function() OK. 


$ /Users/unix/Desktop/myappx/bin/app2
 [INFO] Application 2 Called Ok.
<span class="org-function-name">dyld</span>: lazy symbol binding failed: Symbol not found: __ZN4util13util_functionEi
  Referenced from: /Users/unix/Desktop/myappx/bin/app2
  Expected<span class="org-keyword"> in</span>: /usr/lib/libutil.dylib

<span class="org-function-name">dyld</span>: Symbol not found: __ZN4util13util_functionEi
  Referenced from: /Users/unix/Desktop/myappx/bin/app2
  Expected<span class="org-keyword"> in</span>: /usr/lib/libutil.dylib


$ env <span class="org-variable-name">DYLD_LIBRARY_PATH</span>=/Users/unix/Desktop/myappx/lib   /Users/unix/Desktop/myappx/bin/app2
 [INFO] Application 2 Called Ok.
 [TRACE] util_function() called with n = 20
 [TRACE] Called tool_lib_function() OK. 
</pre>
</div>

<p>
Analysze depdencies of an executable: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ otool -l  /Users/unix/Desktop/myappx/bin/app1

<span class="org-function-name">/Users/unix/Desktop/myappx/bin/app1</span>:
Mach header
      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags
 0xfeedfacf 16777223          3  0x00           2    19       1584 0x00218085
Load command 0
      cmd LC_SEGMENT_64
  cmdsize 72
  segname __PAGEZERO
   vmaddr 0x0000000000000000
   vmsize 0x0000000100000000
 .... .. .   .... .. .   .... .. .    .... .. .   .... .. .   .... .. .
 .... .. .   .... .. .   .... .. .    .... .. .   .... .. .   .... .. .
Load command 17
      cmd LC_DATA_IN_CODE
  cmdsize 16
  dataoff 22088
 datasize 0
Load command 18
          cmd LC_RPATH
      cmdsize 40
         path @executable_path/../lib (offset 12)
</pre>
</div>

<p>
<b>Install in system-wide way</b> 
</p>

<ul class="org-ul">
<li>DO NOT ATTEMPT =&gt; It results in error as the command attempts to
install the applications to <code>/bin</code> directory which is a read-only file
system.</li>
<li>Unlike other unix-like operating systems which installs everything
scattered across the system (executables to /bin and libraries to
/lib), in Mac-OSX, the most used approach for deploying
applications is to distribute applications as <span class="underline">App bundles</span>, which are
directories terminated in <span class="underline">.app</span> suffix containing all executables,
shared libraries dependencies (*.dylib), assets and metadata. The
advantage of the app-bundle method of deployment are: applications
are self-contained; they can be installed by just dragging and
dropping them to the /Applications directory; they can be removed
just by deleting a d single directory; different versions of the
same application can be installed without disrupting each other or
any other system library.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Error: attemtps to install to read-only file system </span>
$ cmake --config Release -H. -B_build2 -DCMAKE_INSTALL_PREFIX=
$ cmake --build _build2 --target install
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbc47124" class="outline-3">
<h3 id="orgbc47124"><span class="section-number-3">1.9</span> [DRAFT] Enabling and disabling preprocessor macros</h3>
<div class="outline-text-3" id="text-1-9">
<p>
File: <span class="underline">CMakeLists.txt</span> 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(MacroCmake)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON )

<span class="org-function-name">option</span>(ENABLE_LOGGING <span class="org-string">"Enable compilation with logging"</span> OFF)

<span class="org-comment">#============== Set targets =============================#</span>

            <span class="org-function-name">add_executable</span>( macro-test macro-test.cpp    )
<span class="org-function-name">target_compile_definitions</span>( macro-test PRIVATE
                                       CODE_VERSION=<span class="org-string">"\\"</span>0.25\\<span class="org-string">""</span>
                           )

<span class="org-keyword">IF</span>(ENABLE_LOGGING)
  <span class="org-function-name">target_compile_definitions</span>( macro-test PRIVATE LOGGING)
<span class="org-keyword">ENDIF</span>()
</pre>
</div>

<p>
File: <span class="underline">macro-test.cpp</span> 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> CODE_VERSION
<span class="org-preprocessor">  #define</span> <span class="org-variable-name">CODE_VERSION</span> <span class="org-string">"0.1"</span> 
<span class="org-preprocessor">#endif</span> 

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>

  <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>argc &lt; 2<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">{</span>
      <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr,  <span class="org-string">" Product version: %s \n"</span>, CODE_VERSION<span class="org-rainbow-delimiters-depth-3">)</span>;
      <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" Usage: %s &lt;NUMBER&gt; \n"</span>, argv<span class="org-rainbow-delimiters-depth-4">[</span>0<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>;
      <span class="org-keyword">return</span> EXIT_FAILURE;
  <span class="org-rainbow-delimiters-depth-2">}</span>

  <span class="org-type">int</span> <span class="org-variable-name">n</span>    = <span class="org-constant">std</span>::stoi<span class="org-rainbow-delimiters-depth-2">(</span>argv<span class="org-rainbow-delimiters-depth-3">[</span>1<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-type">int</span> <span class="org-variable-name">prod</span> = 1;

  <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = 1; i &lt;= n; i++<span class="org-rainbow-delimiters-depth-2">){</span>
    prod *= i;

<span class="org-preprocessor">    #if</span> LOGGING 
      <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" =&gt; i = %d ; prod = %d \n"</span>, i, prod<span class="org-rainbow-delimiters-depth-3">)</span>; 
<span class="org-preprocessor">    #endif</span> 
  <span class="org-rainbow-delimiters-depth-2">}</span>

  <span class="org-constant">std</span>::printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" =&gt; product = %d \n"</span>, prod<span class="org-rainbow-delimiters-depth-2">)</span>; 

  <span class="org-comment-delimiter">// </span><span class="org-comment">Same as: return 0;</span>
  <span class="org-keyword">return</span> EXIT_SUCCESS;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>


<p>
<b>Building</b>
</p>

<p>
Build without enabling logging. 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug  
$ &gt;&gt; cmake --build _build --target

$ &gt;&gt; _build/macro-test 
Product version: <span class="org-string">"0.25"</span> 
<span class="org-function-name">Usage</span>: _build/macro-test &lt;NUMBER&gt; 

$ &gt;&gt; _build/macro-test 6
=&gt; product = 720 
</pre>
</div>

<p>
Build enabling logging. 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug -DENABLE_LOGGING=ON
$ &gt;&gt; cmake --build _build --target

$ &gt;&gt; _build/macro-test 6
=&gt; i = 1 ; prod = 1 
=&gt; i = 2 ; prod = 2 
=&gt; i = 3 ; prod = 6 
=&gt; i = 4 ; prod = 24 
=&gt; i = 5 ; prod = 120 
=&gt; i = 6 ; prod = 720 
=&gt; product = 720 
</pre>
</div>

<p>
Build defining macros on command line: (Note: this procedure is not
portable, it will not work with MSVC - visual C++ compiler as the MSVC
macros uses '/D' slash instead of '-D' dash for setting macros.)
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_FLAGS=<span class="org-string">'-DLOGGING -DCODE_VERSION=\"3.0\"'</span>
$ &gt;&gt; cmake --build _build --target

$ &gt;&gt; _build/macro-test
Product version: 3.0 
<span class="org-function-name">Usage</span>: _build/macro-test &lt;NUMBER&gt; 

$ &gt;&gt; _build/macro-test 4
=&gt; i = 1 ; prod = 1 
=&gt; i = 2 ; prod = 2 
=&gt; i = 3 ; prod = 6 
=&gt; i = 4 ; prod = 24 
=&gt; product = 24 
</pre>
</div>
</div>
</div>

<div id="outline-container-org93abc72" class="outline-3">
<h3 id="org93abc72"><span class="section-number-3">1.10</span> Consuming or Dependencies</h3>
<div class="outline-text-3" id="text-1-10">
</div>
<div id="outline-container-orga3f1439" class="outline-4">
<h4 id="orga3f1439"><span class="section-number-4">1.10.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
Note: 
</p>
<ul class="org-ul">
<li>object-code =&gt; Here means any compiled machine code, any file with
the extensions: <code>*.exe, *.o, *.obj, *.so, *.dylib</code></li>
</ul>

<p>
CMake can consume libraries or external dependencies in many different ways: 
</p>

<ul class="org-ul">
<li><b>Library Installation with building system</b> 
<ul class="org-ul">
<li>Installing the libraries with CMake, GNU Make, GNU autotools or
any building systems and consuming them via find_package(LIB) and
target_link_libraries( &#x2026;.).</li>
<li>Disadvantages:
<ul class="org-ul">
<li>As C++ compilers do not have a standard and stable ABI -
Application Binary Interface, the library needs to be
installed for every different compiler and different version
of the same compiler, otherwise it will not be possible to
build an application that links against a library built with
different compiler.</li>
<li>Installing multiple versions of the same library may result in
dependency hell breaking dynamic-linked applications depending
on it.</li>
</ul></li>
</ul></li>

<li><b>Library installation from operating system's package manager</b>
<ul class="org-ul">
<li>Installing libraries with a package manager such as Linux
Fedora (dnf), Ubuntu (apt-get or Mac OSX (brew) and consuming
them via find_package(LIB) and target_link_libraries(&#x2026;).</li>
<li>Disadvantages:
<ul class="org-ul">
<li>The installation is not reproducible in other platforms and
often, it is not possible to install multiple versions of the
same library and it may not be available in all package
managers.</li>
</ul></li>
</ul></li>

<li><b>CMake add_subdirectory(lib/&lt;LIBRARY_DIR&gt;)</b>
<ul class="org-ul">
<li>The library directory containing the source code is added to the
project either via CMake <a href="https://cmake.org/cmake/help/latest/module/ExternalProject.html">ExternalProject</a>, manual copy or via git
add submodule. The library is consumed in the project by adding
a line: add_subdirectory(lib/&lt;LIBRARY_DIR&gt;) to the file
CMaklists.txt. And the applications links against the library
with target_link_libraries(app lib::libname).</li>
<li>Advantages:
<ul class="org-ul">
<li>No ABI issues as the library is built with the same compiler
as the application.</li>
<li>Better for static linking.</li>
<li>More simple as it does not require the library maintainer to
provide a CMake module for find_package.</li>
<li>Better reproducibility and easier compilation on different
operating systems and also easier cross-compilation for
embedded targets.</li>
<li>No dependency hell: As multiple versions of the library can be
used in different projects without disrupting each other.</li>
</ul></li>
<li>Disadvantages:
<ul class="org-ul">
<li>Longer compile-time</li>
<li>More disk space spending</li>
<li>The library is recompiled for every project.</li>
</ul></li>
</ul></li>

<li><b>C++-specific Package Manager with CMake Integration</b>
<ul class="org-ul">
<li>Package managers automates the process of downloading libraries'
source code and compiling them alongside the project. It is no
possible to generalize C++ package managers as there are many differences
among them. In the case of Conan package manager, it builds and
installs the library object-code and header files to the Conan's
cache directory where the library can be reused on many projects
and recompiled on-demand if the compiler used to build the
project is not ABI-compatible with the compiler used to build
the libraries object codes.</li>
<li>Note: there are other package managers built as CMake scripts,
but they fall short when dealing with libraries using other
building systems such as GNU autotools or GNU Makefiles.</li>
<li>Advantages:
<ul class="org-ul">
<li>Automates the process of getting and installing libraries.</li>
<li>Saves disk space.</li>
<li>Shorter compile-time as library-object codes can be reused in
other projects.</li>
<li>No ABI issues</li>
<li>No dependency hell</li>
<li>Better for static linking and cross-compilation for embedded
systems.</li>
<li>Reproducible on many different operating systems.</li>
<li>Makes easier to install big libraries, frameworks or libraries
with many dependencies such as Boost and Poco libraries which
depends on openssl which is problematic to build on Windows.</li>
</ul></li>
<li>Disadvantages:
<ul class="org-ul">
<li>conan is not mainstream and there are still many competing
package managers.</li>
<li>conan requires a Python installation, although it is not a big
issue since there are many tools using Python as an embedded
scripting language such GNU Debugger GDB or Windows Debugger.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org4f1f787" class="outline-4">
<h4 id="org4f1f787"><span class="section-number-4">1.10.2</span> CMake add_subdirectory</h4>
<div class="outline-text-4" id="text-1-10-2">
<p>
External libraries or sub-projects can be consumed with CMake command
add_subdirectory(&lt;PATH-TO/LIB-DIRECTORY&gt;) which builds the project and
the library source code &lt;LIB-DIRECTORY&gt; containing a
CMakeLists.txt. The benefits of this approach is that libraries are:
</p>

<ul class="org-ul">
<li>Libraries does not need to be installed in the system before
usage.</li>

<li>No ABI incompatibility issue as the compiler used for building the
application and library are the same.</li>

<li>Better tracking of dependencies and no dependency hell as
different versions of the same library can be used in many project
without disrupting each other.</li>
</ul>

<p>
Drawbacks:
</p>

<ul class="org-ul">
<li>Higher disk space usage as every project needs a copy of the
library sources.</li>

<li>Libraries need to use CMake as building system and contain a
CMakeLists.txt file at root directory, otherwise, it will not be
possible to use add_subdirectory command.</li>

<li>Possible complexity of git add submodule.</li>
</ul>

<p>
<b>Libraries used:</b>
</p>

<ul class="org-ul">
<li><a href="https://github.com/gabime/spdlog">spdlog</a></li>
<li><a href="https://github.com/cpputest/cpputest">cpputest</a></li>
</ul>

<p>
<b>Creating project</b> 
</p>

<p>
(1) Create project and git repository 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git init .
Initialized empty Git repository<span class="org-keyword"> in</span> /home/user/projects/cmake-experiment/.git/

$ git add CMakeLists.txt main.cpp 

$ git commit -m started
[master (root-commit) 8e60c5c] started
 2 files changed, 16 insertions(+)
 create mode 100644 CMakeLists.txt
 create mode 100644 main.cpp
</pre>
</div>

<p>
(2) Add external libraries to the project via git submodule or by
copying them manually.    
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git submodule add  https://github.com/gabime/spdlog extern/spdlog
$ git submodule add https://github.com/cpputest/cpputest extern/cpputest
</pre>
</div>

<p>
(3) Show current directory: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tree -L 2 .
<span class="org-builtin">.</span>
&#9500;&#9472;&#9472; CMakeLists.txt
&#9500;&#9472;&#9472; CMakeLists.txt.user
&#9500;&#9472;&#9472; extern
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cpputest
&#9474;&#160;&#160; &#9492;&#9472;&#9472; spdlog
&#9492;&#9472;&#9472; main.cpp

3 directories, 3 files
</pre>
</div>


<p>
<b>File: CMakeLists.txt</b>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 2.8)
<span class="org-function-name">project</span>(cmake-experiment)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-function-name">add_subdirectory</span>(extern/spdlog)
<span class="org-function-name">add_subdirectory</span>(extern/cpputest)

<span class="org-function-name">add_executable</span>(app main.cpp)
<span class="org-function-name">target_link_libraries</span>(app spdlog::spdlog CppUTest)
</pre>
</div>

<ul class="org-ul">
<li>The command <a href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html">add_subdirectory</a> adds the sources of the library spdlog
to the current build by processing the file
extern/spdlog/CMakeLists.txt.</li>

<li>Libraries can be made easier to use and consume by listing in their
documentation the <span class="underline">targets they define</span> which client codes can link
against with <span class="underline">add_library</span>. If the those targets are not mentioned
the user has to inspect all libraries CMakeLists.txt files which
can be cumbersome in libraries with many nested directories.</li>
</ul>

<p>
Finding targets defined by spdlog and CppUtest libraries:
</p>

<ul class="org-ul">
<li>The file extern/spdlog/CMakeLists.txt contains the following lines
that defines library targets which the top-level CMakeLists.txt
file can consume:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_library</span>(spdlog INTERFACE)
<span class="org-function-name">add_library</span>(spdlog::spdlog ALIAS spdlog)
</pre>
</div>

<ul class="org-ul">
<li>The file extern/CppUtest/CMakeLists.txt contains the following
lines which builds the extern/CppUtest/src/CppUtest/CMakeLists.txt
as a sub-project.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">include_directories</span>(${<span class="org-variable-name">CppUTestRootDirectory</span>}/include)
<span class="org-function-name">add_subdirectory</span>(src/CppUTest)
</pre>
</div>

<ul class="org-ul">
<li>The file extern/CppUtest/src/CppUtest/CMakeLists.txt contains the
following lines which defines the target CppUtest which the top
level CMakeLists.txt that has add_subdirectory(extern/cpputest)
can link against:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_library</span>( CppUTest
            CommandLineArguments.cpp
            MemoryLeakWarningPlugin.cpp
            TestHarness_c.cpp
            ... ... ... ... 
           )
</pre>
</div>

<p>
<b>File: main.cpp</b>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">spdlog/spdlog.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/CommandLineTestRunner.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/Utest.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/TestHarness.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">double</span> <span class="org-function-name">func</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> 3 * x * x - 21.0 * x + 36.0;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-function-name">TEST_GROUP</span><span class="org-rainbow-delimiters-depth-1">(</span>MainTest<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-function-name">TEST</span><span class="org-rainbow-delimiters-depth-1">(</span>MainTest, functionPoints<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Running functionPointsTest."</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>4.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>3.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>3.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>10.0, func<span class="org-rainbow-delimiters-depth-3">(</span>126.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Supposed to fail</span>
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>1.0, func<span class="org-rainbow-delimiters-depth-3">(</span>18.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Ending functionPointsTest."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Entering function"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Starting server OK."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::error<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Server crashed. "</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Received request from 192.168.10.1 at port 9090"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Sending response to client 192.168.100.1 connection ID 10"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"========== Running Tests ============"</span> &lt;&lt; <span class="org-constant">std</span>::endl;

    <span class="org-keyword">return</span> RUN_ALL_TESTS<span class="org-rainbow-delimiters-depth-2">(</span>argc, argv<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Build on Command Line</b> 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -B_build -GNinja -DCMAKE_BUILD_TYPE=Debug
 ... ... ... ... ... ... 
-------------------------------------------------------

-- Configuring done
-- Generating done
-- Build files have been written to: /home/archbox/projects/cmake-experiment/_build

$ cmake --build _build --target
</pre>
</div>

<p>
<b>Running</b> 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ _build/app 
[2019-07-11 17:24:59.450] [info] Starting server OK.
[2019-07-11 17:24:59.450] [error] Server crashed. 
[2019-07-11 17:24:59.450] [info] Received request from 192.168.10.1 at port 9090
[2019-07-11 17:24:59.451] [info] Sending response to client 192.168.100.1 connection ID 10
========== Running Tests ============
[2019-07-11 17:24:59.451] [info] Running functionPointsTest.

<span class="org-function-name">../main.cpp</span>:23: error: Failure<span class="org-keyword"> in</span> TEST(MainTest, functionPoints)
        expected &lt;10&gt;
        but was  &lt;45018&gt; threshold used was &lt;0.001&gt;

<span class="org-builtin">.</span>
<span class="org-function-name">Errors</span> (1 failures, 1 tests, 1 ran, 4 checks, 0 ignored, 0 filtered out, 1 ms)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb559a01" class="outline-4">
<h4 id="orgb559a01"><span class="section-number-4">1.10.3</span> FetchContent module (Approach 1)</h4>
<div class="outline-text-4" id="text-1-10-3">
<p>
The CMake module <a href="https://cmake.org/cmake/help/v3.15/module/FetchContent.html">FetchContent</a> can fetch dependencies at configuration
time from many possible sources such as GIT remote repositories, http
servers (URLs) and compressed files such as *.tar, *.tgz, *.zip and so
on.
</p>

<p>
Documentation: 
</p>
<ul class="org-ul">
<li><a href="https://cmake.org/cmake/help/v3.15/module/FetchContent.html">https://cmake.org/cmake/help/v3.15/module/FetchContent.html</a></li>
</ul>

<p>
See also: 
</p>
<ul class="org-ul">
<li><a href="https://cmake.org/cmake/help/latest/module/ExternalProject.html">https://cmake.org/cmake/help/latest/module/ExternalProject.html</a></li>
<li><a href="https://blog.kitware.com/cmake-superbuilds-git-submodules/">https://blog.kitware.com/cmake-superbuilds-git-submodules/</a></li>
</ul>

<p>
<b>Example:</b> 
</p>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.14 FATAL_ERROR)
<span class="org-function-name">project</span>(cmake-experiment)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment"># See documentation at: https://cmake.org/cmake/help/latest/module/FetchContent.html</span>
<span class="org-function-name">include</span>(FetchContent)

<span class="org-comment">#========== Fetch cpputest ============================#</span>

<span class="org-function-name">FetchContent_Declare</span>(
    cpputest
    GIT_REPOSITORY  <span class="org-string">"https://github.com/cpputest/cpputest.git"</span>
    GIT_TAG         <span class="org-string">"v3.8"</span>
)
<span class="org-function-name">FetchContent_GetProperties</span>(cpputest)
<span class="org-keyword">if</span>(NOT cpputest_POPULATED)
    <span class="org-function-name">FetchContent_Populate</span>(cpputest)
    <span class="org-function-name">message</span>(<span class="org-string">" [INFO] cpputest_SOURCE_DIR = ${</span><span class="org-variable-name">cpputest_SOURCE_DIR</span><span class="org-string">} "</span>)
    <span class="org-function-name">message</span>(<span class="org-string">" [INFO] cpputest_BINARY_DIR = ${</span><span class="org-variable-name">cpputest_BINARY_DIR</span><span class="org-string">} "</span>)

    <span class="org-comment"># Optional =&gt; From: https://github.com/cpputest/cpputest/blob/master/CMakeLists.txt</span>
    <span class="org-function-name">set</span>(TEST OFF)
    <span class="org-function-name">set</span>(TEST_DETAILED OFF)

    <span class="org-function-name">add_subdirectory</span>(${<span class="org-variable-name">cpputest_SOURCE_DIR</span>} ${<span class="org-variable-name">cpputest_BINARY_DIR</span>})

    <span class="org-comment"># Note: this path was found by trial and error, it is library-specific</span>
    <span class="org-function-name">include_directories</span>(${<span class="org-variable-name">cpputest_SOURCE_DIR</span>}/include)
<span class="org-keyword">endif</span>()

<span class="org-comment">#===== Fetch spdlog as archive ====================#</span>

<span class="org-function-name">FetchContent_Declare</span>(
    spdlog
    URL       <span class="org-string">"https://github.com/gabime/spdlog/archive/v1.3.1.zip"</span>
)
<span class="org-function-name">FetchContent_GetProperties</span>(spdlog)
<span class="org-keyword">if</span>(NOT spdlog_POPULATED)
    <span class="org-function-name">FetchContent_Populate</span>(spdlog)
    <span class="org-comment"># message(" [INFO] spdlog_SOURCE_DIR = ${</span><span class="org-variable-name">spdlog_SOURCE_DIR</span><span class="org-comment">} ")</span>
    <span class="org-comment"># message(" [INFO] spdlog_BINARY_DIR = ${</span><span class="org-variable-name">spdlog_BINARY_DIR</span><span class="org-comment">} ")</span>

    <span class="org-comment"># Optional =&gt; Set library build options</span>
    <span class="org-comment"># Build options at: https://github.com/gabime/spdlog/blob/v1.x/CMakeLists.txt</span>
    <span class="org-function-name">set</span>(SPDLOG_BUILD_EXAMPLES OFF)
    <span class="org-function-name">set</span>(SPDLOG_BUILD_BENCH    OFF)
    <span class="org-function-name">set</span>(SPDLOG_BUILD_TESTS    OFF)

    <span class="org-function-name">add_subdirectory</span>(${<span class="org-variable-name">spdlog_SOURCE_DIR</span>} ${<span class="org-variable-name">spdlog_BINARY_DIR</span>})
<span class="org-keyword">endif</span>()

<span class="org-comment"># ========= Target Settings ==========================#</span>
<span class="org-function-name">add_executable</span>(app main.cpp)
<span class="org-function-name">target_link_libraries</span>(app  CppUTest spdlog::spdlog)
</pre>
</div>

<p>
File: main.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">spdlog/spdlog.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/CommandLineTestRunner.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/Utest.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">CppUTest/TestHarness.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">double</span> <span class="org-function-name">func</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> 3 * x * x - 21.0 * x + 36.0;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-function-name">TEST_GROUP</span><span class="org-rainbow-delimiters-depth-1">(</span>MainTest<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-function-name">TEST</span><span class="org-rainbow-delimiters-depth-1">(</span>MainTest, functionPoints<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Running functionPointsTest."</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>4.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>3.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>0.0, func<span class="org-rainbow-delimiters-depth-3">(</span>3.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>10.0, func<span class="org-rainbow-delimiters-depth-3">(</span>126.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Supposed to fail</span>
    DOUBLES_EQUAL<span class="org-rainbow-delimiters-depth-2">(</span>1.0, func<span class="org-rainbow-delimiters-depth-3">(</span>18.0<span class="org-rainbow-delimiters-depth-3">)</span>, 0.001<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Ending functionPointsTest."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Entering function"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Starting server OK."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::error<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Server crashed. "</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Received request from 192.168.10.1 at port 9090"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Sending response to client 192.168.100.1 connection ID 10"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"========== Running Tests ============"</span> &lt;&lt; <span class="org-constant">std</span>::endl;

    <span class="org-keyword">return</span> RUN_ALL_TESTS<span class="org-rainbow-delimiters-depth-2">(</span>argc, argv<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Building and running from command line:</b>
</p>

<p>
Configuration step 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=Debug
-- The C compiler identification is GNU 8.3.1
-- The CXX compiler identification is GNU 8.3.1
-- Check for working C compiler: /usr/lib64/ccache/cc
-- Check for working C compiler: /usr/lib64/ccache/cc -- works

 ... .... ... ... ... ... ... ... ... ... 

-- Configuring done
-- Generating done
-- Build files have been written to: /home/user/projects/cmake-experiment/build
</pre>
</div>

<p>
Building step 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build build --target
</pre>
</div>

<p>
Check build directory: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tree -L 2 build
build
&#9500;&#9472;&#9472; app
&#9500;&#9472;&#9472; CMakeCache.txt
&#9500;&#9472;&#9472; CMakeFiles
&#9474;&#160;&#160; &#9500;&#9472;&#9472; 3.14.3
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app.dir
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cmake.check_cache
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeDirectoryInformation.cmake
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeError.log
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeOutput.log
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeRuleHashes.txt
&#9474;&#160;&#160; &#9500;&#9472;&#9472; CMakeTmp
&#9474;&#160;&#160; &#9500;&#9472;&#9472; feature_tests.bin
&#9474;&#160;&#160; &#9500;&#9472;&#9472; feature_tests.c
&#9474;&#160;&#160; &#9500;&#9472;&#9472; feature_tests.cxx
&#9474;&#160;&#160; &#9500;&#9472;&#9472; Makefile2
&#9474;&#160;&#160; &#9500;&#9472;&#9472; Makefile.cmake
&#9474;&#160;&#160; &#9500;&#9472;&#9472; progress.marks
&#9474;&#160;&#160; &#9492;&#9472;&#9472; TargetDirectories.txt
&#9500;&#9472;&#9472; cmake_install.cmake
&#9500;&#9472;&#9472; _deps
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cpputest-build
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cpputest-src
&#9474;&#160;&#160; &#9500;&#9472;&#9472; cpputest-subbuild
&#9474;&#160;&#160; &#9500;&#9472;&#9472; spdlog-build
&#9474;&#160;&#160; &#9500;&#9472;&#9472; spdlog-src
&#9474;&#160;&#160; &#9492;&#9472;&#9472; spdlog-subbuild
&#9500;&#9472;&#9472; Makefile
&#9500;&#9472;&#9472; spdlogConfigVersion.cmake
&#9492;&#9472;&#9472; spdlog.pc

11 directories, 18 files

</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ build/app 
[2019-07-14 01:16:58.305] [info] Starting server OK.
[2019-07-14 01:16:58.305] [error] Server crashed. 
[2019-07-14 01:16:58.305] [info] Received request from 192.168.10.1 at port 9090
[2019-07-14 01:16:58.305] [info] Sending response to client 192.168.100.1 connection ID 10
========== Running Tests ============
[2019-07-14 01:16:58.305] [info] Running functionPointsTest.

<span class="org-function-name">/home/archbox/projects/cmake-experiment/main.cpp</span>:23: error: Failure<span class="org-keyword"> in</span> TEST(MainTest, functionPoints)
        expected &lt;10&gt;
        but was  &lt;45018&gt; threshold used was &lt;0.001&gt;

<span class="org-builtin">.</span>
<span class="org-function-name">Errors</span> (1 failures, 1 tests, 1 ran, 4 checks, 0 ignored, 0 filtered out, 0 ms)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0947dff" class="outline-4">
<h4 id="org0947dff"><span class="section-number-4">1.10.4</span> FetchContent module (Approach 2)</h4>
<div class="outline-text-4" id="text-1-10-4">
<p>
The usage of the CMake module FetchContent can be simplified by
defining functions and macros encapsulating its functionalities.
</p>

<p>
Libraries Used: 
</p>
<ul class="org-ul">
<li><a href="https://github.com/tplgy/cppcodec">cppcodec</a></li>
<li><a href="https://github.com/gabime/spdlog">spdlog</a></li>
</ul>

<p>
Example: 
</p>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.14 FATAL_ERROR)
<span class="org-function-name">project</span>(cmake-experiment)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment"># See documentation at: https://cmake.org/cmake/help/latest/module/FetchContent.html</span>

<span class="org-comment">#========== Macros for automating Library Fetching =============#</span>
<span class="org-function-name">include</span>(FetchContent)

<span class="org-comment"># Download library from Github and add it as sub-project</span>
<span class="org-comment">#</span>
<span class="org-keyword">macro</span>(Download_Library_Git  NAME TAG REPOSITORY_URL)
    <span class="org-function-name">FetchContent_Declare</span>(
        ${<span class="org-variable-name">NAME</span>}
        GIT_REPOSITORY  ${<span class="org-variable-name">REPOSITORY_URL</span>}
        GIT_TAG         ${<span class="org-variable-name">TAG</span>}
    )
    <span class="org-function-name">FetchContent_GetProperties</span>(${<span class="org-variable-name">NAME</span>})
    <span class="org-keyword">if</span>(NOT cpputest_POPULATED)
        <span class="org-function-name">FetchContent_Populate</span>(${<span class="org-variable-name">NAME</span>})
        <span class="org-function-name">message</span>(<span class="org-string">"${</span><span class="org-variable-name">NAME</span><span class="org-string">}_SOURCE_DIR} = ${${</span><span class="org-variable-name">NAME</span><span class="org-string">}_SOURCE_DIR}"</span>)
        <span class="org-function-name">add_subdirectory</span>(${${<span class="org-variable-name">NAME</span>}_SOURCE_DIR} ${${<span class="org-variable-name">NAME</span>}_BINARY_DIR})
    <span class="org-keyword">endif</span>()
<span class="org-keyword">endmacro</span>()

<span class="org-keyword">macro</span>(Download_Library_Github LIBRARY_NAME TAG USER PROJECT )
    <span class="org-function-name">Download_Library_Git</span>(
        ${<span class="org-variable-name">LIBRARY_NAME</span>}
        ${<span class="org-variable-name">TAG</span>}
        <span class="org-string">"https://github.com/${</span><span class="org-variable-name">USER</span><span class="org-string">}/${</span><span class="org-variable-name">PROJECT</span><span class="org-string">}.git"</span>
        )
<span class="org-keyword">endmacro</span>()

<span class="org-comment"># Download library archive (zip, *.tar.gz, ...) from URL</span>
<span class="org-keyword">macro</span>(Download_Library_Url NAME URL)
    <span class="org-function-name">FetchContent_Declare</span>(${<span class="org-variable-name">NAME</span>} URL  ${<span class="org-variable-name">URL</span>})
    <span class="org-function-name">FetchContent_GetProperties</span>(${<span class="org-variable-name">NAME</span>})
    <span class="org-keyword">if</span>(NOT ${<span class="org-variable-name">NAME</span>}_POPULATED)
        <span class="org-function-name">FetchContent_Populate</span>(${<span class="org-variable-name">NAME</span>})
        <span class="org-function-name">add_subdirectory</span>(${${<span class="org-variable-name">NAME</span>}_SOURCE_DIR} ${${<span class="org-variable-name">NAME</span>}_BINARY_DIR})
    <span class="org-keyword">endif</span>()
<span class="org-keyword">endmacro</span>()

<span class="org-comment"># Add path header files to the include path of all targets.</span>
<span class="org-comment"># =&gt; NAME =&gt; Library name added with any Download_Library command.</span>
<span class="org-comment"># =&gt; RELATIVE_PATH =&gt; Path to header files relative to library root directory</span>
<span class="org-comment">#</span>
<span class="org-keyword">function</span>(include_headers_directory NAME REALATIVE_PATH)
    <span class="org-function-name">include_directories</span>(<span class="org-string">"${${</span><span class="org-variable-name">NAME</span><span class="org-string">}_SOURCE_DIR}/${</span><span class="org-variable-name">RELATIVE_PATH</span><span class="org-string">}"</span>)
<span class="org-keyword">endfunction</span>()

<span class="org-comment">#============== Library Download =========================#</span>

<span class="org-function-name">Download_Library_Url</span>(
    spdlog
    <span class="org-string">"https://github.com/gabime/spdlog/archive/v1.3.1.zip"</span>
    )

<span class="org-function-name">Download_Library_Github</span>(
    cppcodec  <span class="org-comment"># Library name - arbitrary</span>
    v0.2      <span class="org-comment"># Git tag</span>
    tplgy     <span class="org-comment"># Github user name</span>
    cppcodec  <span class="org-comment"># Name of project that will be cloned.</span>
              <span class="org-comment"># Note: It is does not always have the same name as the library.</span>
    )

<span class="org-comment"># Only use it if CMake cannot find the headers or the library is not</span>
<span class="org-comment"># set properly.</span>
<span class="org-function-name">include_headers_directory</span>(cppcodec ./cppcodec)

<span class="org-comment"># ========= Targets Settings ==========================#</span>

<span class="org-function-name">add_executable</span>(mainapp main.cpp)
<span class="org-function-name">target_link_libraries</span>(mainapp cppcodec spdlog::spdlog)
</pre>
</div>

<p>
<b>File:</b> main.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">spdlog/spdlog.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cppcodec/base32_crockford.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cppcodec/base64_rfc4648.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>


<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Entering function"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Starting server OK."</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Received request from 192.168.10.1 at port 9090"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Sending response to client 192.168.100.1 connection ID 10"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">using</span> <span class="org-type">base32</span> = <span class="org-constant">cppcodec</span>::base32_crockford;
    <span class="org-keyword">using</span> <span class="org-type">base64</span> = <span class="org-constant">cppcodec</span>::base64_rfc4648;

    <span class="org-constant">std</span>::<span class="org-type">vector</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">uint8_t</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">decoded</span> = <span class="org-constant">base64</span>::decode<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"YW55IGNhcm5hbCBwbGVhc3VyZQ=="</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"decoded size (\"any carnal pleasure\"): "</span> &lt;&lt; decoded.size<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">'\n'</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">base32</span>::encode<span class="org-rainbow-delimiters-depth-2">(</span>decoded<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-constant">std</span>::endl; <span class="org-comment-delimiter">// </span><span class="org-comment">"C5Q7J833C5S6WRBC41R6RSB1EDTQ4S8"</span>


    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cd proejct_directory 
$ cmake -B_build -H. -DCMAKE_BUILD_TYPE=Debug
$ cmake --build _build --target

<span class="org-comment-delimiter"># </span><span class="org-comment">Run </span>
$ _build/mainapp 
[2019-07-19 17:46:56.306] [info] Starting server OK.
[2019-07-19 17:46:56.306] [info] Received request from 192.168.10.1 at port 9090
[2019-07-19 17:46:56.306] [info] Sending response to client 192.168.100.1 connection ID 10
decoded size (<span class="org-string">"any carnal pleasure"</span>): 19
C5Q7J833C5S6WRBC41R6RSB1EDTQ4S8
</pre>
</div>
</div>
</div>

<div id="outline-container-org93a8ed0" class="outline-4">
<h4 id="org93a8ed0"><span class="section-number-4">1.10.5</span> FetchContent_makeAvailable (Approach 3)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="opengl">opengl</span>&#xa0;<span class="glfw">glfw</span>&#xa0;<span class="graphics">graphics</span></span></h4>
<div class="outline-text-4" id="text-1-10-5">
<p>
This example demonstrates how to use FetchContent for building an
OpenGL application that uses the GLFW library downloaded from github
releases URL. The commands FetchContent_Declare and
FetchContent_MakeAvaiable can be used with any other library as long
as it has CMakeLists.txt in its root directory.
</p>

<p>
Key CMake Commands Uses: 
</p>

<ul class="org-ul">
<li>FetchContent_MakeAvailable</li>
<li>FetchContent_Declare</li>
</ul>

<p>
See: 
</p>

<ul class="org-ul">
<li>GLFW Official Web Site
<ul class="org-ul">
<li><a href="https://www.glfw.org/">https://www.glfw.org/</a></li>
</ul></li>

<li>Documentation:
<ul class="org-ul">
<li><a href="https://www.glfw.org/documentation.html">https://www.glfw.org/documentation.html</a></li>
</ul></li>

<li>GLFW Repository
<ul class="org-ul">
<li><a href="https://github.com/glfw/glfw">https://github.com/glfw/glfw</a></li>
</ul></li>

<li>GLWF Releases
<ul class="org-ul">
<li><a href="https://github.com/glfw/glfw/releases">https://github.com/glfw/glfw/releases</a></li>
</ul></li>

<li>Glut Teapot 
<ul class="org-ul">
<li><a href="https://github.com/Balajanovski/teapot-demo">https://github.com/Balajanovski/teapot-demo</a></li>
<li><a href="https://www.sjbaker.org/wiki/index.php?title=The_History_of_The_Teapot#Images_of_the_Complete_Dataset">https://www.sjbaker.org/wiki/index.php?title=The_History_of_The_Teapot#Images_of_the_Complete_Dataset</a></li>
</ul></li>
</ul>


<p>
<b>Install Development Dependencies for Ubuntu Linux</b> 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ sudo apt-get install -y freeglut3-dev
$ sudo apt-get install -y libxi-dev
$ sudo apt-get install -y libxcursor-dev
$ sudo apt-get install -y libxrandr-dev
$ sudo apt-get install -y libxinerama-dev
</pre>
</div>

<p>
<b>Sample Project</b> 
</p>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.5)
<span class="org-function-name">project</span>(GLFW_project)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment">#================ GLFW Settings  ===============#</span>

<span class="org-function-name">include</span>(FetchContent)

<span class="org-comment"># Set GLFW Options before FectchContent_MakeAvailable </span>
<span class="org-function-name">set</span>( GLFW_BUILD_EXAMPLES OFF CACHE BOOL  <span class="org-string">"GLFW lib only"</span> )
<span class="org-function-name">set</span>( GLFW_BUILD_TESTS OFF CACHE BOOL     <span class="org-string">"GLFW lib only"</span> )
<span class="org-function-name">set</span>( GLFW_BUILD_DOCS OFF CACHE BOOL      <span class="org-string">"GLFW lib only"</span> )
<span class="org-function-name">set</span>( GLFW_BUILD_INSTALL OFF CACHE BOOL   <span class="org-string">"GLFW lib only"</span> )

<span class="org-function-name">FetchContent_Declare</span>(
  glfwlib
  URL   https://github.com/glfw/glfw/releases/download/3.3.2/glfw-3.3.2.zip
)

<span class="org-function-name">FetchContent_MakeAvailable</span>(glfwlib)

<span class="org-comment">#========= Find Packages =========================#</span>

<span class="org-function-name">find_package</span>(OpenGL REQUIRED)

<span class="org-comment">#========== Target Configurations ================#</span>

<span class="org-function-name">add_executable</span>(app1 main.cpp)
<span class="org-function-name">target_link_libraries</span>(app1 glfw OpenGL::GL glut GLU)
</pre>
</div>

<p>
File: main.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">GLFW/glfw3.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">GL/glu.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">GL/glut.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">GLFWwindow</span>* <span class="org-variable-name">window</span>;

    <span class="org-comment-delimiter">/* </span><span class="org-comment">Initialize the library */</span>
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-negation-char">!</span>glfwInit<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> -1;

    glutInit<span class="org-rainbow-delimiters-depth-2">(</span>&amp;argc, argv<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">/* </span><span class="org-comment">Create a windowed mode window and its OpenGL context */</span>
    window = glfwCreateWindow<span class="org-rainbow-delimiters-depth-2">(</span>640, 480, <span class="org-string">"Hello World"</span>, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-negation-char">!</span>window<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
        glfwTerminate<span class="org-rainbow-delimiters-depth-3">()</span>;
        <span class="org-keyword">return</span> -1;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">/* </span><span class="org-comment">Make the window's context current */</span>
    glfwMakeContextCurrent<span class="org-rainbow-delimiters-depth-2">(</span>window<span class="org-rainbow-delimiters-depth-2">)</span>;

    glClearColor<span class="org-rainbow-delimiters-depth-2">(</span>0.0f, 0.5f, 0.6f, 1.0f<span class="org-rainbow-delimiters-depth-2">)</span>;


    <span class="org-comment-delimiter">/* </span><span class="org-comment">Loop until the user closes the window */</span>
    <span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-negation-char">!</span>glfwWindowShouldClose<span class="org-rainbow-delimiters-depth-3">(</span>window<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-comment-delimiter">/* </span><span class="org-comment">Render here */</span>
        glClear<span class="org-rainbow-delimiters-depth-3">(</span>GL_COLOR_BUFFER_BIT<span class="org-rainbow-delimiters-depth-3">)</span>;

        glRotated<span class="org-rainbow-delimiters-depth-3">(</span>15.0, 1.0, 1.0, 1.0<span class="org-rainbow-delimiters-depth-3">)</span>;
        ::glutWireTeapot<span class="org-rainbow-delimiters-depth-3">(</span>0.65<span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-comment-delimiter">/* </span><span class="org-comment">Swap front and back buffers */</span>
        glfwSwapBuffers<span class="org-rainbow-delimiters-depth-3">(</span>window<span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-comment-delimiter">/* </span><span class="org-comment">Poll for and process events */</span>
        glfwPollEvents<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    glfwTerminate<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Building from Command Line</b> 
</p>

<p>
<span class="underline">Configuration step</span>
</p>

<ul class="org-ul">
<li>$ cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug 
-- The C compiler identification is GNU 8.3.1
-- The CXX compiler identification is GNU 8.3.1
    ... ... ... .... ... 

-- Found OpenGL: /usr/lib64/libOpenGL.so   
-- Configuring done
-- Generating done
-- Build files have been written to: /home/archbox/projects/glfw-learning/_build

</pre>
</div>

<p>
<span class="underline">Building step</span>
</p>

<ul class="org-ul">
<li>$ cmake &#x2013;build _build &#x2013;target</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _build --target 

... ... ... ... ... ... 
... ... ... ... ... ... 

Scanning dependencies of target glfw
<span class="org-function-name">gmake</span>[<span class="org-compilation-line-number">2</span>]: Leaving directory <span class="org-string">'/home/archbox/projects/glfw-learning/_build'</span>
/usr/bin/gmake -f _deps/glfwlib-build/src/CMakeFiles/glfw.dir/build.make _deps/glfwlib-build/src/CMakeFiles/glfw.dir/build
<span class="org-function-name">gmake</span>[<span class="org-compilation-line-number">2</span>]: Entering directory <span class="org-string">'/home/archbox/projects/glfw-learning/_build'</span>
[  5%] Building C object _deps/glfwlib-build/src/CMakeFiles/glfw.dir/context.c.o

 ... ... ... ... ... .. 
... ... ... ... ... ... 

[ 10%] Building C object _deps/glfwlib-build/src/CMakeFiles/glfw.dir/init.c.o

... ... ... ... ... ... 
... ... ... ... ... ... 

[ 89%] Linking C static library libglfw3.a

[100%] Linking CXX executable app1

</pre>
</div>

<p>
<span class="underline">Running</span> 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ _build/app1 
</pre>
</div>


<div class="figure">
<p><a href="images/opengl_glut_teapot1.png"><img src="images/opengl_glut_teapot1.png" alt="opengl_glut_teapot1.png" /></a>
</p>
<p><span class="figure-number">Figure 1: </span>Graphics Output</p>
</div>
</div>
</div>
<div id="outline-container-org5c4b6bf" class="outline-4">
<h4 id="org5c4b6bf"><span class="section-number-4">1.10.6</span> CPM.cmake module [best]&#xa0;&#xa0;&#xa0;<span class="tag"><span class="cmake">cmake</span>&#xa0;<span class="best">best</span>&#xa0;<span class="dependency">dependency</span></span></h4>
<div class="outline-text-4" id="text-1-10-6">
<p>
The CMake module CPM.cmake is a wrapper around CMake's FetchContent
which simplifies downloading libraries and dependencies
sub-projects. It can download libraries from GIT repositories, HTTP
servers and FTP servers. The downside of this dependency management
that it is only suitable for ligthweight libraries. 
</p>

<p>
This dependency approach is suitable not for large libraries or
frameworks with significant compile time, such as Boost libraries, QT
Framework or Poco libraries, as a downloaded library will have to be
recompiled for every new project. For this case, the best solution is
to use a package manage such as Conan or Vcpkg which can reuse binary
artifacts across many projects.
</p>

<p>
Official Repository: 
</p>
<ul class="org-ul">
<li><a href="https://github.com/TheLartians/CPM.cmake">https://github.com/TheLartians/CPM.cmake</a></li>
</ul>

<p>
Examples: 
</p>
<ul class="org-ul">
<li><a href="https://github.com/TheLartians/CPM.cmake/wiki/More-Snippets">https://github.com/TheLartians/CPM.cmake/wiki/More-Snippets</a></li>
</ul>


<p>
<b>Sample Project</b> 
</p>

<p>
In this sample project, the CMakeLists.txt automatically downloads and
installs CPM.cmake in the current project binary directory
${CMAKE_BINARY_DIR}. The module CPM.cmake provide the function
'CPMAddPackage' which is used for fetching the librares <span class="underline">spdlog</span> and
<span class="underline">cppcodec</span> from HTTP server and GIT repository. 
</p>

<p>
Gist: 
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/caiorss/76b8540d8a358ab0c740709962e1e511">GIST 76b8540d8a358ab0c740709962e1e511</a></li>
</ul>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(Simple_Cmake_Project)

<span class="org-comment-delimiter">#</span><span class="org-comment">========== Global Configurations =============#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">----------------------------------------------#</span>

<span class="org-builtin">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-builtin">set</span>(CMAKE_VERBOSE_MAKEFILE ON)
<span class="org-builtin">set</span>(CMAKE_CXX_EXTENSIONS OFF)

<span class="org-comment-delimiter"># </span><span class="org-comment">------------ Download CPM CMake Script ----------------#</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">Automatically donwload and use module CPM.cmake</span>
<span class="org-function-name">file</span>(DOWNLOAD https://raw.githubusercontent.com/TheLartians/CPM.cmake/v0.26.2/cmake/CPM.cmake
                 <span class="org-string">"${CMAKE_BINARY_DIR}/CPM.cmake"</span>)
<span class="org-function-name">include</span>(<span class="org-string">"${CMAKE_BINARY_DIR}/CPM.cmake"</span>)

<span class="org-comment-delimiter">#</span><span class="org-comment">----------- Add dependencies --------------------------#</span>

<span class="org-function-name">CPMAddPackage</span>(
    NAME spdlog
    URL  <span class="org-string">"https://github.com/gabime/spdlog/archive/v1.3.1.zip"</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">--&gt;&gt; Only enable this, if the library does not use CMake.</span>
    <span class="org-comment-delimiter">#      </span><span class="org-comment">The library uses only Makefile, GNU autotools and so on.  </span>
    <span class="org-comment-delimiter">#      </span><span class="org-comment">In other words, does not have a CMakeLists.txt at root directory.</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">DOWNLOAD_ONLY YES</span>
)

<span class="org-function-name">CPMAddPackage</span>(
    NAME               cppcodec 
    GITHUB_REPOSITORY  tplgy/cppcodec 
    GIT_TAG            v0.2
    <span class="org-comment-delimiter">#</span><span class="org-comment">VERSION            0.2 </span>

    OPTIONS 
        <span class="org-string">"BUILD_TESTING OFF"</span>
)
<span class="org-function-name">include_directories</span>( ${<span class="org-variable-name">cppcodec_SOURCE_DIR</span>}/ )

<span class="org-function-name">message</span>([TRACE] <span class="org-string">" spdlog source = ${spdlog_SOURCE_DIR} "</span>)
<span class="org-function-name">message</span>([TRACE] <span class="org-string">" cppcodec source = ${cppcodec_SOURCE_DIR} "</span>)

<span class="org-comment-delimiter">#</span><span class="org-comment">----------- Set targets -------------------------------#</span>

<span class="org-function-name">add_executable</span>(app1 app1.cpp)
<span class="org-function-name">target_link_libraries</span>(app1 cppcodec spdlog::spdlog)
</pre>
</div>


<p>
File: app1.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">spdlog/spdlog.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cppcodec/base32_crockford.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cppcodec/base64_rfc4648.hpp</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>


<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Entering function"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Starting server OK."</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Received request from 192.168.10.1 at port 9090"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">spdlog</span>::info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Sending response to client 192.168.100.1 connection ID 10"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">using</span> <span class="org-type">base32</span> = <span class="org-constant">cppcodec</span>::base32_crockford;
    <span class="org-keyword">using</span> <span class="org-type">base64</span> = <span class="org-constant">cppcodec</span>::base64_rfc4648;

    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">secret</span> = <span class="org-string">"SGVsbG8gd29ybGQgQ01ha2UgQ1BNIHdpdGggYmFzZTY0IGVuY29uZGluZy4="</span>;

    <span class="org-constant">std</span>::<span class="org-type">vector</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">uint8_t</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">decoded</span> = <span class="org-constant">base64</span>::decode<span class="org-rainbow-delimiters-depth-2">(</span>secret<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-2">(</span>decoded.begin<span class="org-rainbow-delimiters-depth-3">()</span>, decoded.end<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt;&gt; Decoded text = "</span> &lt;&lt; text &lt;&lt; <span class="org-constant">std</span>::endl; 

    SPDLOG_TRACE<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Download code </span>
 $ git clone https://gist.github.com/caiorss/76b8540d8a358ab0c740709962e1e511 demo-cpm 
 $ cd demo-cpm

<span class="org-comment-delimiter"># </span><span class="org-comment">[1] Configuration step </span>
 $ cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug
-- The C compiler identification is GNU 10.1.1
-- The CXX compiler identification is GNU 10.1.1
-- Check for working C compiler: /usr/bin/cc
  ... ....  ... ....  ... .... 
 ... ....  ... ....  ... .... 
-- CPM: adding package spdlog@ ()
-- Build type: Debug
-- CPM: adding package cppcodec@0.2 (v0.2)
[TRACE] spdlog source = /home/myuser/temp-projects/cmake-cpm/_build/_deps/spdlog-src 
[TRACE] cppcodec source = /home/myuser/temp-projects/cmake-cpm/_build/_deps/cppcodec-src 
-- Found PkgConfig: /usr/bin/pkg-config (found version <span class="org-string">"1.6.3"</span>) 
-- Checking for module <span class="org-string">'catch2'</span>
--   Package <span class="org-string">'catch2'</span>, required by <span class="org-string">'virtual:world'</span>, not found
-- Did NOT find system Catch2, instead using bundled version
-- Configuring done
-- Generating done
-- Build files have been written to: /home/myuser/temp-projects/cmake-cpm/_build

<span class="org-comment-delimiter"># </span><span class="org-comment">[2] Building step </span>
$ cmake --build _build --target
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ _build/app1 
[2020-06-01 02:34:11.610] [info] Starting server OK.
[2020-06-01 02:34:11.610] [info] Received request from 192.168.10.1 at port 9090
[2020-06-01 02:34:11.610] [info] Sending response to client 192.168.100.1 connection ID 10
 =&gt;&gt; Decoded text = Hello world CMake CPM with base64 enconding
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga9bbf5c" class="outline-3">
<h3 id="orga9bbf5c"><span class="section-number-3">1.11</span> Show system information</h3>
<div class="outline-text-3" id="text-1-11">
<div class="org-src-container">
<pre class="src src-sh">cmake --sytem-information 
</pre>
</div>

<p>
Output on Linux: 
</p>

<div class="org-src-container">
<pre class="src src-sh">Avoid ctest truncation of output: CTEST_FULL_OUTPUT
========================================================
=== MAIN VARIABLES
========================================================
CMAKE_STATIC_LIBRARY_PREFIX == <span class="org-string">"lib"</span>
CMAKE_STATIC_LIBRARY_SUFFIX == <span class="org-string">".a"</span>
CMAKE_SHARED_LIBRARY_PREFIX == <span class="org-string">"lib"</span>
CMAKE_SHARED_LIBRARY_SUFFIX == <span class="org-string">".so"</span>
CMAKE_SHARED_MODULE_PREFIX == <span class="org-string">"lib"</span>
CMAKE_SHARED_MODULE_SUFFIX == <span class="org-string">".so"</span>


CMAKE_DL_LIBS == <span class="org-string">"dl"</span>
CMAKE_LIBRARY_PATH_FLAG == <span class="org-string">"-L"</span>
CMAKE_LINK_LIBRARY_FLAG == <span class="org-string">"-l"</span>
CMAKE_SKIP_RPATH == <span class="org-string">"NO"</span>
CMAKE_SYSTEM_INFO_FILE == <span class="org-string">"Platform/Linux"</span>
CMAKE_SYSTEM_NAME == <span class="org-string">"Linux"</span>
CMAKE_SYSTEM == <span class="org-string">"Linux-4.18.18-200.fc28.x86_64"</span>
CMAKE_CXX_COMPILER == <span class="org-string">"/usr/lib64/ccache/c++"</span>
CMAKE_C_COMPILER == <span class="org-string">"/usr/lib64/ccache/cc"</span>
CMAKE_COMPILER_IS_GNUCC == <span class="org-string">"1"</span>
CMAKE_COMPILER_IS_GNUCXX == <span class="org-string">"1"</span>

// C shared library flag
CMAKE_SHARED_LIBRARY_C_FLAGS == <span class="org-string">"-fPIC"</span>
CMAKE_SHARED_LIBRARY_CREATE_C_FLAGS == <span class="org-string">"-shared"</span>
CMAKE_SHARED_LIBRARY_LINK_FLAGS == <span class="org-string">""</span>
... ...    ... ...    ... ...    ... ...    ... ... 
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fe232c" class="outline-3">
<h3 id="org4fe232c"><span class="section-number-3">1.12</span> Show all modules</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-sh">$ cmake --help-module-list
</pre>
</div>

<p>
Output: 
</p>

<div class="org-src-container">
<pre class="src src-text">AddFileDependencies
AndroidTestUtilities
BundleUtilities
CMakeAddFortranSubdirectory
CMakeBackwardCompatibilityCXX
CMakeDependentOption
CMakeDetermineVSServicePack
CMakeExpandImportedTargets
CMakeFindDependencyMacro
CMakeFindFrameworks
CMakeFindPackageMode
CMakeForceCompiler
CMakeGraphVizOptions

... ... ... ... ... ... 

FindLAPACK
FindLATEX
FindLTTngUST
FindLibArchive
FindLibLZMA
FindLibXml2
FindLibXslt
FindLua
FindLua50
FindLua51
FindMFC
FindMPEG
FindMPEG2
FindMPI
FindMatlab
FindMotif
FindOpenACC

... ... ... ... ... ... ... ... 

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6823ed" class="outline-3">
<h3 id="orgc6823ed"><span class="section-number-3">1.13</span> Microsft Windows Specific</h3>
<div class="outline-text-3" id="text-1-13">
</div>
<div id="outline-container-org787dcb0" class="outline-4">
<h4 id="org787dcb0"><span class="section-number-4">1.13.1</span> Statically link against MINGW runtime</h4>
<div class="outline-text-4" id="text-1-13-1">
<p>
Linking error reporting missing shared libraries is a common issue
that may happen when distributing C or C+++ applications built with
MINGW to other Windows machines without MINGW runtime installed. The
solution for this issue is to static link the executable against MINGW
runtime dependencies as shown in the next sample project.
</p>

<p>
<b>Project Files</b> 
</p>

<p>
File: <span class="underline">CMakeLists.txt</span>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.5)
<span class="org-function-name">project</span>(mingw-statically-linked)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)


<span class="org-comment"># ---------- T A R G E T S  ----------------------------#</span>

<span class="org-comment"># Executable linked dynamically against MinGW libraries</span>
<span class="org-comment"># It may fail to execute if the deployment machine</span>
<span class="org-comment"># does not have MINGW runtime libraries installed. </span>
       <span class="org-function-name">add_executable</span>( winapp-dynam windows-application.cpp)
<span class="org-function-name">target_link_libraries</span>( winapp-dynam stdc++fs )

<span class="org-comment"># Executable statically linked against MingW runtinme  dependencies</span>
<span class="org-comment"># - which allows deploying it on any Windows machine.</span>
<span class="org-comment">#</span>
<span class="org-comment"># find_package( Threads REQUIRED)</span>
<span class="org-function-name">add_executable</span>( winapp-static windows-application.cpp)
<span class="org-function-name">target_link_libraries</span>( winapp-static stdc++fs )

<span class="org-keyword">IF</span>(MINGW)
   <span class="org-function-name">target_link_options</span>( winapp-static PRIVATE                                 
                         -static-libgcc
                         -static-libstdc++
                         -Wl,-Bstatic,--whole-archive -lwinpthread -Wl,--no-whole-archive
                        )
<span class="org-keyword">ENDIF</span>()       


</pre>
</div>

<p>
File: <span class="underline">windows-application.cpp</span> 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">filesystem</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">windows.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">namespace</span> <span class="org-constant">fs</span> = <span class="org-constant">std</span>::filesystem;

<span class="org-type">void</span> <span class="org-function-name">list_directory</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>

    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">" [TRACE] Display root directory of current machine"</span> &lt;&lt; <span class="org-string">'\n'</span>;
    <span class="org-comment-delimiter">/* </span><span class="org-comment">List root directory or C:\\ */</span>
    list_directory<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"C:\\"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stderr, <span class="org-string">" [TRACE] Hello world MS-Windows."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    OutputDebugStringA<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Output of applications built for Window Subsystem"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">/*  </span><span class="org-comment">Show messagebox window */</span>
    <span class="org-type">DWORD</span> <span class="org-keyword">const</span> <span class="org-variable-name">infoboxOptions</span>  = MB_OK | MB_ICONINFORMATION | MB_SETFOREGROUND;
    MessageBoxA<span class="org-rainbow-delimiters-depth-2">(</span> <span class="org-constant">nullptr</span>, <span class="org-string">"Messagebox text"</span>, <span class="org-string">"MessageBox title"</span>, infoboxOptions<span class="org-rainbow-delimiters-depth-2">)</span>;

    OutputDebugStringA<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; Type RETURN to exit"</span> &lt;&lt; <span class="org-constant">std</span>::endl;    
    <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">list_directory</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">auto</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">entry</span> : <span class="org-constant">fs</span>::directory_iterator<span class="org-rainbow-delimiters-depth-3">(</span>path<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">p</span> = entry.path<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; Path = "</span> &lt;&lt; p.filename<span class="org-rainbow-delimiters-depth-3">()</span> &lt;&lt; <span class="org-constant">std</span>::endl;          
  <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<p>
<b>Building</b> 
</p>

<p>
Build using MinGW on Windows.
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -B_build_mingw -DCMAKE_BUILD_TYPE=Debug -G <span class="org-string">"MinGW Makefiles"</span>
$ cmake --build _build_mingw --target

<span class="org-comment-delimiter"># </span><span class="org-comment">View build directory: </span>
$ ls _build_mingw<span class="org-sh-escaped-newline">\</span>
cmake_install.cmake  CMakeFiles/  winapp-dynam.exe*
CMakeCache.txt       Makefile     winapp-static.exe*
</pre>
</div>

<p>
Build cross compiling with Dockercross (see: <a href="https://github.com/dockcross/dockcross">dockcross</a> ), a docker
image for cross compiling for several platforms. Note: This docker
image only statically links MINGW runtime libraries regardless of
CMake settings.
</p>

<div class="org-src-container">
<pre class="src src-sh">$ docker run -it --rm -v $<span class="org-variable-name">PWD</span>:/cwd -w /cwd --entrypoint=bash dockcross/windows-static-x64
$ cmake -H. -B_build_cross_compile -DCMAKE_BUILD_TYPE=Debug
$ cmake --build _build_cross_compile --target

<span class="org-comment-delimiter"># </span><span class="org-comment">View build directory </span>
[root:/cwd/cmake-mingw-project] <span class="org-comment-delimiter"># </span><span class="org-comment">ls _build_cross_compile/</span>
CMakeCache.txt  Makefile             winapp-dynam.exe
CMakeFiles      cmake_install.cmake  winapp-static.exe
</pre>
</div>


<p>
<b>Attempt to run the executable winapp-dynam.exe</b> 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Execute on Windows </span>
$ _build_mingw\winapp-dynam.exe
</pre>
</div>

<p>
An attempt to run the executable winapp-dynam.exe in a machine without
MINGW installed or without any MINGW runtime dependencies results in
the following error messages which are locale-specific (user language
specific).
</p>


<ul class="org-ul">
<li>Error message 1 (Machine with English Locale) : "The code
execution cannot proceed because libgcc_s_seh-1.dll was not
found. Reinstalling the program may fix this problem".</li>

<li>Error message 2 (Machine with English Locale) : "The code
execution cannot proceed because libstdc++-6.dll was not
found. Reinstalling the program may fix this problem".</li>

<li>Error message 1 (Machine with Portuguese Locale) : "A execução do
código não pode continuar porque libgcc_s_seh-1.dll não foi
encontrado. Reinstalando o programa para corrigir o problema."</li>

<li>Error message 2 (Machine with Portuguese Locale) : "A execução do
código não pode continuar porque libstdc++-6 não foi
encontrado. Reinstalando o programa para corrigir o problema."</li>
</ul>


<p>
If an attempt to run this application using Linux's wine is made, the
next error messages appears: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; wine _build_mingw/winapp-dynam.exe  
<span class="org-function-name">002b</span>:err:module:import_dll Library libgcc_s_seh-1.dll (which is needed by L<span class="org-string">"Z:\\home\\user\\Documents\\cmake-mingw-project\\_build_mingw\\winapp-dynam.exe"</span>) not found
<span class="org-function-name">002b</span>:err:module:import_dll Library libstdc++-6.dll (which is needed by L<span class="org-string">"Z:\\home\\user\\Documents\\cmake-mingw-project\\_build_mingw\\winapp-dynam.exe"</span>) not found
<span class="org-function-name">002b</span>:err:module:LdrInitializeThunk Importing dlls for L<span class="org-string">"Z:\\home\\user\\Documents\\cmake-mingw-project\\_build_mingw\\winapp-dynam.exe"</span> failed, status c0000135
</pre>
</div>

<p>
<b>Attempt to run the executable winapp-static.exe</b>  
</p>

<p>
The second executable works without any issues in another Windows
machine without MINGW runtime libraries. This attempt works because
the executable was statically linked against all MINGW runtime
libraries.
</p>

<ul class="org-ul">
<li>Running under Windows 10</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ _build_mingw\winapp-static.exe

 [TRACE] Display root directory of current machine
 =&gt; Path = <span class="org-string">"$Recycle.Bin"</span>
 =&gt; Path = <span class="org-string">"Config.Msi"</span>
 =&gt; Path = <span class="org-string">"Documents and Settings"</span>
 =&gt; Path = <span class="org-string">"hiberfil.sys"</span>
 =&gt; Path = <span class="org-string">"pagefile.sys"</span>
 =&gt; Path = <span class="org-string">"PerfLogs"</span>
 =&gt; Path = <span class="org-string">"Program Files"</span>
 =&gt; Path = <span class="org-string">"Program Files (x86)"</span>
 =&gt; Path = <span class="org-string">"ProgramData"</span>
 =&gt; Path = <span class="org-string">"Recovery"</span>
 =&gt; Path = <span class="org-string">"swapfile.sys"</span>
 =&gt; Path = <span class="org-string">"System Volume Information"</span>
 =&gt; Path = <span class="org-string">"Temp"</span>
 =&gt; Path = <span class="org-string">"Users"</span>
 =&gt; Path = <span class="org-string">"Windows"</span>
 [TRACE] Hello world MS-Windows. =&gt; Type RETURN to exit
</pre>
</div>

<ul class="org-ul">
<li>Running under Wine on Linux</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; wine _build_mingw/winapp-static.exe
[TRACE] Display root directory of current machine
=&gt; Path = <span class="org-string">"Program Files"</span>
=&gt; Path = <span class="org-string">"Program Files (x86)"</span>
=&gt; Path = <span class="org-string">"ProgramData"</span>
=&gt; Path = <span class="org-string">"users"</span>
=&gt; Path = <span class="org-string">"windows"</span>
[TRACE] Hello world MS-Windows. =&gt; Type RETURN to exit

</pre>
</div>
</div>
</div>


<div id="outline-container-orgeacedcd" class="outline-4">
<h4 id="orgeacedcd"><span class="section-number-4">1.13.2</span> Executable Target with resource icon</h4>
<div class="outline-text-4" id="text-1-13-2">
<p>
This section provides an example about how to add a resource icon to a
Windows executable target.
</p>

<p>
Files:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Project Item</th>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Application</td>
<td class="org-left">ProgramWithICON.exe</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Sources:</td>
<td class="org-left">src/main.cpp src/src1.cpp src/src2.cpp</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Icon</td>
<td class="org-left">src/programImage.ico</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Resource script</td>
<td class="org-left">src/icon.rc</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Resource file: src/icon.rc 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Icon Resource =&gt; Compiled by Resource compiler</span>
<span class="org-type">id</span> <span class="org-variable-name">ICON</span> <span class="org-string">"programImage.ico"</span>
</pre>
</div>

<p>
CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"> <span class="org-comment"># .... Omit beginning and global configuration .... #</span>
  <span class="org-function-name">add_executable</span>(ProgramWithICON src/main.cpp src/src1.cpp src/src2.cpp)
 <span class="org-keyword">if</span>(WIN32)
    <span class="org-function-name">target_sources</span>(ProgramWithICON src/icon.rc)
 <span class="org-keyword">endif</span>()

 <span class="org-function-name">target_include_directories</span>(ProgramWithICON  ./includes)
<span class="org-comment"># .... Omit additional configuration ... #</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga860874" class="outline-4">
<h4 id="orga860874"><span class="section-number-4">1.13.3</span> Build executable for console or window subsystem</h4>
<div class="outline-text-4" id="text-1-13-3">
<p>
The following CMakeLists.txt file defines two executables targets
built with the same source file main.cpp. The target
<span class="underline">app_console_subsystem.exe</span> is compiled for the Windows' <b>console subsystem</b> and 
the target <span class="underline">app_window_subsystem.exe</span> for the <b>window subsystem</b>. 
</p>

<p>
Applications compiled for the console subsystem opens a terminal when
clicked and prints the std::cout and std::cerr output to it while
applications built for the window subsystem do not open any terminal
and do not print any std::cout or std::cerr output. 
</p>

<p>
An window-subsystem application can perform logging by using the
Windows API function <a href="https://docs.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-outputdebugstringw">OutputDebugString</a>, writing to a file or
redirecting the std::cout and std::cerr streams to file stream
object such as std::ofstream. 
</p>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 2.8)
<span class="org-function-name">project</span>(cppwindows)

<span class="org-comment">#=======================================</span>

<span class="org-comment"># Copy target file to current directory whenerver it is rebuilt</span>
<span class="org-keyword">function</span>(copy_after_build TARGET_NAME )
    <span class="org-comment"># Note: CMAKE_CURRENT_LIST_DIR is the directory where is this</span>
    <span class="org-comment"># CMakeLists.txt file.</span>
    <span class="org-function-name">set</span>(DESTDIR ${<span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span>}/bin/)
    <span class="org-function-name">file</span>(MAKE_DIRECTORY ${<span class="org-variable-name">DESTDIR</span>})

    <span class="org-comment"># Copy binary file to &lt;CMakeLists.txt didctory&gt;./bin</span>
    <span class="org-comment"># after target is compiled.</span>
    <span class="org-function-name">add_custom_command</span>(TARGET ${<span class="org-variable-name">TARGET_NAME</span>} POST_BUILD
      COMMAND ${<span class="org-variable-name">CMAKE_COMMAND</span>} -E copy
                               $&lt;TARGET_FILE:${<span class="org-variable-name">TARGET_NAME</span>}&gt; ${<span class="org-variable-name">DESTDIR</span>}
                               )
<span class="org-keyword">endfunction</span>()

<span class="org-comment">#----------------------------------------</span>

<span class="org-comment"># Build the executable: app_console_subsystem.exe which opens a</span>
<span class="org-comment"># terminal when clicked</span>
<span class="org-function-name">add_executable</span>(app_console_subsystem main.cpp)
<span class="org-function-name">copy_after_build</span>(app_console_subsystem)

<span class="org-comment"># Builds the executable: app_window_subsystem.exe</span>
<span class="org-comment"># which does not open a terminal when clicked, it only shows</span>
<span class="org-comment"># a message box</span>
<span class="org-function-name">add_executable</span>(app_window_subsystem WIN32 main.cpp)
<span class="org-function-name">copy_after_build</span>(app_window_subsystem)
</pre>
</div>

<p>
File: main.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">windows.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Hello World Windows Console and Window subsystem!"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    OutputDebugStringA<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Output of applications built for Window Subsystem"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Show messagebox window</span>
    <span class="org-type">DWORD</span> <span class="org-keyword">const</span> <span class="org-variable-name">infoboxOptions</span>  = MB_OK | MB_ICONINFORMATION | MB_SETFOREGROUND;
    MessageBoxA<span class="org-rainbow-delimiters-depth-2">(</span> <span class="org-constant">nullptr</span>, <span class="org-string">"Messagebox text"</span>, <span class="org-string">"MessageBox title"</span>, infoboxOptions<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Exit application "</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    OutputDebugStringA<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Exit application"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; Enter RETURN to exit"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>


<div class="figure">
<p><a href="images/cmake_console_subsystem1.png"><img src="images/cmake_console_subsystem1.png" alt="cmake_console_subsystem1.png" /></a>
</p>
<p><span class="figure-number">Figure 2: </span>Application app_console_subsystem.exe (Console subsystem)</p>
</div>


<div class="figure">
<p><a href="images/cmake_window_subsystem1.png"><img src="images/cmake_window_subsystem1.png" alt="cmake_window_subsystem1.png" /></a>
</p>
<p><span class="figure-number">Figure 3: </span>Application app_window_subsystem.exe (Window subsystem)</p>
</div>


<p>
Note: Another way to make the executable to build for the
window-subsystem is by using the following CMake Lines: 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_executable</span>(my-target src1.cpp src1.hpp src2.cpp src2.hpp ... )

<span class="org-keyword">IF</span>(WIN32)
   <span class="org-function-name">set_property</span>(TARGET my-target PROPERTY WIN32_EXECUTALE true)
<span class="org-keyword">ENDIF</span>()
</pre>
</div>
</div>
</div>

<div id="outline-container-orged8996a" class="outline-4">
<h4 id="orged8996a"><span class="section-number-4">1.13.4</span> Set target subsystem: console/window</h4>
<div class="outline-text-4" id="text-1-13-4">
<p>
Set target subsystem. 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(WIN32)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES LINK_FLAGS_DEBUG <span class="org-string">"/SUBSYSTEM:CONSOLE"</span>)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES COMPILE_DEFINITIONS_DEBUG <span class="org-string">"_CONSOLE"</span>)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES LINK_FLAGS_RELWITHDEBINFO <span class="org-string">"/SUBSYSTEM:CONSOLE"</span>)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES COMPILE_DEFINITIONS_RELWITHDEBINFO <span class="org-string">"_CONSOLE"</span>)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES LINK_FLAGS_RELEASE <span class="org-string">"/SUBSYSTEM:WINDOWS"</span>)
   <span class="org-function-name">set_target_properties</span>(WindowApplicationExample PROPERTIES LINK_FLAGS_MINSIZEREL <span class="org-string">"/SUBSYSTEM:WINDOWS"</span>)
<span class="org-keyword">endif</span>(WIN32)
</pre>
</div>

<p>
Taken from: 
</p>
<ul class="org-ul">
<li><a href="https://gitlab.kitware.com/cmake/community/wikis/doc/cmake/recipe/VSConfigSpecificSettings">Vsconfigspecificsettings · Wiki · CMake / Community · GitLab</a></li>
<li><a href="https://developercommunity.visualstudio.com/content/problem/46678/cmake-set-subsystem-to-console.html">cmake: Set subsystem to console - Developer Community</a></li>
<li><a href="https://stackoverflow.com/questions/33873735/correctly-set-visual-studio-linker-flag-subsystem-in-cmake">c++ -
Correctly set Visual Studio linker flag /SUBSYSTEM in CMAKE - Stack
Overflow</a></li>
</ul>
</div>
</div>
<div id="outline-container-org1584dae" class="outline-4">
<h4 id="org1584dae"><span class="section-number-4">1.13.5</span> Export all shared library symbols</h4>
<div class="outline-text-4" id="text-1-13-5">
<p>
CMake has a handy option <span class="underline">CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS</span> that can
export all DLL shared library symbols without any
<code>__declspec(dllexport)</code> or <code>__declspec(dllimport)</code> annotation.
</p>

<p>
<b>Example:</b> 
</p>

<p>
File: main.cpp (executable main.exe)
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.5)
<span class="org-function-name">project</span>(testbed_project)

<span class="org-comment">#=========== Global Settings ==============================#</span>
<span class="org-comment"># ... omit other settings ... </span>

<span class="org-comment"># Export ALL DLLs symbols on Windows without __declspec(xxxx) annotations.</span>
<span class="org-function-name">set</span>(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS true)

<span class="org-comment">#=============== Targets-specific settings ====================#</span>

<span class="org-comment"># Target: libutil (Library)</span>
<span class="org-function-name">add_library</span>(utils SHARED utils.cpp utils.hpp)

<span class="org-comment"># Target: app1 =&gt; Executable (Dynamically linked)</span>
<span class="org-function-name">add_executable</span>(main main1.cpp)
<span class="org-function-name">target_link_libraries</span>(main utils)
</pre>
</div>

<p>
File: utils.hpp (Shared library utils.dll)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _UTILS_HPP_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_UTILS_HPP_</span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">namespace</span>  <span class="org-constant">utils</span> <span class="org-rainbow-delimiters-depth-1">{</span>

     <span class="org-keyword">class</span> <span class="org-type">Dummy</span><span class="org-rainbow-delimiters-depth-2">{</span>
     <span class="org-keyword">private</span>:
          <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">m_name</span> = <span class="org-string">"&lt;Untitled&gt;"</span>;
     <span class="org-keyword">public</span>:
         <span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-3">()</span>;
         <span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-3">)</span>;
         <span class="org-type">void</span>  <span class="org-function-name">showName</span><span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-keyword">const</span>;
     <span class="org-rainbow-delimiters-depth-2">}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
<span class="org-preprocessor">#endif</span> 
</pre>
</div>

<p>
File: utils.cpp (Shared library utils.dll)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string">"utils.hpp"</span>

<span class="org-keyword">namespace</span> <span class="org-constant">utils</span><span class="org-rainbow-delimiters-depth-1">{</span>
      <span class="org-constant">Dummy</span>::<span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>
      <span class="org-constant">Dummy</span>::<span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-2">)</span>: <span class="org-function-name">m_name</span><span class="org-rainbow-delimiters-depth-2">(</span>name<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>

      <span class="org-type">void</span> <span class="org-constant">Dummy</span>::<span class="org-function-name">showName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>
      <span class="org-rainbow-delimiters-depth-2">{</span>
          <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Object name is : "</span> &lt;&lt; m_name &lt;&lt; <span class="org-string">"\n"</span>;
      <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Without the CMake option <span class="underline">CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS</span>, the class
Dummy would need the __declspec annotation and the code would be: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-keyword">__declspec</span><span class="org-rainbow-delimiters-depth-1">(</span>dllexport<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">Dummy</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
     <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">m_name</span> = <span class="org-string">"&lt;Untitled&gt;"</span>;
<span class="org-function-name">public</span>:
    <span class="org-variable-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-variable-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::string <span class="org-keyword">const</span>&amp; name<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">void</span>  <span class="org-variable-name">showName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
To make a symbol private (visible only the <span class="underline">utils.cpp</span> compilation-unit)
annotate it with the <span class="underline">static</span> keyword or place the symbols in a
<span class="underline">anonymous namespace</span>, example:
</p>

<div class="org-src-container">
<pre class="src src-cpp"> <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">internal_function</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">... code here ... </span>
 <span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-keyword">static</span> <span class="org-keyword">class</span> <span class="org-type">InternalClass</span> <span class="org-rainbow-delimiters-depth-1">{</span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">... code here ... </span>
 <span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-keyword">static</span> <span class="org-keyword">struct</span> <span class="org-type">MyStruct</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">double</span> <span class="org-variable-name">x</span>; 
    <span class="org-type">double</span> <span class="org-variable-name">y</span>;
 <span class="org-rainbow-delimiters-depth-1">}</span>; 

<span class="org-comment-delimiter">// </span><span class="org-comment">---- OR make the symbols private with anonymous namespace  ------// </span>

<span class="org-keyword">namespace</span> <span class="org-rainbow-delimiters-depth-1">{</span>

   <span class="org-type">void</span> <span class="org-function-name">internal_function</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span>
     <span class="org-comment-delimiter">// </span><span class="org-comment">... code here ... </span>
   <span class="org-rainbow-delimiters-depth-2">}</span>

   <span class="org-keyword">class</span> <span class="org-type">InternalClass</span> <span class="org-rainbow-delimiters-depth-2">{</span>
     <span class="org-comment-delimiter">// </span><span class="org-comment">... code here ... </span>
   <span class="org-rainbow-delimiters-depth-2">}</span>

   <span class="org-keyword">static</span> <span class="org-keyword">struct</span> <span class="org-type">MyStruct</span><span class="org-rainbow-delimiters-depth-2">{</span>
      <span class="org-type">double</span> <span class="org-variable-name">x</span>; 
      <span class="org-type">double</span> <span class="org-variable-name">y</span>;
   <span class="org-rainbow-delimiters-depth-2">}</span>; 

<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org42982ac" class="outline-3">
<h3 id="org42982ac"><span class="section-number-3">1.14</span> Snippets</h3>
<div class="outline-text-3" id="text-1-14">
</div>
<div id="outline-container-orgf192cd5" class="outline-4">
<h4 id="orgf192cd5"><span class="section-number-4">1.14.1</span> Place build-tree object-code in source directory</h4>
<div class="outline-text-4" id="text-1-14-1">
<p>
The following sample project shows how to place build-tree
object-codes (executables and libraries) in the source directory
(project directory) for making easier to find them wihout browsing the
build tree. 
</p>

<p>
The sample project is comprised of two executables app1 and app2
linked against a shared library libutils. 
</p>

<p>
<b>Sample Project</b> 
</p>

<p>
File: CMakeLists.txt
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.5)
<span class="org-function-name">project</span>(testbed_project)

<span class="org-comment">#=========== Global Settings =================#</span>

<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON) 

<span class="org-comment">#  =&gt; Place executable(s) in ${SOURCE DIRECTORY}/out/bin </span>
<span class="org-comment">#  =&gt; Place libraries in ${SOURCE DIRECTORY}/out/lib </span>
<span class="org-comment">#</span>
<span class="org-comment">#  =&gt; Note: ${SOURCE DIRECTORY} is the directory where is this CMakeLists.txt </span>
<span class="org-function-name">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${<span class="org-variable-name">CMAKE_CURRENT_SOURCE_DIR</span>}/out/lib)
<span class="org-function-name">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${<span class="org-variable-name">CMAKE_CURRENT_SOURCE_DIR</span>}/out/lib)
<span class="org-function-name">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${<span class="org-variable-name">CMAKE_CURRENT_SOURCE_DIR</span>}/out/bin)

<span class="org-comment"># Set relative rpath to shared library in executable object code</span>
<span class="org-comment"># See:</span>
<span class="org-comment">#  =&gt; https://cmake.org/cmake/help/latest/prop_tgt/BUILD_RPATH_USE_ORIGIN.html</span>
<span class="org-comment">#  =&gt; https://gitlab.kitware.com/cmake/community/-/wikis/doc/cmake/RPATH-handling</span>
<span class="org-keyword">if</span>(UNIX)
  <span class="org-function-name">SET</span>(CMAKE_INSTALL_RPATH <span class="org-string">"$ORIGIN/../lib:$ORIGIN/"</span>)
<span class="org-keyword">endif</span>()

<span class="org-comment"># Export ALL DLLs symbols on Windows without __declspec(xxxx) annotations.</span>
<span class="org-function-name">set</span>(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS true)

<span class="org-comment">#=============== Targets-specific settings ====================#</span>

<span class="org-comment"># Target: libutil (Library)</span>
<span class="org-function-name">add_library</span>(utils SHARED utils.cpp utils.hpp)
<span class="org-function-name">add_library</span>(utils_static STATIC utils.cpp utils.hpp)

<span class="org-comment"># Target: app1 =&gt; Executable (Dynamically linked)</span>
<span class="org-function-name">add_executable</span>(app1 main1.cpp)
<span class="org-function-name">target_link_libraries</span>(app1 utils)

<span class="org-comment"># Target: app2 =&gt; Executable (Dynamically linked)</span>
<span class="org-function-name">add_executable</span>(app2 main2.cpp)
<span class="org-function-name">target_link_libraries</span>(app2 utils)

<span class="org-comment"># Target: app1_static =&gt; Executable (static linked)</span>
<span class="org-function-name">add_executable</span>(app1_static main1.cpp)
<span class="org-function-name">target_link_libraries</span>(app1_static utils_static)

<span class="org-comment"># Target: app1_static =&gt; Executable (static linked)</span>
<span class="org-function-name">add_executable</span>(app2_static main1.cpp)
<span class="org-function-name">target_link_libraries</span>(app2_static utils_static)


<span class="org-comment">#============== Target: Install ===============================#</span>
<span class="org-comment"># Equivalent to: $ make install </span>

<span class="org-function-name">install</span>(TARGETS app1 app2 app1_static app2_static utils utils_static  
  RUNTIME  DESTINATION bin <span class="org-comment"># Executable: *.exe, </span>
  LIBRARY  DESTINATION lib <span class="org-comment"># Shared libraries: *.dll, *.so and so on </span>
  ARCHIVE  DESTINATION lib <span class="org-comment"># Static libraries: *.a </span>
)

<span class="org-function-name">install</span>(FILES README.txt DESTINATION ./)

</pre>
</div>

<p>
File: README.txt 
</p>

<div class="org-src-container">
<pre class="src src-text">======= Application User Guide ==========

  + app1 =&gt; Application for creating PCB - Printed Circuit Board
  + app2 =&gt; App. for communicating with remote link

  &lt;INSERT TEXT HERE ....&gt;  
</pre>
</div>

<p>
File: utils.hpp (CMake targets: utils and utils_static)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _UTILS_HPP_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_UTILS_HPP_</span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">namespace</span>  <span class="org-constant">utils</span> <span class="org-rainbow-delimiters-depth-1">{</span>

     <span class="org-keyword">class</span> <span class="org-type">Dummy</span><span class="org-rainbow-delimiters-depth-2">{</span>
     <span class="org-keyword">private</span>:
          <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">m_name</span> = <span class="org-string">"&lt;Untitled&gt;"</span>;
     <span class="org-keyword">public</span>:
          <span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-3">()</span>;
          <span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-3">)</span>;
          <span class="org-type">void</span>  <span class="org-function-name">showName</span><span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-keyword">const</span>;
     <span class="org-rainbow-delimiters-depth-2">}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-preprocessor">#endif</span> 
</pre>
</div>

<p>
File: utils.hpp (CMake targets: utils and utils_static)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-preprocessor">#include</span> <span class="org-string">"utils.hpp"</span>

<span class="org-keyword">namespace</span> <span class="org-constant">utils</span><span class="org-rainbow-delimiters-depth-1">{</span>

     <span class="org-constant">Dummy</span>::<span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>
     <span class="org-constant">Dummy</span>::<span class="org-function-name">Dummy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-2">)</span>: <span class="org-function-name">m_name</span><span class="org-rainbow-delimiters-depth-2">(</span>name<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>

     <span class="org-type">void</span> <span class="org-constant">Dummy</span>::<span class="org-function-name">showName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>
     <span class="org-rainbow-delimiters-depth-2">{</span>
         <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Object name is : "</span> &lt;&lt; m_name &lt;&lt; <span class="org-string">"\n"</span>;
     <span class="org-rainbow-delimiters-depth-2">}</span>

<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
File: main1.cpp (CMake targets: app1 and app1_static )
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string">"utils.hpp"</span>

<span class="org-keyword">using</span> <span class="org-constant">utils</span>::<span class="org-type">Dummy</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::puts<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [TRACE] I am the application 1. Ok."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">Dummy</span> <span class="org-variable-name">dummy1</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"I_am_dummy_object_A"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    dummy1.showName<span class="org-rainbow-delimiters-depth-2">()</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
File: main2.cpp (CMake targets: app2 and app2_static )
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string">"utils.hpp"</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::puts<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [TRACE] I am the application 2. Ok."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">utils</span>::<span class="org-type">Dummy</span> <span class="org-variable-name">dummy2</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"I_am_dummy_object_B"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    dummy2.showName<span class="org-rainbow-delimiters-depth-2">()</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Build and running on Linux</b> 
</p>

<p>
Configure and build: 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#  </span><span class="org-comment">+ (-B/tmp/_build2) =&gt; Place build tree at /tmp/_build2</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">+ Install binaries (object-code) at ~/Desktop/appinstall</span>
$ cmake -H. -B/tmp/_build2 -DCMAKE_INSTALL_PREFIX=~/Desktop/appinstall
$ cmake --build /tmp/build2 --target 
</pre>
</div>

<p>
Check binaries in the source directory (project directory):
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">List source/project directory </span>
$ ls .
out/  CMakeLists.txt  main1.cpp  main2.cpp  README.txt  utils.cpp  utils.hpp


$ tree .
<span class="org-builtin">.</span>
&#9500;&#9472;&#9472; CMakeLists.txt
&#9500;&#9472;&#9472; main1.cpp
&#9500;&#9472;&#9472; main2.cpp
&#9500;&#9472;&#9472; out
&#9474;&#160;&#160; &#9500;&#9472;&#9472; bin
&#9474;&#160;&#160; &#9474;&#160;&#160; &#9500;&#9472;&#9472; app1
&#9474;&#160;&#160; &#9474;&#160;&#160; &#9500;&#9472;&#9472; app1_static
&#9474;&#160;&#160; &#9474;&#160;&#160; &#9500;&#9472;&#9472; app2
&#9474;&#160;&#160; &#9474;&#160;&#160; &#9492;&#9472;&#9472; app2_static
&#9474;&#160;&#160; &#9492;&#9472;&#9472; lib
&#9474;&#160;&#160;     &#9500;&#9472;&#9472; libutils.so
&#9474;&#160;&#160;     &#9492;&#9472;&#9472; libutils_static.a
&#9500;&#9472;&#9472; README.txt
&#9500;&#9472;&#9472; utils.cpp
&#9492;&#9472;&#9472; utils.hpp

3 directories, 12 files
</pre>
</div>

<p>
Test executables: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ out/bin/app1
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A

$ out/bin/app2
 [TRACE] I am the application 2. Ok.
 [TRACE] Object name is : I_am_dummy_object_B

$ out/bin/app1_static 
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A

$ out/bin/app2_static 
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A


<span class="org-comment-delimiter"># </span><span class="org-comment">Check app1 dependencies </span>
$ ldd out/bin/app1
        linux-vdso.so.1 (0x00007ffff7ffa000)
        libutils.so =&gt; /home/archbox/shared/demo-cmake-proj2/out/lib/libutils.so (0x00007ffff7bd0000)
        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007ffff783e000)
        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007ffff74aa000)
        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007ffff7292000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ffff6ed4000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd6000)

<span class="org-comment-delimiter"># </span><span class="org-comment">Check app1_static dependencies </span>
$ ldd out/bin/app2_static 
        linux-vdso.so.1 (0x00007ffff7ffa000)
        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007ffff7a44000)
        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007ffff76b0000)
        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007ffff7498000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ffff70da000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd6000)
</pre>
</div>

<p>
Build and install (execute CMake's intall target):
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build /tmp/_build2/ --target install
</pre>
</div>

<p>
Check intalled files: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ls ~/Desktop/appinstall/
bin/  lib/  README.txt

$ tree ~/Desktop/appinstall/
&#9500;&#9472;&#9472; bin
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app1
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app1_static
&#9474;&#160;&#160; &#9500;&#9472;&#9472; app2
&#9474;&#160;&#160; &#9492;&#9472;&#9472; app2_static
&#9500;&#9472;&#9472; lib
&#9474;&#160;&#160; &#9500;&#9472;&#9472; libutils.so
&#9474;&#160;&#160; &#9492;&#9472;&#9472; libutils_static.a
&#9492;&#9472;&#9472; README.txt

$ ~/Desktop/appinstall/bin/app1
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A

$ ~/Desktop/appinstall/bin/app2
 [TRACE] I am the application 2. Ok.
 [TRACE] Object name is : I_am_dummy_object_B

$ ~/Desktop/appinstall/bin/app1_static 
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A
</pre>
</div>

<p>
Check dependencies of app1:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ldd ~/Desktop/appinstall/bin/app1
        linux-vdso.so.1 (0x00007ffff7ffa000)
        libutils.so =&gt; /home/archbox/Desktop/appinstall/bin/../lib/libutils.so (0x00007ffff7bd0000)
        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007ffff783e000)
        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007ffff74aa000)
        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007ffff7292000)
        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ffff6ed4000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd6000)
</pre>
</div>

<p>
<b>Build and running on Windows 10 with MSVC 2017</b>  
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -B..<span class="org-string">\_</span>build_proj -G <span class="org-string">"Visual Studio 15 2017 Win64"</span> -DCMAKE_INSTALL_RPEFIX=%USERPROFILE%\appinstall
$ cmake --build ..<span class="org-string">\_</span>build_proj --target 
</pre>
</div>

<p>
List directory: 
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; ls
CMakeLists.txt  README.txt  main1.cpp  main2.cpp  out/  utils.cpp  utils.hpp
</pre>
</div>

<p>
List binaries in the source directory: 
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; ls out\bin\Debug<span class="org-sh-escaped-newline">\</span>
app1.exe*  app1.pdb          app1_static.ilk  app2.exe*  app2.pdb          app2_static.ilk  utils.dll*  utils.pdb
app1.ilk   app1_static.exe*  app1_static.pdb  app2.ilk   app2_static.exe*  app2_static.pdb  utils.ilk
</pre>
</div>

<p>
Test executables: 
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; out\bin\Debug\app1.exe
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A

&#955; out\bin\Debug\app2.exe
 [TRACE] I am the application 2. Ok.
 [TRACE] Object name is : I_am_dummy_object_B

&#955; out\bin\Debug\app1_static.exe
 [TRACE] I am the application 1. Ok.
 [TRACE] Object name is : I_am_dummy_object_A
</pre>
</div>

<p>
Install: 
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; cmake --build ..<span class="org-string">\_</span>build_proj --target install
</pre>
</div>

<p>
Check installation: 
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; ls C:<span class="org-string">\\</span>Users\archbox\appinstall<span class="org-sh-escaped-newline">\</span>
README.txt  bin/  lib/

&#955; ls %USERPROFILE%\appinstall/bin
app1.exe*  app1_static.exe*  app2.exe*  app2_static.exe*  utils.dll*

&#955; ls %USERPROFILE%\appinstall/lib
utils.lib  utils_static.lib

&#955; type %USERPROFILE%\appinstall\README.txt
======= Application User Guide ==========

  + app1 =&gt; Application for creating PCB - Printed Circuit Board
  + app2 =&gt; App. for communicating with remote link

  &lt;INSERT TEXT HERE ....&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc71ba06" class="outline-4">
<h4 id="orgc71ba06"><span class="section-number-4">1.14.2</span> Set common file extension for all executables</h4>
<div class="outline-text-4" id="text-1-14-2">
<p>
Unlike Windows, native executables files on Unix-like operating
systems don't have a file extension such as .exe which makes harder for
automation tools, such as Jenkins, distinguish them form other files. 
</p>

<ul class="org-ul">
<li>The following CMakeListst.txt builds two executables app1 and
app2. The executable names on Windows are app1.exe and app2.exe. On
Unix-like operating systems, their name become <span class="underline">app1.bin</span> and
<span class="underline">app2.bin</span>. Without the line with <b>CMAKE_EXECUTABLE_SUFFIX</b> their name
on Unix-like operating systems would be <span class="underline">app1</span> and <span class="underline">app2</span>.</li>
</ul>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(ProjectWithUnixExtension)

<span class="org-comment">#----------------------------------------------#</span>

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)
<span class="org-function-name">set</span>(CMAKE_CXX_EXTENSIONS OFF)

<span class="org-comment"># Add file extension .bin to all executable files on Unix (Linux, OSX, BSD, ...)</span>
<span class="org-keyword">if</span>(UNIX)
  <span class="org-function-name">set</span>(CMAKE_EXECUTABLE_SUFFIX <span class="org-string">".bin"</span>)
<span class="org-keyword">endif</span>()

<span class="org-comment">#========== Targets Configurations ============#</span>
<span class="org-function-name">add_executable</span>(app1  main1.cpp)
<span class="org-function-name">add_executable</span>(app2  main1.cpp src1.cpp src2.cpp src3.cpp)
</pre>
</div>
</div>
</div>
<div id="outline-container-org34bc5f6" class="outline-4">
<h4 id="org34bc5f6"><span class="section-number-4">1.14.3</span> Glob files from a directory or sub-directories</h4>
<div class="outline-text-4" id="text-1-14-3">
<p>
Globing allows adding files of a given cmake target without specifying
all of them explicitly. Although, it is not a good practice, it can be
useful for migrating projects using other building systems to CMake. 
</p>

<p>
Example: sample project that used GNU autotools or Makefiles. 
</p>

<ul class="org-ul">
<li>./path/to/project &lt;DIRECTORY&gt;
<ul class="org-ul">
<li>CMakeLists.txt</li>

<li>main/   &lt;DIR&gt; =&gt;&gt; Executable Target: main -&gt; ./main (Unix) or  main.exe (Windows)
<ul class="org-ul">
<li>main.cpp</li>
<li>class1.cpp</li>
<li>class1.hpp</li>
<li>class2.cpp</li>
<li>class2.hpp</li>
</ul></li>

<li>mylib  &lt;DIR&gt;  =&gt;&gt; Shared Library Target:  mylib1 libmylib1.so (Unix), libmylib1.dylib (OSX) or mylib1.dll (Windows)
<ul class="org-ul">
<li>class1A.cpp</li>
<li>class1A.hpp</li>
<li>class2A.cpp</li>
<li>class2A.hpp</li>
<li>&#x2026;. &#x2026; ..</li>
<li>./directory/ &lt;DIR&gt; 
<ul class="org-ul">
<li>file1A.cpp</li>
<li>file1A.hpp</li>
<li>file1A.cpp</li>
<li>file1A.hpp</li>
<li>&#x2026; &#x2026; &#x2026;</li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.0)
<span class="org-function-name">project</span>(cmake-glob)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

  <span class="org-comment">#----------------------------------------------#</span>
  <span class="org-comment">#    mylib  =&gt; Library target                  #</span>
  <span class="org-comment">#----------------------------------------------#</span>

<span class="org-comment"># Assign all *.cpp files paths in the directory ./mylib </span>
<span class="org-comment"># to the variable 'mylib_sources'. It allso includes the </span>
<span class="org-comment"># subdirectories of ./mylib. </span>
<span class="org-function-name">file</span>(GLOB_RECURSE mylib_sources <span class="org-string">"mylib/*.cpp"</span>)
<span class="org-function-name">file</span>(GLOB_RECURSE mylib_headers <span class="org-string">"mylib/*.hpp"</span>)

<span class="org-function-name">add_library</span>(mylib SHARED ${<span class="org-variable-name">lib_sources</span>} ${<span class="org-variable-name">lib_headers</span>} )
<span class="org-function-name">target_include_directories</span>(mylib PUBLIC ./lib)

  <span class="org-comment">#----------------------------------------------#</span>
  <span class="org-comment">#     main  =&gt; Executable target               #</span>
  <span class="org-comment">#----------------------------------------------#</span>

<span class="org-comment"># --&gt; Assign the path of all *.cpp files in the directory </span>
<span class="org-comment">#  ./main to the variable 'main_sources'</span>
<span class="org-comment">#  note: it does not include subdirectories. </span>
<span class="org-function-name">file</span>(GLOB main_sources <span class="org-string">"main/*.cpp"</span>)
<span class="org-function-name">file</span>(GLOB main_headers <span class="org-string">"main/*.hpp"</span>)

       <span class="org-function-name">add_executable</span>( main ${<span class="org-variable-name">main_sources</span>} ${<span class="org-variable-name">main_headers</span>})
<span class="org-function-name">target_link_libraries</span>( main mylib glut gl ... )
</pre>
</div>

<p>
<b>Highlights</b> 
</p>

<ul class="org-ul">
<li>The following lines sets the variable <span class="underline">main_sources</span> to the
following list of strings containing the file names:
main/main.cpp, main/class1.cpp, main/class2.cpp and so on.</li>

<li><span class="underline">GLOB</span> scans all files in a directory with a given pattern, but does
not scan in sub-directories.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">file</span>(GLOB main_sources <span class="org-string">"main/*.cpp"</span>)
</pre>
</div>

<ul class="org-ul">
<li>The next lien sets the variable <span class="underline">mylib_headers</span> to mylib a list of
strings contains the file names: mylib/class1A.cpp
mylib/class2A.cpp &#x2026; mylib/directory/file1A.cpp,
mylib/directory/file2A.cpp and so on.</li>

<li><span class="underline">GLOB_RECURSE</span> scans all files in a directory and subdirectories
with a given pattern.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">file</span>(GLOB_RECURSE mylib_sources <span class="org-string">"mylib/*.cpp"</span>) 
</pre>
</div>
</div>
</div>

<div id="outline-container-org985fc35" class="outline-4">
<h4 id="org985fc35"><span class="section-number-4">1.14.4</span> Copy some target binaries to a directory</h4>
<div class="outline-text-4" id="text-1-14-4">
<p>
This piece of code copies the target binaries (compiled code) to a
directory relative to project's root directory where is CMakeLists.txt 
</p>

<p>
Targets:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># TARGET: testlib Shared library =&gt; Builds liblinalg.so on Unix or</span>
<span class="org-comment"># linalg.dll on Windows.</span>
<span class="org-function-name">add_library</span>(linalg SHARED  src/testlib.cpp)

<span class="org-comment"># TARGET: app Executable =&gt; Builds 'app' on Unix-like Oses and</span>
<span class="org-comment"># unix.exe on Windows.</span>
<span class="org-function-name">add_executable</span>(app src/main/main-app.cpp src/main/file1.cpp src/main/file2.cpp)
</pre>
</div>

<p>
Copy target files to top level directory where is CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># If not set the install directory, attemp set the install directory</span>
<span class="org-comment"># CMAKE_INSTALL_PREFIX to the directory ./bin </span>
<span class="org-keyword">if</span>(NOT DEFINED CMAKE_INSTALL_PREFIX OR CMAKE_INSTALL_PREFIX MATCHES <span class="org-string">""</span>)
  <span class="org-function-name">set</span>(CMAKE_INSTALL_PREFIX  <span class="org-string">"./bin"</span>)
<span class="org-keyword">endif</span>()

<span class="org-function-name">message</span>(<span class="org-string">" [INFO] CMakeLists.txt is in the directory ${</span><span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span><span class="org-string">}"</span>)

<span class="org-comment"># Copy targets to ./ - Directory where is this file CMakeLists.txt (project top level dir)</span>
<span class="org-function-name">install</span>(TARGETS app linalg DESTINATION  ${<span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span>})
</pre>
</div>

<p>
This target can be run with: 
</p>

<ul class="org-ul">
<li>STEP 1: Set CMake building system or the project type with -G.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cd project-directory 

<span class="org-comment-delimiter">#</span><span class="org-comment">===&gt; Set build system </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">-H&lt;SOURCE&gt; -B&lt;COMPILATION-OUTPUT&gt; -G &lt;BUILDING-SYSTEM&gt;</span>
$ cmake -H. -G <span class="org-string">"Unix Makefiles"</span> -Bbuild 
</pre>
</div>

<ul class="org-ul">
<li>STEP 2: Run targets</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">===&gt; Run all targets [all default.]</span>
$ cmake --build build --target all 

<span class="org-comment-delimiter">#</span><span class="org-comment">===&gt; Run target install and copy the binaries to ./bin </span>
$ cmake --build build --target install 
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bd6086" class="outline-4">
<h4 id="org7bd6086"><span class="section-number-4">1.14.5</span> Create target to run compiled executable</h4>
<div class="outline-text-4" id="text-1-14-5">
<p>
The piece following piece of code runs an executable target after it
is built in a similar way to a command $ make run. 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)

 ... ...  ... ...  ... ...

<span class="org-comment"># TARGET: myapplication </span>
<span class="org-function-name">add_executable</span>(myapplication src/main.cpp src/code1.cpp code2.cpp ...)

<span class="org-comment"># TARGET: run -&gt; Runs the executable myapplication </span>
<span class="org-comment"># On Unix-like Oses, it runs  /&lt;build-directory&gt;/myapplication </span>
<span class="org-comment"># On Windows: it runs  &lt;build-directory&gt;/myapplication.exe </span>
<span class="org-function-name">add_custom_target</span>(run
    COMMAND myapplication
    DEPENDS myapplication
    WORKING_DIRECTORY ${<span class="org-variable-name">CMAKE_PROJECT_DIR</span>}
)
</pre>
</div>

<p>
After the building system is set and output directory ./build, run:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">===&gt; Run all targets [all default.]</span>
$ cmake --build build --target run
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda077a5" class="outline-4">
<h4 id="orgda077a5"><span class="section-number-4">1.14.6</span> Issue an error if condition is not met</h4>
<div class="outline-text-4" id="text-1-14-6">
<p>
In this piece of code, if the compiler is not MSVC (vc++, aka cl.exe),
CMake stops the generation of the building script showing an error
message to the user.
</p>

<div class="org-src-container">
<pre class="src src-cmake">... ... 

<span class="org-keyword">if</span>(MSVC)
   <span class="org-function-name">set_target_properties</span>(WindowApp1 PROPERTIES LINK_FLAGS <span class="org-string">"/entry:mainCRTStartup"</span>)
<span class="org-keyword">else</span>() 
   <span class="org-function-name">message</span>(FATAL_ERROR <span class="org-string">" [ERROR] Linker flags of target WindowApp1 not set for this compiler"</span>)
<span class="org-keyword">endif</span>()
... ... 
</pre>
</div>
</div>
</div>
<div id="outline-container-org9b1220d" class="outline-4">
<h4 id="org9b1220d"><span class="section-number-4">1.14.7</span> Copy a target file whenever it is recompiled</h4>
<div class="outline-text-4" id="text-1-14-7">
<p>
Example:  Copy a shared library to project root directory ./
whenever it is rebuilt. 
</p>

<ul class="org-ul">
<li>Set the shared library target. (libtestlib.so on Unix or testlib.dll
on Windows)</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_library</span>( testlib  SHARED  ./testlib.cpp)
<span class="org-function-name">set_target_properties</span>(testlib PROPERTIES CXX_VISIBILITY_PRESET hidden)
</pre>
</div>

<ul class="org-ul">
<li>Automatically copy to root directory the generated shared library
binary to root directory on every recompilation of the target
testlib.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">add_custom_command</span>(TARGET testlib POST_BUILD
  COMMAND ${<span class="org-variable-name">CMAKE_COMMAND</span>} -E copy 
  $&lt;TARGET_FILE:testlib&gt;                     <span class="org-comment"># Source    </span>
  ${<span class="org-variable-name">CMAKE_CURRENT_SOURCE_DIR</span>}/libtest.so     <span class="org-comment"># Destination, file or directory </span>
  <span class="org-comment"># OR: ${</span><span class="org-variable-name">CMAKE_CURRENT_SOURCE_DIR</span><span class="org-comment">}/         # Directory destination. </span>
)
</pre>
</div>

<p>
Test this post-build target: 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Generate cache directory containing building scripts or project files </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">specifics for some building systems</span>
$ cmake -H. -Bcache -G <span class="org-string">"CHOOSE SYSTEM&gt;"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Run all targets  [Default]</span>
$ cmake --build cache --target
$ cmake --build cache --target all 

<span class="org-comment-delimiter"># </span><span class="org-comment">Run target 'testlib'. </span>
$ cmake --build cache --target testlib 
</pre>
</div>

<p>
After the target is recompiled, the shared library is copied to the
current directory (project top-level directory ./).
</p>

<p>
References: 
</p>
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/31277186">https://stackoverflow.com/questions/31277186</a></li>
<li><a href="https://stackoverflow.com/questions/15694347/">https://stackoverflow.com/questions/15694347/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org8c60e32" class="outline-4">
<h4 id="org8c60e32"><span class="section-number-4">1.14.8</span> Cross compiling for Android</h4>
<div class="outline-text-4" id="text-1-14-8">
<p>
See: 
</p>
<ul class="org-ul">
<li><a href="https://developer.android.com/ndk/guides/cmake">https://developer.android.com/ndk/guides/cmake</a></li>
<li><a href="http://www.ccp4.ac.uk/dist/checkout/cmake-3.1.3/Help/manual/cmake-toolchains.7.rst">http://www.ccp4.ac.uk/dist/checkout/cmake-3.1.3/Help/manual/cmake-toolchains.7.rst</a></li>
<li><a href="https://itk.org/Wiki/ITK/Cross_Compiling">https://itk.org/Wiki/ITK/Cross_Compiling</a></li>
<li><a href="https://cristianadam.eu/20181202/a-better-qnx-cmake-toolchain-file/">https://cristianadam.eu/20181202/a-better-qnx-cmake-toolchain-file/</a></li>
<li><a href="https://stackoverflow.com/questions/12844772/how-to-cross-compile-cmake-for-arm-with-cmake">https://stackoverflow.com/questions/12844772/how-to-cross-compile-cmake-for-arm-with-cmake</a></li>
<li><a href="https://stackoverflow.com/questions/5098360/cmake-specifying-build-toolchain">https://stackoverflow.com/questions/5098360/cmake-specifying-build-toolchain</a></li>
</ul>

<p>
File: application1.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>

  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Hello world from application1"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
  ::system<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"whoami"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

  <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
File: CmakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(Simple_Cmake_Project)

<span class="org-comment">#========== Global Configurations =============#</span>
<span class="org-comment">#----------------------------------------------#</span>
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment">#========== Targets Configurations ============#</span>
<span class="org-function-name">add_executable</span>(app1 application1.cpp)
</pre>
</div>

<p>
<b>Building</b>:
</p>

<p>
STEP 1: Set CMake Configuration.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Using Makefile (Linux)   </span>
$ cmake -H. -B_build -G Ninja -DCMAKE_BUILD_TYPE=Debug <span class="org-sh-escaped-newline">\</span>
   -DCMAKE_TOOLCHAIN_FILE=$<span class="org-variable-name">HOME</span>/Android/Sdk/ndk-bundle/build/cmake/android.toolchain.cmake <span class="org-sh-escaped-newline">\</span>
   -DANDROID_ABI=armeabi-v7a <span class="org-sh-escaped-newline">\</span>
   -DANDROID_NATIVE_API_LEVEL=21

<span class="org-comment-delimiter"># </span><span class="org-comment">OR Using Ninja build generator </span>
$ cmake -H. -B_build -G Ninja -DCMAKE_BUILD_TYPE=Debug <span class="org-sh-escaped-newline">\</span>
  -DCMAKE_TOOLCHAIN_FILE=$<span class="org-variable-name">HOME</span>/Android/Sdk/ndk-bundle/build/cmake/android.toolchain.cmake <span class="org-sh-escaped-newline">\</span>
  -DANDROID_ABI=armeabi-v7a <span class="org-sh-escaped-newline">\</span>
  -DANDROID_NATIVE_API_LEVEL=21
</pre>
</div>

<p>
STEP 2: Build 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --build _build --target
[4/4] Linking CXX executable app1

<span class="org-comment-delimiter"># </span><span class="org-comment">Check executable </span>
$ file _build/app1
<span class="org-function-name">_build/app1</span>: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, 
interpreter /system/, <span class="org-variable-name">BuildID</span>[sha1]=8d6b159e0e65604fe1f65bca5ad9eef36aa4ab26, with debug_info, not stripped

<span class="org-comment-delimiter"># </span><span class="org-comment">Attempt to run =&gt; Fails because the current machine (host) is Linux</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">x86_64 - 64 bits, not ARM 32 bits</span>
$ _build/app1
<span class="org-function-name">bash</span>: _build/app1: cannot execute binary file: Exec format error
</pre>
</div>

<p>
STEP 3: Deploy with ADB - Android Debug Bridge 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ adb push _build/app1 /data/local/tmp
<span class="org-function-name">_build/app1</span>: 1 file pushed. 18.6 MB/s (2848980 bytes<span class="org-keyword"> in</span> 0.146s)
</pre>
</div>

<p>
STEP 4: Run application on Android.
</p>

<ul class="org-ul">
<li>Run in adb shell</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ adb shell

<span class="org-function-name">on5xelte</span>:/ $ /data/local/tmp/app1
 [INFO] Hello world from application1
shell
</pre>
</div>

<ul class="org-ul">
<li>Run with adb directly</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ adb shell /data/local/tmp/app1
 [INFO] Hello world from application1
shell
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf092992" class="outline-4">
<h4 id="orgf092992"><span class="section-number-4">1.14.9</span> Detect Operating System</h4>
<div class="outline-text-4" id="text-1-14-9">
</div>
<ol class="org-ol">
<li><a id="orgf9fc679"></a>Detect operating system with predefined variables<br />
<div class="outline-text-5" id="text-1-14-9-1">
<p>
Check whether current OS is Microsft Windows NT:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(WIN32)
  <span class="org-comment"># actions ... </span>
  <span class="org-function-name">message</span>(<span class="org-string">"Compiling for Windows NT"</span>)
<span class="org-keyword">else</span>()
  <span class="org-comment"># else actions .... ...</span>
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
Check whether current OS is a Unix-like operating system (Linux, BSD,
MacOSX, Android and so on): 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(UNIX)
  <span class="org-comment"># actions ... </span>
  <span class="org-function-name">message</span>(<span class="org-string">"Running on Unix-like OS"</span>)
<span class="org-keyword">endif</span>()  
</pre>
</div>

<p>
Check if current OS is MacOSX:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(APPLE)
  <span class="org-comment"># actions ... </span>
  <span class="org-function-name">message</span>(<span class="org-string">"Running on Unix-like OS"</span>)
<span class="org-keyword">endif</span>()  
</pre>
</div>

<p>
Check if current OS is Linux:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(LINUX)
  <span class="org-comment"># actions ... </span>
  <span class="org-function-name">message</span>(<span class="org-string">"Running on Unix-like OS"</span>)
<span class="org-keyword">endif</span>()  
</pre>
</div>

<p>
Check if current OS is UNIX, but not MacOSX:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(UNIX AND NOT APPLE)
  <span class="org-comment"># actions ... </span>
  <span class="org-function-name">message</span>(<span class="org-string">"Running on Unix-like OS"</span>)
<span class="org-keyword">endif</span>()  
</pre>
</div>
</div>
</li>
<li><a id="orga143bcf"></a>Detect operating system with variable CMAKE_SYSTEM_NAME<br />
<div class="outline-text-5" id="text-1-14-9-2">
<p>
Example: 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(${<span class="org-variable-name">CMAKE_SYSTEM_NAME</span>} matches <span class="org-string">"linux"</span>)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] compiling for Linux"</span>)
<span class="org-keyword">elseif</span>(${<span class="org-variable-name">CMAKE_SYSTEM_NAME</span>} matches <span class="org-string">"Windows"</span>)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] compiling for Windows"</span>)
<span class="org-keyword">elseif</span>(${<span class="org-variable-name">CMAKE_SYSTEM_NAME</span>} matches <span class="org-string">"darwin"</span>)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] compiling for Apple MacOSX"</span>)
<span class="org-keyword">elseif</span>(${<span class="org-variable-name">CMAKE_SYSTEM_NAME</span>} matches <span class="org-string">"Android"</span>)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] compiling for Android OS."</span>)
<span class="org-keyword">else</span>()
  <span class="org-function-name">message</span>( <span class="org-string">" [WARNING] Operating system not identified."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
Possible Values of Variable <span class="underline">CMAKE_SYSTEM_NAME</span>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(${<span class="org-variable-name">CMAKE_SYSTEM_NAME</span>} matches &lt;&lt;MATCHING-STRING&gt;)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] compiling for &lt;&lt;MATCHIGN-STTRING&gt; "</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Value of &lt;&lt;MATCHING-STRING&gt;</th>
<th scope="col" class="org-left">Operating System</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>

<tr>
<th scope="col" class="org-left">for <span class="underline">CMAKE_SYSTEM_NAME</span></th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Windows</td>
<td class="org-left">Windows</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Darwin</td>
<td class="org-left">MacOSX</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">BSD</td>
<td class="org-left">Free BSD, OpenBDS, NetBSD &#x2026;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">FreeBSD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">Linux</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Android</td>
<td class="org-left">Android</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<div id="outline-container-org17a49fe" class="outline-4">
<h4 id="org17a49fe"><span class="section-number-4">1.14.10</span> Detect whether current build is 32 bits or 64 bits</h4>
<div class="outline-text-4" id="text-1-14-10">
<p>
Check whether current configuration is for 64 bits build:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(CMAKE_SIZEOF_VOID_P EQUAL 8)
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] 64 bits build."</span>)
<span class="org-keyword">else</span>()
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] 32 bits build."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>
</div>
</div>
<div id="outline-container-org4c7d548" class="outline-4">
<h4 id="org4c7d548"><span class="section-number-4">1.14.11</span> Detect Compiler</h4>
<div class="outline-text-4" id="text-1-14-11">
</div>
<ol class="org-ol">
<li><a id="org8dd987b"></a>Detect compiler using predefined variables<br />
<div class="outline-text-5" id="text-1-14-11-1">
<p>
<b>MSVC</b>
</p>

<p>
Check if current compiler is MSVC - Microsft - Visual C/C++ Compiler
(Visual C++, vc++ for short):
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(MSVC)
  <span class="org-function-name">message</span>(STATUS &lt;&lt; <span class="org-string">"Running MSVC"</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
<b>MSVC for 32 bits target</b>
</p>

<p>
Detect MSVC set up for 32 bits target (buids 32 bits binaries):
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(MSVC AND NOT CMAKE_CL_64)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Building for 32 bits Windows target."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
<b>MSVC for 64 bits target</b>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(MSVC AND CMAKE_CL_64)
  <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Building for 64 bits Windows target."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
<b>Mingw</b> 
</p>

<p>
Check if current compiler is GCC/Mingw, GCC compiler ported to
Windows.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(MSVC)
  <span class="org-function-name">message</span>(<span class="org-string">"Running Mingw/GCC maybe on Windows"</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>
</div>
</li>
<li><a id="org78b76fd"></a>Detect compiler using CMAKE_CXX_COMPILER_ID variable<br />
<div class="outline-text-5" id="text-1-14-11-2">
<p>
The variable CMAKE_CXX_COMPILER_ID can be used for checking the
current C++ compiler.
</p>
<ul class="org-ul">
<li>See: <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER_ID.html#variable:CMAKE_%3CLANG%3E_COMPILER_ID">Documentation</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span> (${<span class="org-variable-name">CMAKE_CXX_COMPILER_ID</span>} matches GNU)
  <span class="org-function-name">message</span>(STATUS <span class="org-string">" [INFO] Using GCC - GNU C/C++ Compiler or MingW/GCC."</span>)
<span class="org-keyword">elseif</span>(${<span class="org-variable-name">CMAKE_CXX_COMPILER_ID</span>} matches CLANG) 
  <span class="org-function-name">message</span>(STATUS <span class="org-string">" [INFO] Using the super amazing, the finest C++ compiler: Clang++/LLVM."</span>)
<span class="org-keyword">elseif</span>(${<span class="org-variable-name">CMAKE_CXX_COMPILER_ID</span>} matches MSVC)
  <span class="org-function-name">message</span>(STATUS <span class="org-string">" [INFO] Using MSVC Windows 'Visual!!' C++ compiler"</span>)
<span class="org-keyword">else</span>()
  <span class="org-function-name">message</span>( FATAL_ERROR <span class="org-string">" [ERROR] I cannot identify CMake Configuration not set for this compiler yet."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
All possible values of <code>CMAKE_CXX_COMPILER_ID</code>:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Value of <code>CMAKE_CXX_COMPILER_ID</code></th>
<th scope="col" class="org-left">Compiler</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>Most used compilers</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">GNU</td>
<td class="org-left">GNU Compiler Collection (gcc.gnu.org)</td>
</tr>

<tr>
<td class="org-left">Clang</td>
<td class="org-left">LLVM Clang (clang.llvm.org)</td>
</tr>

<tr>
<td class="org-left">MSVC</td>
<td class="org-left">Microsoft Visual Studio (microsoft.com)</td>
</tr>

<tr>
<td class="org-left">Intel</td>
<td class="org-left">Intel Compiler (intel.com)</td>
</tr>

<tr>
<td class="org-left">PGI</td>
<td class="org-left">The Portland Group (pgroup.com)</td>
</tr>

<tr>
<td class="org-left">G95</td>
<td class="org-left">G95 Fortran (g95.org)</td>
</tr>

<tr>
<td class="org-left">Embarcadero, Borland</td>
<td class="org-left">Embarcadero (embarcadero.com)</td>
</tr>

<tr>
<td class="org-left">ARMCC</td>
<td class="org-left">ARM Compiler (arm.com)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>Other compilers</b></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Absoft</td>
<td class="org-left">Absoft Fortran (absoft.com)</td>
</tr>

<tr>
<td class="org-left">ADSP</td>
<td class="org-left">Analog VisualDSP++ (analog.com)</td>
</tr>

<tr>
<td class="org-left">AppleClang</td>
<td class="org-left">Apple Clang (apple.com)</td>
</tr>

<tr>
<td class="org-left">Bruce</td>
<td class="org-left">Bruce C Compiler</td>
</tr>

<tr>
<td class="org-left">CCur</td>
<td class="org-left">Concurrent Fortran (ccur.com)</td>
</tr>

<tr>
<td class="org-left">Cray</td>
<td class="org-left">Cray Compiler (cray.com)</td>
</tr>

<tr>
<td class="org-left">HP</td>
<td class="org-left">Hewlett-Packard Compiler (hp.com)</td>
</tr>

<tr>
<td class="org-left">IAR</td>
<td class="org-left">IAR Systems (iar.com)</td>
</tr>

<tr>
<td class="org-left">MIPSpro</td>
<td class="org-left">SGI MIPSpro (sgi.com)</td>
</tr>

<tr>
<td class="org-left">NVIDIA</td>
<td class="org-left">NVIDIA CUDA Compiler (nvidia.com)</td>
</tr>

<tr>
<td class="org-left">OpenWatcom</td>
<td class="org-left">Open Watcom (openwatcom.org)</td>
</tr>

<tr>
<td class="org-left">Flang</td>
<td class="org-left">Flang Fortran Compiler</td>
</tr>

<tr>
<td class="org-left">PathScale</td>
<td class="org-left">PathScale (pathscale.com)</td>
</tr>

<tr>
<td class="org-left">SDCC</td>
<td class="org-left">Small Device C Compiler (sdcc.sourceforge.net)</td>
</tr>

<tr>
<td class="org-left">SunPro</td>
<td class="org-left">Oracle Solaris Studio (oracle.com)</td>
</tr>

<tr>
<td class="org-left">TI</td>
<td class="org-left">Texas Instruments (ti.com)</td>
</tr>

<tr>
<td class="org-left">TinyCC</td>
<td class="org-left">Tiny C Compiler (tinycc.org)</td>
</tr>

<tr>
<td class="org-left">XL, VisualAge, zOS</td>
<td class="org-left">IBM XL (ibm.com)</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<div id="outline-container-org5cbb1b7" class="outline-4">
<h4 id="org5cbb1b7"><span class="section-number-4">1.14.12</span> Debug Information for diagnosing problems</h4>
<div class="outline-text-4" id="text-1-14-12">
<p>
<b>Set Build Type</b>
</p>

<p>
Informs whether the current build type is Release or Debug. Relase has
optmization flags enabled and debugging symbols disabled. Debug
building type has optmization flags and debugging symbols flags
disabled.
</p>

<p>
The build type is:
</p>

<ul class="org-ul">
<li>Release when :
<ul class="org-ul">
<li>$ cmake &#x2013;build &lt;BUILD-DIRECTORY&gt; &#x2013;config Release &#x2013;target</li>
<li>$ cmake &#x2013;build &lt;BUILD-DIRECTORY&gt; &#x2013;config Release &#x2013;target install</li>
</ul></li>

<li>Debug when using (Default):
<ul class="org-ul">
<li>$ cmake &#x2013;build &lt;BUILD-DIRECTORY&gt; &#x2013;config Debug &#x2013;target</li>
<li>$ cmake &#x2013;build &lt;BUILD-DIRECTORY&gt; &#x2013;config Debug &#x2013;target Application1</li>
<li>$ cmake &#x2013;build &lt;BUILD-DIRECTORY&gt; &#x2013;config Debug &#x2013;target install</li>
</ul></li>
</ul>

<p>
<b>Set Installation Directory</b> 
</p>

<p>
The installation directory can be set with the option
-DCMAKE_INSTALL_PREFIX, examples: 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Configuration </span>
$ cmake -Bcache -DCMAKE_INSTALL_PREFIX=C:<span class="org-string">\\</span>Users\Dummy\apps 

<span class="org-comment-delimiter"># </span><span class="org-comment">Execute install target </span>
$ cmake --build cache --config Debug --target install 
</pre>
</div>

<p>
<b>Useful Debugging Commands</b>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] Build type = ${</span><span class="org-variable-name">CMAKE_BUILD_TYPE</span><span class="org-string">}"</span>)
</pre>
</div>

<p>
Target word size 32 bits (x86) or 64 bits (x86_64):
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(CMAKE_SIZEOF_VOID_P EQUAL 8)
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Target = 64 bits build."</span>)
<span class="org-keyword">else</span>()
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Target = 32 bits build."</span>)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
Compiler: 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] Compiler ID = ${</span><span class="org-variable-name">CMAKE_CXX_COMPILER_ID</span><span class="org-string">}"</span>)
</pre>
</div>

<p>
Current Platform: 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] System Name = ${</span><span class="org-variable-name">CMAKE_SYSTEM_NAME</span><span class="org-string">} "</span>)
</pre>
</div>

<p>
Binary directory &lt;BUILD-DIRECTORY&gt;
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] CMake binary dir = ${</span><span class="org-variable-name">CMAKE_BINARY_DIR</span><span class="org-string">}"</span>)
</pre>
</div>

<p>
Installation directory specifies the directory where the binaries will
be installed by the target <b>install</b>. It can be specified during
configuration phase by using:
</p>

<ul class="org-ul">
<li><b>&#x2013;DCMAKE_INSTALL_PREFIX=C:\Users\Dummy\app</b></li>
</ul>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] Install path CMAKE_INSTALL_PREFIX = ${</span><span class="org-variable-name">CMAKE_INSTALL_PREFIX</span><span class="org-string">} "</span>)
</pre>
</div>


<p>
Putting it all together:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO]  System Name  - CMAKE_SYSTEM_NAME     = ${</span><span class="org-variable-name">CMAKE_SYSTEM_NAME</span><span class="org-string">}"</span>)
<span class="org-function-name">message</span>(<span class="org-string">" [INFO]  Build type   - CMAKE_BUILD_TYPE      = ${</span><span class="org-variable-name">CMAKE_BUILD_TYPE</span><span class="org-string">}"</span>)
<span class="org-function-name">message</span>(<span class="org-string">" [INFO]  Compiler ID  - CMAKE_CXX_COMPILER_ID = ${</span><span class="org-variable-name">CMAKE_CXX_COMPILER_ID</span><span class="org-string">}"</span>)
<span class="org-function-name">message</span>(<span class="org-string">" [INFO]  Install path - CMAKE_INSTALL_PREFIX  = ${</span><span class="org-variable-name">CMAKE_INSTALL_PREFIX</span><span class="org-string">} "</span>)
<span class="org-keyword">if</span>(CMAKE_SIZEOF_VOID_P EQUAL 8)
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Target = 64 bits build."</span>)
<span class="org-keyword">else</span>()
   <span class="org-function-name">message</span>(<span class="org-string">" [INFO] Target = 32 bits build."</span>)
<span class="org-keyword">endif</span>()
<span class="org-function-name">message</span>(<span class="org-string">" [INFO] CMake binary dir = ${</span><span class="org-variable-name">CMAKE_BINARY_DIR</span><span class="org-string">}"</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd19c82c" class="outline-3">
<h3 id="orgd19c82c"><span class="section-number-3">1.15</span> Force Settings</h3>
<div class="outline-text-3" id="text-1-15">
</div>
<div id="outline-container-org6161703" class="outline-4">
<h4 id="org6161703"><span class="section-number-4">1.15.1</span> Force generation of debugging symbols</h4>
<div class="outline-text-4" id="text-1-15-1">
<p>
This snippet forces the generation of debugging symbols regardless of
the build type. It is a useful setting when building from command
line. 
</p>

<p>
Add the following line to the CMake file: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-function-name">set</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">CMAKE_BUILD_TYPE</span> <span class="org-variable-name">Debug</span><span class="org-rainbow-delimiters-depth-1">)</span> # Force debug build
</pre>
</div>

<p>
After the line is added, the file CMakeLists.txt becomes:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment">#========= Global Configuration ===============# </span>
<span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(Demo_cpp_plugin)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-comment"># Force debug build</span>
<span class="org-function-name">set</span>(CMAKE_BUILD_TYPE Debug) <span class="org-comment"># Force debug build</span>

<span class="org-comment">#========== Targets Configurations ============#</span>

<span class="org-function-name">add_executable</span>(app ... )
.. ... ... ... 
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf301ce6" class="outline-4">
<h4 id="orgf301ce6"><span class="section-number-4">1.15.2</span> Force Compiler to Clang</h4>
<div class="outline-text-4" id="text-1-15-2">
<p>
Despite C++ language remarkable improvements, C++ compiler error
messages of most compilers still cryptic and hard to grasp. Even for
silly syntax mistakes, C++ compilers can fill the screen with error
messages providing little context about the compiler error. 
</p>

<p>
Such cryptic errors can be better diagnosed by switching the compiler
to Clang that provides much better error messages that other compilers.
The compiler can be temporarily switched by using the IDE, by setting
environment variables or by setting CMake variables to force using an
specific compiler.
</p>


<p>
Example: CMakeLists.txt forcing compiler to Clang.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(NumericalMethods)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-function-name">set</span>(FORCE_CLANG ON)
<span class="org-comment"># Force compiler to Clang++</span>
<span class="org-keyword">if</span>(FORCE_CLANG)
    <span class="org-function-name">set</span>(CMAKE_C_COMPILER clang)
    <span class="org-function-name">set</span>(CMAKE_CXX_COMPILER clang++)
<span class="org-keyword">endif</span>()

<span class="org-comment">#========== Targets Configurations ============#</span>

<span class="org-comment"># TARGET: rootFinding1.cpp </span>
<span class="org-function-name">add_executable</span>(rootFinding1 rootFinding1.cpp)
</pre>
</div>

<p>
<b>Explanation:</b>
</p>

<p>
This next line sets the variable FORCE_CLANG:
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">set</span>(FORCE_CLANG ON)   <span class="org-comment"># Force using clang compiler </span>
<span class="org-function-name">set</span>(FORCE_CLANG OFF)  <span class="org-comment"># Use default compiler </span>
</pre>
</div>

<p>
When the variable FORCE_CLANG is set, the commands within the if-endif
block set the C and C++ compiler to Clang and Clang++.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># Force compiler to Clang++</span>
<span class="org-keyword">if</span>(FORCE_CLANG)
    <span class="org-function-name">set</span>(CMAKE_C_COMPILER clang)
    <span class="org-function-name">set</span>(CMAKE_CXX_COMPILER clang++)
<span class="org-keyword">endif</span>()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org01831b6" class="outline-3">
<h3 id="org01831b6"><span class="section-number-3">1.16</span> Useful CMake Modules</h3>
<div class="outline-text-3" id="text-1-16">
</div>
<div id="outline-container-orga07de7e" class="outline-4">
<h4 id="orga07de7e"><span class="section-number-4">1.16.1</span> CMake Module Projects</h4>
<div class="outline-text-4" id="text-1-16-1">
<ul class="org-ul">
<li><b>Cotire</b> [BEST]
<ul class="org-ul">
<li>CMake module for speeding compilation by automating the usage of
pre-compiled headers in a non-intrusive way that requires few
modifications in the source code.</li>
<li>Note: The process of using pre-compiled headers is usually
cumbersome and compiler-specific. This CMake module (script)
automates this configuration.</li>
<li>Repository: <a href="https://github.com/sakra/cotire">https://github.com/sakra/cotire</a></li>
</ul></li>

<li><b>ruslo/poly</b>
<ul class="org-ul">
<li>wrench Collection of CMake toolchain files and scripts for
cross-platform build and CI testing (GCC, Visual Studio, iOS,
Android, Clang analyzer, sanitizers etc.) <a href="http://goo.gl/5JpHX">http://goo.gl/5JpHX</a></li>
<li>Contains CMAKE Toolchain files for iOS, Android, Raspberry Pi,
Windows &#x2026;</li>
<li><a href="https://github.com/ruslo/polly">https://github.com/ruslo/polly</a></li>
</ul></li>

<li><b>cmake-precompile-headers</b>
<ul class="org-ul">
<li>Precompiled header setup for CMake. Supported CMake generators:
Visual Studio; NMake Makefiles; Unix Makefiles (GCC); MinGW
Makefiles; MSYS Makefiles and Ninja.</li>
<li><a href="https://github.com/larsch/cmake-precompiled-header">https://github.com/larsch/cmake-precompiled-header</a></li>
</ul></li>

<li><b>UCM</b>
<ul class="org-ul">
<li>Useful cmake macros that help with: compiler/linker flags,
collecting sources, PCHs, Unity builds and other stuff.</li>
<li>Repository: <a href="https://github.com/onqtam/ucm">https://github.com/onqtam/ucm</a></li>
</ul></li>

<li><b>Dockcross</b> 
<ul class="org-ul">
<li>Cross compiling toolchains in Docker images</li>
<li>Repository: <a href="https://github.com/dockcross/dockcross">https://github.com/dockcross/dockcross</a></li>
</ul></li>

<li><b>clang-tidy-project-cmake</b>
<ul class="org-ul">
<li>Add clang-tidy checks to a target usingCMake</li>
<li>Repository: <a href="https://github.com/polysquare/clang-tidy-target-cmake">https://github.com/polysquare/clang-tidy-target-cmake</a></li>
</ul></li>

<li><b>FindLAPACK</b>
<ul class="org-ul">
<li>CMake FindLAPACK.cmake that works with Intel MKL, Atlas, OpenBLAS, Netlib, LAPACK95 for C / C++ / Fortran</li>
<li>Repository: <a href="https://github.com/scivision/lapack-cmake">https://github.com/scivision/lapack-cmake</a></li>
</ul></li>

<li><b>android-cmake</b>
<ul class="org-ul">
<li>"CMake is great, and so is Android. This is a collection of CMake
scripts that may be useful to the Android NDK community. It is
based on experience from porting OpenCV library to Android:
<a href="http://opencv.org/platforms/android.html">http://opencv.org/platforms/android.html</a> Main goal is to share
these scripts so that devs that use CMake as their build system
may easily compile native code for Android."</li>
<li>Repository: <a href="https://github.com/taka-no-me/android-cmake">https://github.com/taka-no-me/android-cmake</a></li>
</ul></li>

<li><b>cmake-avr</b>
<ul class="org-ul">
<li>cmake-avr - a cmake toolchain for AVR projects</li>
<li><a href="https://github.com/mkleemann/cmake-avr">https://github.com/mkleemann/cmake-avr</a></li>
</ul></li>

<li><b>arduino-cmake</b>
<ul class="org-ul">
<li>Arduino CMake Build system</li>
<li><a href="https://github.com/francoiscampbell/arduino-cmake">https://github.com/francoiscampbell/arduino-cmake</a></li>
</ul></li>

<li><b>Hunder Package Manager</b> - A CMake module (aka script) that works as
package manager. 
<ul class="org-ul">
<li>Repository: <a href="https://github.com/ruslo/hunter">https://github.com/ruslo/hunter</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org452b63f" class="outline-4">
<h4 id="org452b63f"><span class="section-number-4">1.16.2</span> Collected CMake Modules</h4>
<div class="outline-text-4" id="text-1-16-2">
<p>
Collected CMake modules/scripts from other projects. 
</p>

<ul class="org-ul">
<li><a href="https://github.com/OpenChemistry/avogadroapp/blob/master/cmake/DeployQt5.cmake">DeployQt5.cmake</a></li>

<li><a href="https://github.com/OpenChemistry/avogadroapp/blob/master/cmake/AvogadroCPack.cmake">AvogadroCPack.cmake</a></li>

<li><a href="https://gitlab.com/rpdev/opentodolist/blob/master/cmake/BuildLinuxAppImage.cmake">BuildLinuxAppImage.cmake</a></li>

<li><a href="https://github.com/OpenChemistry/avogadroapp/blob/master/cmake/DetermineVersion.cmake">DetermineVersion.cmake</a></li>

<li><a href="https://github.com/owncloud/client/blob/master/cmake/modules/GetGitRevisionDescription.cmake">GetGitRevisionDescription.cmake</a></li>

<li><a href="https://github.com/owncloud/client/blob/master/cmake/modules/UseDoxygen.cmake">UseDoxygen.cmake</a></li>

<li><a href="https://github.com/nitroshare/nitroshare-desktop/blob/226dd32879981c0bf2ef4c78faee3af3b797bfdc/cmake/Windeployqt.cmake">Windeployqt.cmake</a></li>

<li><a href="https://github.com/nitroshare/nitroshare-desktop/blob/226dd32879981c0bf2ef4c78faee3af3b797bfdc/cmake/SharedLibrary.cmake">SharedLibrary.cmake</a></li>

<li><a href="https://git.ircad.fr/Sight/sight/blob/dev/CMake/doxygen/doxygen_generator.cmake">doxygen_generator.cmake</a></li>

<li><a href="https://git.ircad.fr/Sight/sight/blob/dev/CMake/install/linux_install.cmake">linux_install.cmake</a></li>

<li><a href="https://git.ircad.fr/Sight/sight/blob/dev/CMake/install/osx_install.cmake">osx_install.cmake</a></li>

<li><a href="https://git.ircad.fr/Sight/sight/blob/dev/CMake/install/win_install.cmake">win_install.cmake</a></li>

<li><a href="https://git.ircad.fr/Sight/sight/blob/dev/CMake/vscode/vscode_generator.cmake">vscode_generator.cmake</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga5b3312" class="outline-3">
<h3 id="orga5b3312"><span class="section-number-3">1.17</span> Cross references</h3>
<div class="outline-text-3" id="text-1-17">
</div>
<div id="outline-container-org52133f1" class="outline-4">
<h4 id="org52133f1"><span class="section-number-4">1.17.1</span> Common Variables</h4>
<div class="outline-text-4" id="text-1-17-1">
</div>
<ol class="org-ol">
<li><a id="orgff3cd18"></a>CMAKE_CURRENT_LIST_DIR - Directory where is CMakeLists.txt<br />
<div class="outline-text-5" id="text-1-17-1-1">
<p>
Prints the directory where CMAkeLists.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">message</span>(<span class="org-string">" [INFO] CMakeLists.txt is in the directory ${</span><span class="org-variable-name">CMAKE_CURRENT_LIST_DIR</span><span class="org-string">}"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org7a62268"></a>CMAKE_CXX_STANDARD - Set C++ Standard<br />
<div class="outline-text-5" id="text-1-17-1-2">
<p>
The variable <code>CMAKE_CXX_STANDARD</code> sets the project current C++
standard. This variable can be set to 98 (for C++98); 11 (C++11); 14
(C++14); 17 (C++17) and 20 (C++20 - experimental yet.)
</p>

<ul class="org-ul">
<li>Documentation: <a href="https://cmake.org/cmake/help/latest/prop_tgt/CXX_STANDARD.html#prop_tgt:CXX_STANDARD">CXX_STANDARD — CMake 3.13.2 Documentation</a></li>
</ul>

<p>
Example: Set project to compile with C++11 ISO standard.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 11)
</pre>
</div>

<p>
Usage: (File CMAKELists.txt)
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(MY_PROJECT_NAME)

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
... ... .... .... 
</pre>
</div>
</div>
</li>

<li><a id="org4c89503"></a>CMAKE_BUILD_TYPE - Set default building type to DEBUG<br />
<div class="outline-text-5" id="text-1-17-1-3">
<p>
In the debug building type optimization flags are disabled and flags
for generating debugging symbols are enabled, for GGC or GCC/Mingw and
Clang the (-g) is automatically added and for MSVC, aka VC++ (cl.exe),
the flag /Zi is also passed to the compiler. The default building type
can be set to DEBUG with the following code.
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-comment"># Set default building type to debug if it was not set</span>
<span class="org-comment"># in command line with -DCMAKE_BUILD_TYPE=release</span>
<span class="org-keyword">if</span>(NOT DEFINED CMAKE_BUILD_TYPE OR CMAKE_BUILD_TYPE MATCHES <span class="org-string">""</span>)
  <span class="org-function-name">set</span>(CMAKE_BUILD_TYPE  debug)
<span class="org-keyword">endif</span>()
</pre>
</div>

<p>
The building type can be changed by running cmake with the flag
 (-DCMAKE_BUILD_TYPE=release). Example: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=DEBUG -G <span class="org-string">"Visual Studio 15 2017 Win64"</span>
</pre>
</div>

<p>
Note: CMake is not case sensitive, so it does not matter using
'release' or RELEASE; if or IF; endif or ENDIF and so on. 
</p>
</div>
</li>

<li><a id="orgb8b40d0"></a>CMAKE_CXX_FLAGS - Compiler flags<br />
<div class="outline-text-5" id="text-1-17-1-4">
<p>
The globals compiler flags used to build all targets can be extended
by setting the variable CMAKE_CXX_FLAGS. However, as the compiler
flags depends on the compiler, the custom settings may not be portable
if one uses a different compiler, for instance the (-g) flag used to
generate debug symbols with GCC or Clang does not work with MSVC
(visual c++ compiler, vc++) as it uses the flag /Zi for generating
debugging symbols.
</p>

<p>
Example 1: 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">set</span>(CMAKE_CXX_FLAGS <span class="org-string">"${</span><span class="org-variable-name">CMAKE_CXX_FLAGS</span><span class="org-string">}"</span>  <span class="org-string">"-std=c++17 -g -Wall -Wextra -pendantic -O0"</span> )
</pre>
</div>

<p>
Example 2 (better):
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-keyword">if</span>(NOT MSVC)
   <span class="org-function-name">set</span>(CMAKE_CXX_FLAGS <span class="org-string">"${</span><span class="org-variable-name">CMAKE_CXX_FLAGS</span><span class="org-string">}"</span>  <span class="org-string">"-std=c++17 -g -Wall -Wextra -pendantic -O0"</span> )
<span class="org-keyword">endif</span>()
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb2c37ba" class="outline-4">
<h4 id="orgb2c37ba"><span class="section-number-4">1.17.2</span> CMake Map</h4>
<div class="outline-text-4" id="text-1-17-2">
<ul class="org-ul">
<li>Global configuration/settings 
<ul class="org-ul">
<li>add_definitions</li>
<li>set(&lt;VARIABLE&gt; &lt;VALUE&gt;)</li>
<li>add_subdirectory</li>
</ul></li>

<li>Target defintions
<ul class="org-ul">
<li>add_executable =&gt; Create target for building executable.</li>
<li>add_library    =&gt; Create target for building static or shared library.</li>
<li>add_custom_target</li>
</ul></li>

<li>Target Configuration:
<ul class="org-ul">
<li>set_target_properties(&lt;TARGET&gt; PROPERTIES &lt;KEY&gt; &lt;VALUE&gt; [&lt;KEY &lt;VALUE&gt;] &#x2026;)</li>
<li>set_target_properties(testlib PROPERTIES CXX_VISIBILITY_PRESET hidden)
<ul class="org-ul">
<li>Make  symbols of shared or static library hidden by default,
only explicitly annotated symbols are visible. It avoids name
clashing which can lead to undefined behavior.</li>
</ul></li>

<li>target_link_libraries(&lt;executable-target&gt; PUBLIC testlib)</li>
</ul></li>

<li>Auxiliary targets:
<ul class="org-ul">
<li>install  =&gt; Install packages to some directoriy.</li>
</ul></li>

<li>Find Commands:
<ul class="org-ul">
<li>find_path</li>
<li>find_package</li>
<li>find_library</li>
<li>include_directory</li>
</ul></li>

<li>Global Variables:
<ul class="org-ul">
<li>set(CMAKE_CXX_STANDARD 14)</li>
<li>set(CMAKE_VERBOSE_MAKEFILE ON)</li>
<li>set(CMAKE_BUILD_TYPE  debug)</li>
</ul></li>
</ul>

<p>
Typical CMake Variables:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Compiler flags</th>
<th scope="col" class="org-left">Description</th>
</tr>

<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">affected</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>Misc</b></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PROJECT_NAME</td>
<td class="org-left">-</td>
<td class="org-left">Sets project name.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>Compiler</b></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMAKE_CXX_STANDARD</td>
<td class="org-left">-std=c++11</td>
<td class="org-left">Set the C++ standard used for compoling all sources</td>
</tr>

<tr>
<td class="org-left">CMAKE_CXX_FLAGS</td>
<td class="org-left">-</td>
<td class="org-left">Additional compiler flags for all targets.</td>
</tr>

<tr>
<td class="org-left">CMAKE_BUILD_TYPE</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Set whether build type is release or debug</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><b>Location</b></td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMAKE_BINARY_DIR</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMAKE_CURRENT_LIST_DIR</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Get location of current CMakeLists.txt file.</td>
</tr>

<tr>
<td class="org-left">CMAKE_INSTALL_PREFIX</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Location where targets will be installed (target <span class="underline">install</span>)</td>
</tr>

<tr>
<td class="org-left">CMAKE_CURRENT_BINARY_DIR</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Notes: 
</p>

<ul class="org-ul">
<li>The default value of the variable CMAKE_INSTALL_PREFIX are:
<ul class="org-ul">
<li>Windows:        C:/Program Files/${PROJECT_NAME}</li>
<li>Unix-like OS:   /usr/local</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-06-04 Fri 15:10</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
