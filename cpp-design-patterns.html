<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-10-26 Fri 22:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CPP / C++ Notes - Design Patterns</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="cpp/c++ c++ design patterns gneric programming object oriented metaprogramming"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="theme/org-nav-theme.css" rel="stylesheet">
<script src="theme/org-nav-theme.js"></script>
<link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">CPP / C++ Notes - Design Patterns</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4322d66">1. Design Patterns</a>
<ul>
<li><a href="#org2e570f6">1.1. Named constructor - static factory method</a></li>
<li><a href="#org2ad7995">1.2. Singleton</a></li>
<li><a href="#orgb29ef3a">1.3. Interface Class</a>
<ul>
<li><a href="#org77d54c8">1.3.1. Overview</a></li>
<li><a href="#orgf325bb5">1.3.2. Example</a></li>
</ul>
</li>
<li><a href="#org889c7a7">1.4. Builder Design Pattern (Joshua Blosh)</a></li>
<li><a href="#orgdc09e2b">1.5. Strategy Design Pattern</a>
<ul>
<li><a href="#org764920d">1.5.1. Overview</a></li>
<li><a href="#orgfe5f28b">1.5.2. Example</a></li>
</ul>
</li>
<li><a href="#orga1c638a">1.6. Method Chaining - Fluent API</a></li>
<li><a href="#org3341ef7">1.7. GOF - Template Pattern</a></li>
<li><a href="#orge706722">1.8. Null-Object Pattern</a></li>
<li><a href="#orgbcc2775">1.9. PIMPL - Pointer to Implementation (C++ Only)</a></li>
<li><a href="#orgd812ea2">1.10. Type Erasure (C++ Only)</a>
<ul>
<li><a href="#org9fe0e61">1.10.1. Overview</a></li>
<li><a href="#org20ae051">1.10.2. Example 1 - Simple type erasure.</a></li>
</ul>
</li>
<li><a href="#orgf903f72">1.11. CRTP - Curious Recurring Template Pattern (C++ Only)</a>
<ul>
<li><a href="#org89643aa">1.11.1. Overview</a></li>
<li><a href="#orgbc4b01b">1.11.2. Example</a></li>
</ul>
</li>
<li><a href="#org2ea564e">1.12. RAII - Resource Aquisition Is Initialization (C++ Only)</a></li>
<li><a href="#org8541d83">1.13. Cross platform code with conditional compilation (C++ Only)</a></li>
<li><a href="#org85d0bd5">1.14. Multiple booleans encoded as bitmask</a></li>
</ul>
</li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><a href='index.html'>Index</a></li>
</ul>

<div id="outline-container-org4322d66" class="outline-2">
<h2 id="org4322d66"><span class="section-number-2">1</span> Design Patterns</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org2e570f6" class="outline-3">
<h3 id="org2e570f6"><span class="section-number-3">1.1</span> Named constructor - static factory method</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The named constructor or static factory design pattern uses static
methods instead of constructors for instantiating objects. This
approach has many advantages over constructor instantiation. Named
constructors are more readable than ordinary constructors and unlike
constructors, many named constructors static methods sharing the same
type signature can coexist. Another benefit is that this technique
allows objects to be instantiated in many different ways from several
different data representation.
</p>

<p>
Side note: It should not be confused with factory design pattern or
abstract factory design pattern.
</p>

<p>
Example:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">ostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cstdint</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">#include &lt;stdint&gt;   // WARNING - It may not be available</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Unsigned byte from 0 to 255 or 0x00 to 0xFF</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">---&gt; typedef uint8_t ubyte;</span>
<span class="org-keyword">using</span> <span class="org-type">ubyte</span> = uint8_t ; 

<span class="org-keyword">class</span> <span class="org-type">Color</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-type">ubyte</span> <span class="org-variable-name">m_r</span>;
    <span class="org-type">ubyte</span> <span class="org-variable-name">m_g</span>;
    <span class="org-type">ubyte</span> <span class="org-variable-name">m_b</span>;
<span class="org-function-name">public</span>:
    <span class="org-function-name">Color</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">ubyte</span> <span class="org-variable-name">red</span>, <span class="org-type">ubyte</span> <span class="org-variable-name">green</span>, <span class="org-type">ubyte</span> <span class="org-variable-name">blue</span><span class="org-rainbow-delimiters-depth-2">)</span>:
        m_r<span class="org-rainbow-delimiters-depth-2">(</span>red<span class="org-rainbow-delimiters-depth-2">)</span>, m_g<span class="org-rainbow-delimiters-depth-2">(</span>green<span class="org-rainbow-delimiters-depth-2">)</span>, m_b<span class="org-rainbow-delimiters-depth-2">(</span>blue<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{}</span>
    <span class="org-type">ubyte</span> <span class="org-function-name">red</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> m_r;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">ubyte</span> <span class="org-function-name">blue</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> m_b;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">ubyte</span> <span class="org-function-name">green</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> m_g;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Named constructor or static factory method which builds the object</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">From the RGB tuple data representation </span>
    <span class="org-keyword">static</span> <span class="org-type">Color</span> <span class="org-function-name">fromRGB</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">ubyte</span> <span class="org-variable-name">red</span>, <span class="org-type">ubyte</span> <span class="org-variable-name">green</span>, <span class="org-type">ubyte</span> <span class="org-variable-name">blue</span><span class="org-rainbow-delimiters-depth-2">){</span>
        <span class="org-keyword">return</span> Color<span class="org-rainbow-delimiters-depth-3">(</span>red, green, blue<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Named constructor which builds Color object </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">from hexadecimal data representation </span>
    <span class="org-keyword">static</span> <span class="org-type">Color</span> <span class="org-function-name">fromHex</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">color</span><span class="org-rainbow-delimiters-depth-2">){</span>
        <span class="org-type">int</span> <span class="org-variable-name">r</span> = color &amp; 0xFF;
        <span class="org-type">int</span> <span class="org-variable-name">g</span> = <span class="org-rainbow-delimiters-depth-3">(</span>color &gt;&gt; 8 <span class="org-rainbow-delimiters-depth-3">)</span> &amp; 0xFF;
        <span class="org-type">int</span> <span class="org-variable-name">b</span> = <span class="org-rainbow-delimiters-depth-3">(</span>color &gt;&gt; 16<span class="org-rainbow-delimiters-depth-3">)</span> &amp; 0xFF;
        <span class="org-keyword">return</span> Color<span class="org-rainbow-delimiters-depth-3">(</span>r, g, b<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Named constructor which builds a specific color.</span>
    <span class="org-keyword">static</span> <span class="org-type">Color</span> <span class="org-function-name">colorRED</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> fromRGB<span class="org-rainbow-delimiters-depth-3">(</span>255, 0, 0<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">static</span> <span class="org-type">Color</span> <span class="org-function-name">colorBLUE</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> fromRGB<span class="org-rainbow-delimiters-depth-3">(</span>0, 255, 0<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">static</span> <span class="org-type">Color</span> <span class="org-function-name">colorGREEN</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-keyword">return</span> fromRGB<span class="org-rainbow-delimiters-depth-3">(</span>0, 0, 255<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">friend</span> <span class="org-constant">std</span>::<span class="org-type">ostream</span>&amp; <span class="org-keyword">operator</span> <span class="org-function-name">&lt;&lt;</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::<span class="org-type">ostream</span>&amp; <span class="org-variable-name">os</span>, <span class="org-keyword">const</span> <span class="org-type">Color</span>&amp; <span class="org-variable-name">c</span><span class="org-rainbow-delimiters-depth-2">){</span>
        os &lt;&lt; <span class="org-string">"Color(r = "</span>
           &lt;&lt; <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>c.m_r<span class="org-rainbow-delimiters-depth-3">)</span>
           &lt;&lt; <span class="org-string">", g = "</span> &lt;&lt; <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>c.m_g<span class="org-rainbow-delimiters-depth-3">)</span>
           &lt;&lt; <span class="org-string">", b = "</span> &lt;&lt; <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>c.m_b<span class="org-rainbow-delimiters-depth-3">)</span> &lt;&lt; <span class="org-string">")"</span>;
        <span class="org-keyword">return</span> os;
    <span class="org-rainbow-delimiters-depth-2">}</span>      
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(){</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Red    = "</span> &lt;&lt; <span class="org-constant">Color</span>::colorRED<span class="org-rainbow-delimiters-depth-2">()</span>   &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Blue   = "</span> &lt;&lt; <span class="org-constant">Color</span>::colorBLUE<span class="org-rainbow-delimiters-depth-2">()</span>  &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Green  = "</span> &lt;&lt; <span class="org-constant">Color</span>::colorGREEN<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Color1 = "</span> &lt;&lt; <span class="org-constant">Color</span>::fromRGB<span class="org-rainbow-delimiters-depth-2">(</span>20, 90, 200<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Color2 = "</span> &lt;&lt; <span class="org-constant">Color</span>::fromHex<span class="org-rainbow-delimiters-depth-2">(</span>0xFF8AB5<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-constant">std</span>::cout.flush<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<pre class="example">
Red    = Color(r = 255, g = 0, b = 0)
Blue   = Color(r = 0, g = 255, b = 0)
Green  = Color(r = 0, g = 0, b = 255)
Color1 = Color(r = 20, g = 90, b = 200)
Color2 = Color(r = 181, g = 138, b = 255)

</pre>
</div>
</div>
<div id="outline-container-org2ad7995" class="outline-3">
<h3 id="org2ad7995"><span class="section-number-3">1.2</span> Singleton</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Singleton is a creational design pattern where there is only a single
instance of a class and client code is forbidden from creating new
instances.
</p>

<p>
Note: Despite that there are lots of objections against this design
pattern, it is still worth knowing how it works.
</p>

<ul class="org-ul">
<li>File: <a href="src/design-patterns/singleton1.cpp">file:src/design-patterns/singleton1.cpp</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">FileRepository</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-constant">std</span>::<span class="org-type">deque</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">_files</span>; 
    <span class="org-comment-delimiter">// </span><span class="org-comment">Forbid client code instating a new instance. </span>
    <span class="org-function-name">FileRepository</span><span class="org-rainbow-delimiters-depth-2">(){}</span>  
    <span class="org-comment-delimiter">// </span><span class="org-comment">Forbid client code from creating a copy or using the</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">copy constructor.</span>
    <span class="org-function-name">FileRepository</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">FileRepository</span>&amp;<span class="org-rainbow-delimiters-depth-2">){}</span>
<span class="org-function-name">public</span>:
    <span class="org-comment-delimiter">// </span><span class="org-comment">Return a reference to not allow client code </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">to delete object. </span>
    <span class="org-keyword">static</span> <span class="org-keyword">auto</span> <span class="org-function-name">getInstance</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">FileRepository</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">Initialized once - lazy initialization </span>
        <span class="org-keyword">static</span> <span class="org-keyword">auto</span> _instance = <span class="org-constant">std</span>::unique_ptr<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">FileRepository</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span><span class="org-keyword">new</span> <span class="org-type">FileRepository</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">return</span> *_instance.get<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">void</span> <span class="org-function-name">addFile</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">fname</span><span class="org-rainbow-delimiters-depth-2">){</span>
        _files.push_back<span class="org-rainbow-delimiters-depth-3">(</span>fname<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">void</span> <span class="org-function-name">clearFiles</span><span class="org-rainbow-delimiters-depth-2">(){</span>
            _files.clear<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">C++11 member function declaration looks better. </span>
    <span class="org-keyword">auto</span> <span class="org-function-name">showFiles</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">const</span> <span class="org-keyword">auto</span>&amp; <span class="org-variable-name">file</span>: _files<span class="org-rainbow-delimiters-depth-3">){</span>
            <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" File = "</span> &lt;&lt; file &lt;&lt; <span class="org-string">"\n"</span>;
        <span class="org-rainbow-delimiters-depth-3">}</span>
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Test in CERN ROOT/Clign REPL:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Load C++ code as it was a script.</span>
&gt;&gt; .L singleton1.cpp

<span class="org-comment-delimiter">// </span><span class="org-comment">Try to instantiate singleton object without reference. </span>
<span class="org-comment-delimiter">//</span><span class="org-comment">------------------------------------------------------</span>
&gt;&gt; FileRepository repo = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-function-name">ROOT_prompt_2</span>:1:23: error: calling a <span class="org-keyword">private</span> constructor of <span class="org-keyword">class</span> <span class="org-warning">'</span>FileRepository<span class="org-warning">'</span>
FileRepository repo = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>
                      ^
<span class="org-function-name">singleton1.cpp</span>:21:5: note: declared <span class="org-keyword">private</span> here
    FileRepository<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">FileRepository</span>&amp;<span class="org-rainbow-delimiters-depth-1">){}</span>
    ^
&gt;&gt; FileRepository&amp; repo = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">FileRepository</span> &amp;<span class="org-rainbow-delimiters-depth-1">)</span> @0x2fc9640
&gt;&gt; 

&gt;&gt; FileRepository&amp; repo = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">FileRepository</span> &amp;<span class="org-rainbow-delimiters-depth-1">)</span> @0x2fc9640
&gt;&gt; 

&gt;&gt; repo.showFiles<span class="org-rainbow-delimiters-depth-1">()</span>
&gt;&gt; 
&gt;&gt; repo.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"quarterly-sales-report.dat"</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt;&gt; repo.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"interest-payments.txt"</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt;&gt; repo.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"taxes-report.xls"</span><span class="org-rainbow-delimiters-depth-1">)</span>
&gt;&gt; repo.showFiles<span class="org-rainbow-delimiters-depth-1">()</span>
 File = quarterly-sales-report.dat
 File = interest-payments.txt
 File = taxes-report.xls
&gt;&gt; 
&gt;&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Try to copy object. </span>
&gt;&gt; FileRepository r = repo;
<span class="org-function-name">ROOT_prompt_9</span>:1:20: error: calling a <span class="org-keyword">private</span> constructor of <span class="org-keyword">class</span> <span class="org-warning">'</span>FileRepository<span class="org-warning">'</span>
FileRepository r = repo;
                   ^
<span class="org-function-name">singleton1.cpp</span>:21:5: note: declared <span class="org-keyword">private</span> here
    FileRepository<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">FileRepository</span>&amp;<span class="org-rainbow-delimiters-depth-1">){}</span>
    ^
&gt;&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Try to create a new object </span>
&gt;&gt; FileRepository&amp; repo2 = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">FileRepository</span> &amp;<span class="org-rainbow-delimiters-depth-1">)</span> @0x2fc9640
&gt;&gt; repo2.showFiles<span class="org-rainbow-delimiters-depth-1">()</span>
 File = quarterly-sales-report.dat
 File = interest-payments.txt
 File = taxes-report.xls
&gt;&gt; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Check whether repo and repo2 are the same object (reference equality)</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">-&gt; They are equal under reference equality criteria if they have the same address.</span>
&gt;&gt; &amp;repo == &amp;repo2
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">bool</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-constant">true</span>
&gt;&gt; 
</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">FileRepository</span>&amp; <span class="org-variable-name">repo1</span> = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>;
repo1.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"CashFlowStatement.txt"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
repo1.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Balance-Sheet.dat"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
repo1.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Sales-Report.csv"</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">FileRepository</span>&amp; <span class="org-variable-name">repo2</span> = <span class="org-constant">FileRepository</span>::getInstance<span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-constant">std</span>::boolalpha &lt;&lt; <span class="org-string">"Same object? (&amp;repo == &amp;repo1 ?) = "</span>
          &lt;&lt; <span class="org-rainbow-delimiters-depth-1">(</span>&amp;repo1 == &amp;repo2<span class="org-rainbow-delimiters-depth-1">)</span>
          &lt;&lt; <span class="org-string">"\n"</span>;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Repository files"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
repo2.showFiles<span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Add more files"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
repo2.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fileX1.pdf"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
repo2.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fileX2.pdf"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
repo2.addFile<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"fileX3.pdf"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
repo2.showFiles<span class="org-rainbow-delimiters-depth-1">()</span>;
</pre>
</div>

<p>
Compiling and running (<a href="src/design-patterns/singleton1.cpp">file:src/design-patterns/singleton1.cpp</a>): 
</p>

<div class="org-src-container">
<pre class="src src-txt">$ clang++ singleton1.cpp -o singleton1.bin -g -std=c++1z -Wall -Wextra 
$ ./singleton1.bin

Same object? (&amp;repo == &amp;repo1 ?) = true
Repository files
 File = CashFlowStatement.txt
 File = Balance-Sheet.dat
 File = Sales-Report.csv
Add more files
 File = CashFlowStatement.txt
 File = Balance-Sheet.dat
 File = Sales-Report.csv
 File = fileX1.pdf
 File = fileX2.pdf
 File = fileX3.pdf
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb29ef3a" class="outline-3">
<h3 id="orgb29ef3a"><span class="section-number-3">1.3</span> Interface Class</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org77d54c8" class="outline-4">
<h4 id="org77d54c8"><span class="section-number-4">1.3.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
Unlike C# and Java, C++ doesn't have any keyword for implementing
interface, however it can be implemented by creating a class with only
pure virtual functions, in other words, only abstract methods or
methods without implementation. 
</p>

<p>
The interface class has a runtime overhead due to the virtual methods
that are resolved at runtime. An alternative solution when the virtual
methods calls performance overhead is not acceptable, is to use
generic programming or templates which doesn't have runtime cost since
the methods to be called are resolved at compile-time.
</p>

<p>
Note: 
</p>
<ul class="org-ul">
<li>The annotation <b>virtual</b> - means that the method (member function)
can be overriden by the derived class. Methods in the base class
not annotated as virtual cannot be overriden in the derived
classes. Unlike Java, C++ methods are not virtual by default.</li>

<li>The annotation (=0) - means a pure virtual member function, aka
pure virtual function which is an <span class="underline">abstract method</span>, method without
implementation.</li>
</ul>

<p>
<b>Example</b>: Interface Class Declaration: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
    <span class="org-keyword">virtual</span> ~<span class="org-function-name">IStack</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
    <span class="org-keyword">virtual</span> <span class="org-type">int</span>    <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">void</span>   <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span>       = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">()</span>                = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Or: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">struct</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">virtual</span> ~<span class="org-function-name">IStack</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
    <span class="org-keyword">virtual</span> <span class="org-type">int</span>    <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">void</span>   <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span>       = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">()</span>                = 0;
    <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Or using C++ auto keyword for functions: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">struct</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">virtual</span> ~<span class="org-function-name">IStack</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
    <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>   -&gt; <span class="org-type">int</span>    = 0;
    <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">void</span>   = 0;
    <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">()</span>          -&gt; <span class="org-type">double</span> = 0;
    <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>   -&gt; <span class="org-type">double</span> = 0;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf325bb5" class="outline-4">
<h4 id="orgf325bb5"><span class="section-number-4">1.3.2</span> Example</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
<b>Complete Code Example</b>
</p>
<ul class="org-ul">
<li>File:  <a href="src/design-patterns/interface-class.cpp">file:src/design-patterns/interface-class.cpp</a></li>
</ul>

<p>
Interface class declaration:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Interface Stack. (Should be placed in the header file.) </span>
<span class="org-keyword">class</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-keyword">virtual</span> ~<span class="org-function-name">IStack</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
        <span class="org-keyword">virtual</span> <span class="org-type">int</span>    <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
        <span class="org-keyword">virtual</span> <span class="org-type">void</span>   <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span>       = 0;
        <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">()</span>                = 0;
        <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span>         <span class="org-keyword">const</span> = 0;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Example: Interface implementations. 
</p>

<ul class="org-ul">
<li>Implementation of interface IStack using vector as internal
representation.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">StackVector</span>: <span class="org-keyword">public</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-function-name">StackVector</span><span class="org-rainbow-delimiters-depth-2">(){}</span>
        <span class="org-function-name">StackVector</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">initializer_list</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-3">&gt;</span>&amp; <span class="org-variable-name">xs</span><span class="org-rainbow-delimiters-depth-2">){</span>
                _stack.insert<span class="org-rainbow-delimiters-depth-3">(</span>_stack.begin<span class="org-rainbow-delimiters-depth-4">()</span>, xs.begin<span class="org-rainbow-delimiters-depth-4">()</span>, xs.end<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">int</span> <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-keyword">return</span> _stack.size<span class="org-rainbow-delimiters-depth-3">()</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">void</span> <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">){</span>
                _stack.push_back<span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">double</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">(){</span>
                <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>-&gt;size<span class="org-rainbow-delimiters-depth-4">()</span> == 0<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: stack is empty"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
                <span class="org-type">double</span> <span class="org-variable-name">top</span> = _stack.back<span class="org-rainbow-delimiters-depth-3">()</span>;
                _stack.pop_back<span class="org-rainbow-delimiters-depth-3">()</span>;
                <span class="org-keyword">return</span> top;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">double</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>-&gt;size<span class="org-rainbow-delimiters-depth-4">()</span> == 0<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: stack is empty"</span><span class="org-rainbow-delimiters-depth-3">)</span>;      
                <span class="org-keyword">return</span> _stack.back<span class="org-rainbow-delimiters-depth-3">()</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">private</span>:
        <span class="org-constant">std</span>::<span class="org-type">vector</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">_stack</span><span class="org-rainbow-delimiters-depth-2">{}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Implementation using deque as internal representation:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">StackDeque</span>: <span class="org-keyword">public</span> <span class="org-type">IStack</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-function-name">StackDeque</span><span class="org-rainbow-delimiters-depth-2">(){}</span>
        <span class="org-function-name">StackDeque</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">initializer_list</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-3">&gt;</span>&amp; <span class="org-variable-name">xs</span><span class="org-rainbow-delimiters-depth-2">){</span>
                _stack.insert<span class="org-rainbow-delimiters-depth-3">(</span>_stack.begin<span class="org-rainbow-delimiters-depth-4">()</span>, xs.begin<span class="org-rainbow-delimiters-depth-4">()</span>, xs.end<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">int</span> <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-keyword">return</span> _stack.size<span class="org-rainbow-delimiters-depth-3">()</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">void</span> <span class="org-function-name">push</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">){</span>
                _stack.push_back<span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">double</span> <span class="org-function-name">pop</span><span class="org-rainbow-delimiters-depth-2">(){</span>
                <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>-&gt;size<span class="org-rainbow-delimiters-depth-4">()</span> == 0<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: stack is empty"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
                <span class="org-type">double</span> <span class="org-variable-name">top</span> = _stack.back<span class="org-rainbow-delimiters-depth-3">()</span>;
                _stack.pop_back<span class="org-rainbow-delimiters-depth-3">()</span>;
                <span class="org-keyword">return</span> top;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">double</span> <span class="org-function-name">peek</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>-&gt;size<span class="org-rainbow-delimiters-depth-4">()</span> == 0<span class="org-rainbow-delimiters-depth-3">)</span>
                        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: stack is empty"</span><span class="org-rainbow-delimiters-depth-3">)</span>;      
                <span class="org-keyword">return</span> _stack.back<span class="org-rainbow-delimiters-depth-3">()</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">private</span>:
        <span class="org-constant">std</span>::<span class="org-type">deque</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">_stack</span><span class="org-rainbow-delimiters-depth-2">{}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Sample client code:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">
<span class="org-keyword">auto</span> <span class="org-function-name">stack_sum</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">IStack</span>&amp; <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">double</span><span class="org-rainbow-delimiters-depth-1">{</span>
        <span class="org-comment-delimiter">//</span><span class="org-comment">std::cerr &lt;&lt; " ==&gt; stack_sum for references" &lt;&lt; std::endl;</span>
        <span class="org-type">double</span> <span class="org-variable-name">sum</span> = 0.0;
        <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>s.size<span class="org-rainbow-delimiters-depth-3">()</span> == 0<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-keyword">return</span> sum;
        <span class="org-keyword">while</span><span class="org-rainbow-delimiters-depth-2">(</span>s.size<span class="org-rainbow-delimiters-depth-3">()</span> != 0<span class="org-rainbow-delimiters-depth-2">)</span>
                sum += s.pop<span class="org-rainbow-delimiters-depth-2">()</span>;
        <span class="org-keyword">return</span> sum;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">auto</span> <span class="org-function-name">stack_sum</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">IStack</span>* <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">double</span><span class="org-rainbow-delimiters-depth-1">{</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">std::cerr &lt;&lt; " ==&gt; stack_sum for pointers" &lt;&lt; std::endl;</span>
        <span class="org-type">double</span> <span class="org-variable-name">sum</span> = 0.0;
        <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>s-&gt;size<span class="org-rainbow-delimiters-depth-3">()</span> == 0<span class="org-rainbow-delimiters-depth-2">)</span>
                <span class="org-keyword">return</span> sum;
        <span class="org-keyword">while</span><span class="org-rainbow-delimiters-depth-2">(</span>s-&gt;size<span class="org-rainbow-delimiters-depth-3">()</span> != 0<span class="org-rainbow-delimiters-depth-2">)</span>
                sum += s-&gt;pop<span class="org-rainbow-delimiters-depth-2">()</span>;
        <span class="org-keyword">return</span> sum;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Function main: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">StackVector</span> <span class="org-variable-name">sv</span> = <span class="org-rainbow-delimiters-depth-1">{</span>1.0, 2.0, 3.0, 5.0, 6.0<span class="org-rainbow-delimiters-depth-1">}</span>;
<span class="org-type">StackDeque</span>  <span class="org-variable-name">sd</span> = <span class="org-rainbow-delimiters-depth-1">{</span>1.0, 2.0, 3.0, 5.0, 6.0<span class="org-rainbow-delimiters-depth-1">}</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">The same client code works with any implementation of the interface. </span>
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(sv) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>sv<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(sd) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>sd<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;

<span class="org-type">IStack</span>* <span class="org-variable-name">spointer</span> = <span class="org-constant">nullptr</span>;
<span class="org-type">StackVector</span> <span class="org-variable-name">sv2</span> = <span class="org-rainbow-delimiters-depth-1">{</span>1.0, 2.0, 3.0, 5.0, 6.0<span class="org-rainbow-delimiters-depth-1">}</span>;
<span class="org-type">StackDeque</span>  <span class="org-variable-name">sd2</span> = <span class="org-rainbow-delimiters-depth-1">{</span>1.0, 2.0, 3.0, 5.0, 6.0<span class="org-rainbow-delimiters-depth-1">}</span>;
spointer = &amp;sv2;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(spointer) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>spointer<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
spointer = &amp;sd2;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(spointer) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>spointer<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;

<span class="org-keyword">auto</span> <span class="org-variable-name">sptr</span> = <span class="org-constant">std</span>::<span class="org-type">unique_ptr</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">IStack</span>, <span class="org-constant">std</span>::<span class="org-type">function</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IStack</span>*<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">&gt;</span><span class="org-rainbow-delimiters-depth-1">&gt;{</span>
        <span class="org-constant">nullptr</span>,
        <span class="org-comment-delimiter">// </span><span class="org-comment">Custom deleter </span>
        <span class="org-rainbow-delimiters-depth-2">[](</span><span class="org-type">IStack</span>* <span class="org-variable-name">p</span><span class="org-rainbow-delimiters-depth-2">){</span>
                <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">" ==== Stack deleted OK"</span> &lt;&lt; <span class="org-constant">std</span>::endl ;
                <span class="org-keyword">delete</span> p;
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
sptr.reset<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">StackVector</span><span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>10<span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>25.0<span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>20.0<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(sptr) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>*sptr<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
sptr.reset<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">StackDeque</span><span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>10<span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>25.0<span class="org-rainbow-delimiters-depth-1">)</span>;
sptr-&gt;push<span class="org-rainbow-delimiters-depth-1">(</span>20.0<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"stack_sum(sptr) = "</span> &lt;&lt; stack_sum<span class="org-rainbow-delimiters-depth-1">(</span>*sptr<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
</pre>
</div>

<p>
Compiling Running: 
</p>

<div class="org-src-container">
<pre class="src src-txt">$ clang++ interface-class.cpp -o interface-class.bin -g -std=c++1z -Wall -Wextra 
$ ./interface-class.bin
stack_sum(sv) = 17
stack_sum(sd) = 17
stack_sum(spointer) = 17
stack_sum(spointer) = 17
stack_sum(sptr) = 55
 ==== Stack deleted OK
stack_sum(sptr) = 55
 ==== Stack deleted OK
</pre>
</div>

<p>
References and further reading: 
</p>
<ul class="org-ul">
<li><a href="https://en.wikibooks.org/wiki/More_C++_Idioms/Interface_Class">More C++ Idioms/Interface Class - Wikibooks, open books for an open world</a></li>
<li><a href="https://accu.org/index.php/journals/269">ACCU - Separating Interface and Implementation in C++</a></li>
<li><a href="https://www.boost.org/doc/libs/1_63_0/libs/smart_ptr/sp_techniques.html">Smart Pointer Programming Techniques - 1.63.0</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org889c7a7" class="outline-3">
<h3 id="org889c7a7"><span class="section-number-3">1.4</span> Builder Design Pattern (Joshua Blosh)</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The purpose of the builder design pattern proposed by Joshua Bloch is
to simplify the instantiation of objects with many constructor
parameters or many optional parameters. Note: it should not be
confused with the GOF (Gang of Four) builder pattern.
</p>

<p>
Example: 
</p>

<ul class="org-ul">
<li>File: builder.cpp</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Joshua Bloch's Builder Pattern for simplifying the instantiation</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">of objects with many constructor parameters. It is not the</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">GOF (Gang of Four) builder pattern. </span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Function meta object </span>
<span class="org-keyword">class</span> <span class="org-type">UserData</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-keyword">using</span> <span class="org-type">ulong</span> = <span class="org-type">unsigned</span> <span class="org-type">long</span>;
<span class="org-function-name">private</span>:
        <span class="org-type">ulong</span>          <span class="org-variable-name">_userID</span> = 0;
        <span class="org-constant">std</span>::<span class="org-type">string</span>    <span class="org-variable-name">_name</span>;
        <span class="org-constant">std</span>::<span class="org-type">string</span>    <span class="org-variable-name">_lastName</span>;
        <span class="org-constant">std</span>::<span class="org-type">string</span>    <span class="org-variable-name">_email</span>;
        <span class="org-function-name">UserData</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
<span class="org-function-name">public</span>:
        <span class="org-comment-delimiter">// </span><span class="org-comment">Explicit is better than implicit </span>
        ~<span class="org-function-name">UserData</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;

        <span class="org-keyword">auto</span> <span class="org-function-name">show</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">void</span>
        <span class="org-rainbow-delimiters-depth-2">{</span>
            <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\nUser{"</span>
                      &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"  id        = "</span> &lt;&lt; _userID
                      &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"  name      = "</span> &lt;&lt; _name
                      &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"  last name = "</span> &lt;&lt; _lastName
                      &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"  email     = "</span> &lt;&lt; _email
                      &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"}"</span>
                      &lt;&lt; <span class="org-string">"\n"</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>

        <span class="org-comment-delimiter">// </span><span class="org-comment">Allow builder class access UserData's private data</span>
        <span class="org-keyword">friend</span> <span class="org-keyword">class</span> <span class="org-type">UserBuilder</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>; <span class="org-comment-delimiter">//</span><span class="org-comment">--- EoF class UserData --- //</span>

<span class="org-keyword">class</span> <span class="org-type">UserBuilder</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
        <span class="org-comment-delimiter">//</span><span class="org-comment">class UserData;</span>
        <span class="org-type">UserData</span> <span class="org-variable-name">_data</span><span class="org-rainbow-delimiters-depth-2">{}</span>;
<span class="org-function-name">public</span>:
        <span class="org-function-name">UserBuilder</span><span class="org-rainbow-delimiters-depth-2">(){</span>
                <span class="org-comment-delimiter">// </span><span class="org-comment">_data = UserData();</span>
        <span class="org-rainbow-delimiters-depth-2">}</span>       
        <span class="org-keyword">auto</span> <span class="org-function-name">setID</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">ulong</span> <span class="org-variable-name">userID</span> <span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">UserBuilder</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
           _data._userID = userID;
           <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-keyword">auto</span> <span class="org-function-name">setName</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">UserBuilder</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
            _data._name = name;
            <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-keyword">auto</span> <span class="org-function-name">setLastName</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">UserBuilder</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
            _data._lastName = name;
            <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-keyword">auto</span> <span class="org-function-name">setEmail</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">email</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">UserBuilder</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
           _data._email = email;
           <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-keyword">auto</span> <span class="org-function-name">build</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">UserData</span> <span class="org-rainbow-delimiters-depth-2">{</span>
           <span class="org-keyword">return</span> <span class="org-keyword">this</span>-&gt;_data;
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>; <span class="org-comment-delimiter">//</span><span class="org-comment">--- EoF class UserData::builder --- //</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(){</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">user0</span> =
            UserBuilder<span class="org-rainbow-delimiters-depth-2">()</span>
            .setID<span class="org-rainbow-delimiters-depth-2">(</span>2065<span class="org-rainbow-delimiters-depth-2">)</span>
            .setName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"John"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setLastName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Von Neumman"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setEmail<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"nx098774a@sknmap.co"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .build<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">user1</span> =
            UserBuilder<span class="org-rainbow-delimiters-depth-2">()</span>
            .setID<span class="org-rainbow-delimiters-depth-2">(</span>1065<span class="org-rainbow-delimiters-depth-2">)</span>
            .setName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Enrico"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setLastName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Fermi"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setEmail<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"dummyEmail@service1.co.uk"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .build<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">user2</span> =
            UserBuilder<span class="org-rainbow-delimiters-depth-2">()</span>
            .setID<span class="org-rainbow-delimiters-depth-2">(</span>2001<span class="org-rainbow-delimiters-depth-2">)</span>
            .setName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Stanislaw"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setLastName<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Ulam"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .setEmail<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"wsx752@couk.com.sk"</span><span class="org-rainbow-delimiters-depth-2">)</span>
            .build<span class="org-rainbow-delimiters-depth-2">()</span>;
    user0.show<span class="org-rainbow-delimiters-depth-2">()</span>;
    user1.show<span class="org-rainbow-delimiters-depth-2">()</span>;       
    user2.show<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">return</span> EXIT_SUCCESS;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ g++ builder.cpp -o <span class="org-keyword">builder.bin</span> -g -std=c++1z -Wall -Wextra &amp;&amp; ./builder.bin
User{
  id        = 2065
  name      = John
  last name = Von Neumman
  email     = nx098774a@sknmap.co
}

User{
  id        = 1065
  name      = Enrico
  last name = Fermi
  email     = dummyEmail@service1.co.uk
}

User{
  id        = 2001
  name      = Stanislaw
  last name = Ulam
  email     = wsx752@couk.com.sk
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdc09e2b" class="outline-3">
<h3 id="orgdc09e2b"><span class="section-number-3">1.5</span> Strategy Design Pattern</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org764920d" class="outline-4">
<h4 id="org764920d"><span class="section-number-4">1.5.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
Intent: A behavioral design pattern from GOF which allows the client
code to select and change an algorithm encapsulated as an object at
runtime.
</p>

<p>
Note: this design pattern is similar to a callback and can be
simplified with functional programming. 
</p>

<p>
<b>Parts:</b>
</p>

<ul class="org-ul">
<li><span class="underline">Context</span>:
<ul class="org-ul">
<li>Object that has a reference to an strategy objects and sets the
strategy at runtime.</li>
<li>Resposibilities:
<ul class="org-ul">
<li>Set strategy</li>
<li>Change strategy</li>
<li>Invoke strategy</li>
</ul></li>
</ul></li>

<li><span class="underline">IStrategy</span>: (Algorithm interface)
<ul class="org-ul">
<li>Strategt interface define the algorithm operations.</li>
</ul></li>

<li><span class="underline">Concrete strategy</span>.
<ul class="org-ul">
<li>Strategies objects or implementation of IStrategy class.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgfe5f28b" class="outline-4">
<h4 id="orgfe5f28b"><span class="section-number-4">1.5.2</span> Example</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
Code: 
</p>
<ul class="org-ul">
<li>File: <a href="src/design-patterns/strategy-pattern1.cpp">file:src/design-patterns/strategy-pattern1.cpp</a></li>
<li>Online Compiler: <a href="https://rextester.com/WQO93455">https://rextester.com/WQO93455</a></li>
</ul>

<p>
Strategy interface: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Strategy interface </span>
<span class="org-keyword">struct</span> <span class="org-type">IStrategy</span><span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-keyword">virtual</span> ~<span class="org-function-name">IStrategy</span><span class="org-rainbow-delimiters-depth-2">(){}</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">Essential: Algorithm encapsulated by strategy object </span>
  <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">compute</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">double</span> = 0;  
  <span class="org-comment-delimiter">// </span><span class="org-comment">Optional: Provides strategy metadata </span>
  <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">name</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span> = 0;
  <span class="org-comment-delimiter">// </span><span class="org-comment">Clone this object (Note: This is a virtual constructor)</span>
  <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">clone</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">IStrategy</span>* = 0;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Context Class: 
</p>
<ul class="org-ul">
<li>Selects and switch the strategy (aka algorithm).</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">Context</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>: 
  <span class="org-constant">std</span>::<span class="org-type">unique_ptr</span><span class="org-rainbow-delimiters-depth-2">&lt;</span>IStrategy<span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">_strategy</span>;
<span class="org-function-name">public</span>:
  <span class="org-function-name">Context</span><span class="org-rainbow-delimiters-depth-2">()</span>
    : _strategy<span class="org-rainbow-delimiters-depth-2">{</span><span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">}</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-function-name">Context</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">IStrategy</span>* <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-2">)</span>
    : _strategy<span class="org-rainbow-delimiters-depth-2">{</span>s<span class="org-rainbow-delimiters-depth-2">}</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-function-name">Context</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">IStrategy</span>&amp; <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-2">)</span>
    : _strategy<span class="org-rainbow-delimiters-depth-2">{</span>s.clone<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">}</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">setStrategy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">IStrategy</span>* <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-2">){</span>
    _strategy.reset<span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-rainbow-delimiters-depth-3">)</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">setStrategy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">IStrategy</span>&amp; <span class="org-variable-name">s</span><span class="org-rainbow-delimiters-depth-2">){</span>
    _strategy.reset<span class="org-rainbow-delimiters-depth-3">(</span>s.clone<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>  
  <span class="org-keyword">auto</span> <span class="org-function-name">compute</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span>_strategy == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: strategy not set"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-type">double</span> <span class="org-variable-name">result</span> = _strategy-&gt;compute<span class="org-rainbow-delimiters-depth-3">(</span>x, y<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" strategy = "</span> &lt;&lt; _strategy-&gt;name<span class="org-rainbow-delimiters-depth-3">()</span> &lt;&lt; <span class="org-string">" "</span>
              &lt;&lt; <span class="org-string">"( x = "</span> &lt;&lt; x &lt;&lt; <span class="org-string">" ; "</span>
              &lt;&lt; <span class="org-string">"y = "</span> &lt;&lt; y &lt;&lt; <span class="org-string">" )"</span>
              &lt;&lt; <span class="org-string">"\n"</span> ;
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Result = "</span> &lt;&lt; result &lt;&lt; <span class="org-string">"\n"</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Concrete strategies: 
</p>

<ul class="org-ul">
<li>add =&gt; algorithm which adds two numbers.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">AddStrategy</span>: <span class="org-keyword">public</span> <span class="org-type">IStrategy</span> <span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
  <span class="org-keyword">auto</span> <span class="org-function-name">name</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> <span class="org-string">"add"</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">compute</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">double</span> <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> x + y;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">clone</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">IStrategy</span>* <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">" [TRACE] AddStrategy =&gt; I was cloned"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">AddStrategy</span><span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-keyword">this</span><span class="org-rainbow-delimiters-depth-3">)</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Multiplication</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">struct</span> <span class="org-type">MulStrategy</span>: <span class="org-keyword">public</span> <span class="org-type">IStrategy</span> <span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
  <span class="org-keyword">auto</span> <span class="org-function-name">name</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> <span class="org-string">"mul"</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>  
  <span class="org-type">double</span> <span class="org-function-name">compute</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> x + y;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">clone</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">IStrategy</span>* <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">" [TRACE] MulStrategy =&gt; I was cloned"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">MulStrategy</span><span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-keyword">this</span><span class="org-rainbow-delimiters-depth-3">)</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>  
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Linear Combination:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">struct</span> <span class="org-type">LinearCombStrategy</span>: <span class="org-keyword">public</span> <span class="org-type">IStrategy</span> <span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-type">double</span> <span class="org-variable-name">a</span>, <span class="org-variable-name">b</span>, <span class="org-variable-name">c</span>;
  <span class="org-function-name">LinearCombStrategy</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">a</span>, <span class="org-type">double</span> <span class="org-variable-name">b</span>, <span class="org-type">double</span> <span class="org-variable-name">c</span><span class="org-rainbow-delimiters-depth-2">)</span>
    : a<span class="org-rainbow-delimiters-depth-2">(</span>a<span class="org-rainbow-delimiters-depth-2">)</span>, b<span class="org-rainbow-delimiters-depth-2">(</span>b<span class="org-rainbow-delimiters-depth-2">)</span>, c<span class="org-rainbow-delimiters-depth-2">(</span>c<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">{</span>
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">name</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> <span class="org-string">"Linear combination a * x + b * y + c"</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>    
  <span class="org-keyword">auto</span> <span class="org-function-name">compute</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">double</span><span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-keyword">return</span> a * x + b * y + c;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">auto</span> <span class="org-function-name">clone</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-type">IStrategy</span>* <span class="org-rainbow-delimiters-depth-2">{</span>
    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">" [TRACE] LinearCombStrategy =&gt; I was cloned"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">LinearCombStrategy</span><span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-keyword">this</span><span class="org-rainbow-delimiters-depth-3">)</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>  
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">Context</span> <span class="org-variable-name">ctx</span>;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"==== Strategy = add ===="</span> &lt;&lt; <span class="org-string">"\n"</span>;
ctx.setStrategy<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">AddStrategy</span><span class="org-rainbow-delimiters-depth-1">)</span>;
ctx.compute<span class="org-rainbow-delimiters-depth-1">(</span>3.0, 4.0<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"==== Strategy = mul ===="</span> &lt;&lt; <span class="org-string">"\n"</span>;
ctx.setStrategy<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">MulStrategy</span><span class="org-rainbow-delimiters-depth-1">)</span>;
ctx.compute<span class="org-rainbow-delimiters-depth-1">(</span>3.0, 4.0<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"==== Strategy = Linear combination ===="</span> &lt;&lt; <span class="org-string">"\n"</span>;
ctx.setStrategy<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">LinearCombStrategy</span><span class="org-rainbow-delimiters-depth-2">(</span>5, 3, 4<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
ctx.compute<span class="org-rainbow-delimiters-depth-1">(</span>3.0, 4.0<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"==== Strategy = Linear combination [2] ===="</span> &lt;&lt; <span class="org-string">"\n"</span>;
<span class="org-keyword">auto</span> <span class="org-variable-name">comb1</span> = LinearCombStrategy<span class="org-rainbow-delimiters-depth-1">(</span>6.0, 5.0, 10.0<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Copy stack-allocated object comb1 using the virtual constructor</span>
ctx.setStrategy<span class="org-rainbow-delimiters-depth-1">(</span>comb1<span class="org-rainbow-delimiters-depth-1">)</span>;
ctx.compute<span class="org-rainbow-delimiters-depth-1">(</span>5.0, 3.0<span class="org-rainbow-delimiters-depth-1">)</span>;  

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"==== Strategy = Linear combination [2] ===="</span> &lt;&lt; <span class="org-string">"\n"</span>;  
<span class="org-comment-delimiter">// </span><span class="org-comment">Copy stack-allocated temporary object comb1 using the virtual constructor</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">clone</span>
ctx.setStrategy<span class="org-rainbow-delimiters-depth-1">(</span>LinearCombStrategy<span class="org-rainbow-delimiters-depth-2">{</span>6.0, 5.0, 10.0<span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>;
ctx.compute<span class="org-rainbow-delimiters-depth-1">(</span>2.0, 6.0<span class="org-rainbow-delimiters-depth-1">)</span>;  
</pre>
</div>

<p>
Output: 
</p>

<div class="org-src-container">
<pre class="src src-txt">$ clang++ strategy-pattern1.cpp -o strategy-pattern1.bin -g -std=c++1z -Wall -Wextra 
$ ./strategy-pattern1.bin
==== Strategy = add ====
 strategy = add ( x = 3 ; y = 4 )
Result = 7
==== Strategy = mul ====
 strategy = mul ( x = 3 ; y = 4 )
Result = 7
==== Strategy = Linear combination ====
 strategy = Linear combination a * x + b * y + c ( x = 3 ; y = 4 )
Result = 31
==== Strategy = Linear combination [2] ====
 [TRACE] LinearCombStrategy =&gt; I was cloned
 strategy = Linear combination a * x + b * y + c ( x = 5 ; y = 3 )
Result = 55
==== Strategy = Linear combination [2] ====
 [TRACE] LinearCombStrategy =&gt; I was cloned
 strategy = Linear combination a * x + b * y + c ( x = 2 ; y = 6 )
Result = 52

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga1c638a" class="outline-3">
<h3 id="orga1c638a"><span class="section-number-3">1.6</span> Method Chaining - Fluent API</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">CharacterSuperMutant</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-type">double</span> <span class="org-variable-name">m_x</span>;
    <span class="org-type">double</span> <span class="org-variable-name">m_y</span>;
    <span class="org-type">double</span> <span class="org-variable-name">m_z</span>;
<span class="org-function-name">public</span>:
    <span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-function-name">setX</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">){</span>
        m_x = x;
        <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-function-name">setPosition</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span>, <span class="org-type">double</span> <span class="org-variable-name">z</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-function-name">setColor</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">COLOR</span> <span class="org-variable-name">color</span><span class="org-rainbow-delimiters-depth-2">){</span>
        ... ....
        <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">C++ 11 </span>
    <span class="org-keyword">auto</span> <span class="org-function-name">setForce</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">force</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-rainbow-delimiters-depth-2">{</span>
        ... ... 
        <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>   

    <span class="org-comment-delimiter">// </span><span class="org-comment">Method / member function declaration, the implemention is in a different file.</span>
    <span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-constant">CharacterSuperMutant</span>::<span class="org-function-name">setPosition</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span>, <span class="org-type">double</span> <span class="org-variable-name">z</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">C++11 </span>
    <span class="org-keyword">auto</span> <span class="org-constant">CharacterSuperMutant</span>::<span class="org-function-name">setStamina</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span>, <span class="org-type">double</span> <span class="org-variable-name">z</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">CharacterSuperMutant</span>&amp;;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Example: Method implemented separated from class declaration in .cpp file.</span>
<span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-constant">CharacterSuperMutant</span>::<span class="org-function-name">setPosition</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span>, <span class="org-type">double</span> <span class="org-variable-name">z</span><span class="org-rainbow-delimiters-depth-1">){</span>
    m_x = x; m_y = y; m_z  = z;
    <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">C++11 auto syntax </span>
<span class="org-keyword">auto</span> <span class="org-constant">CharacterSuperMutant</span>::<span class="org-function-name">setStamina</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span>, <span class="org-type">double</span> <span class="org-variable-name">y</span>, <span class="org-type">double</span> <span class="org-variable-name">z</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">CharacterSuperMutant</span>&amp; <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">... ... ... </span>
    <span class="org-keyword">return</span> *<span class="org-keyword">this</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<p>
Usage: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">CharacterSuperMutant</span> <span class="org-variable-name">mutant1</span>;
mutant1.setForce<span class="org-rainbow-delimiters-depth-1">(</span>1000<span class="org-rainbow-delimiters-depth-1">)</span>.setColor<span class="org-rainbow-delimiters-depth-1">(</span>BLUE<span class="org-rainbow-delimiters-depth-1">)</span>.setPosition<span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>.show<span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Instead of:</span>
mutant1.setForce<span class="org-rainbow-delimiters-depth-1">(</span>1000<span class="org-rainbow-delimiters-depth-1">)</span>
mutant1.setColor<span class="org-rainbow-delimiters-depth-1">(</span>BLUE<span class="org-rainbow-delimiters-depth-1">)</span>
mutant1.setPosition<span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3341ef7" class="outline-3">
<h3 id="org3341ef7"><span class="section-number-3">1.7</span> GOF - Template Pattern</h3>
<div class="outline-text-3" id="text-1-7">
<p>
It is stated by GOF as: "Defines the skeleton of an algorithm in a
method, deferring some steps to subclasses. Template Method lets
subclasses redefine certain steps of an algorithm without changing the
algorithms structure."
</p>

<ul class="org-ul">
<li>Intent: Create an algorithm template that allows redefine some
steps without changing its structure.</li>
</ul>

<p>
The parent abstract class has four different types of methods:
</p>
<ul class="org-ul">
<li><span class="underline">Concrete methods</span>: Methods implemented in the abstract class.</li>

<li><span class="underline">Abstract methods</span>: Methods without implementation that must be
implemented by subclasses.</li>

<li><span class="underline">Hook methods</span>: Methods with default implementation that can be
overriden by subclasses.</li>

<li><span class="underline">Template methods</span>: Method that calls concrete methods, abstract
methods or hook methods.</li>
</ul>

<p>
Participants: 
</p>
<ul class="org-ul">
<li><span class="underline">Base Class</span>: Defines an algorithm which calls primitive methods (aka
hook methods) that will be defined by the derived classes.</li>
<li><span class="underline">Derived Class</span>: Implements primitive methods (virtual methods or
methods that can be overriden) defined in the <span class="underline">base class</span>.</li>
</ul>

<p>
Features: 
</p>
<ul class="org-ul">
<li>The base class defines an algorithm stub, however some steps are
required to be implemented by the derived class.</li>
<li>This pattern provides an <span class="underline">inverse control structure</span>, the algorithm
defined in the base class which calls the primitive methods which
are algorithm steps declared in the base class.</li>
<li>This pattern can be the base of an framework.</li>
</ul>

<p>
Example: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
 <span class="org-comment-delimiter">// </span><span class="org-comment">Algorithm or entry point which calls the derived class method.</span>
 <span class="org-comment-delimiter">// </span><span class="org-comment">This is the template method </span>
 <span class="org-type">double</span> <span class="org-function-name">summation</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">lower</span>, <span class="org-type">int</span> <span class="org-variable-name">upper</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span><span class="org-rainbow-delimiters-depth-2">{</span>
         <span class="org-type">double</span> <span class="org-variable-name">sum</span> = 0;
         <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = lower; i &lt;= upper; i++<span class="org-rainbow-delimiters-depth-3">)</span>
                 sum += <span class="org-keyword">this</span>-&gt;stepFn<span class="org-rainbow-delimiters-depth-3">(</span>i<span class="org-rainbow-delimiters-depth-3">)</span>;
         <span class="org-keyword">return</span> sum; 
 <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">protected</span>:
    <span class="org-comment-delimiter">// </span><span class="org-comment">Hook method or to be defined by the derived class</span>
    <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> = 0 ;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfSquares</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfCubes</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">void</span> <span class="org-function-name">clientCode</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">IntervalSummation</span>&amp; <span class="org-variable-name">obj</span><span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Summation at [0, 15] = "</span> &lt;&lt; obj.summation<span class="org-rainbow-delimiters-depth-2">(</span>0, 15<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<p>
Running in CERN's ROOT REPL:
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt; sq.summation(0, 10)
(double) 385.00000

&gt;&gt; sc.summation(0, 10)
(double) 3025.0000

&gt;&gt; clientCode(sq)
Summation at [0, 15] = 1240

&gt;&gt; clientCode(sc)
Summation at [0, 15] = 14400
&gt;&gt; 
</pre>
</div>

<p>
References: 
</p>

<ul class="org-ul">
<li>Template Method, Factory Method, and Composite. -
<a href="http://condor.depaul.edu/cjones1/depaul/se455/notes/lecture07.pdf">http://condor.depaul.edu/cjones1/depaul/se455/notes/lecture07.pdf</a></li>
<li>Template Method - <a href="http://cs.unb.ca/~wdu/cs4015/ch5k.pdf">http://cs.unb.ca/~wdu/cs4015/ch5k.pdf</a></li>
<li>Encapsulating Algorithms with the Template Method Design Pattern -
<a href="https://redlich.net/pdf/publications/jupitermedia/template.pdf">https://redlich.net/pdf/publications/jupitermedia/template.pdf</a></li>
<li>Template Method Design Pattern in Java -
<a href="https://www.journaldev.com/1763/template-method-design-pattern-in-java">https://www.journaldev.com/1763/template-method-design-pattern-in-java</a></li>
</ul>
</div>
</div>

<div id="outline-container-orge706722" class="outline-3">
<h3 id="orge706722"><span class="section-number-3">1.8</span> Null-Object Pattern</h3>
<div class="outline-text-3" id="text-1-8">
<p>
An object, called nulll object, which doesn't do anything and has
empty methods implementing a required interface by the client code is
used to convey the absense of an ordinary object instead of null or
null pointer.
</p>

<p>
Example: in a database system, instead of returning null, null
reference or null pointer for an not found employee object, an empty
object, called null object, with an empty mehtods is returned. It has
the advantage of avoiding null exception that can crash unexpectdely a
program. Another problem of null or null pointers is that null bugs
cannot be caught at compile-time and are also known to be hard to
debug and trace.
</p>

<p>
Alternatives: 
</p>
<ul class="org-ul">
<li>Throw an exception when there is the absense of an object. For
instance, std::runtime_error("Error: record not found.").</li>
<li>Use optional type (Haskell's maybe) or C++17 Optional.</li>
<li>Return a pointer that is set to null for denoting the absence of an
object. This pattern is widely used by many C and C++
codes. However it is prone for the infamous null pointer exception
problems.</li>
</ul>

<blockquote>
<p>
A Null Object provides a surrogate for another object that shares
the same interface but does nothing. Thus, the Null Object
encapsulates the implementation decisions of how to do nothing and
hides those details from its collaborators.
  &#x2013; Bobby Woolf in [PLoP3]
</p>
</blockquote>

<p>
Code Example:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Interface </span>
<span class="org-keyword">class</span> <span class="org-type">ICompany</span><span class="org-rainbow-delimiters-depth-1">{</span>
        <span class="org-keyword">virtual</span> <span class="org-type">unsigned</span>    <span class="org-function-name">getID</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>       = 0;    
        <span class="org-keyword">virtual</span> <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>     = 0;
        <span class="org-keyword">virtual</span> <span class="org-type">void</span>        <span class="org-function-name">showCompany</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> = 0;
        <span class="org-keyword">virtual</span> ~<span class="org-function-name">ICompany</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">Company</span>: <span class="org-keyword">public</span> <span class="org-type">ICompany</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-function-name">Company</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">unsigned</span> <span class="org-variable-name">id</span>, <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-2">)</span>:
                _name<span class="org-rainbow-delimiters-depth-2">(</span>name<span class="org-rainbow-delimiters-depth-2">)</span>,
                _id<span class="org-rainbow-delimiters-depth-2">(</span>id<span class="org-rainbow-delimiters-depth-2">){</span>
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">unsigned</span> <span class="org-function-name">getID</span><span class="org-rainbow-delimiters-depth-2">()</span>      <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> _id; <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> _name; <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">void</span> <span class="org-function-name">showCompany</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Company is = "</span> &lt;&lt; _name &lt;&lt; <span class="org-string">"\n"</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        ~<span class="org-function-name">Company</span><span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;
<span class="org-function-name">private</span>:
        <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">_name</span>;
        <span class="org-type">unsigned</span>    <span class="org-variable-name">_id</span>;    
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Null object </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Returns this null object instead of returning a null pointer</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">when a givne company is not found in the database system.</span>
<span class="org-keyword">class</span> <span class="org-type">NullCompany</span>: <span class="org-keyword">public</span> <span class="org-type">ICompany</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-type">unsigned</span> <span class="org-function-name">getID</span><span class="org-rainbow-delimiters-depth-2">()</span>      <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> 0; <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> <span class="org-string">""</span>; <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-type">void</span> <span class="org-function-name">showCompany</span><span class="org-rainbow-delimiters-depth-2">()</span>    <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{}</span>      
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcc2775" class="outline-3">
<h3 id="orgbcc2775"><span class="section-number-3">1.9</span> PIMPL - Pointer to Implementation (C++ Only)</h3>
<div class="outline-text-3" id="text-1-9">
<p>
The PIMPL - Pointer to Implementation idiom, also known as compiler
firewall, is a widely used technique  in C++ for completly hiding class
private members in the public header file. This technique uses an
opaque pointer to an internal non declared class in the current header
file encapsulating all fields of the outer class.
</p>

<p>
Also known as: 
</p>
<ul class="org-ul">
<li>PIMPL - Pointer to Implementation</li>
<li>Compiler firewall idiom</li>
<li>Cheshire Cat</li>
</ul>

<p>
Motivation and Benefits: 
</p>

<ul class="org-ul">
<li>Reduce compilation time as the number of #include headers in the
class header is not changed.</li>

<li>Makes the class data member in the public header really private.</li>

<li>Changing of private members of the class which are encapsulated in
the opaque pointer class does not require recompilation of client
code. This feature is very important for library development as it
avoid client code recompilation as the public headers are not
changed.</li>

<li>Less likely to breaking binary compatibility - ABI Application
Binary Interface.</li>

<li>Note: Changing class member variables or member functions (methods)
breaks the ABI and requires the recompilation of client code. The
pimpl maintains the binary compatibility by not changing class'
private members.</li>

<li>TL;DR
<ul class="org-ul">
<li>PIMPL: Allow changes to implementation without the
need to recompile client code.</li>
</ul></li>
</ul>

<p>
Drawbacks: 
</p>

<ul class="org-ul">
<li>More complexity and work for API implementators.</li>
<li>Not convenient when there are protected members which needs to be
accessed by subclasses.</li>
<li>Runtime performance overhead due to the pointer indirection.</li>
</ul>

<p>
Example: All private members of class CashFlow are conained in the
opaque type Impl which is not defined in the header file.
</p>

<ul class="org-ul">
<li>file: <span class="underline">CashFlow.h</span>  -&gt; Class public interface.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _CashFlow_H_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_CashFlow_H_</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">C++ 11's smart pointers</span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">memory</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">class</span> <span class="org-type">CashFlow</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-comment-delimiter">// </span><span class="org-comment">Forward declaration of incomplete type.</span>
    <span class="org-keyword">struct</span> <span class="org-type">Impl</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">This opaque type encapsulate the outer class' private member </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Pointer to implementation (PIMPL)</span>
    <span class="org-constant">std</span>::<span class="org-type">unique_ptr</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Impl</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">m_pimpl</span>;
<span class="org-function-name">public</span>:
    <span class="org-comment-delimiter">// </span><span class="org-comment">Default ctor </span>
    <span class="org-function-name">CashFlow</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-type">void</span> <span class="org-function-name">show</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-type">void</span> <span class="org-function-name">add</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">int</span>  <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Net Present Value - NPV of cash flow for a given rate of return </span>
    <span class="org-type">double</span> <span class="org-function-name">npv</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">rate</span><span class="org-rainbow-delimiters-depth-2">)</span>; 
    <span class="org-comment-delimiter">// </span><span class="org-comment">Compute IRR - Internal rate of return </span>
    <span class="org-type">double</span> <span class="org-function-name">irr</span><span class="org-rainbow-delimiters-depth-2">()</span>; 
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-preprocessor">#endif</span> <span class="org-comment-delimiter">// </span><span class="org-comment">--- EOF ---- // </span>
</pre>
</div>

<ul class="org-ul">
<li>file: <span class="underline">CashFlow.cpp</span>  -&gt; Class implementation.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">C++ 11's smart pointers</span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">memory</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string">"CashFlow.h"</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Struct is just class with all members</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">public by default </span>
<span class="org-keyword">struct</span> <span class="org-constant">CashFlow</span>::<span class="org-type">Impl</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">cash flow vector </span>
    <span class="org-constant">std</span>::<span class="org-type">vector</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">m_clf</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Default ctor </span>
    <span class="org-function-name">Impl</span><span class="org-rainbow-delimiters-depth-2">(){}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Default dtor </span>
    ~Impl<span class="org-rainbow-delimiters-depth-2">()</span> = <span class="org-keyword">default</span>;  
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Default ctor </span>
<span class="org-function-name">CashFlow</span>::~CashFlow = <span class="org-keyword">default</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Ctor </span>
<span class="org-function-name">CashFlow</span>::CashFlow<span class="org-rainbow-delimiters-depth-1">()</span>: m_pimpl<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">new</span> <span class="org-type">Impl</span><span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{}</span>

<span class="org-type">void</span> <span class="org-constant">CashFlow</span>::<span class="org-function-name">add</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">){</span>
    m_pimpl-&gt;m_clf.push_back<span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">double</span> <span class="org-constant">CashFlow</span>::<span class="org-function-name">get</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span><span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-keyword">return</span> m_pimpl-&gt;m_clf<span class="org-rainbow-delimiters-depth-2">[</span>i<span class="org-rainbow-delimiters-depth-2">]</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
   ... ... ... .... 
</pre>
</div>

<p>
References and further: 
</p>

<ul class="org-ul">
<li><b>Pimpl Idiom</b> - &lt;&gt;</li>

<li><b>Best Friends: C++11 Move Semantics and Pimpl</b> -
<a href="https://www.embeddeduse.com/2016/05/30/best-friends-cpp11-move-semantics-and-pimpl/">https://www.embeddeduse.com/2016/05/30/best-friends-cpp11-move-semantics-and-pimpl/</a></li>

<li><b>Improving C++ Encapsulation with the Pimpl Idiom</b> -
<a href="https://visualstudiomagazine.com/articles/2012/11/29/the-pimpl-idiom-in-c-plus-plus.aspx">https://visualstudiomagazine.com/articles/2012/11/29/the-pimpl-idiom-in-c-plus-plus.aspx</a></li>

<li><b>Why every C++ developer should know about the pimpl idiom pattern</b> -
<a href="https://tonka2013.wordpress.com/2013/08/31/why-every-c-developer-should-know-about-the-pimpl-idiom-pattern/">https://tonka2013.wordpress.com/2013/08/31/why-every-c-developer-should-know-about-the-pimpl-idiom-pattern/</a></li>

<li><b>Passing Containing Parent to pimpl idiom implementation class</b> -
<a href="http://www.sharprobotica.com/2010/04/passing-containing-parent-to-pimpl-idiom-implementation-class/">http://www.sharprobotica.com/2010/04/passing-containing-parent-to-pimpl-idiom-implementation-class/</a></li>

<li><b>Dive in to C++ and survive</b> -
<a href="https://www.embedded.com/print/4008235">https://www.embedded.com/print/4008235</a></li>

<li><b>Modern and Lucid C++ Advanced for Professional Programmers</b> -
<a href="https://wiki.ifs.hsr.ch/CppAdvanced/files/lecture_12_advanced_library_design.pdf">https://wiki.ifs.hsr.ch/CppAdvanced/files/lecture_12_advanced_library_design.pdf</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd812ea2" class="outline-3">
<h3 id="orgd812ea2"><span class="section-number-3">1.10</span> Type Erasure (C++ Only)</h3>
<div class="outline-text-3" id="text-1-10">
</div>
<div id="outline-container-org9fe0e61" class="outline-4">
<h4 id="org9fe0e61"><span class="section-number-4">1.10.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-10-1">
<p>
Type erasure is a set of techniques for providing an uniform interface
for many different types by hiding the type information from the
client code. In C++ type erasure can be implemented with a combination
of object oriented programming and generic programming, in other
words, inheritance and templates. The fundamental building blocks of
this pattern are a base class, called <span class="underline">concept</span>, which provides the
uniform interface to the wrapped types and a derived templatized
class, called <span class="underline">model</span>, inherting the concept class which adapts the
wrapped type to the concept class. The inheritance allows any template
instantation of the model to be treated as it was the base class, thus
this approach hides the type information which can be later recovered
by downcasting the base class to the derived class.
</p>

<ul class="org-ul">
<li>Definition by Dave Abrahams and Aleksey Curtovoy in, <b>C++ Template</b>
<b>Metaprogramming.</b></li>
</ul>

<blockquote>
<p>
In its fullest expression, type erasure is the process of turning a
wide variety of types with a common interface into one type with that
same interface
</p>
</blockquote>

<p>
Parts: 
</p>

<ul class="org-ul">
<li><b>Concept class</b>
<ul class="org-ul">
<li>base class - definines the interface being enforced.</li>
</ul></li>
<li><b>Model class</b>
<ul class="org-ul">
<li>templatized class inherting the concept class adpating the
wrapped type to the concept class and holding an instance of the
wrapped type.</li>
</ul></li>
<li><b>Type Erasure class</b> (outter class)
<ul class="org-ul">
<li>Both the concept and model classes are private inner classes of
the type erasure class.</li>
<li>The type erasure class takes an instance of the model class in the
constructor.</li>
<li>This class stores a pointer variable to the concept class, but
storing a pointer to the model class (dynamic polymorphism).</li>
</ul></li>
<li><b>Wrapped Type</b> or Objects 
<ul class="org-ul">
<li>Types wrapped by the model class wich will be erased.</li>
</ul></li>
</ul>

<p>
Use-cases: 
</p>

<ul class="org-ul">
<li>Create a common interface for many different types.</li>
<li>Store wrapped types without a common base class in STL containers.</li>
<li>Store templatized classes in STL containers.</li>
<li>Implement dynamic or runtime polymorphism with value semantics.</li>
<li>Take advantage of the commonality of many unrelated classes without
a common base class without modifying their source code.</li>
</ul>

<p>
Known uses in C++ standard library: 
</p>

<ul class="org-ul">
<li>std::function (C++11, formber Boost.Function)</li>

<li>std::any (C++17, former Boost.Any)
<ul class="org-ul">
<li>A container which can store anything and the type of the stored
object is not known at runtime.</li>
</ul></li>

<li>std::variant (C++17, former Boost.Variant)
<ul class="org-ul">
<li>Provides an interface for sum types or disjoint union or <span class="underline">visitor</span> OO
design pattern which is useful for manipulating abstract syntax
tree, creating interpreters, tree data structures and fixed class
hierarchies.</li>
</ul></li>

<li>void* - Void pointer in many C-APIs.</li>
</ul>


<p>
References and further reading:
</p>
<ul class="org-ul">
<li>Nevin Liber, <b>Type Erasure</b>  <a href="http://files.meetup.com/1455470/Type%20Erasure.pdf">http://files.meetup.com/1455470/Type Erasure.pdf</a></li>
<li><a href="https://stackoverflow.com/questions/46041683/type-erasure-retrieving-value-type-check-at-compile-time">c++ - Type erasure: Retrieving value - type check at compile time - Stack Overflow</a></li>
<li><a href="http://talesofcpp.fusionfenix.com/post-16/episode-nine-erasing-the-concrete">Episode Nine: Erasing the Concrete</a></li>
<li><a href="https://codereview.stackexchange.com/questions/41879/concept-based-polymorphism">c++ - Concept based polymorphism - Code Review Stack Exchange</a></li>
<li><a href="https://github.com/andyprowl/virtual-concepts/blob/master/draft/Dynamic%20Generic%20Programming%20with%20Virtual%20Concepts.pdf">Dynamic Programming with Virtual Concepts</a></li>
<li><a href="https://www.reddit.com/r/cpp/comments/5epngi/type_erased_concepts/">Type erased concepts : cpp</a></li>
<li><a href="http://www.cplusplus.com/articles/oz18T05o/">C++ type erasure - C++ Articles</a></li>
<li><a href="https://blog.tartanllama.xyz/type-erasure-unified-call/">Type erasure with unified call syntax</a></li>
<li><a href="http://www.sgh1.net/posts/cpp-type-erasure.md">My Internet Weblog - Type Erasure in C++</a></li>
<li><a href="https://accu.org/index.php/journals/2424">ACCU - Polymorphism in C++ – A Type Compatibility View</a></li>
</ul>
</div>
</div>

<div id="outline-container-org20ae051" class="outline-4">
<h4 id="org20ae051"><span class="section-number-4">1.10.2</span> Example 1 - Simple type erasure.</h4>
<div class="outline-text-4" id="text-1-10-2">
<p>
<span class="underline">Problem:</span> Handle the classes A, B and C which don't have a common base
class using dynamic (aka runtime) polymorphism taking advantage of
their commonality, the method .getName(). Note: the source code of A,
B and C aren't allowed to be modified
</p>

<ul class="org-ul">
<li>Complete source code:
<ul class="org-ul">
<li>File: <a href="src/design-patterns/type-erasure1.cpp">file:src/design-patterns/type-erasure1.cpp</a></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">A</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">return</span> <span class="org-string">"class A"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">void</span> <span class="org-function-name">sayA</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"I am the class A"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">B</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>  <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">return</span> <span class="org-string">"class B"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">void</span> <span class="org-function-name">sayB</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"I am the class B"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>   
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">C</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>  <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">return</span> <span class="org-string">"class C"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-type">void</span> <span class="org-function-name">sayC</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"I am the class C"</span> &lt;&lt; <span class="org-string">"\n"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Solution: Type erasure design pattern. 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">TypeErasure</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
    <span class="org-comment-delimiter">//  </span><span class="org-comment">--- Forward declarations ----</span>
    <span class="org-keyword">class</span> <span class="org-type">Concept</span>;
    <span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">class</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-keyword">class</span> <span class="org-type">Model</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">--- Member Variables ----- // </span>
    <span class="org-constant">std</span>::<span class="org-type">shared_ptr</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Concept</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> <span class="org-variable-name">_concept_ptr</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Optional: </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">RTTI (runtime type information) for recovering wrapped type</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">by downcasting </span>
    <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">type_info</span>&amp; <span class="org-variable-name">_tinfo</span>;
<span class="org-function-name">public</span>:
    <span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> 
    <span class="org-function-name">TypeErasure</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">T</span>&amp; <span class="org-variable-name">obj</span><span class="org-rainbow-delimiters-depth-2">)</span>
    : _concept_ptr<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::make_shared<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">Model</span><span class="org-rainbow-delimiters-depth-4">&lt;</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-4">&gt;</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
    ,_tinfo<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">typeid</span><span class="org-rainbow-delimiters-depth-3">(</span>T<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> 
    <span class="org-rainbow-delimiters-depth-2">{</span>       
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-keyword">auto</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-2">{</span>
            <span class="org-keyword">return</span> _concept_ptr-&gt;getName<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Recover reference to wrapped type </span>
    <span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>
    <span class="org-keyword">auto</span> <span class="org-function-name">recover</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">T</span> <span class="org-rainbow-delimiters-depth-2">{</span>       
        <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">typeid</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-4">)</span> != _tinfo<span class="org-rainbow-delimiters-depth-3">)</span>
                <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: cannot cast to this type"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-comment-delimiter">// </span><span class="org-comment">Note: static_cast downcasting to wrong type has undefined behavior,</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">use with care!</span>
        <span class="org-keyword">return</span> <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">Model</span><span class="org-rainbow-delimiters-depth-4">&lt;</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-4">&gt;</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>_concept_ptr.get<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>-&gt;_obj;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>
    <span class="org-keyword">auto</span> <span class="org-function-name">hasType</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">bool</span> <span class="org-rainbow-delimiters-depth-2">{</span>
            <span class="org-keyword">return</span> _tinfo == <span class="org-keyword">typeid</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">private</span>:
   <span class="org-comment-delimiter">// </span><span class="org-comment">Concept class defines the interface to be enforced</span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">In general, it is an interface class, a class with only pure virtual</span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">methods (abstract methods), in other words methods without implementation.</span>
   <span class="org-keyword">class</span> <span class="org-type">Concept</span><span class="org-rainbow-delimiters-depth-2">{</span>
   <span class="org-keyword">public</span>:
           <span class="org-keyword">virtual</span> <span class="org-keyword">auto</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> = 0;
           <span class="org-keyword">virtual</span> ~<span class="org-function-name">Concept</span><span class="org-rainbow-delimiters-depth-3">()</span> = <span class="org-keyword">default</span>;
   <span class="org-rainbow-delimiters-depth-2">}</span>;

   <span class="org-comment-delimiter">// </span><span class="org-comment">Adapt the wrapped type (T) to the concept</span>
   <span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>
   <span class="org-keyword">class</span> <span class="org-type">Model</span>: <span class="org-keyword">public</span> <span class="org-type">Concept</span> <span class="org-rainbow-delimiters-depth-2">{</span>
   <span class="org-keyword">public</span>:
           <span class="org-comment-delimiter">// </span><span class="org-comment">Instance of the wrapped type </span>
           <span class="org-type">T</span> <span class="org-variable-name">_obj</span>;
           <span class="org-comment-delimiter">// </span><span class="org-comment">Initialize _opj by copying the parameter </span>
           <span class="org-function-name">Model</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">const</span> <span class="org-type">T</span>&amp; <span class="org-variable-name">obj</span><span class="org-rainbow-delimiters-depth-3">)</span>: <span class="org-function-name">_obj</span><span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">){}</span>
           <span class="org-keyword">auto</span> <span class="org-function-name">getName</span><span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-keyword">const</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-3">{</span>
                   <span class="org-keyword">return</span> _obj.getName<span class="org-rainbow-delimiters-depth-4">()</span>;
           <span class="org-rainbow-delimiters-depth-3">}</span>
   <span class="org-rainbow-delimiters-depth-2">}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

</pre>
</div>

<p>
Testing in Cling REPL: 
</p>

<div class="org-src-container">
<pre class="src src-cpp">&gt;&gt; .L type-erasure1.cpp 
&gt;&gt; 
&gt;&gt; A<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-1">)</span> @0x1fc2970
&gt;&gt; A<span class="org-rainbow-delimiters-depth-1">()</span>.getName<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"class A"</span>
&gt;&gt; B<span class="org-rainbow-delimiters-depth-1">()</span>.getName<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"class B"</span>
&gt;&gt; 
&gt;&gt; B<span class="org-rainbow-delimiters-depth-1">()</span>.sayB<span class="org-rainbow-delimiters-depth-1">()</span>
I am the <span class="org-keyword">class</span> <span class="org-type">B</span>
&gt;&gt; 

<span class="org-keyword">auto</span> tlist = <span class="org-constant">std</span>::deque<span class="org-rainbow-delimiters-depth-1">&lt;</span>TypeErasure<span class="org-rainbow-delimiters-depth-1">&gt;()</span>;
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>

&gt;&gt; <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-keyword">auto</span>&amp; <span class="org-variable-name">t</span>: tlist<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Class type = "</span> &lt;&lt; t.getName<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">"\n"</span>; <span class="org-rainbow-delimiters-depth-1">}</span>
<span class="org-type">Class</span> <span class="org-variable-name">type</span> = <span class="org-keyword">class</span> A
Class type = <span class="org-keyword">class</span> B
Class type = <span class="org-keyword">class</span> C
&gt;&gt; 

&gt;&gt; tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>0<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span>A<span class="org-rainbow-delimiters-depth-1">&gt;()</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-1">)</span> @0x20cc590
&gt;&gt; tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>0<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span>A<span class="org-rainbow-delimiters-depth-1">&gt;()</span>.sayA<span class="org-rainbow-delimiters-depth-1">()</span>
I am the <span class="org-keyword">class</span> <span class="org-type">A</span>
&gt;&gt; tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>0<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">A</span><span class="org-rainbow-delimiters-depth-1">&gt;()</span>.getName<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"class A"</span>
&gt;&gt; 

&gt;&gt; tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>1<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">B</span><span class="org-rainbow-delimiters-depth-1">&gt;()</span>.getName<span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-string">"class B"</span>
&gt;&gt; 

&gt;&gt; tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>1<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span>C<span class="org-rainbow-delimiters-depth-1">&gt;()</span>
<span class="org-type">Error</span> <span class="org-type">in</span> <span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-constant">TRint</span>::HandleTermInput<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>: <span class="org-constant">std</span>::runtime_error caught: Error: cannot cast to <span class="org-keyword">this</span> type
&gt;&gt; 
</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-variable-name">tlist</span> = <span class="org-constant">std</span>::deque<span class="org-rainbow-delimiters-depth-1">&lt;</span>TypeErasure<span class="org-rainbow-delimiters-depth-1">&gt;()</span>;
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;
tlist.emplace_back<span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"EXPERIMENT 1 ============"</span> &lt;&lt; <span class="org-string">"\n"</span>;   
<span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-keyword">auto</span>&amp; <span class="org-variable-name">t</span>: tlist<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Class type = "</span> &lt;&lt; t.getName<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">"\n"</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-comment-delimiter">// </span><span class="org-comment">Note: It is a copy!</span>
 <span class="org-type">A</span> <span class="org-variable-name">objA</span> = tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>0<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">A</span><span class="org-rainbow-delimiters-depth-1">&gt;()</span>;
 objA.sayA<span class="org-rainbow-delimiters-depth-1">()</span>;

 <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n"</span> &lt;&lt; <span class="org-string">"EXPERIMENT 2 ============"</span> &lt;&lt; <span class="org-string">"\n"</span>;

 <span class="org-comment-delimiter">// </span><span class="org-comment">Simulate downcasting failure </span>
 <span class="org-keyword">try</span> <span class="org-rainbow-delimiters-depth-1">{</span>
         <span class="org-type">B</span> <span class="org-variable-name">objB</span> = tlist.at<span class="org-rainbow-delimiters-depth-2">(</span>0<span class="org-rainbow-delimiters-depth-2">)</span>.recover<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">B</span><span class="org-rainbow-delimiters-depth-2">&gt;()</span>;
         objB.sayB<span class="org-rainbow-delimiters-depth-2">()</span>;
 <span class="org-rainbow-delimiters-depth-1">}</span> <span class="org-keyword">catch</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">runtime_error</span>&amp; <span class="org-variable-name">ex</span><span class="org-rainbow-delimiters-depth-1">){</span>
         <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [FAILURE]"</span> &lt;&lt; ex.what<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">"\n"</span>;
 <span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-type">B</span> <span class="org-variable-name">objB</span> = tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>1<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">B</span><span class="org-rainbow-delimiters-depth-1">&gt;()</span>;
 objB.sayB<span class="org-rainbow-delimiters-depth-1">()</span>;

 <span class="org-keyword">auto</span> <span class="org-variable-name">objC</span> = tlist.at<span class="org-rainbow-delimiters-depth-1">(</span>2<span class="org-rainbow-delimiters-depth-1">)</span>.recover<span class="org-rainbow-delimiters-depth-1">&lt;</span>C<span class="org-rainbow-delimiters-depth-1">&gt;()</span>;
 objC.sayC<span class="org-rainbow-delimiters-depth-1">()</span>;
</pre>
</div>

<p>
Compiling and running: (File: <a href="src/design-patterns/type-erasure1.cpp">file:src/design-patterns/type-erasure1.cpp</a>)
</p>

<div class="org-src-container">
<pre class="src src-cpp">$ clang++ type-erasure1.cpp -o <span class="org-keyword">type-erasure1.bin</span> -g -std=c++1z -Wall -Wextra 
$ ./type-erasure1.bin

EXPERIMENT 1 ============
Class type = <span class="org-keyword">class</span> A
Class type = <span class="org-keyword">class</span> B
Class type = <span class="org-keyword">class</span> C
I am the <span class="org-keyword">class</span> A

EXPERIMENT 2 ============
 <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-constant">FAILURE</span><span class="org-rainbow-delimiters-depth-1">]</span>Error: cannot cast to <span class="org-keyword">this</span> type
I am the <span class="org-keyword">class</span> B
I am the <span class="org-keyword">class</span> C
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf903f72" class="outline-3">
<h3 id="orgf903f72"><span class="section-number-3">1.11</span> CRTP - Curious Recurring Template Pattern (C++ Only)</h3>
<div class="outline-text-3" id="text-1-11">
</div>
<div id="outline-container-org89643aa" class="outline-4">
<h4 id="org89643aa"><span class="section-number-4">1.11.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
It is a variation of GOF template design pattern where an algorithm
defined by the base class is customized or specified by the derived 
class. However, unlike the GOF one, this version uses C++ template
metaprogramming for emulating dynamic polymorphism or inheritance
at compile time. So it makes the code faster by eliminating virtual
function-calls.
</p>

<p>
Features: 
</p>
<ul class="org-ul">
<li>Coined by James Coplien - 1995</li>
<li>Static polymorphism technique based on template metaprogramming for
speeding up the code eliminating virtual functions.</li>
</ul>

<p>
Use cases:
</p>
<ul class="org-ul">
<li>Reduce virtual function call overhead - by simulating dynamic
polymorphism through static polymorphism.</li>
<li>Implement state machines.</li>
<li>Implement high performance numerical libraries.</li>
<li>Code injection.</li>
</ul>

<p>
Libraries using this pattern:
</p>
<ul class="org-ul">
<li>Boost.Iterator</li>
<li>Boost.Python</li>
<li>Boost.Serialization</li>
</ul>

<p>
Also known as: 
</p>
<ul class="org-ul">
<li>Code injection</li>
<li>Barton‐Nackman Trick</li>
<li>Mixin - Name used outside C++ community</li>
</ul>
</div>
</div>

<div id="outline-container-orgbc4b01b" class="outline-4">
<h4 id="orgbc4b01b"><span class="section-number-4">1.11.2</span> Example</h4>
<div class="outline-text-4" id="text-1-11-2">
<p>
<b>Approach 1 - GOF - OOP template pattern</b> 
</p>

<ul class="org-ul">
<li>Code 1: GOF Template method design pattern using virtual functions.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">class</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-comment-delimiter">// </span><span class="org-comment">Algorithm or entry point which calls the derived class method.</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">This is the template method </span>
        <span class="org-type">double</span> <span class="org-function-name">summation</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">lower</span>, <span class="org-type">int</span> <span class="org-variable-name">upper</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span><span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-type">double</span> <span class="org-variable-name">sum</span> = 0;
                <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = lower; i &lt;= upper; i++<span class="org-rainbow-delimiters-depth-3">)</span>
                        sum += <span class="org-keyword">this</span>-&gt;stepFn<span class="org-rainbow-delimiters-depth-3">(</span>i<span class="org-rainbow-delimiters-depth-3">)</span>;
                <span class="org-keyword">return</span> sum; 
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">protected</span>:
        <span class="org-comment-delimiter">// </span><span class="org-comment">Hook method or to be defined by the derived class</span>
        <span class="org-keyword">virtual</span> <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> = 0 ;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfSquares</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
        <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfCubes</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">private</span>:
        <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">void</span> <span class="org-function-name">clientCode</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">IntervalSummation</span>&amp; <span class="org-variable-name">obj</span><span class="org-rainbow-delimiters-depth-1">){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Summation at [0, 15] = "</span> &lt;&lt; obj.summation<span class="org-rainbow-delimiters-depth-2">(</span>0, 15<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Approach 2 - CRTP generic programming pattern</b> 
</p>

<ul class="org-ul">
<li>Code 2: Code rewritten using CRTP for eliminating virtual function
calls. The advantage is that this code can run faster than the
previous one, however the cost is the higher complexity, loss of
readability and runtime polymorphism. For instance, now is not
possible to store multiple implementations of IntervalSummation in
a data structure or refer to them with the same pointer.</li>

<li>File: <a href="src/design-patterns/crtp1.cpp">file:src/design-patterns/crtp1.cpp</a></li>
<li>Online Compiler: <a href="https://rextester.com/ZLZH2040">https://rextester.com/ZLZH2040</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">class</span> <span class="org-type">Implementation</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-keyword">class</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
        <span class="org-comment-delimiter">// </span><span class="org-comment">Get reference to implementation </span>
        <span class="org-type">Implementation</span>&amp; <span class="org-function-name">self</span><span class="org-rainbow-delimiters-depth-2">(){</span>
                <span class="org-keyword">return</span> *<span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">Implementation</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span><span class="org-keyword">this</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">Overload method </span>
        <span class="org-keyword">const</span> <span class="org-type">Implementation</span>&amp; <span class="org-function-name">self</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
                <span class="org-keyword">return</span> *<span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">Implementation</span> <span class="org-keyword">const</span> * <span class="org-keyword">const</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span><span class="org-keyword">this</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-rainbow-delimiters-depth-2">}</span>   
        <span class="org-type">double</span> <span class="org-function-name">summation</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">lower</span>, <span class="org-type">int</span> <span class="org-variable-name">upper</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-type">double</span> <span class="org-variable-name">sum</span> = 0;
        <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = lower; i &lt;= upper; i++<span class="org-rainbow-delimiters-depth-3">)</span>
              sum += self<span class="org-rainbow-delimiters-depth-3">()</span>.stepFn<span class="org-rainbow-delimiters-depth-3">(</span>i<span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">return</span> sum; 
        <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfSquares</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">SumOfSquares</span><span class="org-rainbow-delimiters-depth-1">&gt;{</span>
<span class="org-function-name">public</span>:
        <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">class</span> <span class="org-type">SumOfCubes</span>: <span class="org-keyword">public</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">SumOfCubes</span><span class="org-rainbow-delimiters-depth-1">&gt;{</span>
<span class="org-function-name">public</span>:
        <span class="org-type">double</span> <span class="org-function-name">stepFn</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">const</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-keyword">return</span> x * x * x; <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">class</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-type">void</span> <span class="org-function-name">clientCode</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">IntervalSummation</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>&amp; <span class="org-variable-name">obj</span><span class="org-rainbow-delimiters-depth-1">){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Summation at [0, 15] = "</span> &lt;&lt; obj.summation<span class="org-rainbow-delimiters-depth-2">(</span>0, 15<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ clang++ crtp.cpp -o <span class="org-keyword">crtp.bin</span> -std=c++1z -Wall -Wextra  &amp;&amp; ./crtp.bin
Sum of squares<span class="org-keyword"> in</span> [0, 10] = 385
Sum of cubes  <span class="org-keyword"> in</span> [0, 10] = 3025
Summation at [0, 15] = 1240
Summation at [0, 15] = 14400
</pre>
</div>

<p>
References: 
</p>

<ul class="org-ul">
<li><a href="https://www.codeproject.com/Tips/537606/Cplusplus-Prefer-Curiously-Recurring-Template-Patt">C++: Prefer Curiously Recurring Template Pattern (CRTP) to Template Pattern - CodeProject</a></li>
<li><a href="https://mklimenko.github.io/english/2018/07/02/platform-dependent-crtp/">CRTP-based platform-dependent optimizations | GNSS C++ solutions</a></li>
<li><a href="http://stevedewhurst.com/once_weakly/once-weakly20170328/once-weakly20170328.pdf">http://stevedewhurst.com/once_weakly/once-weakly20170328/once-weakly20170328.pdf</a></li>
<li id="[[<a href="http://enki-tech.blogspot.com/2012/08/c11-generic-singleton.html">http://enki-tech.blogspot.com/2012/08/c11-generic-singleton.html</a>][Enki">Technical Blog: C++11: A generic Singleton]]</li>
<li>IDENTIFYING PROGRAMMING IDIOMS IN C++ GENERIC LIBRARIES -
<a href="https://etd.ohiolink.edu/rws_etd/document/get/kent1259116053/inline">https://etd.ohiolink.edu/rws_etd/document/get/kent1259116053/inline</a></li>
<li><a href="http://www.masaers.com/2014/01/22/CRTP-operator-hijacking.html">Using CRTP to easily hijack operators in c++11 | masaers’ blog</a></li>
<li><a href="https://github.com/nojhan/crtp_functor_ttp">https://github.com/nojhan/crtp_functor_ttp</a></li>
<li><a href="https://web.archive.org/web/20060211034709/http://devnet.developerpipeline.com/documents/s=9843/cuj0601diggins/">Developer::Pipelines | Building More Flexible Types with Mixins</a></li>
<li id="[[<a href="https://accu.org/index.php/journals/296">https://accu.org/index.php/journals/296</a>][ACCU">Better Encapsulation for the Curiously Recurring Template Pattern]]</li>
<li><a href="http://www.di.unipi.it/~nids/docs/templates_vs_inheritance.html">Replacing Virtual Methods with Templates</a></li>
<li><a href="http://gsd.web.elte.hu/lectures/bolyai/2018/mixin_crtp/mixin_crtp.pdf">http://gsd.web.elte.hu/lectures/bolyai/2018/mixin_crtp/mixin_crtp.pdf</a></li>
<li><a href="https://faithandbrave.hateblo.jp/entry/20071206/1196934096">https://faithandbrave.hateblo.jp/entry/20071206/1196934096</a></li>
<li><a href="https://nativecoding.wordpress.com/2015/06/05/virtual-methods-vs-crtp-benchmark-2/">Virtual Methods vs CRTP Benchmark – Native Coding</a></li>
<li><a href="https://nativecoding.wordpress.com/2015/01/11/important-c-idioms/">https://nativecoding.wordpress.com/2015/01/11/important-c-idioms/</a></li>
<li><a href="http://barngoggles.com/visitor-with-crtp/">http://barngoggles.com/visitor-with-crtp/</a></li>
</ul>

<p>
Best Links: 
</p>

<ul class="org-ul">
<li><a href="https://nativecoding.wordpress.com/2015/01/11/important-c-idioms/">https://nativecoding.wordpress.com/2015/01/11/important-c-idioms/</a></li>
<li><a href="https://marcoarena.wordpress.com/2012/04/29/use-crtp-for-polymorphic-chaining/">https://marcoarena.wordpress.com/2012/04/29/use-crtp-for-polymorphic-chaining/</a></li>
<li><a href="http://thothonegan.tumblr.com/post/157363120503/crtp-curiously-recurring-template-pattern">http://thothonegan.tumblr.com/post/157363120503/crtp-curiously-recurring-template-pattern</a></li>
</ul>

<p>
Videos: 
</p>

<ul class="org-ul">
<li>Curiously Recurring Template Pattern (CRTP) -
<a href="https://www.youtube.com/watch?v=C3Pi5GlIfjs">https://www.youtube.com/watch?v=C3Pi5GlIfjs</a></li>

<li></li>


<li></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org2ea564e" class="outline-3">
<h3 id="org2ea564e"><span class="section-number-3">1.12</span> RAII - Resource Aquisition Is Initialization (C++ Only)</h3>
<div class="outline-text-3" id="text-1-12">
<p>
Comes from book: <span class="underline">C++ Programming with Design Patterns Revealed</span> 
</p>

<p>
RAII is a design pattern which takes advantage of C++'s deterministic
destructor feature for deallocating resources such as pointers to
objects allocated on the heap memory, database handlers, socket
handlers and etc. The RAAI technique uses an object allocated on the
stack which acquires the resource as a constructor argument and
performs the resource cleanup in the destructor method which is called
when when the wrapper object goes out scope or an exception happens.
</p>

<ul class="org-ul">
<li>Note: This pattern is specific for C++, for Java and Scala use <span class="underline">try</span>
<span class="underline">finally</span> statements. Python has the <span class="underline">with</span> statement and C# has the
<span class="underline">using</span> statement. In addition, this pattern needs the
<b>deterministic destructor</b> feature which is unique to C++.</li>
</ul>

<p>
Note: It is no longer necessary to design any class for RAII since
C++11 has smart pointers which already implements this
pattern. However, it is important to understand how this idiom works
and the problem that it solves.
</p>
<ul class="org-ul">
<li>In C++ &gt;= C++ 11, it is better to use <code>unique_ptr</code> for handling
resources as shown at <a href="https://msdn.microsoft.com/en-us/library/hh438480.aspx">Objects Own Resources (RAII)</a></li>
</ul>

<p>
RAII is described as the process of: 
</p>
<ul class="org-ul">
<li>Acquiring a resouce and wrapping it as an object's state.</li>
<li>Using the resource</li>
<li>Releasing the resource in the object's destructor member function
which is executed when the object goes out of escope.</li>
</ul>

<p>
What i solves: 
</p>
<ul class="org-ul">
<li>Avoid memory leaks.</li>
<li>Avoid resource leaks.</li>
</ul>

<p>
Known uses: 
</p>
<ul class="org-ul">
<li>C++11 <span class="underline">shared_ptr</span> (Smart pointer)</li>
<li>C++11 <span class="underline">unique_ptr</span> (Smart pointer)</li>
</ul>

<p>
 <b>Example 1:</b> Naive code - If an exception happens, the resource will not
be released and the code will be vulnerable against memory leak or
resource leak.  
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">Handler</span>* <span class="org-variable-name">handle</span>  = getDatabaseHandler<span class="org-rainbow-delimiters-depth-1">()</span>; 
<span class="org-comment-delimiter">// </span><span class="org-comment">Throw exception =&gt; Resource leak </span>
performInvalidOperation<span class="org-rainbow-delimiters-depth-1">(</span>handle<span class="org-rainbow-delimiters-depth-1">)</span>;  
...
<span class="org-comment-delimiter">// </span><span class="org-comment">Forget to release resource!</span>
deleteResource<span class="org-rainbow-delimiters-depth-1">(</span>handle<span class="org-rainbow-delimiters-depth-1">)</span>; 
</pre>
</div>

<p>
Or: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">Object</span>* <span class="org-variable-name">heapObject</span> = <span class="org-keyword">new</span> <span class="org-type">Object</span><span class="org-rainbow-delimiters-depth-1">(</span>param0, param1, ....<span class="org-rainbow-delimiters-depth-1">)</span>;
peformOperation<span class="org-rainbow-delimiters-depth-1">(</span>heapObject<span class="org-rainbow-delimiters-depth-1">)</span>; 
heapObject-&gt;method1; 

<span class="org-comment-delimiter">// </span><span class="org-comment">Throw exception!! ==&gt; Memory Leak!</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">If the user forget this statement, </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">a memory leak will happen. </span>
<span class="org-keyword">delete</span> heapObject; 
</pre>
</div>

<p>
<b>Solution - RAAI Pattern</b>
</p>

<ul class="org-ul">
<li>An object is used to control the lifetime of a resource ensuring
that is released when the object goes out of scope or an exception
happens. The resource is aquired by the constructor and realeased
by the destructor.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">class</span> <span class="org-type">Resource</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-keyword">class</span> <span class="org-type">RaaiHandler</span> <span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:  
   <span class="org-comment-delimiter">// </span><span class="org-comment">Consructor: Acquire resource on the constructor </span>
   <span class="org-function-name">RaaiHandler</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">Resource</span>* <span class="org-variable-name">rawHandle_</span><span class="org-rainbow-delimiters-depth-2">)</span> : <span class="org-rainbow-delimiters-depth-2">(</span>rawHandle_<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{}</span>;

   <span class="org-comment-delimiter">// </span><span class="org-comment">Destructor: Releases resource </span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">The destructor is always called when the object goes out of scope </span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">or an exception happens.</span>
   ~<span class="org-function-name">RaiiHandler</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-rainbow-delimiters-depth-2">{</span>
      <span class="org-keyword">delete</span> _handler; 
    <span class="org-rainbow-delimiters-depth-2">}</span>      
<span class="org-function-name">private</span>:
   <span class="org-type">RaiiHandler</span>* <span class="org-variable-name">_handler</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Object created without new keyword is allocated in the stack, not in the heap.</span>
<span class="org-type">RaiiHandler</span> <span class="org-function-name">hnd</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">createNewResource</span><span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">.. . Peform operation </span>
Operation<span class="org-rainbow-delimiters-depth-1">(</span>hnd<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Once the escope is gone, the resource is released.</span>
</pre>
</div>

<p>
<b>References</b>
</p>

<ul class="org-ul">
<li><a href="https://www.codeproject.com/Articles/580077/ResourceplusAcquisitionplusisplusInitializationplu">Resource Acquisition is Initialization (RAII) - CodeProject</a></li>
<li><a href="https://stackoverflow.com/questions/2321511/what-is-meant-by-resource-acquisition-is-initialization-raii">c++ - What is meant by Resource Acquisition is Initialization (RAII)? - Stack Overflow</a></li>
<li><a href="https://www.codeproject.com/Articles/122129/RAII-Resource-Acquisition-Is-Initialization-C-Help">RAII (Resource Acquisition Is Initialization) C# Helper Classes - CodeProject</a></li>
<li><a href="http://jrdodds.blogs.com/blog/2004/08/raii_in_c.html/">RAII in C++ (constructive nonconformist)</a></li>
</ul>
</div>
</div>

<div id="outline-container-org8541d83" class="outline-3">
<h3 id="org8541d83"><span class="section-number-3">1.13</span> Cross platform code with conditional compilation (C++ Only)</h3>
<div class="outline-text-3" id="text-1-13">
<p>
Note: It is not a design pattern, but a useful for techinque for
designing cross platform code in C++.
</p>

<p>
Macros are useful for writing cross-platform code by hiding and
isolating platform-specific details, such as specific hardware
registers address, compiler extensions, APIs and system calls. This
example shows how to use conditional compilation to write code which
can be compiled on an Unix-like operating system, such as Linux or OSX
and Windows.
</p>

<p>
Example: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Scoped enum is used to identify the operating system the code </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">was copiled against.</span>
<span class="org-keyword">enum</span> <span class="org-keyword">class</span> <span class="org-type">SystemType</span><span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-variable-name">WindowsNT</span>,
    <span class="org-variable-name">Linux</span>,
    <span class="org-variable-name">MacOSX</span>,
    <span class="org-variable-name">FreeBSD</span>,
    <span class="org-variable-name">Unknown</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-comment-delimiter">/**  </span><span class="org-comment">Returns operating system that the </span>
<span class="org-comment"> *   library was compiled against.</span>
<span class="org-comment">*/</span>
<span class="org-keyword">auto</span> <span class="org-function-name">getSystemType</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-type">SystemType</span> <span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-preprocessor">     #ifdef</span> __apple__
        <span class="org-keyword">return</span> <span class="org-constant">SystemType</span>::MacOSX;
<span class="org-preprocessor">     #elif</span> <span class="org-preprocessor">defined</span> __linux__
        <span class="org-keyword">return</span> <span class="org-constant">SystemType</span>::Linux;
<span class="org-preprocessor">     #elif</span> <span class="org-preprocessor">defined</span> _WIN32 || <span class="org-preprocessor">defined</span> _WIN64
       <span class="org-keyword">return</span> <span class="org-constant">SystemType</span>::WindowsNT;
<span class="org-preprocessor">     #else</span>
       <span class="org-keyword">return</span> <span class="org-constant">SystemType</span>::Unknown;
<span class="org-preprocessor">     #endif</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">auto</span> <span class="org-function-name">getOperatingSystem</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">SystemType</span> <span class="org-variable-name">type</span> = getSystemType<span class="org-rainbow-delimiters-depth-2">()</span>;
     <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span>type == <span class="org-constant">SystemType</span>::Linux<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> <span class="org-string">"Linux"</span>;
     <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == <span class="org-constant">SystemType</span>::MacOSX<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> <span class="org-string">"MacOSX"</span>;
     <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == <span class="org-constant">SystemType</span>::WindowsNT<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> <span class="org-string">"Windows NT"</span>;
     <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == <span class="org-constant">SystemType</span>::FreeBSD<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> <span class="org-string">"FreeBSD"</span>;       
     <span class="org-keyword">return</span> <span class="org-string">"Unknown operating system"</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">auto</span> <span class="org-function-name">isWindows</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-type">bool</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> getSystemType<span class="org-rainbow-delimiters-depth-2">()</span> == <span class="org-constant">SystemType</span>::WindowsNT;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Check whether is U-N-I-X like </span>
<span class="org-keyword">auto</span> <span class="org-function-name">isNixLike</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-type">bool</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-keyword">auto</span> <span class="org-variable-name">t</span> = getSystemType<span class="org-rainbow-delimiters-depth-2">()</span>;
     <span class="org-keyword">return</span> t == <span class="org-constant">SystemType</span>::Linux
             || t == <span class="org-constant">SystemType</span>::FreeBSD
             || t == <span class="org-constant">SystemType</span>::MacOSX;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Cross platform code for creating directory */</span>
<span class="org-type">void</span> <span class="org-function-name">makeDirectory</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">){</span>
<span class="org-preprocessor">     #if</span> <span class="org-preprocessor">defined</span> __linux__ || <span class="org-preprocessor">defined</span> __apple__
    <span class="org-comment-delimiter">/** </span><span class="org-comment">==== U-NIX Specific code ==== */</span>
        mkdir<span class="org-rainbow-delimiters-depth-2">(</span>path.c_str<span class="org-rainbow-delimiters-depth-3">()</span>, 0777<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-preprocessor">     #elif</span> _WIN32
    <span class="org-comment-delimiter">/** </span><span class="org-comment">==== Windows Specific Code ==== */</span>
        CreateDirectoryA<span class="org-rainbow-delimiters-depth-2">(</span>path.c_str<span class="org-rainbow-delimiters-depth-3">()</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-preprocessor">     #endif</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Get home directory, ~/ or $HOME on Unix or %USERPROFILE% </span>
<span class="org-comment"> * environment variable on Windows </span>
<span class="org-comment"> */</span>
<span class="org-function-name">std</span>::string getHomeDir<span class="org-rainbow-delimiters-depth-1">(){</span>
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span>getSystemType<span class="org-rainbow-delimiters-depth-3">()</span> == <span class="org-constant">SystemType</span>::WindowsNT<span class="org-rainbow-delimiters-depth-2">)</span>
       <span class="org-keyword">return</span> getEnv<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"USERPROFILE"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">else</span>
      <span class="org-keyword">return</span> getEnv<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"HOME"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org85d0bd5" class="outline-3">
<h3 id="org85d0bd5"><span class="section-number-3">1.14</span> Multiple booleans encoded as bitmask</h3>
<div class="outline-text-3" id="text-1-14">
<p>
Note: It is not a design pattern, but a technique for encoding
multiple booleans or flags inside a single value, passing multiple
booleans as function parameters or returning multiple booleans as a
single value.
</p>

<p>
Example: 
</p>

<ul class="org-ul">
<li>File:  <a href="src/design-patterns/boolean-bitmask.C">file:src/design-patterns/boolean-bitmask.C</a>  (CLING script)</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">vector</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">ostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-comment-delimiter">// </span><span class="org-comment">Operator: (&lt;&lt;)</span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">enum</span> <span class="org-keyword">class</span> <span class="org-type">Permissions</span>: <span class="org-type">unsigned</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-variable-name">executable</span> = 0x01,  <span class="org-comment-delimiter">// </span><span class="org-comment">decimal = 1 or (1 &lt;&lt; 0)</span>
    <span class="org-variable-name">writeable</span>  = 0x02,  <span class="org-comment-delimiter">// </span><span class="org-comment">decimal = 2 or (1 &lt;&lt; 1)</span>
    <span class="org-variable-name">readable</span>   = 0x04   <span class="org-comment-delimiter">// </span><span class="org-comment">decimal = 4 or (1 &lt;&lt; 2)</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-type">Permissions</span> <span class="org-keyword">operator</span> <span class="org-function-name">|</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">Permissions</span> <span class="org-variable-name">lhs</span>, <span class="org-type">Permissions</span> <span class="org-variable-name">rhs</span><span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-keyword">return</span> <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Permissions</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span><span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">unsigned</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>lhs<span class="org-rainbow-delimiters-depth-3">)</span> | <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">unsigned</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>rhs<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
<span class="org-type">bool</span> <span class="org-keyword">operator</span> <span class="org-function-name">&amp;</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">Permissions</span> <span class="org-variable-name">lhs</span>, <span class="org-type">Permissions</span> <span class="org-variable-name">rhs</span><span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-keyword">return</span> <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">unsigned</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>lhs<span class="org-rainbow-delimiters-depth-2">)</span> &amp; <span class="org-keyword">static_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">unsigned</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>rhs<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Make permissions enum printable. </span>
<span class="org-function-name">std</span>::ostream&amp; <span class="org-keyword">operator</span>&lt;&lt;<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">ostream</span>&amp; <span class="org-variable-name">os</span>, <span class="org-keyword">const</span> <span class="org-type">Permissions</span>&amp; <span class="org-variable-name">p</span><span class="org-rainbow-delimiters-depth-1">){</span>
    os &lt;&lt; <span class="org-constant">std</span>::boolalpha; <span class="org-comment-delimiter">// </span><span class="org-comment">Make bool printable as 'true' or 'false' instead of 0 or 1</span>
    os &lt;&lt; <span class="org-string">"readable = "</span>   &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::readable<span class="org-rainbow-delimiters-depth-2">)</span>   &lt;&lt; <span class="org-string">"; "</span>
       &lt;&lt; <span class="org-string">"writeable = "</span>  &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::writeable<span class="org-rainbow-delimiters-depth-2">)</span>  &lt;&lt; <span class="org-string">"; "</span>
       &lt;&lt; <span class="org-string">"executable = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::executable<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> os;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Load script </span>
&gt;&gt; .L boolean-bitmask.C 

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">Permissions</span>::readable &lt;&lt; <span class="org-constant">std</span>::endl;
readable = <span class="org-constant">true</span>; writeable = <span class="org-constant">false</span>; executable = <span class="org-constant">false</span>

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">Permissions</span>::readable &lt;&lt; <span class="org-string">"\n"</span>;
readable = <span class="org-constant">true</span>; writeable = <span class="org-constant">false</span>; executable = <span class="org-constant">false</span>

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">Permissions</span>::writeable &lt;&lt; <span class="org-string">"\n"</span>;
readable = <span class="org-constant">false</span>; writeable = <span class="org-constant">true</span>; executable = <span class="org-constant">false</span>

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">Permissions</span>::executable &lt;&lt; <span class="org-string">"\n"</span>;
readable = <span class="org-constant">false</span>; writeable = <span class="org-constant">false</span>; executable = <span class="org-constant">true</span>

&gt;&gt; <span class="org-keyword">auto</span> p1 = <span class="org-constant">Permissions</span>::executable | <span class="org-constant">Permissions</span>::readable ;
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"p1 =&gt; "</span> &lt;&lt; p1 &lt;&lt; <span class="org-string">"\n"</span>;
p1 =&gt; readable = <span class="org-constant">true</span>; writeable = <span class="org-constant">false</span>; executable = <span class="org-constant">true</span>
&gt;&gt; 

&gt;&gt; <span class="org-keyword">auto</span> p2 = <span class="org-constant">Permissions</span>::executable | <span class="org-constant">Permissions</span>::readable | <span class="org-constant">Permissions</span>::writeable ;
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"p2 =&gt; "</span> &lt;&lt; p2 &lt;&lt; <span class="org-string">"\n"</span>;
p2 =&gt; readable = <span class="org-constant">true</span>; writeable = <span class="org-constant">true</span>; executable = <span class="org-constant">true</span>
&gt;&gt; 

&gt;&gt; <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-1">(</span>p1 &amp; <span class="org-constant">Permissions</span>::readable<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"File is readable"</span> &lt;&lt; <span class="org-string">"\n"</span>; <span class="org-rainbow-delimiters-depth-1">}</span>
File <span class="org-type">is</span> <span class="org-variable-name">readable</span>
&gt;&gt; 

</pre>
</div>

<p>
Shows all flags or all bits that are set: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">void</span> <span class="org-function-name">showPermissions</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">Permissions</span> <span class="org-variable-name">p</span><span class="org-rainbow-delimiters-depth-1">){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Is readable?     : "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::readable<span class="org-rainbow-delimiters-depth-2">)</span>   &lt;&lt; <span class="org-string">'\n'</span>;
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Is writeable?    : "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::writeable<span class="org-rainbow-delimiters-depth-2">)</span>  &lt;&lt; <span class="org-string">'\n'</span>;
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Is executable?   : "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::executable<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">'\n'</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

&gt;&gt; showPermissions<span class="org-rainbow-delimiters-depth-1">(</span>p1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Is</span> <span class="org-function-name">readable</span>?     : <span class="org-constant">true</span>
Is writeable?    : <span class="org-constant">false</span>
Is executable?   : <span class="org-constant">true</span>
&gt;&gt; 
&gt;&gt; showPermissions<span class="org-rainbow-delimiters-depth-1">(</span>p2<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Is</span> <span class="org-variable-name">readable</span>?     : <span class="org-constant">true</span>
Is writeable?    : <span class="org-constant">true</span>
Is executable?   : <span class="org-constant">true</span>
&gt;&gt; 
</pre>
</div>

<p>
Design 1: Function uses multiple bools creating a file with some
permissions. 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">using</span> <span class="org-type">FilePerms</span> = <span class="org-constant">std</span>::<span class="org-type">tuple</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">bool</span>, <span class="org-type">bool</span>, <span class="org-type">bool</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Design 1:</span>
<span class="org-type">FilePerms</span> <span class="org-function-name">createFileDD1</span><span class="org-rainbow-delimiters-depth-1">(</span>
     <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">name</span>,
     <span class="org-type">bool</span> <span class="org-variable-name">readable</span>,
     <span class="org-type">bool</span> <span class="org-variable-name">writeable</span>,
     <span class="org-type">bool</span> <span class="org-variable-name">executable</span> <span class="org-rainbow-delimiters-depth-1">){</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">std</span>::boolalpha
               &lt;&lt; <span class="org-string">"Create file = "</span> &lt;&lt; name &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">" with the following permissions"</span> &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + readable   = "</span> &lt;&lt; readable   &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + writeable  = "</span> &lt;&lt; writeable  &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + executable = "</span> &lt;&lt; executable &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"\n"</span>;
     <span class="org-keyword">return</span> FilePerms <span class="org-rainbow-delimiters-depth-2">{</span>readable, writeable, executable<span class="org-rainbow-delimiters-depth-2">}</span>;    
<span class="org-rainbow-delimiters-depth-1">}</span>

&gt;&gt; <span class="org-keyword">auto</span> pd1 = createFileDD1<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"dataset.txt"</span>, <span class="org-constant">true</span>, <span class="org-constant">false</span>, <span class="org-constant">false</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Create</span> <span class="org-variable-name">file</span> = dataset.txt
 with the following permissions
  + readable   = <span class="org-constant">true</span>
  + writeable  = <span class="org-constant">false</span>
  + executable = <span class="org-constant">false</span>

&gt;&gt; pd1
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">tuple</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">bool</span>, <span class="org-type">bool</span>, <span class="org-type">bool</span><span class="org-rainbow-delimiters-depth-2">&gt;</span> &amp;<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-constant">true</span>, <span class="org-constant">false</span>, <span class="org-constant">false</span> <span class="org-rainbow-delimiters-depth-1">}</span>
&gt;&gt; 

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"R = "</span> &lt;&lt; <span class="org-constant">std</span>::get<span class="org-rainbow-delimiters-depth-1">&lt;</span>0<span class="org-rainbow-delimiters-depth-1">&gt;(</span>pd1<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
R = <span class="org-constant">true</span>
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"W = "</span> &lt;&lt; <span class="org-constant">std</span>::get<span class="org-rainbow-delimiters-depth-1">&lt;</span>1<span class="org-rainbow-delimiters-depth-1">&gt;(</span>pd1<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
W = <span class="org-constant">false</span>
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"X = "</span> &lt;&lt; <span class="org-constant">std</span>::get<span class="org-rainbow-delimiters-depth-1">&lt;</span>2<span class="org-rainbow-delimiters-depth-1">&gt;(</span>pd1<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
X = <span class="org-constant">false</span>
&gt;&gt; 
</pre>
</div>

<p>
Design 2: Use bitmask flags instead of bools. The advantage is more
readability and less functions parameters. 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Design 1:</span>
<span class="org-type">Permissions</span> <span class="org-function-name">createFileDD2</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">name</span>, <span class="org-type">Permissions</span> <span class="org-variable-name">p</span><span class="org-rainbow-delimiters-depth-1">){</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">std</span>::boolalpha
               &lt;&lt; <span class="org-string">"Create file = "</span> &lt;&lt; name &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">" with the following permissions"</span> &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + readable   = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::readable<span class="org-rainbow-delimiters-depth-2">)</span>   &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + writeable  = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::writeable<span class="org-rainbow-delimiters-depth-2">)</span>  &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"  + executable = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>p &amp; <span class="org-constant">Permissions</span>::executable<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>
               &lt;&lt; <span class="org-string">"\n"</span>;
     <span class="org-keyword">return</span> p;
<span class="org-rainbow-delimiters-depth-1">}</span>

&gt;&gt; <span class="org-keyword">auto</span> pd2 = createFileDD2<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Sales-report.xls"</span>, <span class="org-constant">Permissions</span>::readable | <span class="org-constant">Permissions</span>::writeable<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">Create</span> <span class="org-variable-name">file</span> = Sales-report.xls
 with the following permissions
  + readable   = <span class="org-constant">true</span>
  + writeable  = <span class="org-constant">true</span>
  + executable = <span class="org-constant">false</span>

<span class="org-rainbow-delimiters-depth-1">(</span>Permissions<span class="org-rainbow-delimiters-depth-1">)</span>  : <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">unsigned</span> <span class="org-type">int</span><span class="org-rainbow-delimiters-depth-1">)</span> 6
&gt;&gt; 

&gt;&gt; createFileDD2<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"parser.exe"</span>, <span class="org-constant">Permissions</span>::readable | <span class="org-constant">Permissions</span>::writeable | Create file = parser.exe
 with the following permissions
  + readable   = <span class="org-constant">true</span>
  + writeable  = <span class="org-constant">true</span>
  + executable = <span class="org-constant">true</span>

<span class="org-rainbow-delimiters-depth-2">(</span>Permissions<span class="org-rainbow-delimiters-depth-2">)</span>  : <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">unsigned</span> <span class="org-type">int</span><span class="org-rainbow-delimiters-depth-2">)</span> 7
&gt;&gt; 

&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"R = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>pd2 &amp; <span class="org-constant">Permissions</span>::readable<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
R = <span class="org-constant">true</span>
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"W = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>pd2 &amp; <span class="org-constant">Permissions</span>::writeable<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
W = <span class="org-constant">true</span>
&gt;&gt; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"X = "</span> &lt;&lt; <span class="org-rainbow-delimiters-depth-2">(</span>pd2 &amp; <span class="org-constant">Permissions</span>::executable<span class="org-rainbow-delimiters-depth-2">)</span> &lt;&lt; <span class="org-string">"\n"</span>;
X = <span class="org-constant">false</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-10-26 Fri 22:41</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
