<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-20 Sat 11:16 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux and Unix system programming</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="Linux, unix and posix system programming"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="theme/org-nav-theme.css" rel="stylesheet">
<script src="theme/org-nav-theme.js"></script>
<link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Linux and Unix system programming</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1ee1681">1. Linux and Unix system programming</a>
<ul>
<li><a href="#org38b550a">1.1. Low level IO functions</a></li>
<li><a href="#orga6fec42">1.2. Low level IO - open(), read(), write() syscall functions</a></li>
<li><a href="#orge047b23">1.3. Low level IO - creat()</a></li>
<li><a href="#orgbfb3f1c">1.4. Information about current process</a></li>
<li><a href="#org25df9e3">1.5. Dynamic Loading Shared Libraries</a>
<ul>
<li><a href="#org7c16ec9">1.5.1. Overview</a></li>
<li><a href="#org755eca3">1.5.2. GK3 GUI with dynamic linking</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-org1ee1681" class="outline-2">
<h2 id="org1ee1681"><span class="section-number-2">1</span> Linux and Unix system programming</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org38b550a" class="outline-3">
<h3 id="org38b550a"><span class="section-number-3">1.1</span> Low level IO functions</h3>
<div class="outline-text-3" id="text-1-1">
<p>
C-Library functions which encapsulates file-related systems calls.
</p>

<p>
Headers: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/types.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/stat.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fcntl.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">unistd.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
</pre>
</div>

<p>
<b>Special File Descriptors</b> 
</p>

<ul class="org-ul">
<li>STDOUT_FILENO =&gt; File descritor for stdout (process standard output)</li>
<li>STDERR_FILENO =&gt; File descritor for stderr (process standard error output)</li>
<li>STDIN_FILENO =&gt; File descritor for stdin (process standard input)</li>
</ul>

<p>
<b>Functions</b> 
</p>

<ul class="org-ul">
<li>close() =&gt; Close a file descriptor.
<ul class="org-ul">
<li>Doc: $ man 2 close</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">int</span> <span class="org-function-name">close</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">fd</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li>open() =&gt; Encapsulates open system call =&gt; Returns a file descritor
number. When fails, it returns (-1) setting the global variable
<span class="underline">errno</span>.
<ul class="org-ul">
<li>Doc: $ man 2 open</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">int</span> <span class="org-function-name">open</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">pathname</span>, <span class="org-type">int</span> <span class="org-variable-name">flags</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li>creat() =&gt; Create file
<ul class="org-ul">
<li>Doc: $ man 2 creat</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">int</span> <span class="org-function-name">creat</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">pathname</span>, <span class="org-type">mode_t</span> <span class="org-variable-name">mode</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<ul class="org-ul">
<li>read() =&gt; Read bytes from a file descriptor into a buffer, returning the
number of bytes read. If there is an error, the functions returns
(-1) setting the global variable <span class="underline">errno</span>.
<ul class="org-ul">
<li>Doc: $ man 2 read</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">ssize_t</span> <span class="org-function-name">read</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">fd</span>, <span class="org-type">void</span> *<span class="org-variable-name">buf</span>, <span class="org-type">size_t</span> <span class="org-variable-name">count</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li>write() =&gt; Write N bytes from a buffer to a file descriptor.
<ul class="org-ul">
<li>Doc: $ man 2 write</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">ssize_t</span> <span class="org-function-name">write</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">fd</span>, <span class="org-keyword">const</span> <span class="org-type">void</span> *<span class="org-variable-name">buf</span>, <span class="org-type">size_t</span> <span class="org-variable-name">count</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</div>
</div>



<div id="outline-container-orga6fec42" class="outline-3">
<h3 id="orga6fec42"><span class="section-number-3">1.2</span> Low level IO - open(), read(), write() syscall functions</h3>
<div class="outline-text-3" id="text-1-2">
<p>
This code demonstrates the usage of the open(), read(), write(),
close() low-level IO library-calls for file descriptors which
encapsulates system-calls with the same name. 
</p>

<p>
GIST: 
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/05fbba6475cca1dbdd50bbb2bd5ac8ae">https://gist.github.com/05fbba6475cca1dbdd50bbb2bd5ac8ae</a></li>
</ul>

<p>
File: unix-low-level-io.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">unistd.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/types.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/stat.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fcntl.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cstring</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-comment-delimiter">// </span><span class="org-comment">Import: char* strerror(in errnum);</span>

<span class="org-keyword">const</span> <span class="org-type">char</span>* 
<span class="org-function-name">errno_to_cstring</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">err</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">No such file or directory </span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == ENOENT<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span> <span class="org-string">"ENOENT"</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Operation not permitted </span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == EPERM<span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-keyword">return</span> <span class="org-string">"EPERM"</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Onput/Output error </span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == EIO<span class="org-rainbow-delimiters-depth-2">)</span>    <span class="org-keyword">return</span> <span class="org-string">"EIO"</span>;

    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == EAGAIN<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span> <span class="org-string">"EAGAIN"</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == EPERM<span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-keyword">return</span> <span class="org-string">"EPERM"</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>err == EPIPE<span class="org-rainbow-delimiters-depth-2">)</span>  <span class="org-keyword">return</span> <span class="org-string">"EPIPE"</span>;

    <span class="org-keyword">return</span> <span class="org-string">"&lt;UNKNOWN&gt;"</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>   


<span class="org-comment-delimiter">/** </span><span class="org-comment">Check whether file descriptor is regular file */</span>
<span class="org-type">bool</span> <span class="org-function-name">fd_is_regular_file</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">fd</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>       
     <span class="org-keyword">struct</span> <span class="org-type">stat</span> <span class="org-variable-name">fd_info</span>; 
     <span class="org-comment-delimiter">// </span><span class="org-comment">int fstat(int fd, struct stat *statbuf);</span>
     <span class="org-type">int</span> <span class="org-variable-name">r</span> = fstat<span class="org-rainbow-delimiters-depth-2">(</span>fd, &amp;fd_info<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> S_ISREG<span class="org-rainbow-delimiters-depth-2">(</span>fd_info.st_mode<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">bool</span> <span class="org-function-name">fd_is_directory</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">fd</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">struct</span> <span class="org-type">stat</span> <span class="org-variable-name">fd_info</span>; 
    <span class="org-comment-delimiter">// </span><span class="org-comment">int fstat(int fd, struct stat *statbuf);</span>
    <span class="org-type">int</span> <span class="org-variable-name">r</span> = fstat<span class="org-rainbow-delimiters-depth-2">(</span>fd, &amp;fd_info<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> S_ISDIR<span class="org-rainbow-delimiters-depth-2">(</span>fd_info.st_mode<span class="org-rainbow-delimiters-depth-2">)</span>;    
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">print_errno_details</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">err</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stderr , <span class="org-string">"\n   =&gt;    errno(int) = %d"</span> 
                          <span class="org-string">"\n   =&gt;    errno(str) = %s"</span>
                          <span class="org-string">"\n   =&gt; errno message = %s \n"</span>
                          , err, errno_to_cstring<span class="org-rainbow-delimiters-depth-3">(</span>err<span class="org-rainbow-delimiters-depth-3">)</span>, strerror<span class="org-rainbow-delimiters-depth-3">(</span>err<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-constant">std</span>::fflush<span class="org-rainbow-delimiters-depth-2">(</span>stderr<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::puts<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [INFO] Program started. "</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>argc &lt; 3<span class="org-rainbow-delimiters-depth-2">){</span>
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" Usage:                             \n"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">"  =&gt; To read a file:                \n"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">"    $ %s file &lt;FILE&gt;                \n"</span>, argv<span class="org-rainbow-delimiters-depth-4">[</span>0<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">"  =&gt; To read stdin (console input): \n"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">"    $ %s file -stdin                \n"</span>, argv<span class="org-rainbow-delimiters-depth-4">[</span>0<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-keyword">return</span> 0;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Compare two c-strings return 0 (zero) when they are equal.</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">int strcmp(const char *s1, const char *s2)</span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> strcmp<span class="org-rainbow-delimiters-depth-3">(</span>argv<span class="org-rainbow-delimiters-depth-4">[</span>1<span class="org-rainbow-delimiters-depth-4">]</span>, <span class="org-string">"file"</span><span class="org-rainbow-delimiters-depth-3">)</span> != 0 <span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" [ERROR] Expected command file. \n"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-keyword">return</span> EXIT_FAILURE;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Variable for holding a file descriptor </span>
    <span class="org-type">int</span> <span class="org-variable-name">fd</span>; 

    <span class="org-comment-delimiter">// </span><span class="org-comment">The library-call open() attempts to open a file  and returns a "file-descriptor" </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">(integer number ) when the operation is successful. The library-call </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">returns (-1) when the operation fails. </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Note: It encapsulates the 'open' system call. </span>
    <span class="org-comment-delimiter">//  </span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> strcmp<span class="org-rainbow-delimiters-depth-3">(</span>argv<span class="org-rainbow-delimiters-depth-4">[</span>2<span class="org-rainbow-delimiters-depth-4">]</span>, <span class="org-string">"-stdin"</span><span class="org-rainbow-delimiters-depth-3">)</span> == 0<span class="org-rainbow-delimiters-depth-2">)</span>
            fd = STDIN_FILENO; 
    <span class="org-keyword">else</span> 
            fd = open<span class="org-rainbow-delimiters-depth-2">(</span>argv<span class="org-rainbow-delimiters-depth-3">[</span>2<span class="org-rainbow-delimiters-depth-3">]</span>, O_RDONLY<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>fd == -1<span class="org-rainbow-delimiters-depth-2">){</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">Get error flag 'errno' to get more details about current error.</span>
            <span class="org-type">int</span> <span class="org-variable-name">err</span> = errno;
            <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr ,<span class="org-string">" [ERROR] Failed to open file. "</span><span class="org-rainbow-delimiters-depth-3">)</span>;
            print_errno_details<span class="org-rainbow-delimiters-depth-3">(</span>err<span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-keyword">return</span> EXIT_FAILURE;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" [INFO] ?? File is regular file = %s \n"</span>
                              , fd_is_regular_file<span class="org-rainbow-delimiters-depth-3">(</span>fd<span class="org-rainbow-delimiters-depth-3">)</span> ? <span class="org-string">"TRUE"</span> : <span class="org-string">"FALSE"</span>  <span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" [INFO] ?? File is directory file = %s \n"</span>
                              , fd_is_directory<span class="org-rainbow-delimiters-depth-3">(</span>fd<span class="org-rainbow-delimiters-depth-3">)</span> ? <span class="org-string">"TRUE"</span> : <span class="org-string">"FALSE"</span>  <span class="org-rainbow-delimiters-depth-2">)</span>;                
    <span class="org-comment-delimiter">// </span><span class="org-comment">Flush file =&gt; Force changes to be immeditely written.</span>
    <span class="org-constant">std</span>::fflush<span class="org-rainbow-delimiters-depth-2">(</span>stdout<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Buffer maximum size in bytes </span>
    <span class="org-keyword">constexpr</span> <span class="org-type">size_t</span> <span class="org-variable-name">BUFFER_MAX_SIZE</span> = 200;     
    <span class="org-type">char</span> <span class="org-variable-name">buffer</span><span class="org-rainbow-delimiters-depth-2">[</span>BUFFER_MAX_SIZE<span class="org-rainbow-delimiters-depth-2">]</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Stream BUFFER_MAX_SIZE bytes from file descriptor </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">to STDOUT_FILENO (file descriptor).</span>
    <span class="org-comment-delimiter">//</span><span class="org-comment">---------------------------------------------------</span>
    <span class="org-type">ssize_t</span> <span class="org-variable-name">ret</span>; 
    <span class="org-keyword">do</span> <span class="org-rainbow-delimiters-depth-2">{</span>
            ret = read<span class="org-rainbow-delimiters-depth-3">(</span>fd, buffer, BUFFER_MAX_SIZE<span class="org-rainbow-delimiters-depth-3">)</span>;        
            <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span>ret == -1<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">{</span>
                    <span class="org-type">int</span> <span class="org-variable-name">err</span> = errno; 
                    <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-4">(</span>stderr, <span class="org-string">" [ERROR] An error has happened =&gt; "</span><span class="org-rainbow-delimiters-depth-4">)</span>;
                    print_errno_details<span class="org-rainbow-delimiters-depth-4">(</span>err<span class="org-rainbow-delimiters-depth-4">)</span>;
                    close<span class="org-rainbow-delimiters-depth-4">(</span>fd<span class="org-rainbow-delimiters-depth-4">)</span>;
                    <span class="org-keyword">return</span> EXIT_FAILURE;
            <span class="org-rainbow-delimiters-depth-3">}</span>       
            ::write<span class="org-rainbow-delimiters-depth-3">(</span>STDOUT_FILENO, buffer, ret<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span> <span class="org-keyword">while</span><span class="org-rainbow-delimiters-depth-2">(</span> ret != 0<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Always close the file descriptor.</span>
    close<span class="org-rainbow-delimiters-depth-2">(</span>fd<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ g++ unix-low-level-io.cpp -o <span class="org-keyword">unix-low-level-io.bin</span> -std=c++1z -Wall -Wextra
</pre>
</div>

<p>
Running:
</p>

<ul class="org-ul">
<li>Run 1</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ./unix-low-level-io.bin 
[INFO] Program started. 
<span class="org-function-name">Usage</span>:                             
 =&gt; To read a file:                
   $ ./unix-low-level-io.bin file &lt;FILE&gt;                
 =&gt; To read stdin (console input): 
   $ ./unix-low-level-io.bin file -stdin                
</pre>
</div>

<ul class="org-ul">
<li>Run 2:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; ./unix-low-level-io.bin file /proc/filesystems 
 [INFO] Program started. 
 [INFO] ?? File is regular file = TRUE 
 [INFO] ?? File is directory file = FALSE 
nodev   sysfs
nodev   tmpfs
nodev   bdev
nodev   proc
nodev   cgroup
nodev   cgroup2
... ... ... 

$ &gt;&gt; ./unix-low-level-io.bin file /etc/resolv.conf 
 [INFO] Program started. 
 [INFO] ?? File is regular file = TRUE 
 [INFO] ?? File is directory file = FALSE 
<span class="org-comment-delimiter"># </span><span class="org-comment">Generated by NetworkManager</span>
nameserver 194.165.12.10
</pre>
</div>

<ul class="org-ul">
<li>Run 3: (Error)</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ./unix-low-level-io.bin file /etc/resosad
[INFO] Program started. 
[ERROR] Failed to open file. 
  =&gt;    errno(int) = 2
  =&gt;    errno(str) = ENOENT
  =&gt; errno message = No such file or directory 

$ &gt;&gt; ./unix-low-level-io.bin file /etc/shadow
[INFO] Program started. 
[ERROR] Failed to open file. 
  =&gt;    errno(int) = 13
  =&gt;    errno(str) = &lt;UNKNOWN&gt;
  =&gt; errno message = Permission denied 

$ &gt;&gt; ./unix-low-level-io.bin file /
[INFO] Program started. 
[INFO] ?? File is regular file = FALSE 
[INFO] ?? File is directory file = TRUE 
[ERROR] An error has happened =&gt; 
  =&gt;    errno(int) = 21
  =&gt;    errno(str) = &lt;UNKNOWN&gt;
  =&gt; errno message = Is a directory 
</pre>
</div>

<ul class="org-ul">
<li>Run 4 - read stdin file descriptor <span class="underline">STDIN_FILENO</span></li>
</ul>

<pre class="example">
 $ &gt;&gt; ./unix-low-level-io.bin file -stdin
 [INFO] Program started. 
 [INFO] ?? File is regular file = FALSE 
 [INFO] ?? File is directory file = FALSE 


Hello world
Hello world
 Unix-linux file descriptors - Low level IO
 Unix-linux file descriptors - Low level IO

# User types Ctrl+D to close STDIN 
</pre>
</div>
</div>

<div id="outline-container-orge047b23" class="outline-3">
<h3 id="orge047b23"><span class="section-number-3">1.3</span> Low level IO - creat()</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Creates a file using Unix-low level IO function creat() which
encapsulates the creat() system-call.
</p>

<p>
File: unix-creat.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">unistd.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/types.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/stat.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fcntl.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cstring</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-type">void</span> <span class="org-function-name">print_errno_details</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">err</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">File is created with read, write permissions for owner </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">,groups and others</span>
    <span class="org-type">mode_t</span> <span class="org-variable-name">mode</span> = S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH;

    <span class="org-type">int</span> <span class="org-variable-name">fd</span> = creat<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"/tmp/my-sample-file.txt"</span>, mode<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>fd  == -1<span class="org-rainbow-delimiters-depth-2">){</span>
        print_errno_details<span class="org-rainbow-delimiters-depth-3">(</span>errno<span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">return</span> EXIT_FAILURE;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-keyword">constexpr</span> <span class="org-type">size_t</span> <span class="org-variable-name">BUFFER_SIZE</span> = 500;
    <span class="org-type">char</span> <span class="org-variable-name">buffer</span><span class="org-rainbow-delimiters-depth-2">[</span>BUFFER_SIZE<span class="org-rainbow-delimiters-depth-2">]</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Fill the whole buffer with '\0' null char characters</span>
    memset<span class="org-rainbow-delimiters-depth-2">(</span>buffer, <span class="org-string">'\0'</span>, BUFFER_SIZE<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">strcpy =&gt; Copy string literal to buffer. </span>
    strcpy<span class="org-rainbow-delimiters-depth-2">(</span>buffer, <span class="org-string">" [LINE 0] Write this message to buffer\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" Buffer size (non blank chars) = %zu \n"</span>, strlen<span class="org-rainbow-delimiters-depth-3">(</span>buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Write strlen(buffer) bytes to file descriptor </span>
    write<span class="org-rainbow-delimiters-depth-2">(</span>fd, buffer, strlen<span class="org-rainbow-delimiters-depth-3">(</span>buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    strcpy<span class="org-rainbow-delimiters-depth-2">(</span>buffer, <span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX, AIX, POSIX\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" Buffer size (non blank chars) = %zu \n"</span>, strlen<span class="org-rainbow-delimiters-depth-3">(</span>buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" Buffer content = '%s' \n"</span>, buffer<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Write strlen(buffer) bytes to file descriptor </span>
    write<span class="org-rainbow-delimiters-depth-2">(</span>fd, buffer, strlen<span class="org-rainbow-delimiters-depth-3">(</span>buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    strcpy<span class="org-rainbow-delimiters-depth-2">(</span>buffer, <span class="org-string">" [LINE 2] FreeRTOS Linux RTAI Real-time RTMES QNX\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    write<span class="org-rainbow-delimiters-depth-2">(</span>fd, buffer, strlen<span class="org-rainbow-delimiters-depth-3">(</span>buffer<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    close<span class="org-rainbow-delimiters-depth-2">(</span>fd<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> EXIT_SUCCESS;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Ruires: #include &lt;string&gt;</span>
<span class="org-type">void</span> <span class="org-function-name">print_errno_details</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">err</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
        <span class="org-constant">std</span>::fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stderr , <span class="org-string">"\n   =&gt;    errno(int) = %d"</span> 
                              <span class="org-string">"\n   =&gt; errno message = %s \n"</span>
                            , err, strerror<span class="org-rainbow-delimiters-depth-3">(</span>err<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
        <span class="org-constant">std</span>::fflush<span class="org-rainbow-delimiters-depth-2">(</span>stderr<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ g++ unix-creat.cpp -o <span class="org-keyword">unix-creat.bin</span> -std=c++1z -Wall -Wextra -g 
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; ./unix-creat.bin 
 Buffer size (non blank chars) = 39 
 Buffer size (non blank chars) = 44 
 Buffer content = <span class="org-string">' [LINE 1] Unix, BSD, OSX, LINUX, AIX, POSIX</span>
<span class="org-string">'</span>
</pre>
</div>

<p>
Content of generated file: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; cat /tmp/my-sample-file.txt 
[LINE 0] Write this message to buffer
[LINE 1] Unix, BSD, OSX, LINUX, AIX, POSIX
[LINE 2] FreeRTOS Linux RTAI Real-time RTMES QNX
</pre>
</div>

<p>
Trace library-calls with <span class="underline">ltrace</span> application: 
</p>

<ul class="org-ul">
<li>$ ltrace ./unix-creat.bin</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ltrace ./unix-creat.bin

<span class="org-function-name">_ZNSt8ios_base4InitC1Ev</span>(0x4040a9, 0xffff, 0x7ffcfe326598, 224) = 0
<span class="org-function-name">__cxa_atexit</span>(0x4010e0, 0x4040a9, 0x402008, 6)                  = 0
<span class="org-function-name">creat</span>(0x402010, 420, 0x7ffcfe326598, 256)                      = 3
<span class="org-function-name">memset</span>(0x7ffcfe326280, <span class="org-string">'\0'</span>, 500)                              = 0x7ffcfe326280
<span class="org-function-name">strlen</span>(<span class="org-string">" [LINE 0] Write this message to "</span>...)                  = 39
<span class="org-function-name">fprintf</span>(0x7f95f2612500, <span class="org-string">" Buffer size (non blank chars) ="</span>..., 39 Buffer size (non blank chars) = 39 
) = 37
<span class="org-function-name">strlen</span>(<span class="org-string">" [LINE 0] Write this message to "</span>...)                  = 39
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 0] Write this message to "</span>..., 39)            = 39
<span class="org-function-name">strlen</span>(<span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX,"</span>...)                  = 44
<span class="org-function-name">fprintf</span>(0x7f95f2612500, <span class="org-string">" Buffer size (non blank chars) ="</span>..., 44 Buffer size (non blank chars) = 44 
) = 37
<span class="org-function-name">fprintf</span>(0x7f95f2612500, <span class="org-string">" Buffer content = '%s' \n"</span>, <span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX,"</span>... Buffer content = <span class="org-string">' [LINE 1] Unix, BSD, OSX, LINUX, AIX, POSIX</span>
<span class="org-string">'</span> 
) = 66
<span class="org-function-name">strlen</span>(<span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX,"</span>...)                  = 44
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX,"</span>..., 44)            = 44
<span class="org-function-name">strlen</span>(<span class="org-string">" [LINE 2] FreeRTOS Linux RTAI Re"</span>...)                  = 50
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 2] FreeRTOS Linux RTAI Re"</span>..., 50)            = 50
<span class="org-function-name">close</span>(3)                                                       = 0
<span class="org-function-name">_ZNSt8ios_base4InitD1Ev</span>(0x4040a9, 0, 0x4010e0, 1)              = 0x7f95f2965e40
+++ exited (status 0) +++

</pre>
</div>

<p>
Trace system-calls with <span class="underline">strace</span> application: 
</p>

<ul class="org-ul">
<li>$ strace ./unix-creat.bin</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ strace ./unix-creat.bin 

<span class="org-function-name">execve</span>(<span class="org-string">"./unix-creat.bin"</span>, [<span class="org-string">"./unix-creat.bin"</span>], 0x7fff489b8e40 /* 83 vars */) = 0
<span class="org-function-name">brk</span>(NULL)                               = 0x57c000
<span class="org-function-name">arch_prctl</span>(0x3001 /* ARCH_??? */, 0x7fff751bd910) = -1 EINVAL (Invalid argument)
<span class="org-function-name">access</span>(<span class="org-string">"/etc/ld.so.preload"</span>, R_OK)      = -1 ENOENT (No such file or directory)
 ... ... ... ... ... ... ... ... ... ... ... ... ... ...
 ... ... ... ... ... ... ... ... ... ... ... ... ... ...

<span class="org-function-name">mprotect</span>(0x7fed4e032000, 4096, PROT_READ) = 0
<span class="org-function-name">munmap</span>(0x7fed4dfe4000, 136250)          = 0
<span class="org-function-name">brk</span>(NULL)                               = 0x57c000
<span class="org-function-name">brk</span>(0x59d000)                           = 0x59d000
<span class="org-function-name">creat</span>(<span class="org-string">"/tmp/my-sample-file.txt"</span>, 0644)  = 3
<span class="org-function-name">fstat</span>(1, {<span class="org-variable-name">st_mode</span>=S_IFCHR|0620, <span class="org-variable-name">st_rdev</span>=makedev(0x88, 0xc), ...}) = 0
<span class="org-function-name">write</span>(1, <span class="org-string">" Buffer size (non blank chars) ="</span>..., 37) = 37
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 0] Write this message to "</span>..., 39) = 39
<span class="org-function-name">write</span>(1, <span class="org-string">" Buffer size (non blank chars) ="</span>..., 37) = 37
<span class="org-function-name">write</span>(1, <span class="org-string">" Buffer content = ' [LINE 1] Uni"</span>..., 63) = 63
<span class="org-function-name">write</span>(1, <span class="org-string">"' \n"</span>, 3)                     = 3
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 1] Unix, BSD, OSX, LINUX,"</span>..., 44) = 44
<span class="org-function-name">write</span>(3, <span class="org-string">" [LINE 2] FreeRTOS Linux RTAI Re"</span>..., 50) = 50
<span class="org-function-name">close</span>(3)                                = 0
<span class="org-function-name">exit_group</span>(0)                           = ?
+++ exited with 0 +++
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbfb3f1c" class="outline-3">
<h3 id="orgbfb3f1c"><span class="section-number-3">1.4</span> Information about current process</h3>
<div class="outline-text-3" id="text-1-4">
<p>
File: current-process.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cstring</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">unistd.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/types.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sys/stat.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fcntl.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">limits.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> <span class="org-comment-delimiter">// </span><span class="org-comment">PATH_MAX constant (macro)</span>

<span class="org-keyword">auto</span> <span class="org-function-name">get_cwd</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>;
<span class="org-keyword">auto</span> <span class="org-function-name">set_cwd</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">void</span>;
<span class="org-keyword">auto</span> <span class="org-function-name">read_symlink</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Unique process ID (identifier) number </span>
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"   =&gt; Process PID = %d \n"</span>, ::getpid<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">PID for parent process</span>
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"   =&gt; Process PID = %d \n"</span>, ::getppid<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Current directory </span>
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"   =&gt; Current directory = %s \n"</span>, get_cwd<span class="org-rainbow-delimiters-depth-3">()</span>.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"\n Change the curren directory to /etc \n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    set_cwd<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"/etc"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"   =&gt; Current directory = %s \n"</span>, get_cwd<span class="org-rainbow-delimiters-depth-3">()</span>.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Note: It only works on Linux. The directory /proc/self is a pseudo-directory </span>
    <span class="org-comment-delimiter">//       </span><span class="org-comment">whith pseudo-files containing information about the current process. </span>
    <span class="org-comment-delimiter">// </span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">the file /proc/self/exe is a symbolic link to the current executable.</span>
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">exe_file</span> = read_symlink<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"/proc/self/exe"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"  =&gt; Absolute Path of current executable = %s \n"</span>, exe_file.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Current directory </span>
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">exe_dir</span> = read_symlink<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"/proc/self/cwd"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">"  =&gt; Current directory of this executable = %s \n"</span>, exe_dir.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    fprintf<span class="org-rainbow-delimiters-depth-2">(</span>stdout, <span class="org-string">" [INFO] Finish Ok. \n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">----------- Functions Implementations ------------// </span>
<span class="org-comment-delimiter">// </span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Get current working directory of current process */</span>
<span class="org-keyword">auto</span> <span class="org-function-name">get_cwd</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> 
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">char</span>* <span class="org-variable-name">buffer</span> = ::getcwd<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nullptr</span>, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">cwd</span> = <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-2">(</span>buffer<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Note buffer was allocated with malloc </span>
    free<span class="org-rainbow-delimiters-depth-2">(</span>buffer<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> cwd;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Set current working directory for current process. */</span>
<span class="org-keyword">auto</span> <span class="org-function-name">set_cwd</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">void</span> 
<span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">int</span> <span class="org-variable-name">status</span> = ::chdir<span class="org-rainbow-delimiters-depth-2">(</span>path.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>status &lt; 0<span class="org-rainbow-delimiters-depth-2">)</span>
         <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"Failed to change directory."</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Read value of symbolic link </span>
<span class="org-comment"> *  </span>
<span class="org-comment"> * Requires: &lt;limits.h&gt;, &lt;sys/types.h&gt;, &lt;sys/stats.h&gt;</span>
<span class="org-comment"> */</span>
<span class="org-keyword">auto</span> <span class="org-function-name">read_symlink</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-keyword">const</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> 
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Create a buffer with size PATH_MAX + 1 filled with 0 ('\0'), null characters</span>
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">buffer</span><span class="org-rainbow-delimiters-depth-2">(</span>PATH_MAX, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">ssize_t readlink(const char *pathname, char *buf, size_t bufsiz);</span>
    <span class="org-type">ssize_t</span> <span class="org-variable-name">nread</span> = ::readlink<span class="org-rainbow-delimiters-depth-2">(</span>path.c_str<span class="org-rainbow-delimiters-depth-3">()</span>, &amp;buffer<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, PATH_MAX<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>nread == -1<span class="org-rainbow-delimiters-depth-2">){</span>
        fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" Error: %s \n"</span>, strerror<span class="org-rainbow-delimiters-depth-4">(</span>errno<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: unable to read symlink. Check 'errno' variable"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    buffer.resize<span class="org-rainbow-delimiters-depth-2">(</span>nread<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> buffer;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; g++ current-process.cpp -o <span class="org-keyword">current-process.elf</span> -Wall -Wextra -ggdb
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ./current-process.elf 
  =&gt; Process PID = 719155 
  =&gt; Process PID = 678179 
  =&gt; Current directory = /home/mxpkf8/temp-projects/unix-explore 

Change the curren directory to /etc 
  =&gt; Current directory = /etc 
 =&gt; Absolute Path of current executable = /home/mxpkf8/temp-projects/unix-explore/current-process.elf 
 =&gt; Current directory of this executable = /etc 
[INFO] Finish Ok.
</pre>
</div>
</div>
</div>

<div id="outline-container-org25df9e3" class="outline-3">
<h3 id="org25df9e3"><span class="section-number-3">1.5</span> Dynamic Loading Shared Libraries</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org7c16ec9" class="outline-4">
<h4 id="org7c16ec9"><span class="section-number-4">1.5.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
 The dlopen API provide access to the <span class="underline">dynamic linker</span> services allowing
the current process to load and unload shared objects or shared
libraries in its address space (virtual memory).
</p>

<p>
This API for loading shared libraries is not only available on Linux,
it also can be found in FreeBSD, NetBSD, MacOSX, Android and so on.
</p>

<p>
Use cases: 
</p>

<ul class="org-ul">
<li>Load new code at-runtime</li>

<li>Load third-party code a runtime</li>

<li>Plugin systems, extensions or addons.</li>

<li>Load native code extensions in languages with interpreters written
in C, such as Python, Ruby, Lua and so on. Note: Python native
extensions are shared libraries.</li>
</ul>

<p>
Documentation: 
</p>

<ul class="org-ul">
<li><a href="http://gnu.wiki/man3/dlopen.3.php">http://gnu.wiki/man3/dlopen.3.php</a></li>

<li><a href="https://man7.org/linux/man-pages/man3/dlopen.3.html">Dlopen API - Linux Manpages</a></li>

<li><a href="https://www.freebsd.org/cgi/man.cgi?query=dlopen&amp;apropos=0&amp;sektion=0&amp;manpath=SuSE+Linux%2Fi386+7.3&amp;format=html">Free BSD - dlopen API documentation</a></li>

<li><a href="https://docs.oracle.com/cd/E19048-01/chorus5/806-7014/6jftsjfdq/index.html">Dlopen - Oracle Documentation</a></li>

<li><a href="http://www.qnx.com/developers/docs/6.5.0SP1.update/com.qnx.doc.neutrino_lib_ref/d/dlopen.html">Dlopen - QNX documentation</a></li>

<li><a href="https://dwheeler.com/program-library/Program-Library-HOWTO/x172.html">Dynamically Loaded (DL) Libraries</a></li>
</ul>


<p>
Further Reading: 
</p>

<ul class="org-ul">
<li><a href="https://cseweb.ucsd.edu/~gbournou/CSE131/the_inside_story_on_shared_libraries_and_dynamic_loading.pdf">Inside the history on shared libraries and dynamic loading</a></li>

<li><a href="https://hackaday.com/2018/07/12/its-all-in-the-libs-building-a-plugin-system-using-dynamic-loading/">It 's all in the libs - Building a Plugin system using Dynamic Loading</a></li>

<li><a href="http://docencia.ac.upc.edu/FIB/USO/Bibliografia/unix-c-libraries.html">Building And Using Static And Shared "C" Libraries</a></li>

<li><a href="https://www.informit.com/articles/article.aspx?p=22435">More Shared Libraries-Dynamic Loading and Unloading</a></li>

<li><a href="https://grugq.github.io/docs/subversiveld.pdf">https://grugq.github.io/docs/subversiveld.pdf</a></li>

<li><a href="https://github.com/mgood7123/universal-dynamic-loader">universal-dynamic-loader</a> for Linux - "min-dl: minimal dynamic linker implementation"</li>
</ul>


<p>
Headers and libraries: 
</p>

<ul class="org-ul">
<li>Header:  #include &lt;dlfcn.h&gt;</li>
<li>Linking: (-ldl) flag</li>
</ul>

<p>
<span class="underline">Function dlopen()</span>:
</p>

<ul class="org-ul">
<li>Doc: $ man dlopen</li>
<li>Loads a shared library and returns a <span class="underline">handle</span> or <span class="underline">opaque pointer</span>
casted as void pointer. The term <span class="underline">opaque</span> means that the
implementation is hidden and the pointer is only meant to be
passed around to other functions.</li>
<li>Note: When this function fails, it returns null pointer.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">void</span>* <span class="org-function-name">dlopen</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">filename</span>, <span class="org-type">int</span> <span class="org-variable-name">flags</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<span class="underline">Function dlsym()</span>:
</p>

<ul class="org-ul">
<li>Doc: $ man dlsym</li>
<li>Obtains address of a shared library symbol from <span class="underline">handle</span> (from
dlopen).</li>
<li>Params:
<ul class="org-ul">
<li>handle =&gt; Shared library handle obtained from <span class="underline">dlopen</span></li>
<li>symbol  =&gt; Name of symbol to be loaded.</li>
</ul></li>
<li>Return:
<ul class="org-ul">
<li>Address of symbol casted as void*. It can be a function-pointer
or a pointer to global variable. If the symbol is not found, the
function returns a null pointer.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">void</span>* <span class="org-function-name">dlsym</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">handle</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">symbol</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<span class="underline">Function dlvsym()</span>:
</p>

<ul class="org-ul">
<li>Doc: $ man dlvsym
<ul class="org-ul">
<li>Loads a specific version of a symbol.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">void</span>* <span class="org-function-name">dlvsym</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span> *<span class="org-variable-name">handle</span>, <span class="org-type">char</span> *<span class="org-variable-name">symbol</span>, <span class="org-type">char</span> *<span class="org-variable-name">version</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<span class="underline">Function dlclose()</span>: 
</p>

<ul class="org-ul">
<li>Doc: $ man dlclose()</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">int</span> <span class="org-function-name">dlclose</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span> *<span class="org-variable-name">handle</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<span class="underline">Function dlerror()</span> 
</p>
<ul class="org-ul">
<li>Obtaines error messages from dlopen API.</li>
<li>Doc: $ man dlerror()</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">char</span>* <span class="org-function-name">dlerror</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>Simplified type signatures with a C++-friendly notation</b>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Opaque pointer for shared library (shared object) handle </span>
<span class="org-keyword">using</span> <span class="org-type">HND</span> = <span class="org-type">void</span>* ; 
<span class="org-comment-delimiter">// </span><span class="org-comment">Opaque pointer for shared library symbol </span>
<span class="org-keyword">using</span> <span class="org-type">SYM</span> = <span class="org-type">void</span>* ; 

<span class="org-type">HND</span>  <span class="org-function-name">dlopen</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">filename</span>, <span class="org-type">int</span> <span class="org-variable-name">flags</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">SYM</span>   <span class="org-function-name">dlsym</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">HND</span> <span class="org-variable-name">handle</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">symbol</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">SYM</span>  <span class="org-function-name">dlvsym</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">HND</span> <span class="org-variable-name">handle</span>, <span class="org-type">char</span> *<span class="org-variable-name">symbol</span>, <span class="org-type">char</span> *<span class="org-variable-name">version</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">int</span> <span class="org-function-name">dlclose</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">HND</span> <span class="org-variable-name">handle</span> <span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>Usage example</b> 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">dlfcn.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Opaque pointer for shared library (shared object) handle </span>
<span class="org-keyword">using</span> <span class="org-type">HND</span> = <span class="org-type">void</span>* ; 
<span class="org-comment-delimiter">// </span><span class="org-comment">Opaque pointer for shared library symbol </span>
<span class="org-keyword">using</span> <span class="org-type">SYM</span> = <span class="org-type">void</span>* ; 

<span class="org-type">void</span> <span class="org-function-name">load_library</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Load shared library </span>
    <span class="org-type">HND</span> <span class="org-variable-name">hnd</span> = dlopen<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"/path/to/shared-library.so"</span>, RTLD_LAZY | RTLD_GLOBAL<span class="org-rainbow-delimiters-depth-2">)</span>; 
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>hnd == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
       <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">"  [ERROR] "</span> &lt;&lt; dlerror<span class="org-rainbow-delimiters-depth-3">()</span> &lt;&lt; <span class="org-string">"\n"</span>;
       <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: unable to load shared library"</span><span class="org-rainbow-delimiters-depth-3">)</span>; 
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Load symbol </span>
    <span class="org-type">SYM</span> <span class="org-variable-name">hsym</span> = dlsym<span class="org-rainbow-delimiters-depth-2">(</span>hnd, <span class="org-string">"name_of_function"</span><span class="org-rainbow-delimiters-depth-2">)</span>; 

    <span class="org-comment-delimiter">// </span><span class="org-comment">if(!hsym)</span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>hsym == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
       <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Error: symbol not found"</span><span class="org-rainbow-delimiters-depth-3">)</span>; 
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Function signature type alias </span>
    <span class="org-comment-delimiter">//  </span><span class="org-comment">=&gt; The function to be loaded can only have C-linkage. </span>
    <span class="org-keyword">using</span> <span class="org-type">name_of_function_t</span> = <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">param0</span>, <span class="org-type">double</span> <span class="org-variable-name">param1</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">param3</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">//  </span><span class="org-comment">Function pointer. </span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">name_of_function_ptr</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">name_of_function_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hsym<span class="org-rainbow-delimiters-depth-2">)</span>; 

    <span class="org-comment-delimiter">// </span><span class="org-comment">Call loaded function </span>
    name_of_function_ptr<span class="org-rainbow-delimiters-depth-2">(</span>100, 2.51, <span class="org-string">"string"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Unload shared library </span>
    dlclose<span class="org-rainbow-delimiters-depth-2">(</span>hsym<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-org755eca3" class="outline-4">
<h4 id="org755eca3"><span class="section-number-4">1.5.2</span> GK3 GUI with dynamic linking</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
The following sample code is a GTk3 or GTK2 GUI graphical user
interface application with GTK functions loaded from a GTK shared
library, without any compile-time linking. The advantage of this
approach is the greater portability across different versions of GTk
and the ability to switch between GT3 and GT2.
</p>

<p>
GIST: 
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/d81dd9c422dc93ad4104b5e79259afdf">https://gist.github.com/d81dd9c422dc93ad4104b5e79259afdf</a></li>
</ul>

<p>
File: CMakeLists.txt 
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(gtk-sample)

<span class="org-comment">#========== Global Configurations =============#</span>
<span class="org-comment">#----------------------------------------------#</span>

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)     
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

       <span class="org-function-name">add_executable</span>( gtk-dlopen gtk-dlopen.cpp)
<span class="org-function-name">target_link_libraries</span>( gtk-dlopen dl )   
</pre>
</div>

<p>
File: gtk-dlopen.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cstring</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">cassert</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-comment-delimiter">// </span><span class="org-comment">Uses: dlopen(), dlclose(), ... </span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">dlfcn.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">---- Copied from GTK headers ------// </span>
<span class="org-keyword">typedef</span> <span class="org-type">char</span>            <span class="org-type">gchar</span>;
<span class="org-keyword">typedef</span> <span class="org-type">short</span>           <span class="org-type">gshort</span>;
<span class="org-keyword">typedef</span> <span class="org-type">long</span>            <span class="org-type">glong</span>;
<span class="org-keyword">typedef</span> <span class="org-type">int</span>             <span class="org-type">gint</span>;
<span class="org-keyword">typedef</span> <span class="org-type">gint</span>            <span class="org-type">gboolean</span>;
<span class="org-keyword">typedef</span> <span class="org-type">unsigned</span> <span class="org-type">char</span>   <span class="org-type">guchar</span>;
<span class="org-keyword">typedef</span> <span class="org-type">unsigned</span> <span class="org-type">short</span>  <span class="org-type">gushort</span>;
<span class="org-keyword">typedef</span> <span class="org-type">unsigned</span> <span class="org-type">long</span>   <span class="org-type">gulong</span>;
<span class="org-keyword">typedef</span> <span class="org-type">unsigned</span> <span class="org-type">int</span>    <span class="org-type">guint</span>;
<span class="org-keyword">typedef</span> <span class="org-type">float</span>           <span class="org-type">gfloat</span>;
<span class="org-keyword">typedef</span> <span class="org-type">double</span>          <span class="org-type">gdouble</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>*           <span class="org-type">gpointer</span>;
<span class="org-keyword">typedef</span> <span class="org-keyword">const</span> <span class="org-type">void</span>*     <span class="org-type">gconstpointer</span>;

<span class="org-keyword">enum</span> <span class="org-keyword">class</span> <span class="org-type">GtkWindowType</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-variable-name">GTK_WINDOW_TOPLEVEL</span>,
    <span class="org-variable-name">GTK_WINDOW_POPUP</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">enum</span> <span class="org-keyword">class</span> <span class="org-type">GConnectFlags</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-variable-name">G_CONNECT_AFTER</span>   = 1 &lt;&lt; 0,
  <span class="org-variable-name">G_CONNECT_SWAPPED</span> = 1 &lt;&lt; 1
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">TFun</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-type">TFun</span> <span class="org-function-name">load_symbol</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">hnd</span>, <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">symbol</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">void</span>* <span class="org-variable-name">hSym</span> = dlsym<span class="org-rainbow-delimiters-depth-2">(</span>hnd, symbol.c_str<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>hSym == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">msg</span> = <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">" [Error] symbol not found: "</span><span class="org-rainbow-delimiters-depth-3">)</span> + symbol;
        <span class="org-keyword">throw</span> <span class="org-constant">std</span>::runtime_error<span class="org-rainbow-delimiters-depth-3">(</span>msg<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>    
    <span class="org-keyword">return</span> <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">TFun</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hSym<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Opaque type (aka incomplete type)</span>
<span class="org-keyword">struct</span> <span class="org-type">GClosure</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">-------- Function Pointers type aliases -------------------//</span>
<span class="org-keyword">using</span> <span class="org-type">GCallback</span>      = <span class="org-type">void</span>  <span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">using</span> <span class="org-type">GClosureNotify</span> = <span class="org-type">void</span>  <span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">gpointer</span> <span class="org-variable-name">data</span>, <span class="org-type">GClosure</span>* <span class="org-variable-name">closure</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">using</span> <span class="org-type">g_signal_connect_data_t</span> =  gulong <span class="org-rainbow-delimiters-depth-1">(</span>*<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-rainbow-delimiters-depth-1">(</span>   <span class="org-type">gpointer</span> <span class="org-variable-name">instance</span>
                                                  , <span class="org-keyword">const</span> <span class="org-type">gchar</span>*    <span class="org-variable-name">detailed_signal</span>
                                                  , <span class="org-type">GCallback</span>       <span class="org-variable-name">c_handler</span>
                                                  , <span class="org-type">gpointer</span>        <span class="org-variable-name">data</span>
                                                  , <span class="org-type">GClosureNotify</span>  <span class="org-variable-name">destroy_data</span>
                                                  , <span class="org-type">GConnectFlags</span>   <span class="org-variable-name">connect_flags</span>
                                              <span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>    
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">shared_lib</span> =  <span class="org-rainbow-delimiters-depth-2">[</span>&amp;<span class="org-rainbow-delimiters-depth-2">]()</span> -&gt; <span class="org-constant">std</span>::string 
    <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span>argc &lt; 2<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-keyword">return</span> <span class="org-string">"/lib64/libgtk-3.so.0"</span>;
        <span class="org-keyword">return</span> argv<span class="org-rainbow-delimiters-depth-3">[</span>1<span class="org-rainbow-delimiters-depth-3">]</span>;
    <span class="org-rainbow-delimiters-depth-2">}()</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Loading shared library: "</span> &lt;&lt; shared_lib &lt;&lt; <span class="org-string">"\n"</span>;

    <span class="org-comment-delimiter">//  </span><span class="org-comment">void *dlopen(const char *filename, int flags);</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Handle to shared library </span>
    <span class="org-type">void</span>* <span class="org-variable-name">hnd</span> = dlopen<span class="org-rainbow-delimiters-depth-2">(</span>shared_lib.c_str<span class="org-rainbow-delimiters-depth-3">()</span>, RTLD_NOW | RTLD_GLOBAL<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>hnd == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">){</span> fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">"%s\n"</span>, dlerror<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>;  <span class="org-rainbow-delimiters-depth-2">}</span>
    assert<span class="org-rainbow-delimiters-depth-2">(</span> hnd != <span class="org-constant">nullptr</span> <span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">void</span>* <span class="org-variable-name">hSym</span> = <span class="org-constant">nullptr</span>; 

    <span class="org-comment-delimiter">// </span><span class="org-comment">--------- Load gtk_init_check function pointer ------- // </span>
    hSym = dlsym<span class="org-rainbow-delimiters-depth-2">(</span>hnd, <span class="org-string">"gtk_init_check"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    assert<span class="org-rainbow-delimiters-depth-2">(</span>hSym != <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">using</span> <span class="org-type">gtk_init_check_t</span> = gboolean <span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span>* <span class="org-variable-name">argc</span>, <span class="org-type">char</span>*** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_init_check</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">gtk_init_check_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hSym<span class="org-rainbow-delimiters-depth-2">)</span>;   

    <span class="org-comment-delimiter">// </span><span class="org-comment">------- Load remaining function pointers (symbols) --------// </span>
    <span class="org-comment-delimiter">//</span><span class="org-comment">-----------------------------------------------------------//</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">opaque pointer </span>
    <span class="org-keyword">struct</span> <span class="org-type">GtkWidget</span>;

    <span class="org-keyword">using</span> <span class="org-type">gkt_window_new_t</span> = GtkWidget* <span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_window_new</span>  = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">gkt_window_new_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_window_new"</span><span class="org-rainbow-delimiters-depth-2">)</span>;    
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_widget_show</span> = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">GtkWidget</span>*<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_widget_show"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_main</span>        = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_main"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">using</span> <span class="org-type">gtk_window_set_title_t</span> = <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">GtkWidget</span>* <span class="org-variable-name">window</span>, <span class="org-keyword">const</span> <span class="org-type">gchar</span>* <span class="org-variable-name">title</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_window_set_title</span> = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">gtk_window_set_title_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_window_set_title"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">using</span> <span class="org-type">gtk_widget_set_size_t</span> = <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">GtkWidget</span>*, gint, gint<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_widget_set_size</span> = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">gtk_widget_set_size_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_widget_set_size_request"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_main_quit</span> = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-3">(</span>*<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"gtk_main_quit"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">gtk_signal_connect_data</span> 
          = load_symbol<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">g_signal_connect_data_t</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>hnd, <span class="org-string">"g_signal_connect_data"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">/** </span><span class="org-comment">------- Build Window GUI - Graphical User Interface ----------**/</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Call function pointer </span>
    gtk_init_check<span class="org-rainbow-delimiters-depth-2">(</span>&amp;argc, &amp;argv<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">GtkWidget</span>* <span class="org-variable-name">window</span> = gtk_window_new<span class="org-rainbow-delimiters-depth-2">(</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-constant">GtkWindowType</span>::GTK_WINDOW_TOPLEVEL<span class="org-rainbow-delimiters-depth-2">)</span>;
    gtk_widget_set_size<span class="org-rainbow-delimiters-depth-2">(</span>window, 400, 500<span class="org-rainbow-delimiters-depth-2">)</span>;
    gtk_window_set_title<span class="org-rainbow-delimiters-depth-2">(</span>window, <span class="org-string">"My GTK Window"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    gtk_widget_show<span class="org-rainbow-delimiters-depth-2">(</span>window<span class="org-rainbow-delimiters-depth-2">)</span>;    

    gtk_signal_connect_data<span class="org-rainbow-delimiters-depth-2">(</span>  window         <span class="org-comment-delimiter">// </span><span class="org-comment">Widget </span>
                            , <span class="org-string">"destroy"</span>      <span class="org-comment-delimiter">// </span><span class="org-comment">Event name </span>
                            , gtk_main_quit  <span class="org-comment-delimiter">// </span><span class="org-comment">Callback                             </span>
                            , <span class="org-constant">nullptr</span>        <span class="org-comment-delimiter">// </span><span class="org-comment">Pointer to data (closure )</span>
                            , <span class="org-constant">nullptr</span> 
                            , <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">GConnectFlags</span><span class="org-rainbow-delimiters-depth-3">)</span> 0 <span class="org-comment-delimiter">// </span><span class="org-comment">GConnect flags </span>
                            <span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Window running. OK! "</span> &lt;&lt; <span class="org-string">"\n"</span>;
    gtk_main<span class="org-rainbow-delimiters-depth-2">()</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Always close shared library handler.</span>
    dlclose<span class="org-rainbow-delimiters-depth-2">(</span>hnd<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] Shutdown gracefully. Ok. \n"</span> ;
    <span class="org-keyword">return</span> EXIT_SUCCESS;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://gist.github.com/d81dd9c422dc93ad4104b5e79259afdf &amp;&amp; <span class="org-builtin">cd</span> gist 
$ g++ gtk-dlopen.cpp -o <span class="org-keyword">gtk-dlopen.bin</span> -std=c++1z -ldl -ggdb -Wall -Wextra   
</pre>
</div>

<p>
Checking the dependencies of gtk-dlopen.bin 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ldd gtk-dlopen.bin 
       linux-vdso.so.1 (0x00007ffd23fc4000)
       libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f6a78428000)
       libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007f6a78238000)
       libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f6a780f2000)
       libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f6a780d7000)
       libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f6a77f0d000)
       /lib64/ld-linux-x86-64.so.2 (0x00007f6a78453000)
</pre>
</div>

<p>
Running: (load GTK shared library /lib64/libgtk-3.so.0)
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ./gtk-dlopen.bin 
[INFO] Loading shared library: /lib64/libgtk-3.so.0
[INFO] Window running. OK! 
[INFO] Shutdown gracefully. Ok. 
</pre>
</div>

<p>
Running: (load GK2 shared library )
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; ./gtk-dlopen.bin /usr/lib64/libgtk-x11-2.0.so 
[INFO] Loading shared library: /usr/lib64/libgtk-x11-2.0.so
[INFO] Window running. OK! 
[INFO] Shutdown gracefully. Ok. 
</pre>
</div>

<p>
Verify exported symbols by gtk3 shared library: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ &gt;&gt; nm -D /lib64/libgtk-3.so.0 | grep init
       ... ... ... ... ..
       ... ... ... ... ..
       U g_async_initable_new_async
       U g_async_initable_new_finish
       U g_datalist_init
       U g_hash_table_iter_init
       U g_initable_get_type
       U g_initable_new
       U g_initially_unowned_get_type
       U g_mutex_init
       U g_once_init_enter
      ... ... ... ... ..
      ... ... ... ... ..
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2020-06-20 Sat 11:16</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
