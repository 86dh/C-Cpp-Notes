<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-12-09 Sun 15:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CPP / C++ Notes - Windows API Programming Win32</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="cpp/c++ code examples and demonstrations."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="theme/org-nav-theme.css" rel="stylesheet">
<script src="theme/org-nav-theme.js"></script>
<link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "%LINEBREAKS" },
                        webFont: "%FONT"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "%LINEBREAKS" },
              font: "%FONT"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "%AUTONUMBER"},
               MultLineWidth: "%MULTLINEWIDTH",
               TagSide: "%TAGSIDE",
               TagIndent: "%TAGINDENT"
             }
});
</script>
<script type="text/javascript"
        src="theme/MathJax/MathJax.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">CPP / C++ Notes - Windows API Programming Win32</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org67ad575">1. Windows API Programming Win32</a>
<ul>
<li><a href="#orgcdeec8f">1.1. Overview</a></li>
<li><a href="#org3787c6d">1.2. Idiosincrasies</a></li>
<li><a href="#org03a4589">1.3. Windows API Main Header Files</a></li>
<li><a href="#orgbf1a0c9">1.4. Windows API Runtime Libraries</a></li>
<li><a href="#orga6056bf">1.5. WinAPI C Data Types</a>
<ul>
<li><a href="#org4cc78bc">1.5.1. Hungarian Notation</a></li>
<li><a href="#org00a13b3">1.5.2. General Terminology</a></li>
<li><a href="#org120348d">1.5.3. Common Data Types</a></li>
<li><a href="#org3230cc3">1.5.4. Other data types</a></li>
<li><a href="#org6681f3f">1.5.5. References</a></li>
</ul>
</li>
<li><a href="#org209c5e9">1.6. SAL - Source Code Annotation Language</a></li>
<li><a href="#orgff1497c">1.7. Character Encoding in WinAPI - ANSI x utf8 x utf16 (wchar_t)</a>
<ul>
<li><a href="#orga392ae3">1.7.1. Overview</a></li>
<li><a href="#org4e85180">1.7.2. Example - ANSI X Unicode and Windows API</a></li>
<li><a href="#orgeb40a5d">1.7.3. Example - Using Windows API with UTF8</a></li>
<li><a href="#orgd9ae9b9">1.7.4. Example - Setting Console to UTF8</a></li>
</ul>
</li>
<li><a href="#org2a51fd7">1.8. CODE - Display information about current process</a></li>
<li><a href="#org028d1f5">1.9. CODE - List processes</a></li>
<li><a href="#orgd1f18fd">1.10. CODE - Show all DLLs or modules load by a process</a></li>
<li><a href="#orge5bd3d6">1.11. CODE - List directory files</a></li>
<li><a href="#org583b667">1.12. Install Building Tools and Compilers</a>
<ul>
<li><a href="#org1ef7aaa">1.12.1. Install Mingw</a></li>
<li><a href="#org5dab771">1.12.2. Install Visual Studio + Microsft MSVC C++ Compiler</a></li>
<li><a href="#org29ed73c">1.12.3. Install CMDER Terminal Emulator</a></li>
<li><a href="#org924d976">1.12.4. Install SysInternals</a></li>
<li><a href="#orge415c8b">1.12.5. Install IDA Free Disassembler</a></li>
<li><a href="#org94f3ab1">1.12.6. ILSpy - Dissabler for C#</a></li>
</ul>
</li>
<li><a href="#org181d73e">1.13. MSVC Compiler Options</a></li>
<li><a href="#org27ced20">1.14. WINAPI Map</a>
<ul>
<li><a href="#org39ce0d8">1.14.1. Misc.</a></li>
<li><a href="#org86aa4bd">1.14.2. File</a></li>
<li><a href="#orgfbb8750">1.14.3. Process Information</a></li>
<li><a href="#org7360cfe">1.14.4. Process Manipulation</a></li>
<li><a href="#org9840878">1.14.5. Dynamic Linking or Runtime Linking</a></li>
</ul>
</li>
<li><a href="#org8e3a986">1.15. Books</a></li>
</ul>
</li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><a href='index.html'>Index</a></li>
</ul>

<div id="outline-container-org67ad575" class="outline-2">
<h2 id="org67ad575"><span class="section-number-2">1</span> Windows API Programming Win32</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgcdeec8f" class="outline-3">
<h3 id="orgcdeec8f"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The Windows API is very low level and obviously-Windows only,
therefore it makes sense in most of cases to take advantage of higher
libraries which encapsulates this API in a C++-friendly. Some of those
libraries are: 
</p>

<p>
Windows Only by Microsft: 
</p>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/cpp/mfc/mfc-and-atl?view=vs-2017">MFC</a> - Microsoft Foundation Classes</li>
<li><a href="https://docs.microsoft.com/en-us/cpp/atl/atl-com-desktop-components?view=vs-2017">ATL</a> - Active Template Library</li>
</ul>

<p>
Windows Only - Third party.
</p>

<ul class="org-ul">
<li><a href="http://win32-framework.sourceforge.net/">Win32++</a> - "Win32++ is a C++ library used to build windows
applications. Win32++ is a free alternative to MFC. It has the
added advantage of being able to run on a wide range of free
compilers, including Visual Studio Community, and the MinGW
compiler provided with CodeBlocks and Dev-C++."</li>
</ul>

<p>
Cross-Platform: 
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Qt_(software)">QT Framework</a> - QT is not only a cross platform GUI library, it
also provides all sort of cross platform libraries for databases,
sockets, text parsing, OpenGL, XML and so on. 
<ul class="org-ul">
<li>Supported on: Windows, MacOSX, Linux, Android, iOS and many other
operating systems.</li>
</ul></li>

<li><a href="https://en.wikipedia.org/wiki/WxWidgets">wxWidgets</a> - Just a well known GUI library.
<ul class="org-ul">
<li>Supported on: Windows, Linux, OSX.</li>
</ul></li>

<li><a href="https://pocoproject.org/docs/">Poco - Framework</a> - A collection of cross-platform libraries
for network: HTTP protocol, FTP, ICMP; database access - SQLite,
MySQL, ODBC and MongoDB; Standardized human-readable data exchange
formats - JSON  and XML; Zip compression; SSL and crypto utils.
<ul class="org-ul">
<li>See: <a href="https://en.wikipedia.org/wiki/POCO_C++_Libraries">POCO C++ Libraries - Wikipedia</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org3787c6d" class="outline-3">
<h3 id="org3787c6d"><span class="section-number-3">1.2</span> Idiosincrasies</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>Hungarian Notation</li>

<li>Non standard types:
<ul class="org-ul">
<li>LPSTRING, WORD, DWORD, BOOL, LPVOID &#x2026;</li>
</ul></li>

<li>Paths: Unlike in U*nix-like operating systems which are written
with (/) forward slash, in Windows paths  are written with
backward slash (\) needs to be escaped with double backward slash (\\)
since is slash is used for escape characters such as CR <code>\n</code>, <code>\s</code> and
so on. Thus, a Windows path such as <code>"C:\Users\sombody\file.exe"</code> must be
written as "C:\\Users\\sombody\\file.exe".</li>

<li>Different Calling Conventions in the same OS: 
<ul class="org-ul">
<li><code>__stdcall</code></li>
<li><code>__cdecl</code></li>
<li><code>__fastcall</code></li>
</ul></li>

<li>Characters - ANSI X Unicode in API. 
<ul class="org-ul">
<li>Windows API uses 16-bits Unicode wide characters (wchar_t) instead
of 8 bits Unicode UTF-8 which is common in most modern Unix-like
Oses such as Linux, BSD and MacOSX.</li>

<li>Windows API functions generally has two versions, an ANSI
version with suffix 'A' and a wide unicode version with suffix
'W'. For instance the API <span class="underline">CreateDirectory</span>, has an ANSI version (which uses char)
and does not work with UTF8 characteres such as 'ã', 'õ', 'ç', '
我', 'Ж' and so on. And an wide unicode version using wide
character (wchar_t) CreateDirectoryW.</li>
</ul></li>

<li>Many string types</li>

<li>Many C-runtimes and entry points.</li>

<li>Functions has many parameters which makes them pretty complex. The
only way to understand the API is to compile and run small
specific examples.</li>

<li>Not all system calls are documented like open source OSes such as
Linux or BSD.</li>
</ul>
</div>
</div>

<div id="outline-container-org03a4589" class="outline-3">
<h3 id="org03a4589"><span class="section-number-3">1.3</span> Windows API Main Header Files</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Most used headers: 
</p>

<ul class="org-ul">
<li>#include &lt;windows.h&gt;</li>
<li>#include &lt;wchar.h&gt; - Wide Characters - UTF16 chars</li>
<li>#include &lt;tchar.h&gt;</li>
<li>#include &lt;global.h&gt;</li>
<li>#include &lt;nsfbd.h&gt;</li>
</ul>

<p>
Other useful header files: 
</p>

<ul class="org-ul">
<li>windows.h
<ul class="org-ul">
<li>Basic header file of Windows API</li>
</ul></li>
<li>WinError.h
<ul class="org-ul">
<li>Error codes and strings</li>
</ul></li>
<li>tchar.h
<ul class="org-ul">
<li>Provides the macro _T(&#x2026;) and TEXT(&#x2026;) for Unicode/ANSI string
encoding handling.</li>
</ul></li>
<li>wchar.h
<ul class="org-ul">
<li>Wide Character - UTF16 or wchar</li>
</ul></li>
<li>global.h</li>
<li>ntfsb.h</li>
<li>Winsock2.h
<ul class="org-ul">
<li>Network sockets</li>
</ul></li>
<li>Winbase.h
<ul class="org-ul">
<li>Windows types definitions</li>
</ul></li>
<li>WinUser.h
<ul class="org-ul">
<li>Windows Messages</li>
</ul></li>
<li>ShellAPI.h
<ul class="org-ul">
<li>Shell API</li>
</ul></li>
<li>ShFolder.h
<ul class="org-ul">
<li>Folder definitions</li>
</ul></li>
<li>Commdlg.h
<ul class="org-ul">
<li>Commom Controls (COM based)</li>
</ul></li>
<li>Dlgs.h
<ul class="org-ul">
<li>Dialog definitions</li>
</ul></li>
<li>IUnknown.h
<ul class="org-ul">
<li>COM header</li>
</ul></li>
<li>conio.h
<ul class="org-ul">
<li>Console Input/Output functions - it is heritage grom MSDOS.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgbf1a0c9" class="outline-3">
<h3 id="orgbf1a0c9"><span class="section-number-3">1.4</span> Windows API Runtime Libraries</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>kernel32.dll
<ul class="org-ul">
<li>Low level NTDLL wrappers.</li>
</ul></li>
<li>user32.dll
<ul class="org-ul">
<li>User interface primitives used by graphical programs with menus,
toolboxes, prompts, windows ..</li>
</ul></li>
<li>shell.dll
<ul class="org-ul">
<li></li>
</ul></li>
<li>gdi32.dll
<ul class="org-ul">
<li>Basic drawing primitives.</li>
</ul></li>
<li>ole32.dll</li>
<li>MSVCRT.DLL
<ul class="org-ul">
<li>Implementation of the C standard library stdlib.</li>
</ul></li>
<li>advapi.dll
<ul class="org-ul">
<li>Contains functions for system-related tasks such as registry and
registry handling.</li>
</ul></li>
<li><code>WS_32.DLL</code>
<ul class="org-ul">
<li>Winsock2 library contains a socket implementation.</li>
</ul></li>
<li>Ntdll.dll
<ul class="org-ul">
<li>Interface to Kernel. Not used by Windows programs directly.</li>
</ul></li>
<li>Wininet.dll
<ul class="org-ul">
<li>Provides high level network APIs, for instance, HttpOpenRequest,
FtpGetFile &#x2026;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orga6056bf" class="outline-3">
<h3 id="orga6056bf"><span class="section-number-3">1.5</span> WinAPI C Data Types</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org4cc78bc" class="outline-4">
<h4 id="org4cc78bc"><span class="section-number-4">1.5.1</span> Hungarian Notation</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
Windows API uses the Hungarian notation which was intruduced by
Charles Simonyi at Microsoft and Xerox PARC. This notation uses a
prefix to denote the variable type.
</p>

<p>
Notes and remarks:
</p>

<ul class="org-ul">
<li>Many sources advises against this notation and nowadays many IDEs
can provide a variable type by just hovering the mouse over it.</li>

<li>Understanding the notation can help to reason about the Windows
API.</li>

<li>The HN notation is not standardized.</li>
</ul>

<p>
Form: 
</p>

<div class="org-src-container">
<pre class="src src-text">TYPE-PREFIX + NAME + QUALIFIER 
</pre>
</div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Prefix</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">Variable Name Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">b</td>
<td class="org-left">BYTE or BOOL</td>
<td class="org-left">boolean</td>
<td class="org-left">BOOL bFlag; BOOL bIsOnFocus</td>
</tr>

<tr>
<td class="org-left">c</td>
<td class="org-left">char</td>
<td class="org-left">Character - 1 byte</td>
<td class="org-left">char cLetter</td>
</tr>

<tr>
<td class="org-left">w</td>
<td class="org-left">WORD</td>
<td class="org-left">word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">dw</td>
<td class="org-left">DWORD</td>
<td class="org-left">double word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">i</td>
<td class="org-left">int</td>
<td class="org-left">integer</td>
<td class="org-left">int iNumberOfNodes</td>
</tr>

<tr>
<td class="org-left">u32</td>
<td class="org-left">unsigned [int]</td>
<td class="org-left">unsigned integer</td>
<td class="org-left">unsigned u32Nodes</td>
</tr>

<tr>
<td class="org-left">f or fp</td>
<td class="org-left">float</td>
<td class="org-left">float point - single precision</td>
<td class="org-left">fInterestRate</td>
</tr>

<tr>
<td class="org-left">d</td>
<td class="org-left">double</td>
<td class="org-left">float point - double precision</td>
<td class="org-left">dRateOfReturn</td>
</tr>

<tr>
<td class="org-left">n</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">short int</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sz</td>
<td class="org-left">char* or const char*</td>
<td class="org-left">Pointer to null terminated char array.</td>
<td class="org-left">char* szButtonLabel</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">H</td>
<td class="org-left">HANDLE</td>
<td class="org-left">Handle</td>
<td class="org-left">HANDLE hModule; HMODULE hInstance;</td>
</tr>

<tr>
<td class="org-left">p</td>
<td class="org-left">-</td>
<td class="org-left">Pointer</td>
<td class="org-left">double* pdwMyPointer;</td>
</tr>

<tr>
<td class="org-left">lp</td>
<td class="org-left">-</td>
<td class="org-left">Long Pointer</td>
<td class="org-left">int* lpiPointer;</td>
</tr>

<tr>
<td class="org-left">fn</td>
<td class="org-left">-</td>
<td class="org-left">Function pointer</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">lpsz</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Long Pointer</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LP</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Long Pointer</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">I</td>
<td class="org-left">-</td>
<td class="org-left">Interface (C++ interface class)</td>
<td class="org-left">class IDrawable &#x2026;</td>
</tr>

<tr>
<td class="org-left">S</td>
<td class="org-left">-</td>
<td class="org-left">Struct declaration</td>
<td class="org-left">struct SContext { &#x2026; }</td>
</tr>

<tr>
<td class="org-left">C</td>
<td class="org-left">-</td>
<td class="org-left">Class declaration</td>
<td class="org-left">class CUserData{ &#x2026; }</td>
</tr>

<tr>
<td class="org-left">m_</td>
<td class="org-left">-</td>
<td class="org-left">Private member variable name of some class</td>
<td class="org-left">m_pszFileName</td>
</tr>

<tr>
<td class="org-left">s_</td>
<td class="org-left">-</td>
<td class="org-left">Static member of a class</td>
<td class="org-left">static int s_iObjectCount</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Examples in Windows API - Function Create Process:
</p>

<div class="org-src-container">
<pre class="src src-cpp">BOOL <span class="org-type">WINAPI</span> <span class="org-function-name">CreateProcess</span><span class="org-rainbow-delimiters-depth-1">(</span>
  _In_opt_    <span class="org-type">LPCTSTR</span>               <span class="org-variable-name">lpApplicationName</span>,      <span class="org-comment-delimiter">// </span><span class="org-comment">const char*</span>
  _Inout_opt_ <span class="org-type">LPTSTR</span>                <span class="org-variable-name">lpCommandLine</span>,          <span class="org-comment-delimiter">// </span><span class="org-comment">char*</span>
  _In_opt_    <span class="org-type">LPSECURITY_ATTRIBUTES</span> <span class="org-variable-name">lpProcessAttributes</span>,
  _In_opt_    <span class="org-type">LPSECURITY_ATTRIBUTES</span> <span class="org-variable-name">lpThreadAttributes</span>,     <span class="org-comment-delimiter">// </span>
  _In_        <span class="org-type">BOOL</span>                  <span class="org-variable-name">bInheritHandles</span>,
  _In_        <span class="org-type">DWORD</span>                 <span class="org-variable-name">dwCreationFlags</span>,
  _In_opt_    <span class="org-type">LPVOID</span>                <span class="org-variable-name">lpEnvironment</span>,
  _In_opt_    <span class="org-type">LPCTSTR</span>               <span class="org-variable-name">lpCurrentDirectory</span>,
  _In_        <span class="org-type">LPSTARTUPINFO</span>         <span class="org-variable-name">lpStartupInfo</span>,
  _Out_       <span class="org-type">LPPROCESS_INFORMATION</span> <span class="org-variable-name">lpProcessInformation</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li>dwCreationFlags =&gt; (dw) prefix Indicates that the variable is a
DWORD (int)</li>

<li>lpEnvironment =&gt; (lp - Long Pointer) Indicates that variable is a
void pointer =&gt; (LPVOID = void* )</li>

<li>lpApplicationName =&gt; Indicates that the variable is a pointer to
char or (LPCSTR = const char*)</li>
</ul>


<p>
Furthere Reading: 
</p>

<ul class="org-ul">
<li><b>Coding Conventions: The Hungarian Notation</b>
<ul class="org-ul">
<li><a href="http://cws.cengage.co.uk/rautenbach/students/ancillary_content/hungarian_notation.pdf">http://cws.cengage.co.uk/rautenbach/students/ancillary_content/hungarian_notation.pdf</a></li>
</ul></li>

<li><b>Why I prefer to use the Hungarian Notation</b>
<ul class="org-ul">
<li><a href="https://tommcfarlin.com/hungarian-notation/">https://tommcfarlin.com/hungarian-notation/</a></li>
</ul></li>

<li>Hungarian Notation
<ul class="org-ul">
<li><a href="https://www.reactos.org/wiki/Hungarian_Notation">https://www.reactos.org/wiki/Hungarian_Notation</a></li>
</ul></li>

<li><a href="https://jakewharton.com/just-say-no-to-hungarian-notation/">Just Say mNo to Hungarian Notation - Jake Wharton</a></li>

<li><a href="http://wiki.c2.com/?HungarianNotation">Hungarian Notation</a></li>

<li>Hungarian Notation
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Hungarian_notation">https://en.wikipedia.org/wiki/Hungarian_notation</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org00a13b3" class="outline-4">
<h4 id="org00a13b3"><span class="section-number-4">1.5.2</span> General Terminology</h4>
<div class="outline-text-4" id="text-1-5-2">
<ul class="org-ul">
<li><span class="underline">Handle</span> - Is a unsigned integer number assigned to processes,
windows, buttons, resources and etc. Actually, it is an opaque
pointer to some system data structure (Kernel Object), similar to
Unix's file descriptor pointer. The purpose of using handles or
opaque pointer is to hide the implementation of those data
structures allowing implementators to change their inner working
without disrupting application developers. This approach gives a
pseudo object-oriented interface to the Windows API. See also:

<ul class="org-ul">
<li><span class="underline">Note</span>: A handle can be an <span class="underline">obfuscated pointer</span> exposed as an
integer, void pointer void* (also opaque pointer) or ordinary
opaque pointer (pointer to a C-struct or class which
implementation is not exposed).</li>
</ul></li>

<li><span class="underline">Types of Kernel Objects</span> (Handle is a numeric value related to the
pointer to kernel object C-struct). The name "object" comes from
the idea that it is possible to access the kernel data structure
pointer by the handle using the Win32 API functions. It works in a
similar way to classical object oriented programming where the data
structure and internal representation can only be accessed by the
class methodos. 
<ul class="org-ul">
<li>Symbolic Link</li>
<li>Process
<ul class="org-ul">
<li>A running program, executable. A process has its own address
space, data, stack and heap.</li>
</ul></li>
<li>Job
<ul class="org-ul">
<li>Group of processes managed as group.</li>
</ul></li>
<li>File
<ul class="org-ul">
<li>Open file or I/O device.</li>
</ul></li>
<li>Token
<ul class="org-ul">
<li>Security token used by many Win32 functions.</li>
</ul></li>
<li>Event
<ul class="org-ul">
<li>Synchronization object used for notification.</li>
</ul></li>
<li>Threads
<ul class="org-ul">
<li>Smallest unit of execution within a process.</li>
</ul></li>
<li>Semaphore</li>
<li>Mutex</li>
<li>Timer
<ul class="org-ul">
<li>Object which provides notification after a certain period is
elapsed.</li>
</ul></li>
</ul></li>
</ul>

<p>
References:
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Opaque_pointer">Opaque pointer - Wikipedia</a> - Note: Opaque pointer is also called
"handle classes", "pimpl idiom", "Compiler-firewall", "d-pointer" in C++.</li>
<li><a href="https://en.wikipedia.org/wiki/Handle_(computing)">Handle (computing) - Wikipedia</a></li>
<li><a href="https://stackoverflow.com/questions/2334966/win32-application-arent-so-object-oriented-and-why-there-are-so-many-pointers">c++ - win32 application aren't so object oriented and why there are so many pointers? - Stack Overflow</a></li>
<li><a href="https://dmitryfrank.com/articles/oop_in_c">Object-oriented techniques in C Dmitry Frank</a></li>
<li><a href="https://lwn.net/Articles/444910/">Object-oriented design patterns in the kernel, part 1 </a></li>
</ul>
</div>
</div>
<div id="outline-container-org120348d" class="outline-4">
<h4 id="org120348d"><span class="section-number-4">1.5.3</span> Common Data Types</h4>
<div class="outline-text-4" id="text-1-5-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Data Type</th>
<th scope="col" class="org-left">Definition</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">BOOL</td>
<td class="org-left">typedef int BOOL</td>
<td class="org-left">Boolean variable true (non zero) or false (zero or 0)</td>
</tr>

<tr>
<td class="org-left">BYTE</td>
<td class="org-left">typedef unsigned char BYTE</td>
<td class="org-left">A byte, 8 bits.</td>
</tr>

<tr>
<td class="org-left">CCHAR</td>
<td class="org-left">typedef char CHAR</td>
<td class="org-left">An 8-bit Windows (ANSI) character.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DWORD</td>
<td class="org-left">typedef unsigned long DWORD</td>
<td class="org-left">A 32-bit unsigned integer. The range is 0 through 4294967295 decimal.</td>
</tr>

<tr>
<td class="org-left">DWORDLONG</td>
<td class="org-left">typedef unsigned __int64 DWORDLONG</td>
<td class="org-left">64 bits usigned int.</td>
</tr>

<tr>
<td class="org-left">DWORD32</td>
<td class="org-left">typedef unsigned int DWORD32</td>
<td class="org-left">A 32-bit unsigned integer.</td>
</tr>

<tr>
<td class="org-left">DWORD64</td>
<td class="org-left">typedef unsigned __int64 DWORD64</td>
<td class="org-left">A 64-bit unsigned integer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">FLOAT</td>
<td class="org-left">typedef float FLOAT</td>
<td class="org-left">A floating-point variable.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">INT8</td>
<td class="org-left">typedef signed char INT8</td>
<td class="org-left">An 8-bit signed integer.</td>
</tr>

<tr>
<td class="org-left">INT16</td>
<td class="org-left">typedef signed short INT16</td>
<td class="org-left">A 16-bit signed integer.</td>
</tr>

<tr>
<td class="org-left">INT32</td>
<td class="org-left">typedef signed int INT32</td>
<td class="org-left">A 32-bit signed integer. The range is -2147483648 through 2147483647 decimal.</td>
</tr>

<tr>
<td class="org-left">INT64</td>
<td class="org-left">typedef signed __int64 INT64</td>
<td class="org-left">A 64-bit signed integer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPBOOL</td>
<td class="org-left">typedef BOOL far *LPBOOL;</td>
<td class="org-left">A pointer to a BOOL.</td>
</tr>

<tr>
<td class="org-left">LPBYTE</td>
<td class="org-left">typedef BYTE far *LPBYTE</td>
<td class="org-left">A pointer to a BYTE.</td>
</tr>

<tr>
<td class="org-left">LPCSTR, PCSTR</td>
<td class="org-left">typedef __nullterminated CONST CHAR *LPCSTR</td>
<td class="org-left">pointer to a constant null-terminated string of 8-bit Windows (ANSI) characters.</td>
</tr>

<tr>
<td class="org-left">LPCVOID</td>
<td class="org-left">typedef CONST void *LPCVOID;</td>
<td class="org-left">A pointer to a constant of any type.</td>
</tr>

<tr>
<td class="org-left">LPCWSTR, PCWSTR</td>
<td class="org-left">typedef CONST WCHAR *LPCWSTR;</td>
<td class="org-left">A pointer to a constant null-terminated string of 16-bit Unicode characters.</td>
</tr>

<tr>
<td class="org-left">LPDWORD</td>
<td class="org-left">typedef DWORD *LPDWORD</td>
<td class="org-left">A pointer to a DWORD.</td>
</tr>

<tr>
<td class="org-left">LPSTR</td>
<td class="org-left">typedef CHAR *LPSTR;</td>
<td class="org-left">A pointer to a null-terminated string of 8-bit Windows (ANSI) characters.</td>
</tr>

<tr>
<td class="org-left">LPTSTR</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">An LPWSTR if UNICODE is defined, an LPSTR otherwise.</td>
</tr>

<tr>
<td class="org-left">LPWSTR</td>
<td class="org-left">typedef WCHAR *LPWSTR;</td>
<td class="org-left">A pointer to a null-terminated string of 16-bit Unicode characters.</td>
</tr>

<tr>
<td class="org-left">PCHAR</td>
<td class="org-left">typedef CHAR *PCHAR;</td>
<td class="org-left">A pointer to a CHAR.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CHAR</td>
<td class="org-left">ANSI Char or char</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">WCHAR</td>
<td class="org-left">Wide character 16 bits UTF16</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">TCHAR</td>
<td class="org-left">-</td>
<td class="org-left">A WCHAR if UNICODE is defined, a CHAR otherwise.</td>
</tr>

<tr>
<td class="org-left">UCHAR</td>
<td class="org-left">typedef unsigned char UCHAR;</td>
<td class="org-left">An unsigned CHAR.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">WPARAM</td>
<td class="org-left">typedef UINT_PTR WPARAM;</td>
<td class="org-left">A message parameter.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org3230cc3" class="outline-4">
<h4 id="org3230cc3"><span class="section-number-4">1.5.4</span> Other data types</h4>
<div class="outline-text-4" id="text-1-5-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HANDLE</td>
<td class="org-left">32 bits integer used as a handle</td>
</tr>

<tr>
<td class="org-left">HDC</td>
<td class="org-left">Handle to device context</td>
</tr>

<tr>
<td class="org-left">HWND</td>
<td class="org-left">32-bit unsigned integer used as handle to a window</td>
</tr>

<tr>
<td class="org-left">LONG</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPARAM</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPSTR</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPVOID</td>
<td class="org-left">Generic pointer similar to void*</td>
</tr>

<tr>
<td class="org-left">LRESULT</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UINT</td>
<td class="org-left">Unsigned integer</td>
</tr>

<tr>
<td class="org-left">WCHAR</td>
<td class="org-left">16-bit Unicode character or Wide-Character</td>
</tr>

<tr>
<td class="org-left">WPARAM</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HINSTANCE</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6681f3f" class="outline-4">
<h4 id="org6681f3f"><span class="section-number-4">1.5.5</span> References</h4>
<div class="outline-text-4" id="text-1-5-5">
<p>
General:
</p>

<ul class="org-ul">
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751(v=vs.85).aspx">Windows Data Types (Windows)</a></li>

<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd374131(v=vs.85).aspx">Windows Data Types for Strings (Windows)</a></li>
</ul>

<p>
Windows Programming:
</p>

<ul class="org-ul">
<li><a href="http://www.tenouk.com/ModuleC.html">The Windows OS Win32 programming tutorial: notes, references and C/Win32 program examples on data type, system error, notation, handles and objects</a></li>

<li><a href="https://scs.senecac.on.ca/~chris.szalwinski/archives/gam666.073/content/windo.html">Seneca | Computer Studies | Introduction to Game Programming</a></li>

<li><a href="https://www.codeproject.com/Articles/3004/The-Complete-Guide-to-C-Strings-Part-II-String-Wra">The Complete Guide to C++ Strings, Part II - String Wrapper Classes - CodeProject</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org209c5e9" class="outline-3">
<h3 id="org209c5e9"><span class="section-number-3">1.6</span> SAL - Source Code Annotation Language</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Annotation such as <code>__In__</code> or <code>__Out__</code> commonly found on Windows API
documetation, as shown in the code below, is called <span class="underline">SAL - Source Code</span>
<span class="underline">Annotation language</span>. In a C code, it is hard to figure out which
parameters are used to return values or are read-only used only as
input. The SAL solves this problem by declaring which function
parameters are input, read-only and which parameters are output.
</p>

<blockquote>
<p>
SAL is the Microsoft source code annotation language.  By using source
code annotations, you can make the intent behind your code
explicit. These annotations also enable automated static analysis
tools to analyze your code more accurately, with significantly fewer
false positives and false negatives.
</p>
</blockquote>

<p>
&#x2013; <a href="http://msdn.microsoft.com/en-us/library/hh916383.aspx">http://msdn.microsoft.com/en-us/library/hh916383.aspx</a>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">HANDLE</span> <span class="org-function-name">CreateRemoteThreadEx</span><span class="org-rainbow-delimiters-depth-1">(</span>
  __in__ <span class="org-type">HANDLE</span>                       <span class="org-variable-name">hProcess</span>,
  __in__ <span class="org-type">LPSECURITY_ATTRIBUTES</span>        <span class="org-variable-name">lpThreadAttributes</span>,
  __in__ <span class="org-type">SIZE_T</span>                       <span class="org-variable-name">dwStackSize</span>,
  __in__ <span class="org-type">LPTHREAD_START_ROUTINE</span>       <span class="org-variable-name">lpStartAddress</span>,
  __in__ <span class="org-type">LPVOID</span>                       <span class="org-variable-name">lpParameter</span>,
  __in__ <span class="org-type">DWORD</span>                        <span class="org-variable-name">dwCreationFlags</span>,
  __in__ <span class="org-type">LPPROC_THREAD_ATTRIBUTE_LIST</span> <span class="org-variable-name">lpAttributeList</span>,
  __out__ <span class="org-type">LPDWORD</span>                     <span class="org-variable-name">lpThreadId</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">DWORD</span> <span class="org-type">WINAPI</span> <span class="org-function-name">FormatMessage</span><span class="org-rainbow-delimiters-depth-1">(</span>
   _In_     <span class="org-type">DWORD</span> <span class="org-variable-name">dwFlags</span>,
   _In_opt_ <span class="org-type">LPCVOID</span> <span class="org-variable-name">lpSource</span>,
   _In_     <span class="org-type">DWORD</span> <span class="org-variable-name">dwMessageId</span>,
   _In_     <span class="org-type">DWORD</span> <span class="org-variable-name">dwLanguageId</span>,
   _Out_    <span class="org-type">LPTSTR</span> <span class="org-variable-name">lpBuffer</span>,
   _In_     <span class="org-type">DWORD</span> <span class="org-variable-name">nSize</span>,
   _In_opt_ <span class="org-type">va_list</span> *<span class="org-variable-name">Arguments</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

</pre>
</div>

<p>
To allow those annotations in the source code, it is necessary to add
the header <span class="underline">#include &lt;sal.h&gt;</span>. This SAL annotation is not standard among
C++ compilers and is not defined by any C or C++ standard, as a
result, the annotations only works on MSVC - Microsoft Visual C++
Compiler. This feature can be implemented in a portable way with
macros.
</p>

<p>
SAL Fundamentals: 
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">SAL Annotatio</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>_In_</code></td>
<td class="org-left">Input parameter - read only argument no modified inside the by the function.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Generally has the const qualifier such as const char*.</td>
</tr>

<tr>
<td class="org-left"><code>_In_Out_</code></td>
<td class="org-left">Optional input parameter, can be ignored by passing a null pointer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>_Out_</code></td>
<td class="org-left">Output paramenter - Argument is written by the called function. It is generally a pointer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>_Out_opt_</code></td>
<td class="org-left">Optional output parameter. Can be ignored by setting it to null pointer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>_Inout_</code></td>
<td class="org-left">Data is passed to the function and pontentially modified.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>_Outptr_</code></td>
<td class="org-left">Output to caller. The value returned by written to the parameter is pointer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left"><code>_Outptr_opt_</code></td>
<td class="org-left">Optional output pointer to caller, can be ignored by passing NULL pointer.</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Note: if the parameter is not annotated with <code>_opt_</code> the caller is not
supposed to pass a NULL pointer, otherwise the parameter must be
annotated with <code>_In_opt_</code>, <code>_Out_opt_</code> and etc.
</p>

<p>
Usage example: 
</p>

<ul class="org-ul">
<li>This annotation enhances the readability by telling reader which
parameters are input and which parameters are output or used for
returning values.</li>
</ul>

<p>
File: sal1.cpp 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sal.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>     <span class="org-comment-delimiter">// </span><span class="org-comment">Microsft's Source Code Annotation Language </span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Computes elementwise product of two vectors </span>
<span class="org-type">void</span> <span class="org-function-name">vector_element_product</span><span class="org-rainbow-delimiters-depth-1">(</span>
      _In_ <span class="org-type">size_t</span> <span class="org-variable-name">size</span>,
      <span class="org-type">_In_</span> <span class="org-keyword">const</span> <span class="org-type">double</span> xs<span class="org-rainbow-delimiters-depth-2">[]</span>,
      <span class="org-type">_In_</span> <span class="org-keyword">const</span> <span class="org-type">double</span> ys<span class="org-rainbow-delimiters-depth-2">[]</span>,
      _Out_      <span class="org-type">double</span> <span class="org-variable-name">zs</span><span class="org-rainbow-delimiters-depth-2">[]</span>
      <span class="org-rainbow-delimiters-depth-1">){</span>
      <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; size; i++<span class="org-rainbow-delimiters-depth-2">){</span>
          zs<span class="org-rainbow-delimiters-depth-3">[</span>i<span class="org-rainbow-delimiters-depth-3">]</span> = xs<span class="org-rainbow-delimiters-depth-3">[</span>i<span class="org-rainbow-delimiters-depth-3">]</span> * ys<span class="org-rainbow-delimiters-depth-3">[</span>i<span class="org-rainbow-delimiters-depth-3">]</span>;
      <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">showArray</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">size_t</span> <span class="org-variable-name">size</span>, <span class="org-type">double</span> <span class="org-variable-name">xs</span><span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">){</span>
  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"("</span> &lt;&lt; size &lt;&lt; <span class="org-string">")[ "</span>;
  <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; size; i++<span class="org-rainbow-delimiters-depth-2">){</span>
    <span class="org-constant">std</span>::cout &lt;&lt; xs<span class="org-rainbow-delimiters-depth-3">[</span>i<span class="org-rainbow-delimiters-depth-3">]</span> &lt;&lt; <span class="org-string">" "</span>;
  <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"] "</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(){</span>
  <span class="org-type">double</span> <span class="org-variable-name">xs</span> <span class="org-rainbow-delimiters-depth-2">[]</span> = <span class="org-rainbow-delimiters-depth-2">{</span>4, 5, 6, 10<span class="org-rainbow-delimiters-depth-2">}</span>;
  <span class="org-type">double</span> <span class="org-variable-name">ys</span> <span class="org-rainbow-delimiters-depth-2">[]</span> = <span class="org-rainbow-delimiters-depth-2">{</span>4, 10, 5, 25<span class="org-rainbow-delimiters-depth-2">}</span>;
  <span class="org-type">double</span> <span class="org-variable-name">zs</span> <span class="org-rainbow-delimiters-depth-2">[</span>4<span class="org-rainbow-delimiters-depth-2">]</span>;
  vector_element_product<span class="org-rainbow-delimiters-depth-2">(</span>4, xs, ys, zs<span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"xs = "</span>; showArray<span class="org-rainbow-delimiters-depth-2">(</span>4, xs<span class="org-rainbow-delimiters-depth-2">)</span>; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n"</span>;
  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"ys = "</span>; showArray<span class="org-rainbow-delimiters-depth-2">(</span>4, ys<span class="org-rainbow-delimiters-depth-2">)</span>; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n"</span>;
  <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"zs = "</span>; showArray<span class="org-rainbow-delimiters-depth-2">(</span>4, zs<span class="org-rainbow-delimiters-depth-2">)</span>; <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n"</span>;

<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Compiling: 
</p>

<ul class="org-ul">
<li>MSVC (CL.EXE):</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe sal1.cpp /nologo /Fe:sal1-a.exe &amp;&amp; sal1-a.exe
sal1.cpp
<span class="org-function-name">C</span>:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Tools\MSVC\14.12.25827\include\xlocale(313): warning C4530: C++ exception handler used, but unwind semantics are not enabled. Specify /EHsc
xs = (4)[ 4 5 6 10 ]
ys = (4)[ 4 10 5 25 ]
zs = (4)[ 16 50 30 250 ]
</pre>
</div>

<ul class="org-ul">
<li>Mingw/G++</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ g++ sal1.cpp -o <span class="org-keyword">sal1-b.exe</span> -std=c++11 &amp;&amp; sal1-b.exe
xs = (4)[ 4 5 6 10 ]
ys = (4)[ 4 10 5 25 ]
zs = (4)[ 16 50 30 250 ]
</pre>
</div>


<p>
Note: It doesn't work on Linux or other OSes. But it can be
implemented with header files.
</p>

<p>
<b>Open Source SAL Implementation:</b>
</p>

<ul class="org-ul">
<li>Source-code annotation language (SAL) compatibility header -
<a href="https://github.com/nemequ/salieri">https://github.com/nemequ/salieri</a> 

<ul class="org-ul">
<li>"Salieri is a header which provides definitions for Microsoft's
source-code annotation language (SAL). Simply drop the header
into your code and use it instead of including &lt;sal.h&gt; directly,
and you can use SAL annotations even if you want your program to
be portable to compilers which don't support it."</li>

<li>"SAL provides lots of annotations you can use to describe the
behavior of your program. There is a Best Practices and Examples
(SAL) page on MSDN if you want to get a very quick idea of how it
works, but the basic idea is that you end up with something like
this:"</li>
</ul></li>
</ul>

<p>
<b>References:</b>
</p>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/visualstudio/code-quality/understanding-sal">Understanding SAL - Visual Studio | Microsoft Docs</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/hh916382.aspx">Annotating Function Parameters and Return Values</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/ms182032.aspx?f=255&amp;MSPPError=-2147217396">Using SAL Annotations to Reduce C-C++ Code Defects</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/jj159525.aspx">Best Practices and Examples (SAL)</a></li>
<li><a href="https://stackoverflow.com/questions/11457328/what-is-in-in-c">What is <span class="underline">In</span> in C++? - Stack Overflow</a></li>
<li><a href="https://ariccio.com/2015/04/02/preventing-bugs-and-improving-code-quality-with-microsoft-sal-part-2-custom-preconditions-for-structs-objects/">Preventing bugs, and improving code quality with Microsoft SAL (Part 2, custom preconditions for structs &amp; objects) | Alexander Riccio</a></li>
<li>SQLite Source Code Annotated with SAL -
<a href="https://github.com/ariccio/SQLite-Test-SAL">https://github.com/ariccio/SQLite-Test-SAL</a> and <a href="https://ariccio.com/2015/05/10/using-sal-in-the-sqlite-api/">Using SAL in the SQLite API | Alexander Riccio</a></li>
<li><a href="https://www.osr.com/blog/2015/02/23/sal-annotations-dont-hate-im-beautiful/">SAL Annotations: Don’t Hate Me Because I’m Beautiful – OSR</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgff1497c" class="outline-3">
<h3 id="orgff1497c"><span class="section-number-3">1.7</span> Character Encoding in WinAPI - ANSI x utf8 x utf16 (wchar_t)</h3>
<div class="outline-text-3" id="text-1-7">
</div>
<div id="outline-container-orga392ae3" class="outline-4">
<h4 id="orga392ae3"><span class="section-number-4">1.7.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
Unlike Linux, MacOSX and BSD where the API supports unicode UTF-8,
the Windows API only supports ANSI enconding (char) and UTF16 or
Unicode with 2 bytes per character <span class="underline">wchar_t</span>. 
</p>

<p>
<b>Macros and types for enconding portability</b>
</p>

<p>
The following macros are widely used by Windows API for portability
between ANSI and Unicode: 
</p>

<ul class="org-ul">
<li>Strings:
<ul class="org-ul">
<li><a href="http://www.cplusplus.com/reference/string/">&lt;std::string&gt;</a> (UTF8 enconding) - Ordinary string (aka multi-byte string)</li>

<li><a href="http://www.cplusplus.com/reference/string/wstring/">std::wstring</a> (UTF-16 enconding) - Wide string - string defined as
array of wide characters wchar_t.</li>
</ul></li>

<li><span class="underline">TCHAR</span> (Header: &lt;tchar.h&gt;) - When the <span class="underline">UNICODE</span> is defined TCHAR
becomes wchar_t, otherwise, it becomes char.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#ifdef</span> _UNICODE
  <span class="org-keyword">typedef</span> <span class="org-type">wchar_t</span> <span class="org-type">TCHAR</span>;
<span class="org-preprocessor">#else</span>
  <span class="org-keyword">typedef</span> <span class="org-type">char</span> <span class="org-type">TCHAR</span>;
<span class="org-preprocessor">#endif</span>
</pre>
</div>

<ul class="org-ul">
<li>String Literal <b>_T</b> or TEXT macro.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#ifdef</span> _UNICODE 
<span class="org-preprocessor">   #define</span> <span class="org-function-name">_T</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">str</span><span class="org-rainbow-delimiters-depth-1">)</span>   L##str
<span class="org-preprocessor">   #define</span> <span class="org-function-name">TEXT</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">c</span><span class="org-rainbow-delimiters-depth-1">)</span>   L##str
<span class="org-preprocessor">#else</span> 
<span class="org-preprocessor">   #define</span> <span class="org-function-name">_T</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">str</span><span class="org-rainbow-delimiters-depth-1">)</span>     str 
<span class="org-preprocessor">   #define</span> <span class="org-function-name">TEXT</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">str</span><span class="org-rainbow-delimiters-depth-1">)</span>   str
<span class="org-preprocessor">#endif</span>
</pre>
</div>

<ul class="org-ul">
<li>Character array type definition:</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Definition</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">LPSTR</td>
<td class="org-left">char*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPCSTR</td>
<td class="org-left">const char*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPWSTR</td>
<td class="org-left">wchar_t*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPCWSTR</td>
<td class="org-left">const wchar_t*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPTSTR</td>
<td class="org-left">TCHAR*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LPCTSTR</td>
<td class="org-left">const TCHAR*</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<b>String Literals</b>
</p>

<ul class="org-ul">
<li><span class="underline">Utf-8 string literal</span> (narrow characters or multibyte string) -
cannot be used with Windows APIs as they will interpret those
string literals as ANSI, thus not all characters will be
represented.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-string">"UTF8 - Unicode 8 bits multi-byte literal"</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Note: It doesn't work with Windows APIs (Windows specific functions)</span>
<span class="org-type">char</span> <span class="org-variable-name">utf8_text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = <span class="org-string">"Random text in Chinese script (UTF8): &#35835;&#20889;&#27721;&#23383;1"</span>;
</pre>
</div>

<ul class="org-ul">
<li><span class="underline">Utf-16 string literal</span> (wide characters - wchar_t). Windows Unicode
APIs or functions only works with wide characters (wchar_t).</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">L<span class="org-string">"UTF16 Wchar wide chracters literal"</span>;
<span class="org-type">wchar_t</span> <span class="org-variable-name">utf16_text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = L<span class="org-string">"Random text in Chinese script (UTF16): &#35835;&#20889;&#27721;&#23383;1"</span>;
</pre>
</div>

<ul class="org-ul">
<li>String prefixed with _T or TEXT. If Unicode is defined the string
literal becomes an unicode UTF16 string literal and prefix 'L' is
added to the string, otherwise nothing happens.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">TCHAR</span> <span class="org-variable-name">text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = _T<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Random text in Chinese script  &#35835;&#20889;&#27721;&#23383;1"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">OR </span>
<span class="org-type">TCHAR</span> <span class="org-variable-name">text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = TEXT<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Random text in Chinese script  &#35835;&#20889;&#27721;&#23383;1"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
If <span class="underline">UNICODE</span> is not defined, it becomes: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">char</span> <span class="org-variable-name">text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = <span class="org-string">"Random text in Chinese script &#35835;&#20889;&#27721;&#23383;1"</span>;
</pre>
</div>

<p>
If Unicode is defined, it becomes: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">wchar_t</span> <span class="org-variable-name">text</span> <span class="org-rainbow-delimiters-depth-1">[]</span> = L<span class="org-string">"Random text in Chinese script &#35835;&#20889;&#27721;&#23383;1"</span>;
</pre>
</div>

<p>
<b>Windows APIs - ANSI X Unicode version</b>
</p>

<p>
Almost every function in Windows API such as <a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-createdirectorya">CreateDirectory</a> has an
ANSI and Unicode UTF16 (with wide chars wchar_t) version. The ANSI
version of CreateDirectory API is <a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-createdirectorya">CreateDirectoryA</a> (suffix A) and the
unicode version is <a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-createdirectoryw">CreateDirectoryW</a>. The API <span class="underline">CreateDirectory</span> is
expanded to CreateDirectoryW if #define UNICODE preprocessor flag is
not defined, otherwise it is expanded to CreateDirectoryA. 
</p>

<ul class="org-ul">
<li>ANSI Version:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">CreateDirectoryA</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCSTR</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">const char */</span>  <span class="org-variable-name">lpPathName</span>,
  <span class="org-type">LPSECURITY_ATTRIBUTES</span>    <span class="org-variable-name">lpSecurityAttributes</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li>Unicode Version:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">CreateDirectoryW</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCWSTR</span> <span class="org-comment-delimiter">/* </span><span class="org-comment">const wchar_t*  */</span>  <span class="org-variable-name">lpPathName</span>,   
  <span class="org-type">LPSECURITY_ATTRIBUTES</span>          <span class="org-variable-name">lpSecurityAttributes</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e85180" class="outline-4">
<h4 id="org4e85180"><span class="section-number-4">1.7.2</span> Example - ANSI X Unicode and Windows API</h4>
<div class="outline-text-4" id="text-1-7-2">
<ul class="org-ul">
<li>Source Code: <a href="src/windows/winapi-enconding1.cpp">file:src/windows/winapi-enconding1.cpp</a></li>
<li>Gist: <a href="https://gist.github.com/caiorss/c26e018b1e6838664bd949775fcdf551">winapi-enconding1.cpp</a></li>
</ul>

<p>
Compiling with GCC: 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Build </span>
$ g++ winapi-encoding1.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14  
<span class="org-comment-delimiter"># </span><span class="org-comment">Compile </span>
$ out-gcc.exe 
</pre>
</div>

<p>
Compiling with MSVC:
</p>
<ul class="org-ul">
<li>Note: If there is any unicode literal in the source, such as some
text in Chinese or Hidi script, it is necessary to compile with the
options (/source-charset:utf-8 /execution-charset:utf-8), otherwise
the</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Build </span>
$ cl.exe winapi-encoding1.cpp user32.lib /EHsc /Zi /nologo /source-charset:utf-8 /execution-charset:utf-8 <span class="org-sh-escaped-newline">\</span>
   /Fe:out-msvc.exe 
<span class="org-comment-delimiter"># </span><span class="org-comment">Run </span>
$ out-msvc.exe 
</pre>
</div>


<p>
Headers: 
</p>

<ul class="org-ul">
<li>To enable the expansion to unicode versions of WinAPIs, the flags
UNICODE and <code>_UNICODE</code> must be enabled. For instance, if those flags
are enabled CreateDirectory is expanded to CreateDirectoryW and TCHAR
is expanded to wchar_t. Otherwise, CreateDirectory is expanded to
CreateDirectoryA and TCHAR to char.</li>

<li>Note: The unicode flags must be defined before any windows specific
header such as &lt;windows.h&gt; or &lt;tchar.h&gt;.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fstream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">sstream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Enable Unicode version of Windows API compile with -DWITH_UNICODE </span>
<span class="org-preprocessor">#ifdef</span> WITH_UNICODE
<span class="org-preprocessor">  #define</span> <span class="org-variable-name">UNICODE</span>
<span class="org-preprocessor">  #define</span> <span class="org-variable-name">_UNICODE</span>
<span class="org-preprocessor">#endif</span> 

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">windows.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">tchar.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
</pre>
</div>

<p>
<b>Experiment 1</b> - Print to console: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">===========&gt; EXPERIMENT 1 - Print to Console ============//  </span>
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"\n ===&gt;&gt;&gt; EXPERIMENT 1: Print to terminal [ANSI/UTF8] &lt;&lt;&lt;=== "</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-rainbow-delimiters-depth-1">{</span>
   <span class="org-constant">std</span>::cout  &lt;&lt;  <span class="org-string">" [COUT] Some text example - &#1091;&#1082;&#1072;&#1079;&#1072;&#1085; - &#35835;&#20889;&#27721;&#23383;1 "</span> &lt;&lt; <span class="org-string">"\n"</span>;
   <span class="org-constant">std</span>::wcout &lt;&lt; L<span class="org-string">" [WCOUT] Some text example - &#1091;&#1082;&#1072;&#1079;&#1072;&#1085; - &#35835;&#20889;&#27721;&#23383;1 "</span> &lt;&lt; L<span class="org-string">"\n"</span>;  
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Output: 
</p>

<ul class="org-ul">
<li>This piece of code fails because the Windows' console (cmd.exe)
cannot print unicode text by default. It needs to be configured
before printing unicode, otherwise it will print garbage.</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">===&gt;&gt;&gt; EXPERIMENT 1: Print to terminal [ANSI/UTF8] &lt;&lt;&lt;
[COUT] Some text example - &#9572;&#226;&#9576;&#9553;&#9576;&#9617;&#9576;&#9558;&#9576;&#9617;&#9576;&#9564; - &#934;&#187;&#9559;&#963;&#229;&#214;&#181;&#9618;&#235;&#963;&#161;&#249;
[WCOUT] Some text example -
</pre>
</div>

<p>
<b>Experiment 2</b> - Print to File
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">===========&gt; EXPERIMENT 2 - Print to File ============//</span>
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"\n ===&gt;&gt;&gt; EXPERIMENT 2: Write non ANSI Chars to File &lt;&lt;&lt;=== "</span> &lt;&lt; <span class="org-string">"\n"</span>;
<span class="org-function-name">std</span>::stringstream ss;
ss &lt;&lt; <span class="org-string">" Text in Cyrllic Script: &#1045;&#1089;&#1083;&#1080; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;  "</span> &lt;&lt; <span class="org-string">"\n"</span>
   &lt;&lt; <span class="org-string">" Text in Chinese Script: &#35835;&#20889;&#27721;&#23383;1 "</span> &lt;&lt; <span class="org-string">"\n"</span>
   &lt;&lt; <span class="org-string">"\n"</span>;

<span class="org-keyword">auto</span> <span class="org-variable-name">dfile</span> = <span class="org-constant">std</span>::ofstream<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"logging.txt"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
dfile &lt;&lt; ss.str<span class="org-rainbow-delimiters-depth-1">()</span> &lt;&lt; <span class="org-constant">std</span>::flush;
</pre>
</div>

<p>
Output: file - loggin.txt  
</p>
<ul class="org-ul">
<li>By opening the file logging.txt with notepad.exe, it is
possible view all characters as show in the following block.</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">Text in Cyrllic Script: &#1045;&#1089;&#1083;&#1080; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088;  
Text in Chinese Script: &#35835;&#20889;&#27721;&#23383;1 
</pre>
</div>

<p>
<b>Experiment 3</b> - WinAPI - <a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-createdirectorya">CreateDirectory</a>  
</p>

<p>
This code experiment attempts to create 3 directories: 
</p>

<ul class="org-ul">
<li>Directory: directoryANSI-读写汉字1 with CreateDirectoryA
function (ANSI version of the underlying API)</li>

<li>Directory: directoryWCHAR-读写汉字 with CreateDirectoryW (Unicode
version of the API).</li>

<li>Directory: directoryTCHAR-读写汉字 with <span class="underline">CreateDirectory macro</span>
which is expanded to CreateDirectoryW when UNICODE is defined,
othewise it is expanded to CreateDirectoryA.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">   <span class="org-comment-delimiter">// </span><span class="org-comment">===========&gt; EXPERIMENT 4 - WinAPI - CreateDirectory ============//</span>
   <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n ===&gt;&gt;&gt; EXPERIMENT 3: WinAPI CreateDirectory &lt;&lt;&lt;=== "</span> &lt;&lt; <span class="org-constant">std</span>::endl;

   <span class="org-rainbow-delimiters-depth-1">{</span> <span class="org-comment-delimiter">// </span><span class="org-comment">-- ANSI Version of CreateDirectory API </span>
       <span class="org-type">bool</span> <span class="org-variable-name">res</span>;
       res = CreateDirectoryA<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"directoryANSI-&#35835;&#20889;&#27721;&#23383;1"</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
       <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Successful 1 ?=  "</span> &lt;&lt; <span class="org-constant">std</span>::boolalpha &lt;&lt; res &lt;&lt; <span class="org-constant">std</span>::endl;
   <span class="org-rainbow-delimiters-depth-1">}</span>

   <span class="org-rainbow-delimiters-depth-1">{</span>  <span class="org-comment-delimiter">// </span><span class="org-comment">-- Unicode (UTF16) - Wide character version of CreateDirectory API </span>
       <span class="org-type">bool</span> <span class="org-variable-name">res</span>;
       res = CreateDirectoryW<span class="org-rainbow-delimiters-depth-2">(</span>L<span class="org-string">"directoryWCHAR-&#35835;&#20889;&#27721;&#23383;"</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
       <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Successful 2 ?= "</span> &lt;&lt; <span class="org-constant">std</span>::boolalpha &lt;&lt; res &lt;&lt; <span class="org-constant">std</span>::endl;       
   <span class="org-rainbow-delimiters-depth-1">}</span>
   <span class="org-rainbow-delimiters-depth-1">{</span>
      <span class="org-comment-delimiter">// </span><span class="org-comment">-- TCHAR Version Wide character version of CreateDirectory API </span>
      <span class="org-type">bool</span> <span class="org-variable-name">res</span>;

<span class="org-preprocessor">      #ifdef</span> UNICODE
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] UNICODE (UTF16) CreateDirectory expanded to CreateDirectoryW"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-preprocessor">      #else</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [INFO] ANSI CreateDirectory expanded to CreateDirectoryA"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-preprocessor">      #endif</span>
      res = CreateDirectory<span class="org-rainbow-delimiters-depth-2">(</span>_T<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"directoryTCHAR-&#35835;&#20889;&#27721;&#23383;"</span><span class="org-rainbow-delimiters-depth-3">)</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
      <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"Successful 3 ?= "</span> &lt;&lt; <span class="org-constant">std</span>::boolalpha &lt;&lt; res &lt;&lt; <span class="org-constant">std</span>::endl;        
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Output when compiling without -DWITH_UNICODE: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ g++ winapi-encoding1.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14  &amp;&amp; out-gcc.exe 

 ... ....  ... 
 ===&gt;&gt;&gt; EXPERIMENT 3: WinAPI CreateDirectory &lt;&lt;&lt;=== 
Successful 1 ?=  true
Successful 2 ?= true
 [INFO] ANSI CreateDirectory expanded to CreateDirectoryA
Successful 3 ?= true
 ... ....  ... 
</pre>
</div>

<p>
Directories created: 
</p>

<ul class="org-ul">
<li>[FAILED]  <code>directoryANSI-è¯»å†™æ±‰å­—1</code></li>
<li>[SUCCESS] <code>directoryWCHAR-读写汉字</code>
<ul class="org-ul">
<li>Only the Unicode (CreateDirectoryW) function  works, the ANSI
function CreateDirectoryA fails even if the string is encoded
with UTF-8.</li>
</ul></li>
<li>[FAILED]  <code>directoryTCHAR-è¯»å†™æ±‰å­—</code>
<ul class="org-ul">
<li>Without UNICODE flag, CreateDirectory expands to
CreateDirectoryA.</li>
</ul></li>
</ul>

<p>
Output when compiling without -DWITH_UNICODE: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ g++ winapi-encoding1.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14 -DWITH_UNICODE  &amp;&amp; out-gcc.exe 

    ... .... ... ... ...   
 ===&gt;&gt;&gt; EXPERIMENT 3: WinAPI CreateDirectory &lt;&lt;&lt;=== 
Successful 1 ?=  true
Successful 2 ?= true
 [INFO] UNICODE (UTF16) CreateDirectory expanded to CreateDirectoryW
Successful 3 ?= true
    ... .... ... ... ...   
</pre>
</div>

<p>
Directories created: 
</p>

<ul class="org-ul">
<li>[FAILED] <code>directoryANSI-è¯»å†™æ±‰å­—1</code></li>
<li>[SUCCESS] <code>directoryWCHAR-读写汉字</code></li>
<li>[SUCCESS] <code>directoryTCHAR-读写汉字</code></li>
</ul>


<p>
<b>Experiment 4</b> - WinAPI <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-messagebox">MessageBox</a> function.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">===========&gt; EXPERIMENT 4 - WinAPI - MessageBox ============//</span>
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"\n ===&gt;&gt;&gt; EXPERIMENT 4: MessageBox &lt;&lt;&lt;=== "</span> &lt;&lt; <span class="org-constant">std</span>::endl;

<span class="org-type">DWORD</span> <span class="org-keyword">const</span> <span class="org-variable-name">infoboxOptions</span>  = MB_OK | MB_ICONINFORMATION | MB_SETFOREGROUND;
<span class="org-comment-delimiter">// </span><span class="org-comment">Text in UTF8 =&gt; Note =&gt; Windows API doesn't work with UTF8</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">or multi-byte characters as the API treats the chars as they were ANSI.</span>
<span class="org-type">char</span> <span class="org-variable-name">narrowText</span> <span class="org-rainbow-delimiters-depth-1">[]</span>  = <span class="org-string">"Some chinese text n&#227;o ingl&#234;s  &#35835;&#20889;&#27721;&#23383; - &#23398;&#20013;&#25991;"</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Unicode text in UTF16 </span>
<span class="org-type">wchar_t</span> <span class="org-variable-name">wideText</span> <span class="org-rainbow-delimiters-depth-1">[]</span>  = L<span class="org-string">"Some chinese text n&#227;o ingl&#234;s &#35835;&#20889;&#27721;&#23383; - &#23398;&#20013;&#25991;"</span>;
MessageBoxA<span class="org-rainbow-delimiters-depth-1">(</span> 0, narrowText, <span class="org-string">"ANSI (narrow) text:"</span>, infoboxOptions <span class="org-rainbow-delimiters-depth-1">)</span>;    
MessageBoxW<span class="org-rainbow-delimiters-depth-1">(</span> 0, wideText, L<span class="org-string">"Unicode (wide) text:"</span>, infoboxOptions <span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
Output of <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-messageboxa">MessageBoxA</a> (failure, it cannot deal with unicode UTF-8 chars):
</p>


<div class="figure">
<p><a href="images/messagebox-ansi1.png"><img src="images/messagebox-ansi1.png" alt="messagebox-ansi1.png" /></a>
</p>
</div>

<p>
Output of <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-messageboxw">MessageBoxW</a> (success):
</p>


<div class="figure">
<p><a href="images/messabox-unicode1.png"><img src="images/messabox-unicode1.png" alt="messabox-unicode1.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgeb40a5d" class="outline-4">
<h4 id="orgeb40a5d"><span class="section-number-4">1.7.3</span> Example - Using Windows API with UTF8</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
This example presents how to create wrappers for WinAPI with UTF8
enconding and std::string instead of using UTF16 wide unicode wchar_t
string or wstring. It is better to use UTF8 with WinAPI since UTF8 is
supported on more systems than UTF16 (wide unicode) and UTF8 also
enhances the interoperability. 
</p>


<ul class="org-ul">
<li>Source Code: <a href="src/windows/winapi-utf8.cpp">file:src/windows/winapi-utf8.cpp</a></li>
<li>Gist:</li>
</ul>

<p>
Functions for <span class="underline">wide unicode</span> UTF16 to UTF8 conversion and vice-versa:
(Credits:  <a href="https://gist.github.com/pezy/8571764">https://gist.github.com/pezy/8571764</a> )
</p>

<ul class="org-ul">
<li>Convert wide unicode string (std::wstring) to utf8 (std::string)</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-function-name">utf8_encode</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">wstring</span> &amp;<span class="org-variable-name">wstr</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">int</span> <span class="org-variable-name">size_needed</span> = WideCharToMultiByte<span class="org-rainbow-delimiters-depth-2">(</span>
            CP_UTF8, 0, &amp;wstr<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>,
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">)</span>wstr.size<span class="org-rainbow-delimiters-depth-3">()</span>, <span class="org-constant">NULL</span>, 0, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">strTo</span><span class="org-rainbow-delimiters-depth-2">(</span>size_needed, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
    WideCharToMultiByte<span class="org-rainbow-delimiters-depth-2">(</span>
            CP_UTF8, 0, &amp;wstr<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>,
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">)</span>wstr.size<span class="org-rainbow-delimiters-depth-3">()</span>, &amp;strTo<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, size_needed, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> strTo;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>Convert std::string (UTF8) to std::wstring</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Convert an UTF8 string to a wide Unicode String</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Credits: https://gist.github.com/pezy/8571764</span>
<span class="org-keyword">auto</span> <span class="org-function-name">utf8_decode</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span> &amp;<span class="org-variable-name">str</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">wstring</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">int</span> <span class="org-variable-name">size_needed</span> = MultiByteToWideChar<span class="org-rainbow-delimiters-depth-2">(</span>
             CP_UTF8, 0,
             &amp;str<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">)</span>str.size<span class="org-rainbow-delimiters-depth-3">()</span>, <span class="org-constant">NULL</span>, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-constant">std</span>::<span class="org-type">wstring</span> <span class="org-variable-name">wstrTo</span><span class="org-rainbow-delimiters-depth-2">(</span>size_needed, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     MultiByteToWideChar<span class="org-rainbow-delimiters-depth-2">(</span>
             CP_UTF8, 0, &amp;str<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>,
             <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-3">)</span> str.size<span class="org-rainbow-delimiters-depth-3">()</span>, &amp;wstrTo<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, size_needed<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> wstrTo;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>Wrapper for function <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-getusernamew">GetUserName</a> (GetUserNameW) which returns the
user name encoded with UTF16. The unicode API is used because the
ANSI versio GetUserNameA (which uses char*) would fail if the user
name was written with non-ANSI characters or had any accent such as
'ã', 'ó', 'í' and 'ç'.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"> <span class="org-comment-delimiter">// </span><span class="org-comment">Requires: &lt;windows.h&gt;, &lt;winbase.h&gt; and &lt;Lmcons.h&gt;</span>
<span class="org-keyword">auto</span> <span class="org-function-name">getUserName</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">size</span> = UNLEN + 1;
    <span class="org-constant">std</span>::<span class="org-type">wstring</span> <span class="org-variable-name">buffer</span><span class="org-rainbow-delimiters-depth-2">(</span>size, 0x00<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">//</span><span class="org-comment">BOOL GetUserNameW(LPWSTR lpBuffer, LPDWORD pcbBuffer);</span>
    GetUserNameW<span class="org-rainbow-delimiters-depth-2">(</span>&amp;buffer<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, &amp;size<span class="org-rainbow-delimiters-depth-2">)</span>;
    buffer.resize<span class="org-rainbow-delimiters-depth-2">(</span>size - 1<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> utf8_encode<span class="org-rainbow-delimiters-depth-2">(</span>buffer<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>Wrapper for function <b>messageBox</b> which encapsulates the complexity
of the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-messagebox">MessageBoxW</a>  wide unicode api.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-function-name">messageBox</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">title</span>, <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">void</span> 
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">DWORD</span> <span class="org-keyword">const</span> <span class="org-variable-name">infoboxOptions</span>  =
            MB_OK | MB_ICONINFORMATION | MB_SETFOREGROUND;
    ::MessageBoxW<span class="org-rainbow-delimiters-depth-2">(</span>
            0
            ,utf8_decode<span class="org-rainbow-delimiters-depth-3">(</span>text<span class="org-rainbow-delimiters-depth-3">)</span>.c_str<span class="org-rainbow-delimiters-depth-3">()</span>
            ,utf8_decode<span class="org-rainbow-delimiters-depth-3">(</span>title<span class="org-rainbow-delimiters-depth-3">)</span>.c_str<span class="org-rainbow-delimiters-depth-3">()</span>
            ,infoboxOptions
            <span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"USER NAME = "</span> &lt;&lt; getUserName<span class="org-rainbow-delimiters-depth-1">()</span> &lt;&lt; <span class="org-constant">std</span>::endl;

<span class="org-function-name">std</span>::string message = <span class="org-string">"Text with unicode UTF8 - &#35835;&#20889;&#27721;&#23383;1 - &#1045;&#1089;&#1083;&#1080; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; "</span>;
<span class="org-function-name">std</span>::string title   = <span class="org-string">"Title in UTF8 &#1575;&#1604;&#1618;&#1581;&#1615;&#1585;&#1615;&#1608;&#1601; &#1575;&#1604;&#1618;&#1593;&#1614;&#1585;&#1614;&#1576;&#1616;&#1610;&#1614;&#1617;&#1577;"</span>;   
messageBox<span class="org-rainbow-delimiters-depth-1">(</span>title, message<span class="org-rainbow-delimiters-depth-1">)</span>; 
<span class="org-keyword">return</span> 0;
</pre>
</div>

<p>
Compilation with MSVC:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe winapi1-utf8.cpp /EHsc /Zi /nologo /Fe:out.exe user32.lib advapi32.lib 
$ out.exe
</pre>
</div>

<p>
Compilation with GCC:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Compile </span>
$ g++ winapi1-utf8.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14 
<span class="org-comment-delimiter"># </span><span class="org-comment">Compile and run </span>
$ g++ winapi1-utf8.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14  &amp;&amp; out-gcc.exe 
<span class="org-comment-delimiter"># </span><span class="org-comment">Run </span>
$ out-gcc.exe 
</pre>
</div>

<p>
Output: 
</p>

<div class="org-src-container">
<pre class="src src-sh">USER NAME = archbox
</pre>
</div>


<div class="figure">
<p><a href="images/output-messageboxUTF8.png"><img src="images/output-messageboxUTF8.png" alt="output-messageboxUTF8.png" /></a> 
</p>
<p><span class="figure-number">Figure 3: </span>Graphical output - messagebox</p>
</div>
</div>
</div>

<div id="outline-container-orgd9ae9b9" class="outline-4">
<h4 id="orgd9ae9b9"><span class="section-number-4">1.7.4</span> Example - Setting Console to UTF8</h4>
<div class="outline-text-4" id="text-1-7-4">
<ul class="org-ul">
<li>Source Code: <a href="src/windows/console-utf8.cpp">file:src/windows/console-utf8.cpp</a></li>
<li>Gist: <a href="https://gist.github.com/caiorss/54f73d235b87bbb897b0e3f943876345">console-utf8.cpp</a></li>
</ul>

<p>
The class ConsoleUTF8 uses RAII - Resource Acquisition is
Initialization for setting the console to UTF8 and restoring it when
a class object goes out scope. 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Uses RAII for setting console to UTF8</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">and restoring its previous settings.</span>
<span class="org-keyword">class</span> <span class="org-type">ConsoleUTF8</span><span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
   <span class="org-comment-delimiter">// </span><span class="org-comment">Constructor saves context </span>
   <span class="org-function-name">ConsoleUTF8</span><span class="org-rainbow-delimiters-depth-2">(){</span>
       m_config = ::GetConsoleOutputCP<span class="org-rainbow-delimiters-depth-3">()</span>;
       ::SetConsoleOutputCP<span class="org-rainbow-delimiters-depth-3">(</span>CP_UTF8<span class="org-rainbow-delimiters-depth-3">)</span>;
       <span class="org-constant">std</span>::perror<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">" [TRACE] Console set to UTF8"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
   <span class="org-rainbow-delimiters-depth-2">}</span>
   <span class="org-comment-delimiter">// </span><span class="org-comment">Destructor restores context </span>
   ~<span class="org-function-name">ConsoleUTF8</span><span class="org-rainbow-delimiters-depth-2">(){</span>
      <span class="org-constant">std</span>::perror<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">" [TRACE] Console restored."</span><span class="org-rainbow-delimiters-depth-3">)</span>;
      ::SetConsoleOutputCP<span class="org-rainbow-delimiters-depth-3">(</span>m_config<span class="org-rainbow-delimiters-depth-3">)</span>;
   <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">private</span>:
   <span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">m_config</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Class ExitPrompt uses RAII for asking the user to type RETURN to exit
in order to allow its output to be ovserved by blocking the program
from exiting immediately when it is invoked by clicking the
executable.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">struct</span> <span class="org-type">ExitPrompt</span><span class="org-rainbow-delimiters-depth-1">{</span>
    ~<span class="org-function-name">ExitPrompt</span><span class="org-rainbow-delimiters-depth-2">(){</span>
        <span class="org-constant">std</span>::puts<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">" &gt;&gt;&gt; Enter RETURN to exit"</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-3">()</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#ifdef</span> UTF8
<span class="org-keyword">auto</span> <span class="org-variable-name">utf8Console</span> = ConsoleUTF8<span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-preprocessor">#endif</span> 
<span class="org-comment-delimiter">//</span><span class="org-comment">auto codePage = ::SetConsoleOutputCP(CP_UTF8);</span>

<span class="org-keyword">auto</span> <span class="org-variable-name">exitPrompt</span> = ExitPrompt<span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Testing Console output with UTF8"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"--------------------------------"</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Text with UTF8 - S&#195;O JO&#195;O -  "</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Japanese Kanji - &#28450;&#23383; ; Japanese Hiragrama - &#24179;&#20206;&#21517; "</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Cyrllic Script - Sputnik = &#1057;&#1087;&#1091;&#1090;&#1085;&#1080;&#1082;-1"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Greek/Latin Script = &#913; &#945;, &#914; &#946;, &#915; &#947;, &#916; &#948;, &#917; &#949;, &#918; &#950;, &#919; &#951;, &#920; &#952;"</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">//</span><span class="org-comment">::SetConsoleOutputCP(codePage);</span>
<span class="org-keyword">return</span> 0;
</pre>
</div>

<p>
Compiling with MSVC: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Compile and run with UTF8 flag disabled </span>
$ cl.exe console-utf8.cpp /EHsc /Zi /nologo /Fe:out.exe &amp;&amp; out.exe

  <span class="org-comment-delimiter">// </span><span class="org-comment">Compile and run with UTF8 flag disabled // Compile run with UTF8 flag enabled  </span>
$ cl.exe console-utf8.cpp /EHsc /Zi /nologo /Fe:out.exe -DUTF8 &amp;&amp; out.exe
</pre>
</div>

<p>
Compiling with Mingw/GCC:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Compile and run with UTF8 flag disabled </span>
 g++ console-utf8.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14 -Wall &amp;&amp; out-gcc.exe
<span class="org-comment-delimiter">// </span><span class="org-comment">Compile and run with UTF8 flag disabled </span>
 g++ console-utf8.cpp -o <span class="org-keyword">out-gcc.exe</span> -std=c++14 -Wall -DUTF8 &amp;&amp; out-gcc.exe
</pre>
</div>


<div class="figure">
<p><a href="images/windows-console-ansi-mode.png"><img src="images/windows-console-ansi-mode.png" alt="windows-console-ansi-mode.png" /></a>
</p>
<p><span class="figure-number">Figure 4: </span>Output with UTF8 disabled =&gt; Terminal in ANSI mode.</p>
</div>


<div class="figure">
<p><a href="images/windows-console-unicode-utf8.png"><img src="images/windows-console-unicode-utf8.png" alt="windows-console-unicode-utf8.png" /></a>
</p>
<p><span class="figure-number">Figure 5: </span>Output with UTF8 enalbed =&gt; Terminal in unicode UTF8 mode</p>
</div>

<p>
See: 
</p>

<ul class="org-ul">
<li>WINAPI - <a href="https://docs.microsoft.com/en-us/windows/console/setconsoleoutputcp">SetConsoleOutputCP function - Windows Console | Microsoft Docs</a></li>
<li>WINAPI - <a href="https://docs.microsoft.com/en-us/windows/console/getconsoleoutputcp">GetConsoleOutputCP function - Windows Console | Microsoft Docs</a></li>
<li><a href="https://stackoverflow.com/questions/26834947/how-to-output-unicode-in-c-without-setmode/27894773">How to output unicode in C++ without _setmode - Stack Overflow</a></li>
<li><a href="https://unicodebook.readthedocs.io/operating_systems.html">10. Operating systems — Programming with Unicode</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2a51fd7" class="outline-3">
<h3 id="org2a51fd7"><span class="section-number-3">1.8</span> CODE - Display information about current process</h3>
<div class="outline-text-3" id="text-1-8">
<p>
Print information about current process and copy itself to desktop
directory. 
</p>

<p>
File: <a href="src/windows/currentProcess.cpp">file:src/windows/currentProcess.cpp</a> 
</p>

<p>
Compile: MSVC
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe currentProcess.cpp /EHsc /Zi /nologo /Fe:currentProcess.exe &amp;&amp; currentProcess.exe
</pre>
</div>

<p>
Running on console (from cmd.exe or cmder terminal): 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ currentProcess.exe 
=========== Current Process Info ========
PID              = 5712
hProc            = 0x00007FF65D890000
Executable path  = C:\Users\archbox\Desktop\experiments\currentProcess.exe
Current path     = c:\Users\archbox\Desktop\experiments
</pre>
</div>

<p>
Running program by clicking on it: 
</p>
<ul class="org-ul">
<li>If program checks whether it was launched by click, it waits for
the user to type RETURN before terminating.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">=========== Current Process Info ========
PID              = 6916
hProc            = 0x00007FF72C300000
Executable path  = C:\Users\archbox\Desktop\experiments\currentProcess.exe
Current path     = C:\Users\archbox\Desktop\experiments

 ==&gt; Type RETURN to exit.
</pre>
</div>

<p>
Code: 
</p>

<ul class="org-ul">
<li>Function: isInOwnConsole - returns true if program was launched by
click. Returns false if it was launched from any type console such
as cmd.exe or cmder.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Return true if program was launched by clicking on it, </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">return false if this program was launched from command line.</span>
<span class="org-keyword">auto</span> <span class="org-function-name">isInOwnConsole</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-type">bool</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">DWORD</span> <span class="org-variable-name">procIDs</span><span class="org-rainbow-delimiters-depth-2">[</span>2<span class="org-rainbow-delimiters-depth-2">]</span>;
     <span class="org-type">DWORD</span> <span class="org-variable-name">maxCount</span> = 2;
     <span class="org-type">DWORD</span> <span class="org-variable-name">result</span> = GetConsoleProcessList<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">LPDWORD</span><span class="org-rainbow-delimiters-depth-3">)</span>procIDs, maxCount<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> result != 1;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>Lambda function ExecutablePath - Returns the path of some process
executable given its PID (Process ID).</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-variable-name">ExecutablePath</span> = <span class="org-rainbow-delimiters-depth-1">[](</span><span class="org-type">int</span> <span class="org-variable-name">pid</span><span class="org-rainbow-delimiters-depth-1">){</span>
     <span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span> = OpenProcess<span class="org-rainbow-delimiters-depth-2">(</span> PROCESS_QUERY_INFORMATION
                                | PROCESS_VM_READ, FALSE, pid <span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-comment-delimiter">// </span><span class="org-comment">Get process file path </span>
     <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">process_path</span><span class="org-rainbow-delimiters-depth-2">(</span>MAX_PATH, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-type">DWORD</span> <span class="org-variable-name">size</span> = MAX_PATH; 
     QueryFullProcessImageNameA<span class="org-rainbow-delimiters-depth-2">(</span>hProc, 0, &amp;process_path<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, &amp;size<span class="org-rainbow-delimiters-depth-2">)</span>;
     process_path.resize<span class="org-rainbow-delimiters-depth-2">(</span>size<span class="org-rainbow-delimiters-depth-2">)</span>; 
     CloseHandle<span class="org-rainbow-delimiters-depth-2">(</span>hProc<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> process_path;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Lambda function CurrentDirectory - returns current directory.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-variable-name">CurrentDirectory</span> = <span class="org-rainbow-delimiters-depth-1">[]{</span>
     DWORD size = ::GetCurrentDirectory<span class="org-rainbow-delimiters-depth-2">(</span>0, <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     assert<span class="org-rainbow-delimiters-depth-2">(</span>size != 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-2">(</span>size + 1, 0x00<span class="org-rainbow-delimiters-depth-2">)</span>;
     size = ::GetCurrentDirectory<span class="org-rainbow-delimiters-depth-2">(</span>path.size<span class="org-rainbow-delimiters-depth-3">()</span>, &amp;path<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     path.resize<span class="org-rainbow-delimiters-depth-2">(</span>size<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> path;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<ul class="org-ul">
<li>Main function:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Get current process ID </span>
<span class="org-type">DWORD</span>    <span class="org-variable-name">pid</span>   = GetCurrentProcessId<span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Return module handle of current process </span>
<span class="org-type">HMODULE</span>  <span class="org-variable-name">hProc</span> = GetModuleHandleA<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Get process module</span>
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"=========== Current Process Info ========"</span>  &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"PID              = "</span> &lt;&lt; pid                 &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"hProc            = 0x"</span> &lt;&lt; hProc             &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Executable path  = "</span> &lt;&lt; ExecutablePath<span class="org-rainbow-delimiters-depth-1">(</span>pid<span class="org-rainbow-delimiters-depth-1">)</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Current path     = "</span> &lt;&lt; CurrentDirectory<span class="org-rainbow-delimiters-depth-1">()</span>  &lt;&lt; <span class="org-constant">std</span>::endl;

<span class="org-comment-delimiter">// </span><span class="org-comment">Copy itself to Desktop</span>
CopyFile<span class="org-rainbow-delimiters-depth-1">(</span>ExecutablePath<span class="org-rainbow-delimiters-depth-2">(</span>pid<span class="org-rainbow-delimiters-depth-2">)</span>.c_str<span class="org-rainbow-delimiters-depth-2">()</span>, <span class="org-string">"C:\\Users\\archbox\\Desktop\\appinfo.exe"</span>, <span class="org-constant">false</span><span class="org-rainbow-delimiters-depth-1">)</span> ;

<span class="org-comment-delimiter">// </span><span class="org-comment">Stop program from exiting if it was launched by clicking on it.</span>
<span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-negation-char">!</span>isInOwnConsole<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">){</span>
        <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">"\n ==&gt; Type RETURN to exit."</span> &lt;&lt; <span class="org-constant">std</span>::endl;
        <span class="org-constant">std</span>::cin.get<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>   
<span class="org-keyword">return</span> EXIT_SUCCESS;
</pre>
</div>
</div>
</div>

<div id="outline-container-org028d1f5" class="outline-3">
<h3 id="org028d1f5"><span class="section-number-3">1.9</span> CODE - List processes</h3>
<div class="outline-text-3" id="text-1-9">
<p>
This code prints to stdout (console) and to a file the list of running
processes in current machine:
</p>

<p>
Source: 
</p>
<ul class="org-ul">
<li><a href="src/windows/showProcesses.cpp">file:src/windows/showProcesses.cpp</a></li>
</ul>

<p>
Parts:
</p>

<ul class="org-ul">
<li>Function which prints all processes to any output stream:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Show all processes in current machine</span>
<span class="org-keyword">auto</span> <span class="org-function-name">showProcessInfo</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::<span class="org-type">ostream</span>&amp; <span class="org-variable-name">os</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">int</span> <span class="org-rainbow-delimiters-depth-1">{</span>
  <span class="org-comment-delimiter">// </span><span class="org-comment">Get snapshot with process listing.</span>
  <span class="org-type">HANDLE</span> <span class="org-variable-name">hProcessSnapShot</span> =
    CreateToolhelp32Snapshot<span class="org-rainbow-delimiters-depth-2">(</span>TH32CS_SNAPPROCESS, 0<span class="org-rainbow-delimiters-depth-2">)</span>;  
  <span class="org-comment-delimiter">// </span><span class="org-comment">Instnatiate process' entry structure.</span>
  <span class="org-type">PROCESSENTRY32</span> <span class="org-variable-name">ProcessEntry</span> = <span class="org-rainbow-delimiters-depth-2">{</span> 0 <span class="org-rainbow-delimiters-depth-2">}</span>;
  ProcessEntry.dwSize = <span class="org-keyword">sizeof</span><span class="org-rainbow-delimiters-depth-2">(</span> ProcessEntry <span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-type">BOOL</span> <span class="org-variable-name">Return</span> = FALSE;
  Return = Process32First<span class="org-rainbow-delimiters-depth-2">(</span> hProcessSnapShot, &amp;ProcessEntry <span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-comment-delimiter">// </span><span class="org-comment">Returns -1 if process failed </span>
  <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-negation-char">!</span>Return <span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">{</span>  <span class="org-keyword">return</span> -1;<span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">do</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-comment-delimiter">// </span><span class="org-comment">print process' data</span>
      os &lt;&lt; <span class="org-string">"EXE File     = "</span> &lt;&lt; ProcessEntry.szExeFile      &lt;&lt; <span class="org-string">"\n"</span>
         &lt;&lt; <span class="org-string">"PID          = "</span> &lt;&lt; ProcessEntry.th32ProcessID  &lt;&lt; <span class="org-string">"\n"</span>
         &lt;&lt; <span class="org-string">"References   = "</span> &lt;&lt; ProcessEntry.cntUsage       &lt;&lt; <span class="org-string">"\n"</span>
         &lt;&lt; <span class="org-string">"Thread Count = "</span> &lt;&lt; ProcessEntry.cntThreads     &lt;&lt; <span class="org-string">"\n"</span>  
         &lt;&lt; <span class="org-string">"-----------------------------------------------\n"</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
  <span class="org-keyword">while</span><span class="org-rainbow-delimiters-depth-2">(</span> Process32Next<span class="org-rainbow-delimiters-depth-3">(</span> hProcessSnapShot, &amp;ProcessEntry <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-comment-delimiter">// </span><span class="org-comment">Close handle releasing resource.</span>
  CloseHandle<span class="org-rainbow-delimiters-depth-2">(</span> hProcessSnapShot <span class="org-rainbow-delimiters-depth-2">)</span>;
  <span class="org-keyword">return</span> 1;
<span class="org-rainbow-delimiters-depth-1">}</span>

</pre>
</div>

<ul class="org-ul">
<li>Main function:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Log file </span>
<span class="org-keyword">auto</span> <span class="org-variable-name">plog</span> = <span class="org-constant">std</span>::ofstream<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"process-log.txt"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Print all processes to stdout. </span>
showProcessInfo<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">std</span>::cout<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Write all processes to file </span>
showProcessInfo<span class="org-rainbow-delimiters-depth-1">(</span>plog<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Flush buffer - force data to be written to file.</span>
plog.flush<span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"\n ==&gt; Type return to exit."</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-function-name">std</span>::cin.get<span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-keyword">return</span> 0;
</pre>
</div>

<ul class="org-ul">
<li>Compiling and running:</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor"># Build</span> 
$ cl.exe showProcesses.cpp /EHsc /Zi /nologo /Fe:showProcesses.exe  

<span class="org-preprocessor"># Run</span>: 
$ showProcesses 
<span class="org-preprocessor"># Run</span> 
$ showProcesses.exe 
</pre>
</div>

<ul class="org-ul">
<li>Output:</li>
</ul>

<div class="org-src-container">
<pre class="src src-text">   $ showProcesses.exe
  ... ... ... ... 
-----------------------------------------------
EXE File     = Registry
PID          = 68
References   = 0
Thread Count = 3
-----------------------------------------------
EXE File     = smss.exe
PID          = 308
References   = 0
Thread Count = 2
-----------------------------------------------
EXE File     = csrss.exe
PID          = 412
References   = 0
Thread Count = 10
-----------------------------------------------
EXE File     = wininit.exe
PID          = 484
References   = 0
Thread Count = 1
-----------------------------------------------
  ... ... ... 
</pre>
</div>

<p>
API DOCS:
</p>
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot">CreateToolhelp32Snapshot function | Microsoft Docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/tlhelp32/nf-tlhelp32-process32first">Process32First function | Microsoft Docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/tlhelp32/nf-tlhelp32-process32firstw">Process32FirstW function | Microsoft Docs</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd1f18fd" class="outline-3">
<h3 id="orgd1f18fd"><span class="section-number-3">1.10</span> CODE - Show all DLLs or modules load by a process</h3>
<div class="outline-text-3" id="text-1-10">
<p>
This example program shows all modules, aka DLLs (Dynamic Linked
Libraries) loaded by some process given its PID.
</p>

<ul class="org-ul">
<li>Source:  <a href="src/windows/showModulesDLL.cpp">file:src/windows/showModulesDLL.cpp</a></li>
<li>Gist:    <a href="https://gist.github.com/caiorss/300a734093430bb8a66cd204526edbf6">showModulesDLL.cpp</a></li>
</ul>

<p>
Compile with MSVC (cl.exe)
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe showModulesDLL.cpp /EHsc /Zi /nologo /Fe:showModulesDLL.exe 
</pre>
</div>

<p>
Compile with MingW/GCC:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ g++ showModulesDLL.cpp -o <span class="org-keyword">showModulesDLL.exe</span> -std=c++14 -lpsapi 
</pre>
</div>

<p>
Running: 
</p>

<ul class="org-ul">
<li>List PID of all processes</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Get PID of all processes </span>
$ tasklist 
  ... ... ... ... ... ... ... ... ... ... ... ... 
svchost.exe                     88 Services                   0      5,920 K
dllhost.exe                   4572 Console                    1      9,520 K
notepad.exe                   5272 Console                    1     14,048 K
vctip.exe                     3564 Console                    1     10,920 K
svchost.exe                   1112 Services                   0      5,572 K
svchost.exe                   2996 Services                   0      7,140 K
SearchProtocolHost.exe        5636 Services                   0     11,964 K
SearchFilterHost.exe          1832 Services                   0      6,104 K
mspdbsrv.exe                  3416 Console                    1      5,888 K
... ... ... ... ... ... ... ... ... ... ... ... ... ... 
</pre>
</div>

<ul class="org-ul">
<li>Show DLLs loaded by process dllhost.exe  (PID 4572)</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ showModulesDLL.exe 4572
Process base name = DllHost.exe
Process path      = C:\Windows\System32\dllhost.exe

00007FF734720000     C:\WINDOWS\system32\DllHost.exe
00007FFBFA8C0000     C:\WINDOWS\SYSTEM32\ntdll.dll
00007FFBF98C0000     C:\WINDOWS\System32\KERNEL32.
00007FFBF78C0000     C:\WINDOWS\System32\KERNELBASE.d
00007FFBF6C90000     C:\WINDOWS\System32\ucrtbase.dll
00007FFBF7EE0000     C:\WINDOWS\System32\combase.dll
... ... ... ...   ... ... ... ...   ... ... ... ... 
00007FFBEDBA0000     C:\WINDOWS\SYSTEM32\iertutil.
00007FFBF65C0000     C:\WINDOWS\SYSTEM32\CRYPTBASE.DL

</pre>
</div>

<p>
Parts: 
</p>

<ul class="org-ul">
<li>Class ResourceHandler&lt;HANDLER&gt; is a RAII (Resource Aquisition Is
Initialization) for any generic resource which may not be a
pointer such as an integer for a file descriptor.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">class</span> <span class="org-type">HANDLER</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-keyword">class</span> <span class="org-type">ResourceHandler</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
<span class="org-function-name">public</span>:
    <span class="org-keyword">using</span> <span class="org-type">Disposer</span> = <span class="org-constant">std</span>::<span class="org-type">function</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">HANDLER</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>;
    <span class="org-function-name">ResourceHandler</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">HANDLER</span> <span class="org-variable-name">hnd</span>, <span class="org-type">Disposer</span> <span class="org-variable-name">disposer</span><span class="org-rainbow-delimiters-depth-2">)</span>
       : m_hnd<span class="org-rainbow-delimiters-depth-2">(</span>hnd<span class="org-rainbow-delimiters-depth-2">)</span>, m_fndisp<span class="org-rainbow-delimiters-depth-2">(</span>disposer<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>  <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">auto</span> <span class="org-function-name">get</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; <span class="org-type">HANDLER</span> <span class="org-rainbow-delimiters-depth-2">{</span>
       <span class="org-keyword">return</span> m_hnd;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    ~<span class="org-function-name">ResourceHandler</span><span class="org-rainbow-delimiters-depth-2">(){</span>
       m_fndisp<span class="org-rainbow-delimiters-depth-3">(</span>m_hnd<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">Disable copy-constructor and copy-assignment operator </span>
    <span class="org-function-name">ResourceHandler</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">ResourceHandler</span>&amp;<span class="org-rainbow-delimiters-depth-2">)</span> = <span class="org-keyword">delete</span>;
    <span class="org-keyword">auto</span> <span class="org-keyword">operator</span><span class="org-function-name">=</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-type">ResourceHandler</span>&amp;<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; ResourceHandler&amp; = <span class="org-keyword">delete</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Move member functios</span>
    <span class="org-function-name">ResourceHandler</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">ResourceHandler</span>&amp;&amp; <span class="org-variable-name">rhs</span><span class="org-rainbow-delimiters-depth-2">)</span>
     : m_hnd<span class="org-rainbow-delimiters-depth-2">(</span>rhs.m_hnd<span class="org-rainbow-delimiters-depth-2">)</span>,
       m_fndisp<span class="org-rainbow-delimiters-depth-2">(</span>rhs.m_fndisp<span class="org-rainbow-delimiters-depth-2">){</span> <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">auto</span> <span class="org-keyword">operator</span><span class="org-function-name">=</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">ResourceHandler</span>&amp;&amp; <span class="org-variable-name">rhs</span><span class="org-rainbow-delimiters-depth-2">){</span>
        <span class="org-constant">std</span>::swap<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>-&gt;m_hnd, rhs.m_hnd<span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">this</span>-&gt;m_fndisp = rhs-&gt;m_fndisp;     
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-function-name">private</span>:
    <span class="org-type">HANDLER</span> <span class="org-variable-name">m_hnd</span>;
    <span class="org-type">Disposer</span> <span class="org-variable-name">m_fndisp</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Namespace WProcess contains functions for querying processes:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">namespace</span> <span class="org-constant">WProcess</span><span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-keyword">using</span> <span class="org-type">ModuleConsumer</span> = <span class="org-constant">std</span>::<span class="org-type">function</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-keyword">auto</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-variable-name">HMODULE</span>, <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp;<span class="org-rainbow-delimiters-depth-3">)</span> -&gt; <span class="org-type">void</span><span class="org-rainbow-delimiters-depth-2">&gt;</span>;  
     <span class="org-keyword">auto</span> <span class="org-function-name">GetName</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>;
     <span class="org-keyword">auto</span> <span class="org-function-name">GetExecutablePath</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span>;
     <span class="org-keyword">auto</span> <span class="org-function-name">ForEachModule</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span>, <span class="org-type">ModuleConsumer</span> <span class="org-variable-name">FunIterator</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">void</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>Main function</b>
</p>

<ul class="org-ul">
<li>Get PID (Process ID) as program argument.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">DWORD</span> <span class="org-variable-name">pid</span>;
<span class="org-type">DWORD</span>  <span class="org-variable-name">flags</span> = PROCESS_QUERY_INFORMATION | PROCESS_VM_READ;

<span class="org-keyword">try</span><span class="org-rainbow-delimiters-depth-1">{</span>
    pid  = <span class="org-constant">std</span>::stoi<span class="org-rainbow-delimiters-depth-2">(</span>argv<span class="org-rainbow-delimiters-depth-3">[</span>1<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span> <span class="org-keyword">catch</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">invalid_argument</span>&amp; <span class="org-variable-name">ex</span><span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">"Error invalid PID"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    <span class="org-keyword">return</span> EXIT_FAILURE;
<span class="org-rainbow-delimiters-depth-1">}</span>  

<span class="org-comment-delimiter">// </span><span class="org-comment">Automatically closes this handle when it goes out of scope.</span>
<span class="org-keyword">auto</span> <span class="org-variable-name">hProc</span> = <span class="org-type">ResourceHandler</span><span class="org-rainbow-delimiters-depth-1">&lt;</span>HANDLE<span class="org-rainbow-delimiters-depth-1">&gt;{</span>
    ::OpenProcess<span class="org-rainbow-delimiters-depth-2">(</span>flags, FALSE, pid<span class="org-rainbow-delimiters-depth-2">)</span>,
    ::CloseHandle
<span class="org-rainbow-delimiters-depth-1">}</span>;
</pre>
</div>

<p>
Print process name: 
</p>

<div class="org-src-container">
<pre class="src src-cpp">
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Process base name = "</span>
          &lt;&lt; <span class="org-constant">WProcess</span>::GetName<span class="org-rainbow-delimiters-depth-1">(</span>hProc.get<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
          &lt;&lt; <span class="org-constant">std</span>::endl; 
</pre>
</div>

<p>
Print path to executable: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"Process path      = "</span>
          &lt;&lt; <span class="org-constant">WProcess</span>::GetExecutablePath<span class="org-rainbow-delimiters-depth-1">(</span>hProc.get<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
          &lt;&lt; <span class="org-constant">std</span>::endl;
</pre>
</div>

<p>
Print all DLLs used by the process:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Print all DLLs used by some process </span>
<span class="org-function-name">WProcess</span>::ForEachModule<span class="org-rainbow-delimiters-depth-1">(</span>
    hProc.get<span class="org-rainbow-delimiters-depth-2">()</span>,
    <span class="org-rainbow-delimiters-depth-2">[](</span><span class="org-type">HMODULE</span> <span class="org-variable-name">hmod</span>, <span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-2">)</span> -&gt; <span class="org-type">void</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
           <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-constant">std</span>::setw<span class="org-rainbow-delimiters-depth-3">(</span>10<span class="org-rainbow-delimiters-depth-3">)</span> &lt;&lt; hmod
                     &lt;&lt; <span class="org-constant">std</span>::setw<span class="org-rainbow-delimiters-depth-3">(</span>5<span class="org-rainbow-delimiters-depth-3">)</span>  &lt;&lt; <span class="org-string">" "</span>
                     &lt;&lt; <span class="org-constant">std</span>::left     &lt;&lt; <span class="org-constant">std</span>::setw<span class="org-rainbow-delimiters-depth-3">(</span>45<span class="org-rainbow-delimiters-depth-3">)</span> &lt;&lt; path
                     &lt;&lt; <span class="org-string">"\n"</span>;                   
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
<b>Functions in namespace WProcess</b>
</p>

<ul class="org-ul">
<li>WProcess::GetName</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-function-name">GetName</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-1">{</span>
      <span class="org-constant">std</span>::<span class="org-type">wstring</span> <span class="org-variable-name">basename</span><span class="org-rainbow-delimiters-depth-2">(</span>MAX_PATH, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
      <span class="org-type">int</span> <span class="org-variable-name">n1</span> = ::GetModuleBaseNameW<span class="org-rainbow-delimiters-depth-2">(</span>hProc, <span class="org-constant">NULL</span>, &amp;basename<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, MAX_PATH<span class="org-rainbow-delimiters-depth-2">)</span>;
      basename.resize<span class="org-rainbow-delimiters-depth-2">(</span>n1<span class="org-rainbow-delimiters-depth-2">)</span>;
      <span class="org-keyword">return</span> utf8_encode<span class="org-rainbow-delimiters-depth-2">(</span>basename<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>WProcess::GetExecutablePath</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-function-name">GetExecutablePath</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-constant">std</span>::<span class="org-type">wstring</span> <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-2">(</span>MAX_PATH, 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-type">int</span> <span class="org-variable-name">n2</span> = ::GetModuleFileNameExW<span class="org-rainbow-delimiters-depth-2">(</span>hProc, <span class="org-constant">NULL</span>, &amp;path<span class="org-rainbow-delimiters-depth-3">[</span>0<span class="org-rainbow-delimiters-depth-3">]</span>, MAX_PATH<span class="org-rainbow-delimiters-depth-2">)</span>;
     path.resize<span class="org-rainbow-delimiters-depth-2">(</span>n2<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> utf8_encode<span class="org-rainbow-delimiters-depth-2">(</span>path<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>WProcess::ForEachModule</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">auto</span> <span class="org-function-name">ForEachModule</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">HANDLE</span> <span class="org-variable-name">hProc</span>, <span class="org-type">ModuleConsumer</span> <span class="org-variable-name">FunIterator</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">HMODULE</span> <span class="org-variable-name">hMods</span><span class="org-rainbow-delimiters-depth-2">[</span>1024<span class="org-rainbow-delimiters-depth-2">]</span>;
     <span class="org-type">DWORD</span>   <span class="org-variable-name">cbNeeded</span>;
     <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span>::EnumProcessModules<span class="org-rainbow-delimiters-depth-3">(</span>hProc, hMods, <span class="org-keyword">sizeof</span><span class="org-rainbow-delimiters-depth-4">(</span>hMods<span class="org-rainbow-delimiters-depth-4">)</span>, &amp;cbNeeded<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">){</span>
            <span class="org-type">int</span> <span class="org-variable-name">n</span> = cbNeeded / <span class="org-keyword">sizeof</span><span class="org-rainbow-delimiters-depth-3">(</span>HMODULE<span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-constant">std</span>::<span class="org-type">wstring</span> <span class="org-variable-name">path</span><span class="org-rainbow-delimiters-depth-3">(</span>MAX_PATH, 0<span class="org-rainbow-delimiters-depth-3">)</span>;
            <span class="org-keyword">for</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">int</span> <span class="org-variable-name">i</span> = 0; i &lt; n; i++<span class="org-rainbow-delimiters-depth-3">){</span>
                <span class="org-type">DWORD</span> <span class="org-variable-name">nread</span> = ::GetModuleFileNameExW<span class="org-rainbow-delimiters-depth-4">(</span>hProc, hMods<span class="org-rainbow-delimiters-depth-5">[</span>i<span class="org-rainbow-delimiters-depth-5">]</span>, &amp;path<span class="org-rainbow-delimiters-depth-5">[</span>0<span class="org-rainbow-delimiters-depth-5">]</span>, MAX_PATH<span class="org-rainbow-delimiters-depth-4">)</span>;
                path.resize<span class="org-rainbow-delimiters-depth-4">(</span>nread<span class="org-rainbow-delimiters-depth-4">)</span>;     
                <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-4">(</span>nread<span class="org-rainbow-delimiters-depth-4">)</span> FunIterator<span class="org-rainbow-delimiters-depth-4">(</span>hMods<span class="org-rainbow-delimiters-depth-5">[</span>i<span class="org-rainbow-delimiters-depth-5">]</span>, utf8_encode<span class="org-rainbow-delimiters-depth-5">(</span>path<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>;
            <span class="org-rainbow-delimiters-depth-3">}</span>
     <span class="org-rainbow-delimiters-depth-2">}</span>  
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge5bd3d6" class="outline-3">
<h3 id="orge5bd3d6"><span class="section-number-3">1.11</span> CODE - List directory files</h3>
<div class="outline-text-3" id="text-1-11">
<p>
Program for listing directories, similar to U*nix's ls or Windows' dir
usign Win32 API.
</p>

<p>
Source:
</p>
<ul class="org-ul">
<li>File: <a href="src/windows/listFiles.cpp">file:src/windows/listFiles.cpp</a></li>
<li>Gist: <a href="https://gist.github.com/caiorss/17e9f2d79566b58b1ba65820c26bc1aa">listFiles.cpp</a></li>
</ul>

<p>
Compiling: 
</p>

<ul class="org-ul">
<li>MSVC</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">$ cl.exe listFiles.cpp /EHsc /Zi /nologo /Fe:listFiles.exe 
</pre>
</div>

<ul class="org-ul">
<li>Mingw/GCC</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">$ g++ listFiles.cpp -o <span class="org-keyword">listFiles.exe</span> -std=c++14 
</pre>
</div>

<p>
Usage: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ listFiles.exe <span class="org-string">"C:\*"</span>
 [TRACE] Console set to UTF8
directoryPath = C:<span class="org-string">\*</span>
 =&gt; $<span class="org-variable-name">GetCurrent</span>
 =&gt; $<span class="org-variable-name">Recycle</span>.Bin
 ... . ... ... .... .. .. ... 
 =&gt; pagefile.sys
 =&gt; PerfLogs
 =&gt; Program Files
 =&gt; Program Files (x86)
 ... ... ... ... 
 =&gt; Users
 =&gt; Windows
 =&gt; Windows10Upgrade
 [LOG] Handler &lt;hFile&gt; closed OK.
 [LOG] End sucessfully
 [TRACE] Console restored.

$ listFiles.exe <span class="org-string">"E:\*"</span>
 [TRACE] Console set to UTF8
directoryPath = E:<span class="org-string">\*</span>
 [LOG] Handler &lt;hFile&gt; closed OK.
 =&gt; Error code    = 3
 =&gt; Error message = The system cannot find the path specified.
 [TRACE] Console restored.


$ listFiles.exe <span class="org-string">"C:\windows\system32\*.dll"</span> 2&gt; log
directoryPath = C:\windows\system32<span class="org-string">\*</span>.dll
 =&gt; aadauthhelper.dll
 =&gt; aadcloudap.dll
 =&gt; aadjcsp.dll
 =&gt; aadtb.dll
 =&gt; aadWamExtension.dll
 =&gt; AboutSettingsHandlers.dll
 =&gt; AboveLockAppHost.dll
 ...    ...    ...    ... 
 [LOG] End sucessfully
</pre>
</div>

<p>
<b>Parts</b> 
</p>

<ul class="org-ul">
<li>Function: getLastErrorAsString - Returns a human readable
std::string description of GetLastError().</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Print human-readable description of GetLastError() - Error Code</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">Source: https://stackoverflow.com/questions/1387064 Requires:</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">&lt;string&gt;, &lt;sstream&gt;, &lt;windows.h&gt;,</span>
<span class="org-keyword">auto</span> <span class="org-function-name">getLastErrorAsString</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; <span class="org-constant">std</span>::<span class="org-type">string</span> <span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">//</span><span class="org-comment">Get the error message, if any.</span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">errorMessageID</span> = ::GetLastError<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>errorMessageID == 0<span class="org-rainbow-delimiters-depth-2">)</span>
        <span class="org-keyword">return</span> <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-type">LPSTR</span> <span class="org-variable-name">messageBuffer</span> = <span class="org-constant">nullptr</span>;
    <span class="org-keyword">static</span> <span class="org-keyword">const</span> <span class="org-type">DWORD</span> <span class="org-variable-name">flags</span>  =
      FORMAT_MESSAGE_ALLOCATE_BUFFER
      | FORMAT_MESSAGE_FROM_SYSTEM
      | FORMAT_MESSAGE_IGNORE_INSERTS;
    <span class="org-type">size_t</span> <span class="org-variable-name">size</span> = FormatMessageA<span class="org-rainbow-delimiters-depth-2">(</span>
                flags,
                <span class="org-constant">NULL</span>,
                errorMessageID,
                MAKELANGID<span class="org-rainbow-delimiters-depth-3">(</span>LANG_NEUTRAL, SUBLANG_DEFAULT<span class="org-rainbow-delimiters-depth-3">)</span>,
                <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">LPSTR</span><span class="org-rainbow-delimiters-depth-3">)</span>&amp;messageBuffer, 0, <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">message</span> = <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-2">(</span>messageBuffer, size<span class="org-rainbow-delimiters-depth-2">)</span>;
        <span class="org-keyword">auto</span> <span class="org-variable-name">ss</span> = <span class="org-constant">std</span>::stringstream<span class="org-rainbow-delimiters-depth-2">(</span>message<span class="org-rainbow-delimiters-depth-2">)</span>;
        <span class="org-keyword">auto</span> <span class="org-variable-name">line</span> = <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-2">{}</span>;
        <span class="org-constant">std</span>::getline<span class="org-rainbow-delimiters-depth-2">(</span>ss, line, <span class="org-string">'\r'</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">//</span><span class="org-comment">Free the buffer.</span>
    LocalFree<span class="org-rainbow-delimiters-depth-2">(</span>messageBuffer<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> line;  
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<ul class="org-ul">
<li>Function <span class="underline">EnumereFiles</span> encapsulates the WinAPIs <a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findfirstfilew">FindFileFirstW</a> and
<a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findnextfilew">FindNextFileW</a>. This function iterate over files of some directory
and applies an Enumerator function taking a string (file name) and
returning a boolean. The iteration continues until the enumerator
function returns false.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"> <span class="org-keyword">using</span> <span class="org-type">FileEnumerator</span> = <span class="org-constant">std</span>::<span class="org-type">function</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">bool</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp;<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>;

<span class="org-comment-delimiter">/** </span><span class="org-comment">Enumerate files of some directory util enumerator function (callback) returns false. </span>
<span class="org-comment">  * - path       - Directory path to be listed </span>
<span class="org-comment">  * - Enumerator - Functions which consumes a string (file listed) and returns bool.</span>
<span class="org-comment">  *                this function returns false when it is no longer interested in </span>
<span class="org-comment">  *                being called. When it returns false the iteration stops. </span>
<span class="org-comment">  *</span>
<span class="org-comment">  * - Return    - Returns error code from GetLastError(). If it is successful, </span>
<span class="org-comment">  *               the function returns ERROR_SUCCESS.</span>
<span class="org-comment">  */</span>
<span class="org-keyword">auto</span> <span class="org-function-name">EnumerateFiles</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-constant">std</span>::<span class="org-type">string</span>&amp; <span class="org-variable-name">path</span>, <span class="org-type">FileEnumerator</span> <span class="org-variable-name">Enumerator</span><span class="org-rainbow-delimiters-depth-1">)</span> -&gt; <span class="org-type">int</span> <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-type">WIN32_FIND_DATAW</span> <span class="org-variable-name">fdata</span>;
     <span class="org-type">HANDLE</span> <span class="org-variable-name">hFind</span> = INVALID_HANDLE_VALUE;
     <span class="org-comment-delimiter">// </span><span class="org-comment">Ensure that resource hFind is always disposed. </span>
     <span class="org-keyword">auto</span> <span class="org-variable-name">close_hFind</span> = CloseHandleRAAI<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::bind<span class="org-rainbow-delimiters-depth-3">(</span>CloseHandleLog, hFind, <span class="org-string">"hFile"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
     hFind = FindFirstFileW<span class="org-rainbow-delimiters-depth-2">(</span>utf8_decode<span class="org-rainbow-delimiters-depth-3">(</span>path<span class="org-rainbow-delimiters-depth-3">)</span>.c_str<span class="org-rainbow-delimiters-depth-3">()</span>, &amp;fdata<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>hFind == INVALID_HANDLE_VALUE<span class="org-rainbow-delimiters-depth-2">)</span>
             <span class="org-keyword">return</span> GetLastError<span class="org-rainbow-delimiters-depth-2">()</span>;
     <span class="org-keyword">do</span> <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-comment-delimiter">//</span><span class="org-comment">Consumer function </span>
             <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-negation-char">!</span>Enumerator<span class="org-rainbow-delimiters-depth-4">(</span>utf8_encode<span class="org-rainbow-delimiters-depth-5">(</span>fdata.cFileName<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-keyword">break</span>;
     <span class="org-rainbow-delimiters-depth-2">}</span> <span class="org-keyword">while</span><span class="org-rainbow-delimiters-depth-2">(</span>FindNextFileW<span class="org-rainbow-delimiters-depth-3">(</span>hFind, &amp;fdata<span class="org-rainbow-delimiters-depth-3">)</span> != 0<span class="org-rainbow-delimiters-depth-2">)</span>;
     <span class="org-keyword">return</span> ERROR_SUCCESS;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Main function: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-1">(</span>argc &lt; 2<span class="org-rainbow-delimiters-depth-1">){</span>
    <span class="org-constant">std</span>::cerr &lt;&lt; <span class="org-string">"Usage: "</span> &lt;&lt; argv<span class="org-rainbow-delimiters-depth-2">[</span>0<span class="org-rainbow-delimiters-depth-2">]</span> &lt;&lt; <span class="org-string">" "</span> &lt;&lt; <span class="org-string">"[PATH]"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    <span class="org-keyword">return</span> EXIT_FAILURE;
<span class="org-rainbow-delimiters-depth-1">}</span>
<span class="org-keyword">auto</span> <span class="org-variable-name">utf8Console</span> = ConsoleUTF8<span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-keyword">auto</span> <span class="org-variable-name">directoryPath</span> = <span class="org-constant">std</span>::string<span class="org-rainbow-delimiters-depth-1">{</span>argv<span class="org-rainbow-delimiters-depth-2">[</span>1<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">}</span>;
<span class="org-function-name">std</span>::cout &lt;&lt; <span class="org-string">"directoryPath = "</span> &lt;&lt; directoryPath &lt;&lt; <span class="org-string">"\n"</span>;
<span class="org-type">int</span> <span class="org-variable-name">count</span> = 0;  
<span class="org-comment-delimiter">// </span><span class="org-comment">Show 50 first files. </span>
<span class="org-type">int</span> <span class="org-variable-name">status</span> = EnumerateFiles<span class="org-rainbow-delimiters-depth-1">(</span>
    directoryPath,
    <span class="org-rainbow-delimiters-depth-2">[</span>&amp;<span class="org-variable-name">count</span><span class="org-rainbow-delimiters-depth-2">](</span><span class="org-keyword">const</span> <span class="org-keyword">auto</span>&amp; <span class="org-variable-name">file</span><span class="org-rainbow-delimiters-depth-2">){</span>
            <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; "</span> &lt;&lt; file &lt;&lt; <span class="org-string">"\n"</span>;
            <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-3">(</span>count++ &lt; 50<span class="org-rainbow-delimiters-depth-3">)</span>
                    <span class="org-keyword">return</span> <span class="org-constant">true</span>;
            <span class="org-keyword">else</span>
                    <span class="org-keyword">return</span> <span class="org-constant">false</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-1">(</span>status != ERROR_SUCCESS<span class="org-rainbow-delimiters-depth-1">){</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; Error code    = "</span> &lt;&lt; ::GetLastError<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-constant">std</span>::endl;
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" =&gt; Error message = "</span> &lt;&lt; getLastErrorAsString<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-constant">std</span>::endl;
     <span class="org-keyword">return</span> EXIT_FAILURE;
<span class="org-rainbow-delimiters-depth-1">}</span>   
<span class="org-function-name">std</span>::puts<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">" [LOG] End sucessfully"</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">return</span> EXIT_SUCCESS;
</pre>
</div>

<p>
WinAPIs used: 
</p>
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findfirstfilew">FindFileFirstW</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findnextfilew">FindNextFileW</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms679360(v=vs.85).aspx">GetLastError</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-formatmessage">FormatMessage</a></li>
</ul>
</div>
</div>
<div id="outline-container-org583b667" class="outline-3">
<h3 id="org583b667"><span class="section-number-3">1.12</span> Install Building Tools and Compilers</h3>
<div class="outline-text-3" id="text-1-12">
</div>
<div id="outline-container-org1ef7aaa" class="outline-4">
<h4 id="org1ef7aaa"><span class="section-number-4">1.12.1</span> Install Mingw</h4>
<div class="outline-text-4" id="text-1-12-1">
<p>
Migw - gcc/g++ GNU C/C++ Compiler ported for Windows  - <a href="https://chocolatey.org/packages/mingw">mingw</a>
</p>

<p>
Tools: 
</p>
<ul class="org-ul">
<li>gcc =&gt; GNU C compiler</li>
<li>g++ =&gt; GNU C++ compiler</li>
<li>gfortran =&gt; GNU Fortran Compiler</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ choco install -f mingw 
</pre>
</div>

<p>
Note the tools are installed at: <code>C:\tools\mingw64\bin\</code>
</p>

<p>
Check installed tools:
</p>

<div class="org-src-container">
<pre class="src src-sh">&#955; dir C:\tools\mingw64\bin
 Volume<span class="org-keyword"> in</span> drive C has no label.
 Volume Serial Number is CEFD-3D70

 Directory of C:\tools\mingw64\bin

12/28/2015  08:49 PM    &lt;DIR&gt;          .
12/28/2015  08:49 PM    &lt;DIR&gt;          ..
12/28/2015  05:51 PM         1,003,008 addr2line.exe
12/28/2015  05:51 PM         1,029,120 ar.exe
12/28/2015  05:51 PM         1,781,248 as.exe
12/28/2015  07:32 PM         1,812,480 c++.exe
12/28/2015  05:51 PM         1,001,472 c++filt.exe
12/28/2015  07:32 PM         1,810,944 cpp.exe
12/28/2015  05:51 PM         1,061,888 dlltool.exe
12/28/2015  05:51 PM            55,296 dllwrap.exe
12/28/2015  05:51 PM         3,037,696 dwp.exe
12/28/2015  05:51 PM            41,984 elfedit.exe
12/28/2015  07:32 PM         1,812,480 g++.exe
12/28/2015  07:32 PM            62,464 gcc-ar.exe
12/28/2015  07:32 PM            61,952 gcc-nm.exe
12/28/2015  07:32 PM            61,952 gcc-ranlib.exe
12/28/2015  07:32 PM         1,809,920 gcc.exe
12/28/2015  07:32 PM         1,391,616 gcov-tool.exe
12/28/2015  07:32 PM         1,409,536 gcov.exe
12/28/2015  08:47 PM            58,333 gdb.exe
12/28/2015  08:47 PM         7,786,103 gdborig.exe
12/28/2015  08:47 PM           412,003 gdbserver.exe
12/28/2015  07:34 PM            57,856 gendef.exe
12/28/2015  07:34 PM            75,264 genidl.exe
12/28/2015  07:34 PM            31,232 genpeimg.exe
12/28/2015  07:32 PM         1,811,968 gfortran.exe
12/28/2015  05:51 PM         1,069,568 gprof.exe
12/28/2015  05:51 PM         1,419,264 ld.bfd.exe
12/28/2015  05:51 PM         1,419,264 ld.exe
12/28/2015  05:51 PM         4,806,144 ld.gold.exe
12/28/2015  07:33 PM            37,888 libatomic-1.dll
12/28/2015  07:33 PM            82,944 libgcc_s_seh-1.dll
12/28/2015  07:33 PM         1,293,312 libgfortran-3.dll
12/28/2015  07:33 PM           112,640 libgomp-1.dll
12/28/2015  07:33 PM            17,920 libgomp-plugin-host_nonshm-1.dll
12/28/2015  07:33 PM           333,824 libquadmath-0.dll
12/28/2015  07:33 PM            19,968 libssp-0.dll
12/28/2015  07:33 PM         1,424,896 libstdc++-6.dll
12/28/2015  07:33 PM            16,384 libvtv-0.dll
12/28/2015  07:33 PM            16,384 libvtv_stubs-0.dll
12/28/2015  07:33 PM            83,456 libwinpthread-1.dll
12/28/2015  08:49 PM           219,648 mingw32-make.exe
12/28/2015  05:51 PM         1,013,760 nm.exe
12/28/2015  05:51 PM         1,171,456 objcopy.exe
12/28/2015  05:51 PM         2,101,760 objdump.exe
12/28/2015  05:51 PM         1,029,120 ranlib.exe
12/28/2015  05:51 PM           490,496 readelf.exe
12/28/2015  05:51 PM         1,004,032 size.exe
12/28/2015  05:51 PM         1,003,520 strings.exe
12/28/2015  05:51 PM         1,171,456 strip.exe
12/28/2015  07:35 PM           437,760 widl.exe
12/28/2015  05:51 PM         1,027,072 windmc.exe
12/28/2015  05:51 PM         1,115,648 windres.exe
12/28/2015  07:32 PM         1,812,480 x86_64-w64-mingw32-c++.exe
12/28/2015  07:32 PM         1,812,480 x86_64-w64-mingw32-g++.exe
12/28/2015  07:32 PM         1,809,920 x86_64-w64-mingw32-gcc-5.3.0.exe
12/28/2015  07:32 PM            62,464 x86_64-w64-mingw32-gcc-ar.exe
12/28/2015  07:32 PM            61,952 x86_64-w64-mingw32-gcc-nm.exe
12/28/2015  07:32 PM            61,952 x86_64-w64-mingw32-gcc-ranlib.exe
12/28/2015  07:32 PM         1,809,920 x86_64-w64-mingw32-gcc.exe
12/28/2015  07:32 PM         1,811,968 x86_64-w64-mingw32-gfortran.exe
              59 File(s)     62,660,535 bytes
               2 Dir(s)  19,433,713,664 bytes free

</pre>
</div>

<p>
See: 
</p>

<ul class="org-ul">
<li><a href="https://www.transmissionzero.co.uk/computing/building-dlls-with-mingw/">Building Windows DLLs with MinGW</a></li>
<li><a href="https://www.codeproject.com/Articles/84461/MinGW-Static-and-Dynamic-Libraries">MinGW Static and Dynamic Libraries - CodeProject</a></li>
<li></li>

<li></li>
</ul>
</div>
</div>
<div id="outline-container-org5dab771" class="outline-4">
<h4 id="org5dab771"><span class="section-number-4">1.12.2</span> Install Visual Studio + Microsft MSVC C++ Compiler</h4>
<div class="outline-text-4" id="text-1-12-2">
<p>
Installing Visual Studio building tools directly is hassle as
Microsoft doesn't provide an easy and quick way to install it as Linux
development tools which can be quick installed by using the command
line and trusted repositories. However <a href="https://chocolatey.org/">chocolately</a> package manager
provides a Linux-like solution to install those development tools in
an automatic and seamlessly way.
</p>

<p>
Visual Studio Build Tools 2015 - <a href="https://chocolatey.org/packages/VisualCppBuildTools">Visual C++ Build Tools 2015 14.0.25420.1</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">$ choco install visualcppbuildtools
</pre>
</div>

<p>
Visual C++ 2017 - <a href="https://chocolatey.org/packages/visualstudio2017buildtools">Visual Studio 2017 Build Tools 15.2.26430.20170650</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">$ choco install hoco install visualstudio2017buildtools 
</pre>
</div>
</div>
</div>
<div id="outline-container-org29ed73c" class="outline-4">
<h4 id="org29ed73c"><span class="section-number-4">1.12.3</span> Install CMDER Terminal Emulator</h4>
<div class="outline-text-4" id="text-1-12-3">
<p>
CMDER Is decent ANSI/VT100 compliant terminal emulator which supports
ANI Escape sequences, ANSI colors and Emacs Keybindigns used on bash.
</p>

<div class="org-src-container">
<pre class="src src-sh">$ choco install cmder 
</pre>
</div>
</div>
</div>
<div id="outline-container-org924d976" class="outline-4">
<h4 id="org924d976"><span class="section-number-4">1.12.4</span> Install SysInternals</h4>
<div class="outline-text-4" id="text-1-12-4">
<p>
SysInterals - <a href="https://chocolatey.org/packages/sysinternals">https://chocolatey.org/packages/sysinternals</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">$  choco install sysinternals 
</pre>
</div>

<p>
Process Explorer - <a href="https://chocolatey.org/packages/procexp">https://chocolatey.org/packages/procexp</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">$ choco install procexp 
</pre>
</div>
</div>
</div>
<div id="outline-container-orge415c8b" class="outline-4">
<h4 id="orge415c8b"><span class="section-number-4">1.12.5</span> Install IDA Free Disassembler</h4>
<div class="outline-text-4" id="text-1-12-5">
<p>
IDA - Free - Famous Disassembler - <a href="https://chocolatey.org/packages/ida-free">https://chocolatey.org/packages/ida-free</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">$ choco install ida-free 
</pre>
</div>
</div>
</div>
<div id="outline-container-org94f3ab1" class="outline-4">
<h4 id="org94f3ab1"><span class="section-number-4">1.12.6</span> ILSpy - Dissabler for C#</h4>
<div class="outline-text-4" id="text-1-12-6">
<ul class="org-ul">
<li><a href="http://chocolately.org/pakcages/lspy">http://chocolately.org/pakcages/lspy</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ choco install -y ilspy 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org181d73e" class="outline-3">
<h3 id="org181d73e"><span class="section-number-3">1.13</span> MSVC Compiler Options</h3>
<div class="outline-text-3" id="text-1-13">
<p>
MSVC Native tools: 
</p>

<ul class="org-ul">
<li>CC = cl.exe
<ul class="org-ul">
<li>C and C++ Compiler - Can compile both C and C++ code depending on
the flag. By default it compiles C++ code.</li>
</ul></li>
<li>rc.exe =&gt; Resource Compiler.</li>
<li>LD = link.exe 
<ul class="org-ul">
<li>C++ Linker.</li>
</ul></li>
<li>AS = ml
<ul class="org-ul">
<li>Assembler</li>
</ul></li>
<li>AR = lib
<ul class="org-ul">
<li>Archiver</li>
</ul></li>
</ul>

<p>
Compiler: cl.exe 
</p>

<ul class="org-ul">
<li>/nologo - Suppress microsoft's logo</li>

<li>/out:&lt;file.exe&gt; - Set output file name.</li>

<li>/EHsc</li>

<li>/Zi - Add debugging symbols to the executable</li>

<li>/c - Doesn't link generating *.exe or *.dll, it creates only
intermedidate object code for further separate linking. It is
useful for compiling large code bases where each compilation unit
can be compiled separately.</li>

<li>/W4 - Set the level of warning to the highest.</li>

<li>/entry:&lt;entrypoint&gt; - Set the C/C++ runtime, it can be:
<ul class="org-ul">
<li>mainCRTStartup     =&gt; calls main(), the entrypoint for console mode apps</li>
<li>wmainCRTStartup    =&gt; calls wmain(), as above but the Unicode version</li>
<li>WinMainCRTStartup  =&gt; calls WinMain(), the entrypoint for native Windows apps</li>
<li>wWinMainCRTStartup =&gt; calls wWinMain(), as above but the Unicode version</li>
<li>_DllMainCRTStartup =&gt; Calls DLLMain()</li>
</ul></li>

<li>/subsystem:&lt;type&gt; - Set the subsystem - default Console, it can be:

<ul class="org-ul">
<li><span class="underline">/subsystem:console</span> - For applications that necessarly runs in the
console (aka terminal emulator)</li>

<li><span class="underline">/subsystem:windows</span> - Doesn't display the cmd.exe terminal when
ones click at the application executable.</li>
</ul></li>

<li>/TC  -&gt; Specify that file name is C source code</li>
<li>/TP  -&gt; Specify that file name is a C++ source code (default)</li>
<li>/MD, /MT, /LD =&gt; Run-time library - Indcates that object-code
(compiled program) is a DLL.</li>
<li>/GF -&gt; (Eliminate Duplicate Strings) - Enables the compiler to
create a single copy of identical strings in the program image and
in memory during execution. This is an optimization called string
pooling that can create smaller programs.</li>
</ul>

<p>
See: 
</p>
<ul class="org-ul">
<li><a href="https://github.com/MicrosoftDocs/cpp-docs/blob/master/docs/build/building-on-the-command-line.md">https://github.com/MicrosoftDocs/cpp-docs/blob/master/docs/build/building-on-the-command-line.md</a></li>
</ul>

<p>
Useful preprocessor: 
</p>

<ul class="org-ul">
<li>Set subsystem</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#pragma</span> comment<span class="org-rainbow-delimiters-depth-1">(</span>linker, <span class="org-string">"/SUBSYSTEM:WINDOWS"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-preprocessor">#pragma</span> comment<span class="org-rainbow-delimiters-depth-1">(</span>linker, <span class="org-string">"/SUBSYSTEM:CONSOLE"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Set linker library to be linked. This pragma is particularly useful
in graphical applications.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#pragma</span> comment<span class="org-rainbow-delimiters-depth-1">(</span>lib, <span class="org-string">"user32.lib"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Examples: 
</p>

<ul class="org-ul">
<li>Compile multiple files generating an executable named out.exe. Note
the default subsystems is the console (<span class="underline">/subsystem:console</span>) and the
default entry point is (mainCRTStartup).
<ul class="org-ul">
<li>/Isrc/includes  =&gt; Directories containing header files</li>
<li>/ld or /linker  =&gt; Linker flags</li>
<li>&amp;&amp; out.exe      =&gt; If the compilation is successful runs the
generated executable out.exe</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe source1.cpp source2.cpp /Fe:out.exe /Isrc/includes /ld gdi.lib user32.lib &amp;&amp; out.exe
</pre>
</div>

<ul class="org-ul">
<li>Compile multiple files for windows subsystem (GUI app) and with
wmainCRtstartup.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ cl.exe source1.cpp source2.cpp /Fe:out.exe /Isrc/includes /entry:wmainCRtstartup /subsystem:windows /ld user32.lib &amp;&amp; out.exe
</pre>
</div>

<p>
References: 
</p>

<ul class="org-ul">
<li><a href="http://psy.swansea.ac.uk/staff/carter/Compiling/compilation_build.htm">Command Line Compilation</a></li>
<li><a href="https://cognitivewaves.wordpress.com/makefiles/">Makefiles and Visual Studio | Cognitive Waves</a></li>
<li><a href="http://resources.esri.com/help/9.3/arcgisengine/com_cpp/Cpp/reference/Makefile.Windows.htm">C++ Windows Makefile</a></li>
<li><a href="https://w3.cs.jmu.edu/bernstdh/web/common/help/msc_development.php">MS C/C++: The Command-Line Tools</a></li>
</ul>

<p>
See also: 
</p>

<ul class="org-ul">
<li><a href="https://support.microsoft.com/en-us/help/94248/how-to-use-the-c-run-time">How To Use the C Run-Time</a></li>

<li></li>


<li></li>
</ul>
</div>
</div>
<div id="outline-container-org27ced20" class="outline-3">
<h3 id="org27ced20"><span class="section-number-3">1.14</span> WINAPI Map</h3>
<div class="outline-text-3" id="text-1-14">
</div>
<div id="outline-container-org39ce0d8" class="outline-4">
<h4 id="org39ce0d8"><span class="section-number-4">1.14.1</span> Misc.</h4>
<div class="outline-text-4" id="text-1-14-1">
<ul class="org-ul">
<li><a href="https://www.pinvoke.net/">https://www.pinvoke.net/</a>
<ul class="org-ul">
<li>Note: Lists of Windows API functions grouped by system DLLs. It
has better discoverability and usability than MSDN docs.</li>
<li><a href="https://www.pinvoke.net/default.aspx/kernel32.AllocConsole">kernel32.dll</a></li>
<li><a href="https://www.pinvoke.net/default.aspx/advapi32.CreateService">advapi32.dll</a></li>
<li><a href="https://www.pinvoke.net/default.aspx/wininet.FtpCommand">wininet.dll</a> - High level functions for Http and Ftp protocol.</li>
<li></li>
</ul></li>

<li><a href="https://www-user.tu-chemnitz.de/~heha/viewchm.php/hs/Win32SEH.chm/">Win32 Structured Exception Handler</a></li>

<li><a href="https://blogs.windows.com/buildingapps/2017/07/06/calling-winrt-components-win32-process-via-desktop-bridge/">Calling WinRT Components from a Win32 process via the Desktop Bridge</a></li>
</ul>
</div>
</div>

<div id="outline-container-org86aa4bd" class="outline-4">
<h4 id="org86aa4bd"><span class="section-number-4">1.14.2</span> File</h4>
<div class="outline-text-4" id="text-1-14-2">
<p>
Ref: 
</p>
<ul class="org-ul">
<li><a href="https://www.ugrad.cs.ubc.ca/~cs219/CourseNotes/Windows/win32-functions.html">Win32 Functions</a></li>
<li><a href="https://support.dce.felk.cvut.cz/pos/os_api/win32-2.html">System Software Win32 File API</a></li>
</ul>

<p>
CreateFile.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">HANDLE</span> <span class="org-function-name">CreateFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
    <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpFileName</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">pointer to name of the file </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">dwDesiredAccess</span>,  <span class="org-comment-delimiter">// </span><span class="org-comment">access (read-write) mode </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">dwShareMode</span>,  <span class="org-comment-delimiter">// </span><span class="org-comment">share mode </span>
    <span class="org-type">LPSECURITY_ATTRIBUTES</span> <span class="org-variable-name">lpSecurityAttributes</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">pointer to security descriptor </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">dwCreationDistribution</span>,   <span class="org-comment-delimiter">// </span><span class="org-comment">how to create </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">dwFlagsAndAttributes</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">file attributes </span>
    <span class="org-type">HANDLE</span> <span class="org-variable-name">hTemplateFile</span>    <span class="org-comment-delimiter">// </span><span class="org-comment">handle to file with attributes to copy  </span>
   <span class="org-rainbow-delimiters-depth-1">)</span>;   
</pre>
</div>

<p>
ReadFile: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">ReadFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
    <span class="org-type">HANDLE</span> <span class="org-variable-name">hFile</span>,   <span class="org-comment-delimiter">// </span><span class="org-comment">handle of file to read </span>
    <span class="org-type">LPVOID</span> <span class="org-variable-name">lpBuffer</span>,    <span class="org-comment-delimiter">// </span><span class="org-comment">address of buffer that receives data  </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">nNumberOfBytesToRead</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">number of bytes to read </span>
    <span class="org-type">LPDWORD</span> <span class="org-variable-name">lpNumberOfBytesRead</span>,    <span class="org-comment-delimiter">// </span><span class="org-comment">address of number of bytes read </span>
    <span class="org-type">LPOVERLAPPED</span> <span class="org-variable-name">lpOverlapped</span>   <span class="org-comment-delimiter">// </span><span class="org-comment">address of structure for data </span>
   <span class="org-rainbow-delimiters-depth-1">)</span>;   

</pre>
</div>

<p>
WriteFile:
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">WriteFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
    <span class="org-type">HANDLE</span> <span class="org-variable-name">hFile</span>,   <span class="org-comment-delimiter">// </span><span class="org-comment">handle to file to write to </span>
    <span class="org-type">LPCVOID</span> <span class="org-variable-name">lpBuffer</span>,   <span class="org-comment-delimiter">// </span><span class="org-comment">pointer to data to write to file </span>
    <span class="org-type">DWORD</span> <span class="org-variable-name">nNumberOfBytesToWrite</span>,    <span class="org-comment-delimiter">// </span><span class="org-comment">number of bytes to write </span>
    <span class="org-type">LPDWORD</span> <span class="org-variable-name">lpNumberOfBytesWritten</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">pointer to number of bytes written </span>
    <span class="org-type">LPOVERLAPPED</span> <span class="org-variable-name">lpOverlapped</span>   <span class="org-comment-delimiter">// </span><span class="org-comment">pointer to structure needed for overlapped I/O</span>
   <span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
Copy File: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">CopyFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpExistingFileName</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">name of an existing file</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpNewFileName</span>,      <span class="org-comment-delimiter">// </span><span class="org-comment">name of new file</span>
  <span class="org-type">BOOL</span> <span class="org-variable-name">bFailIfExists</span>          <span class="org-comment-delimiter">// </span><span class="org-comment">operation if file exists</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;

</pre>
</div>

<p>
Delete File: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">DeleteFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpFileName</span>   <span class="org-comment-delimiter">// </span><span class="org-comment">file name</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
Move File: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">MoveFile</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpExistingFileName</span>, <span class="org-comment-delimiter">// </span><span class="org-comment">file name</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpNewFileName</span>       <span class="org-comment-delimiter">// </span><span class="org-comment">new file name</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
Create Directory: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">CreateDirectory</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpPathName</span>,                         <span class="org-comment-delimiter">// </span><span class="org-comment">directory name</span>
  <span class="org-type">LPSECURITY_ATTRIBUTES</span> <span class="org-variable-name">lpSecurityAttributes</span>  <span class="org-comment-delimiter">// </span><span class="org-comment">SD</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
Remove Directory: 
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">RemoveDirectory</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">LPCTSTR</span> <span class="org-variable-name">lpPathName</span>   <span class="org-comment-delimiter">// </span><span class="org-comment">directory name</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbb8750" class="outline-4">
<h4 id="orgfbb8750"><span class="section-number-4">1.14.3</span> Process Information</h4>
<div class="outline-text-4" id="text-1-14-3">
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-getcurrentprocessid">GetCurrentProcessId</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">DWORD</span> <span class="org-function-name">GetCurrentProcessId</span><span class="org-rainbow-delimiters-depth-1">()</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-getcurrentprocess">GetCurrentProcess</a>
<ul class="org-ul">
<li>Returns handle to current process.</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">HANDLE</span> <span class="org-function-name">GetCurrentProcess</span><span class="org-rainbow-delimiters-depth-1">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7360cfe" class="outline-4">
<h4 id="org7360cfe"><span class="section-number-4">1.14.4</span> Process Manipulation</h4>
<div class="outline-text-4" id="text-1-14-4">
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa">CreateProcessA</a> and <a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessw">CreateProcessW</a>
<ul class="org-ul">
<li>MSDN: "Creates a new process and its primary thread. The new
process runs in the security context of the calling process."</li>
</ul></li>

<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess">TerminateProcess</a>
<ul class="org-ul">
<li>MSDN: "Terminates the specified process and all of its threads."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">TerminateProcess</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">HANDLE</span> <span class="org-variable-name">hProcess</span>,
  <span class="org-type">UINT</span>   <span class="org-variable-name">uExitCode</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-openprocess">OpenProcess</a>
<ul class="org-ul">
<li>MSDN: "Opens an existing local process object."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">HANDLE</span> <span class="org-function-name">OpenProcess</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">DWORD</span> <span class="org-variable-name">dwDesiredAccess</span>,
  <span class="org-type">BOOL</span>  <span class="org-variable-name">bInheritHandle</span>,
  <span class="org-type">DWORD</span> <span class="org-variable-name">dwProcessId</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680553(v=vs.85).aspx">ReadProcessMemory</a>
<ul class="org-ul">
<li>MSDN: "Reads data <span class="underline">from an area of memory in a specified process</span>. The
entire area to be read must be accessible or the operation
fails."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp">BOOL <span class="org-type">WINAPI</span> <span class="org-function-name">ReadProcessMemory</span><span class="org-rainbow-delimiters-depth-1">(</span>
  _In_  <span class="org-type">HANDLE</span>  <span class="org-variable-name">hProcess</span>,
  _In_  <span class="org-type">LPCVOID</span> <span class="org-variable-name">lpBaseAddress</span>,
  _Out_ <span class="org-type">LPVOID</span>  <span class="org-variable-name">lpBuffer</span>,
  _In_  <span class="org-type">SIZE_T</span>  <span class="org-variable-name">nSize</span>,
  _Out_ <span class="org-type">SIZE_T</span>  *<span class="org-variable-name">lpNumberOfBytesRead</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createremotethread">CreateRemoteThread</a>
<ul class="org-ul">
<li>MSDN: "Use the CreateRemoteThreadEx <span class="underline">function to create a thread that</span>
<span class="underline">runs in the virtual address space of another process and</span>
optionally specify extended attributes."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">HANDLE</span> <span class="org-function-name">CreateRemoteThread</span><span class="org-rainbow-delimiters-depth-1">(</span>
  <span class="org-type">HANDLE</span>                 <span class="org-variable-name">hProcess</span>,
  <span class="org-type">LPSECURITY_ATTRIBUTES</span>  <span class="org-variable-name">lpThreadAttributes</span>,
  <span class="org-type">SIZE_T</span>                 <span class="org-variable-name">dwStackSize</span>,
  <span class="org-type">LPTHREAD_START_ROUTINE</span> <span class="org-variable-name">lpStartAddress</span>,
  <span class="org-type">LPVOID</span>                 <span class="org-variable-name">lpParameter</span>,
  <span class="org-type">DWORD</span>                  <span class="org-variable-name">dwCreationFlags</span>,
  <span class="org-type">LPDWORD</span>                <span class="org-variable-name">lpThreadId</span>
<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9840878" class="outline-4">
<h4 id="org9840878"><span class="section-number-4">1.14.5</span> Dynamic Linking or Runtime Linking</h4>
<div class="outline-text-4" id="text-1-14-5">
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibraryA</a> and <a href="https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibraryw">LoadLibraryW</a>
<ul class="org-ul">
<li>MSDN: "Loads the specified module into the address space of the calling
process. The specified module may cause other modules to be
loaded."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">ANSI API </span>
<span class="org-type">HMODULE</span> <span class="org-function-name">LoadLibraryA</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">LPCSTR</span> <span class="org-variable-name">lpLibFileName</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-comment-delimiter">// </span><span class="org-comment">Unicode API </span>
<span class="org-type">HMODULE</span> <span class="org-function-name">LoadLibraryW</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">LPCWSTR</span> <span class="org-variable-name">lpLibFileName</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a>
<ul class="org-ul">
<li>MSDN: "Retrieves the <span class="underline">address of an exported function</span> (function pointer)
or variable from the specified dynamic-link library (DLL)."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">FARPROC</span> <span class="org-function-name">GetProcAddress</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">HMODULE</span> <span class="org-variable-name">hModule</span>, <span class="org-type">LPCSTR</span>  <span class="org-variable-name">lpProcName</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-freelibrary">FreeLibrary</a>
<ul class="org-ul">
<li>MSDN: "Frees the loaded dynamic-link library (DLL) module and, if
necessary, decrements its reference count. When the reference
count reaches zero, the module is unloaded from the address space
of the calling process and the handle is no longer valid."</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">BOOL</span> <span class="org-function-name">FreeLibrary</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">HMODULE</span> <span class="org-variable-name">hLibModule</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8e3a986" class="outline-3">
<h3 id="org8e3a986"><span class="section-number-3">1.15</span> Books</h3>
<div class="outline-text-3" id="text-1-15">
<p>
Books: 
</p>

<ul class="org-ul">
<li>Mark Russinovitch et al - <b>Windows Internals</b> - 5th edition -
Microsft Press 2000.</li>

<li><b>Windows Operating System Internals Curriculum</b>  Development Kit,
developed by David A. Solomon and  Mark E. Russinovich with
Andreas Polze.</li>

<li>Penny Orwick and Guy Smith. <b>Developing Drivers with Windows Driver Foundation</b>.</li>

<li>Charles Petzold: <b>Windows Programming</b> - Microsoft Press.</li>

<li>Visual Basic - <b>Programmer’s Guide to the Win32 API</b>, The
Authoritative Solution by Dan Appleman</li>

<li>Johnson M. Hart, <b>Win32 System Programming: A Windows® 2000</b> -
<b>Application Developer's Guide</b>, 2nd Edition, Addison -
Wesley, 2000.
<ul class="org-ul">
<li>Note: This book discusses select Windows programming problems
and addresses  the problem of portable programming by comparing
Windows and Unixapproaches.</li>
</ul></li>

<li>Jeffrey Richter, <b>Programming Applications for Microsoft Windows</b>,
4th Edition, Microsoft Press, September 1999.
<ul class="org-ul">
<li>Note: This book provides a comprehensive discussion of the
Windows API suggested reading.</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-12-09 Sun 15:12</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
